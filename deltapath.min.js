/*! For license information please see out.min.js.LICENSE.txt */
!function(){var e={9742:function(e,t){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,s=c(e),o=s[0],a=s[1],l=new r(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),u=0,p=a>0?o-4:o;for(n=0;n<p;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,l[u++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t);return l},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,s=[],o=16383,a=0,c=i-r;a<c;a+=o)s.push(l(e,a,a+o>c?c:a+o));1===r?(t=e[i-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return s.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)n[o]=s[o],i[s.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,i){for(var r,s,o=[],a=t;a<i;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(s=r)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},8764:function(e,t,n){"use strict";const i=n(9742),r=n(645),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return p(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|m(e,t);let i=a(n);const r=i.write(e,t);r!==n&&(i=i.slice(0,r));return i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(W(e,Uint8Array)){const t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(W(e,ArrayBuffer)||e&&W(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(W(e,SharedArrayBuffer)||e&&W(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return c.from(i,t,n);const r=function(e){if(c.isBuffer(e)){const t=0|f(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||Q(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function p(e){return u(e),a(e<0?0:0|f(e))}function d(e){const t=e.length<0?0:0|f(e.length),n=a(t);for(let i=0;i<t;i+=1)n[i]=255&e[i];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(i,c.prototype),i}function f(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function m(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||W(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return $(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return i?-1:$(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){let i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function y(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function v(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Q(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=c.from(t,i)),c.isBuffer(t))return 0===t.length?-1:b(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,i,r){let s,o=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){let i=-1;for(s=n;s<a;s++)if(l(e,s)===l(t,-1===i?0:s-i)){if(-1===i&&(i=s),s-i+1===c)return i*o}else-1!==i&&(s-=s-i),i=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){let n=!0;for(let i=0;i<c;i++)if(l(e,s+i)!==l(t,i)){n=!1;break}if(n)return s}return-1}function _(e,t,n,i){n=Number(n)||0;const r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;const s=t.length;let o;for(i>s/2&&(i=s/2),o=0;o<i;++o){const i=parseInt(t.substr(2*o,2),16);if(Q(i))return o;e[n+o]=i}return o}function w(e,t,n,i){return H($(t,e.length-n),e,n,i)}function S(e,t,n,i){return H(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function x(e,t,n,i){return H(V(t),e,n,i)}function T(e,t,n,i){return H(function(e,t){let n,i,r;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),i=n>>8,r=n%256,s.push(r),s.push(i);return s}(t,e.length-n),e,n,i)}function E(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);const i=[];let r=t;for(;r<n;){const t=e[r];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(r+o<=n){let n,i,a,c;switch(o){case 1:t<128&&(s=t);break;case 2:n=e[r+1],128==(192&n)&&(c=(31&t)<<6|63&n,c>127&&(s=c));break;case 3:n=e[r+1],i=e[r+2],128==(192&n)&&128==(192&i)&&(c=(15&t)<<12|(63&n)<<6|63&i,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:n=e[r+1],i=e[r+2],a=e[r+3],128==(192&n)&&128==(192&i)&&128==(192&a)&&(c=(15&t)<<18|(63&n)<<12|(63&i)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),r+=o}return function(e){const t=e.length;if(t<=N)return String.fromCharCode.apply(String,e);let n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=N));return n}(i)}t.kMaxLength=o,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},c.allocUnsafe=function(e){return p(e)},c.allocUnsafeSlow=function(e){return p(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(W(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),W(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const i=c.allocUnsafe(t);let r=0;for(n=0;n<e.length;++n){let t=e[n];if(W(t,Uint8Array))r+t.length>i.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(i,r)):Uint8Array.prototype.set.call(i,t,r);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(i,r)}r+=t.length}return i},c.byteLength=m,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)y(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):g.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(c.prototype[s]=c.prototype.inspect),c.prototype.compare=function(e,t,n,i,r){if(W(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;let s=(r>>>=0)-(i>>>=0),o=(n>>>=0)-(t>>>=0);const a=Math.min(s,o),l=this.slice(i,r),u=e.slice(t,n);for(let e=0;e<a;++e)if(l[e]!==u[e]){s=l[e],o=u[e];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},c.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}const r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let s=!1;for(;;)switch(i){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return S(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const N=4096;function k(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function A(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function O(e,t,n){const i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);let r="";for(let i=t;i<n;++i)r+=K[e[i]];return r}function j(e,t,n){const i=e.slice(t,n);let r="";for(let e=0;e<i.length-1;e+=2)r+=String.fromCharCode(i[e]+256*i[e+1]);return r}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,i,r,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function P(e,t,n,i,r){G(t,i,r,e,n,7);let s=Number(t&BigInt(4294967295));e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function L(e,t,n,i,r){G(t,i,r,e,n,7);let s=Number(t&BigInt(4294967295));e[n+7]=s,s>>=8,e[n+6]=s,s>>=8,e[n+5]=s,s>>=8,e[n+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function M(e,t,n,i,r,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,i,s){return t=+t,n>>>=0,s||M(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function D(e,t,n,i,s){return t=+t,n>>>=0,s||M(e,0,n,8),r.write(e,t,n,i,52,8),n+8}c.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const i=this.subarray(e,t);return Object.setPrototypeOf(i,c.prototype),i},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||C(e,t,this.length);let i=this[e],r=1,s=0;for(;++s<t&&(r*=256);)i+=this[e+s]*r;return i},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||C(e,t,this.length);let i=this[e+--t],r=1;for(;t>0&&(r*=256);)i+=this[e+--t]*r;return i},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||C(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||C(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||C(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=Y((function(e){J(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const i=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,r=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(i)+(BigInt(r)<<BigInt(32))})),c.prototype.readBigUInt64BE=Y((function(e){J(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const i=t*2**24+65536*this[++e]+256*this[++e]+this[++e],r=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)})),c.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||C(e,t,this.length);let i=this[e],r=1,s=0;for(;++s<t&&(r*=256);)i+=this[e+s]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},c.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||C(e,t,this.length);let i=t,r=1,s=this[e+--i];for(;i>0&&(r*=256);)s+=this[e+--i]*r;return r*=128,s>=r&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return e>>>=0,t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||C(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){e>>>=0,t||C(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=Y((function(e){J(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const i=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=Y((function(e){J(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||z(e,this.length-8);const i=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||C(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||C(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||C(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||C(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t>>>=0,n>>>=0,!i){R(this,e,t,n,Math.pow(2,8*n)-1,0)}let r=1,s=0;for(this[t]=255&e;++s<n&&(r*=256);)this[t+s]=e/r&255;return t+n},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t>>>=0,n>>>=0,!i){R(this,e,t,n,Math.pow(2,8*n)-1,0)}let r=n-1,s=1;for(this[t+r]=255&e;--r>=0&&(s*=256);)this[t+r]=e/s&255;return t+n},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=Y((function(e,t=0){return P(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=Y((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}let r=0,s=1,o=0;for(this[t]=255&e;++r<n&&(s*=256);)e<0&&0===o&&0!==this[t+r-1]&&(o=1),this[t+r]=(e/s>>0)-o&255;return t+n},c.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}let r=n-1,s=1,o=0;for(this[t+r]=255&e;--r>=0&&(s*=256);)e<0&&0===o&&0!==this[t+r+1]&&(o=1),this[t+r]=(e/s>>0)-o&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=Y((function(e,t=0){return P(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=Y((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,i){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);const r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},c.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){const t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let r;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{const s=c.isBuffer(e)?e:c.from(e,i),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=s[r%o]}return this};const q={};function U(e,t,n){q[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function B(e){let t="",n=e.length;const i="-"===e[0]?1:0;for(;n>=i+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function G(e,t,n,i,r,s){if(e>n||e<t){const i="bigint"==typeof t?"n":"";let r;throw r=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(s+1)}${i}`:`>= -(2${i} ** ${8*(s+1)-1}${i}) and < 2 ** ${8*(s+1)-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new q.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){J(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||z(t,e.length-(n+1))}(i,r,s)}function J(e,t){if("number"!=typeof e)throw new q.ERR_INVALID_ARG_TYPE(t,"number",e)}function z(e,t,n){if(Math.floor(e)!==e)throw J(e,n),new q.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new q.ERR_BUFFER_OUT_OF_BOUNDS;throw new q.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}U("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),U("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),U("ERR_OUT_OF_RANGE",(function(e,t,n){let i=`The value of "${e}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>2**32?r=B(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=B(r)),r+="n"),i+=` It must be ${t}. Received ${r}`,i}),RangeError);const X=/[^+/0-9A-Za-z-_]/g;function $(e,t){let n;t=t||1/0;const i=e.length;let r=null;const s=[];for(let o=0;o<i;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function V(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(X,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,n,i){let r;for(r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function W(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Q(e){return e!=e}const K=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const i=16*n;for(let r=0;r<16;++r)t[i+r]=e[n]+e[r]}return t}();function Y(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},6497:function(e,t,n){function i(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===i(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===i(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===i(e)},t.isError=function(e){return"[object Error]"===i(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(8764).Buffer.isBuffer},7187:function(e){"use strict";var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,s),i(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}m(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,n)}(e,r,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,n,i){var r,s,o,l;if(a(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=c(e))>0&&o.length>r&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,l=u,console&&console.warn&&console.warn(l)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=u.bind(i);return r.listener=n,i.wrapFn=r,r}function d(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):f(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){i.once&&e.removeEventListener(t,r),n(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var l=c.length,u=f(c,l);for(n=0;n<l;++n)i(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,i,r,s,o;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},2241:function(e,t,n){var i=n(8203),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},7029:function(e,t,n){var i=n(5601),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},6940:function(e,t,n){var i=n(5600),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},8949:function(e,t,n){var i=n(8519),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},1694:function(e,t,n){var i=n(2210),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},3082:function(e,t,n){var i=n(871),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},172:function(e,t,n){var i=n(1444),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},7848:function(e,t,n){var i=n(8404),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},956:function(e,t,n){var i=n(3286),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},2729:function(e,t,n){var i=n(1402),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},5836:function(e,t,n){var i=n(893),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},2526:function(e,t,n){var i=n(1867),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},2456:function(e,t,n){var i=n(2918),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},3046:function(e,t,n){var i=n(2593),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},2023:function(e,t,n){var i=n(9049),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},9566:function(e,t,n){var i=n(696),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},5910:function(e,t,n){var i=n(239),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},9420:function(e,t,n){var i=n(1192),r=n(7672),s=i.Deltapath;r.Deltapath=s,e.exports=i},7672:function(e,t,n){"use strict";e.exports=function(){if("object"==typeof globalThis)return globalThis;var e;try{e=this||new Function("return this")()}catch(e){if("object"==typeof window)return window;if("object"==typeof self)return self;if(void 0!==n.g)return n.g}return e}()},645:function(e,t){t.read=function(e,t,n,i,r){var s,o,a=8*r-i-1,c=(1<<a)-1,l=c>>1,u=-7,p=n?r-1:0,d=n?-1:1,h=e[t+p];for(p+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=256*s+e[t+p],p+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=256*o+e[t+p],p+=d,u-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,i),s-=l}return(h?-1:1)*o*Math.pow(2,s-i)},t.write=function(e,t,n,i,r,s){var o,a,c,l=8*s-r-1,u=(1<<l)-1,p=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:s-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+p>=1?d/c:d*Math.pow(2,1-p))*c>=2&&(o++,c/=2),o+p>=u?(a=0,o=u):o+p>=1?(a=(t*c-1)*Math.pow(2,r),o+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,r),o=0));r>=8;e[n+h]=255&a,h+=f,a/=256,r-=8);for(o=o<<r|a,l+=r;l>0;e[n+h]=255&o,h+=f,o/=256,l-=8);e[n+h-f]|=128*m}},5717:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},5826:function(e){var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},8212:function(e,t,n){"use strict";var i=n(4155);void 0===i||!i.version||0===i.version.indexOf("v0.")||0===i.version.indexOf("v1.")&&0!==i.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,n,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return i.nextTick(e);case 2:return i.nextTick((function(){e.call(null,t)}));case 3:return i.nextTick((function(){e.call(null,t,n)}));case 4:return i.nextTick((function(){e.call(null,t,n,r)}));default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return i.nextTick((function(){e.apply(null,s)}))}}}:e.exports=i},4155:function(e){var t,n,i=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a,c=[],l=!1,u=-1;function p(){l&&a&&(l=!1,a.length?c=a.concat(c):u=-1,c.length&&d())}function d(){if(!l){var e=o(p);l=!0;for(var t=c.length;t;){for(a=c,c=[];++u<t;)a&&a[u].run();u=-1,t=c.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||o(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},6753:function(e,t,n){"use strict";var i=n(8212),r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=p;var s=Object.create(n(6497));s.inherits=n(5717);var o=n(9481),a=n(4229);s.inherits(p,o);for(var c=r(a.prototype),l=0;l<c.length;l++){var u=c[l];p.prototype[u]||(p.prototype[u]=a.prototype[u])}function p(e){if(!(this instanceof p))return new p(e);o.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||i.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(p.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(p.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),p.prototype._destroy=function(e,t){this.push(null),this.end(),i.nextTick(t,e)}},2725:function(e,t,n){"use strict";e.exports=s;var i=n(4605),r=Object.create(n(6497));function s(e){if(!(this instanceof s))return new s(e);i.call(this,e)}r.inherits=n(5717),r.inherits(s,i),s.prototype._transform=function(e,t,n){n(null,e)}},9481:function(e,t,n){"use strict";var i=n(4155),r=n(8212);e.exports=b;var s,o=n(5826);b.ReadableState=v;n(7187).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(2503),l=n(3545).Buffer,u=n.g.Uint8Array||function(){};var p=Object.create(n(6497));p.inherits=n(5717);var d=n(4616),h=void 0;h=d&&d.debuglog?d.debuglog("stream"):function(){};var f,m=n(5057),g=n(1195);p.inherits(b,c);var y=["error","close","destroy","pause","resume"];function v(e,t){e=e||{};var i=t instanceof(s=s||n(6753));this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,o=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(f||(f=n(2553).s),this.decoder=new f(e.encoding),this.encoding=e.encoding)}function b(e){if(s=s||n(6753),!(this instanceof b))return new b(e);this._readableState=new v(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function _(e,t,n,i,r){var s,o=e._readableState;null===t?(o.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,T(e)}(e,o)):(r||(s=function(e,t){var n;i=t,l.isBuffer(i)||i instanceof u||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var i;return n}(o,t)),s?e.emit("error",s):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),i?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?w(e,o,t,!1):I(e,o)):w(e,o,t,!1))):i||(o.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function w(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&T(e)),I(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=l.from(e,t),t=""),n=!0),_(this,e,t,!1,n)},b.prototype.unshift=function(e){return _(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return f||(f=n(2553).s),this._readableState.decoder=new f(e),this._readableState.encoding=e,this};var S=8388608;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=S?e=S:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(E,e):E(e))}function E(e){h("emit readable"),e.emit("readable"),O(e)}function I(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(N,e,t))}function N(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function k(e){h("readable nexttick read 0"),e.read(0)}function A(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),O(e),t.flowing&&!t.reading&&e.read(0)}function O(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function j(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,r=n.data;e-=r.length;for(;n=n.next;){var s=n.data,o=e>s.length?s.length:e;if(o===s.length?r+=s:r+=s.slice(0,e),0===(e-=o)){o===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(o));break}++i}return t.length-=i,r}(e,t):function(e,t){var n=l.allocUnsafe(e),i=t.head,r=1;i.data.copy(n),e-=i.data.length;for(;i=i.next;){var s=i.data,o=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,o),0===(e-=o)){o===s.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=s.slice(o));break}++r}return t.length-=r,n}(e,t);return i}(e,t.buffer,t.decoder),n);var n}function C(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(R,t,e))}function R(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function P(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?C(this):T(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&C(this),null;var i,r=t.needReadable;return h("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",r=!0),t.ended||t.reading?h("reading or ended",r=!1):r&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(n,t))),null===(i=e>0?j(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&C(this)),null!==i&&this.emit("data",i),i},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,h("pipe count=%d opts=%j",s.pipesCount,t);var c=(!t||!1!==t.end)&&e!==i.stdout&&e!==i.stderr?u:b;function l(t,i){h("onunpipe"),t===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,h("cleanup"),e.removeListener("close",y),e.removeListener("finish",v),e.removeListener("drain",p),e.removeListener("error",g),e.removeListener("unpipe",l),n.removeListener("end",u),n.removeListener("end",b),n.removeListener("data",m),d=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||p())}function u(){h("onend"),e.end()}s.endEmitted?r.nextTick(c):n.once("end",c),e.on("unpipe",l);var p=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,O(e))}}(n);e.on("drain",p);var d=!1;var f=!1;function m(t){h("ondata"),f=!1,!1!==e.write(t)||f||((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==P(s.pipes,e))&&!d&&(h("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,f=!0),n.pause())}function g(t){h("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",v),b()}function v(){h("onfinish"),e.removeListener("close",y),b()}function b(){h("unpipe"),n.unpipe(e)}return n.on("data",m),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",y),e.once("finish",v),e.emit("pipe",n),s.flowing||(h("pipe resume"),n.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<r;s++)i[s].emit("unpipe",this,n);return this}var o=P(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},b.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&T(this):r.nextTick(k,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(A,e,t))}(this,e)),this},b.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var r in e.on("end",(function(){if(h("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){(h("wrapped data"),n.decoder&&(r=n.decoder.write(r)),n.objectMode&&null==r)||(n.objectMode||r&&r.length)&&(t.push(r)||(i=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var s=0;s<y.length;s++)e.on(y[s],this.emit.bind(this,y[s]));return this._read=function(t){h("wrapped _read",t),i&&(i=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=j},4605:function(e,t,n){"use strict";e.exports=o;var i=n(6753),r=Object.create(n(6497));function s(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);i.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){c(e,t,n)})):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}r.inherits=n(5717),r.inherits(o,i),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,i.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;i.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},4229:function(e,t,n){"use strict";var i=n(4155),r=n(8212);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;e.entry=null;for(;i;){var r=i.callback;t.pendingcb--,r(n),i=i.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var o,a=!i.browser&&["v0.10","v0.9."].indexOf(i.version.slice(0,5))>-1?setImmediate:r.nextTick;y.WritableState=g;var c=Object.create(n(6497));c.inherits=n(5717);var l={deprecate:n(4927)},u=n(2503),p=n(3545).Buffer,d=n.g.Uint8Array||function(){};var h,f=n(1195);function m(){}function g(e,t){o=o||n(6753),e=e||{};var i=t instanceof o;this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var c=e.highWaterMark,l=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=c||0===c?c:i&&(l||0===l)?l:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var p=!1===e.decodeStrings;this.decodeStrings=!p,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,s=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,s){--t.pendingcb,n?(r.nextTick(s,i),r.nextTick(x,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(s(i),e._writableState.errorEmitted=!0,e.emit("error",i),x(e,t))}(e,n,i,t,s);else{var o=w(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),i?a(b,e,n,o,s):b(e,n,o,s)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function y(e){if(o=o||n(6753),!(h.call(y,this)||this instanceof o))return new y(e);this._writableState=new g(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),u.call(this)}function v(e,t,n,i,r,s,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,s,t.onwrite),t.sync=!1}function b(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),x(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)r[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;r.allBuffers=c,v(e,t,!0,t.length,r,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,u=n.encoding,p=n.callback;if(v(e,t,!1,t.objectMode?1:l.length,l,u,p),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function w(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),x(e,t)}))}function x(e,t){var n=w(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,r.nextTick(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}c.inherits(y,u),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:l.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(h=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!h.call(this,e)||this===y&&(e&&e._writableState instanceof g)}})):h=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var i,s=this._writableState,o=!1,a=!s.objectMode&&(i=e,p.isBuffer(i)||i instanceof d);return a&&!p.isBuffer(e)&&(e=function(e){return p.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof n&&(n=m),s.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),r.nextTick(t,n)}(this,n):(a||function(e,t,n,i){var s=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),r.nextTick(i,o),s=!1),s}(this,s,e,n))&&(s.pendingcb++,o=function(e,t,n,i,r,s){if(!n){var o=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=p.from(t,n));return t}(t,i,r);i!==o&&(n=!0,r="buffer",i=o)}var a=t.objectMode?1:i.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:s,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,a,i,r,s);return c}(this,s,a,e,t,n)),o},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,x(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=f.destroy,y.prototype._undestroy=f.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}},5057:function(e,t,n){"use strict";var i=n(3545).Buffer,r=n(2361);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t,n,r,s=i.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=s,r=a,t.copy(n,r),a+=o.data.length,o=o.next;return s},e}(),r&&r.inspect&&r.inspect.custom&&(e.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},1195:function(e,t,n){"use strict";var i=n(8212);function r(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(r,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(i.nextTick(r,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},2503:function(e,t,n){e.exports=n(7187).EventEmitter},3545:function(e,t,n){var i=n(8764),r=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(s(i,t),t.Buffer=o),s(r,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},8473:function(e,t,n){(t=e.exports=n(9481)).Stream=t,t.Readable=t,t.Writable=n(4229),t.Duplex=n(6753),t.Transform=n(4605),t.PassThrough=n(2725)},7539:function(e){"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n=i[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substr(12),password:r.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");for(let r=3;r<i.length;r++){const s=i[r],o=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){const i=t.parseRtpMap(o),r=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=o.length>0&&o[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(c=l[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const s=t.matchPrefix(e,"a=rtcp-mux");return n.mux=s.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substr(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substr(19),10)),isNaN(r)&&(r=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:n.fmt,maxMessageSize:r};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,i){let r;const s=void 0!==n?n:2;r=e||t.generateSessionId();return"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t},4889:function(e,t,n){var i=n(4155);!function(e,t){"use strict";if(!e.setImmediate){var n,r,s,o,a,c=1,l={},u=!1,p=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?n=function(e){i.nextTick((function(){f(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){f(e.data)},n=function(e){s.port2.postMessage(e)}):p&&"onreadystatechange"in p.createElement("script")?(r=p.documentElement,n=function(e){var t=p.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):n=function(e){setTimeout(f,0,e)}:(o="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&f(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(o+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var r={callback:e,args:t};return l[c]=r,n(c),c++},d.clearImmediate=h}function h(e){delete l[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{h(e),u=!1}}}}}("undefined"==typeof self?void 0===n.g?this:n.g:self)},3322:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.directionToSenders=t.sendersToDirection=t.JINGLE_INFO_RECEIVED_5=t.JINGLE_INFO_CHECKSUM_5=t.JINGLE_INFO_RINGING=t.JINGLE_INFO_ACTIVE=t.JINGLE_INFO_UNHOLD=t.JINGLE_INFO_HOLD=t.JINGLE_INFO_UNMUTE=t.JINGLE_INFO_MUTE=t.JINGLE_INFO=t.USER_ACTIVITY_SPECIFIC=t.USER_ACTIVITY_GENERAL=t.USER_MOODS=t.JingleReasonCondition=t.JingleErrorCondition=t.JingleAction=t.JingleContentSenders=t.JingleApplicationDirection=t.JingleSessionRole=t.ChatState=t.PubsubErrorCondition=t.MUCStatusCode=t.MUCRole=t.MUCAffiliation=t.DataFormFieldType=t.DataFormType=t.RosterSubscription=t.PresenceShow=t.IQType=t.PresenceType=t.MessageType=t.StanzaErrorCondition=t.StreamErrorCondition=t.SASLFailureCondition=t.StreamType=t.VERSION=void 0;const i=n(1595);t.VERSION="12.17.2";const r="not-authorized";t.StreamType={Bosh:i.NS_BOSH,Client:i.NS_CLIENT,Component:i.NS_COMPONENT,Server:i.NS_SERVER},t.SASLFailureCondition={AccountDisabled:"account-disabled",CredentialsExpired:"credentials-expired",EncryptionRequired:"encryption-required",IncorrectEncoding:"incorrect-encoding",InvalidAuthzid:"invalid-authzid",InvalidMechanism:"invalid-mechanism",MalformedRequest:"malformed-request",MechanismTooWeak:"mechanism-too-weak",NotAuthorized:r,TemporaryAuthFailure:"temporary-auth-failure"},t.StreamErrorCondition={BadFormat:"bad-format",BadNamespacePrefix:"bad-namespace-prefix",Conflict:"conflict",ConnectionTimeout:"connection-timeout",HostGone:"host-gone",HostUnknown:"host-unknown",ImproperAddressing:"improper-addressing",InternalServerError:"internal-server-error",InvalidFrom:"invalid-from",InvalidId:"invalid-id",InvalidNamespace:"invalid-namespace",InvalidXML:"invalid-xml",NotAuthorized:r,NotWellFormed:"not-well-formed",PolicyViolation:"policy-violation",RemoteConnectionFailed:"remote-connection-failed",Reset:"reset",ResourceConstraint:"resource-constraint",RestrictedXML:"restricted-xml",SeeOtherHost:"see-other-host",SystemShutdown:"system-shutdown",UndefinedCondition:"undefined-condition",UnsupportedEncoding:"unsupported-encoding",UnsupportedStanzaType:"unsupported-stanza-type",UnsupportedVersion:"unsupported-version"},t.StanzaErrorCondition={BadRequest:"bad-request",Conflict:"conflict",FeatureNotImplemented:"feature-not-implemented",Forbidden:"forbidden",Gone:"gone",InternalServerError:"internal-server-error",ItemNotFound:"item-not-found",JIDMalformed:"jid-malformed",NotAcceptable:"not-acceptable",NotAllowed:"not-allowed",NotAuthorized:r,PolicyViolation:"policy-violation",RecipientUnavailable:"recipient-unavailable",Redirect:"redirect",RegistrationRequired:"registration-required",RemoteServerNotFound:"remote-server-not-found",RemoteServerTimeout:"remote-server-timeout",ResourceConstraint:"resource-constraint",ServiceUnavailable:"service-unavailable",SubscriptionRequired:"subscription-required",UndefinedCondition:"undefined-condition",UnexpectedRequest:"unexpected-request"},t.MessageType={Chat:"chat",Error:"error",GroupChat:"groupchat",Headline:"headline",Normal:"normal"},t.PresenceType={Available:void 0,Error:"error",Probe:"probe",Subscribe:"subscribe",Subscribed:"subscribed",Unavailable:"unavailable",Unsubscribe:"unsubscribe",Unsubscribed:"unsubscribed"},t.IQType={Error:"error",Get:"get",Result:"result",Set:"set"},t.PresenceShow={Away:"away",Chat:"chat",DoNotDisturb:"dnd",ExtendedAway:"xa"},t.RosterSubscription={Both:"both",From:"from",None:"none",ReceivePresenceOnly:"to",Remove:"remove",SendAndReceivePresence:"both",SendPresenceOnly:"from",To:"to"},t.DataFormType={Cancel:"cancel",Form:"form",Result:"result",Submit:"submit"},t.DataFormFieldType={Boolean:"boolean",Fixed:"fixed",Hidden:"hidden",JID:"jid-single",JIDMultiple:"jid-multi",List:"list-single",ListMultiple:"list-multi",Password:"text-private",Text:"text-single",TextMultiple:"text-multi",TextPrivate:"text-private"},t.MUCAffiliation={Admin:"admin",Banned:"outcast",Member:"member",None:"none",Outcast:"outcast",Owner:"owner"},t.MUCRole={Moderator:"moderator",None:"none",Participant:"participant",Visitor:"visitor"},t.MUCStatusCode={AffiliationChanged:"101",AffiliationLost:"321",Banned:"301",Error:"333",Kicked:"307",LoggingDisabled:"171",LoggingEnabled:"170",MembershipLost:"322",NickChanged:"303",NickChangedByService:"210",NonAnonymous:"172",NonAnonymousRoom:"100",NonPrivacyConfigurationChange:"104",RoomCreated:"201",SelfPresence:"110",SemiAnonymous:"173",Shutdown:"332",UnavailableMembersListed:"102",UnavailableMembersNotListed:"103"},t.PubsubErrorCondition={ClosedNode:"closed-node",ConfigurationRequired:"configuration-required",InvalidJID:"invalid-jid",InvalidOptions:"invalid-options",InvalidPayload:"invalid-payload",InvalidSubscriptionId:"invalid-subid",ItemForbidden:"item-forbidden",ItemRequired:"item-required",JIDRequired:"jid-required",MaxItemsExceeded:"max-items-exceeded",MaxNodesExceeded:"max-nodes-exceeded",NodeIdRequired:"nodeid-required",NotInRosterGroup:"not-in-roster-group",NotSubscribed:"not-subscribed",PayloadRequired:"payload-required",PayloadTooBig:"payload-too-big",PendingSubscription:"pending-subscription",PresenceSubscriptionRequired:"presence-subscription-required",SubscriptionIdRequired:"subid-required",TooManySubscriptions:"too-many-subscriptions",Unsupported:"unsupported",UnsupportedAccessModel:"unsupported-access-model"},t.ChatState={Active:"active",Composing:"composing",Gone:"gone",Inactive:"inactive",Paused:"paused"},t.JingleSessionRole={Initiator:"initiator",Responder:"responder"},t.JingleApplicationDirection={Inactive:"inactive",Receive:"recvonly",Send:"sendonly",SendReceive:"sendrecv"},t.JingleContentSenders={Both:"both",Initiator:"initiator",None:"none",Responder:"responder"},t.JingleAction={ContentAccept:"content-accept",ContentAdd:"content-add",ContentModify:"content-modify",ContentReject:"content-reject",ContentRemove:"content-remove",DescriptionInfo:"description-info",SecurityInfo:"security-info",SessionAccept:"session-accept",SessionInfo:"session-info",SessionInitiate:"session-initiate",SessionTerminate:"session-terminate",TransportAccept:"transport-accept",TransportInfo:"transport-info",TransportReject:"transport-reject",TransportReplace:"transport-replace"},t.JingleErrorCondition={OutOfOrder:"out-of-order",TieBreak:"tie-break",UnknownContent:"unknown-content",UnknownSession:"unknown-session",UnsupportedInfo:"unsupported-info"},t.JingleReasonCondition={AlternativeSession:"alternative-session",Busy:"busy",Cancel:"cancel",ConnectivityError:"connectivity-error",Decline:"decline",Expired:"expired",FailedApplication:"failed-application",FailedTransport:"failed-transport",GeneralError:"general-error",Gone:"gone",IncompatibleParameters:"incompatible-parameters",MediaError:"media-error",SecurityError:"security-error",Success:"success",Timeout:"timeout",UnsupportedApplications:"unsupported-applications",UnsupportedTransports:"unsupported-transports"},t.USER_MOODS=["afraid","amazed","amorous","angry","annoyed","anxious","aroused","ashamed","bored","brave","calm","cautious","cold","confident","confused","contemplative","contented","cranky","crazy","creative","curious","dejected","depressed","disappointed","disgusted","dismayed","distracted","embarrassed","envious","excited","flirtatious","frustrated","grateful","grieving","grumpy","guilty","happy","hopeful","hot","humbled","humiliated","hungry","hurt","impressed","in_awe","in_love","indignant","interested","intoxicated","invincible","jealous","lonely","lost","lucky","mean","moody","nervous","neutral","offended","outraged","playful","proud","relaxed","relieved","remorseful","restless","sad","sarcastic","satisfied","serious","shocked","shy","sick","sleepy","spontaneous","stressed","strong","surprised","thankful","thirsty","tired","undefined","weak","worried"],t.USER_ACTIVITY_GENERAL=["doing_chores","drinking","eating","exercising","grooming","having_appointment","inactive","relaxing","talking","traveling","undefined","working"],t.USER_ACTIVITY_SPECIFIC=["at_the_spa","brushing_teeth","buying_groceries","cleaning","coding","commuting","cooking","cycling","cycling","dancing","day_off","doing_maintenance","doing_the_dishes","doing_the_laundry","driving","fishing","gaming","gardening","getting_a_haircut","going_out","hanging_out","having_a_beer","having_a_snack","having_breakfast","having_coffee","having_dinner","having_lunch","having_tea","hiding","hiking","in_a_car","in_a_meeting","in_real_life","jogging","on_a_bus","on_a_plane","on_a_train","on_a_trip","on_the_phone","on_vacation","on_video_phone","other","partying","playing_sports","praying","reading","rehearsing","running","running_an_errand","scheduled_holiday","shaving","shopping","skiing","sleeping","smoking","socializing","studying","sunbathing","swimming","taking_a_bath","taking_a_shower","thinking","walking","walking_the_dog","watching_a_movie","watching_tv","working_out","writing"];t.JINGLE_INFO=(e,t)=>`{${e}}${t}`,t.JINGLE_INFO_MUTE=t.JINGLE_INFO(i.NS_JINGLE_RTP_INFO_1,"mute"),t.JINGLE_INFO_UNMUTE=t.JINGLE_INFO(i.NS_JINGLE_RTP_INFO_1,"unmute"),t.JINGLE_INFO_HOLD=t.JINGLE_INFO(i.NS_JINGLE_RTP_INFO_1,"hold"),t.JINGLE_INFO_UNHOLD=t.JINGLE_INFO(i.NS_JINGLE_RTP_INFO_1,"unhold"),t.JINGLE_INFO_ACTIVE=t.JINGLE_INFO(i.NS_JINGLE_RTP_INFO_1,"active"),t.JINGLE_INFO_RINGING=t.JINGLE_INFO(i.NS_JINGLE_RTP_INFO_1,"ringing"),t.JINGLE_INFO_CHECKSUM_5=t.JINGLE_INFO(i.NS_JINGLE_FILE_TRANSFER_5,"checksum"),t.JINGLE_INFO_RECEIVED_5=t.JINGLE_INFO(i.NS_JINGLE_FILE_TRANSFER_5,"received"),t.sendersToDirection=function(e,n=t.JingleContentSenders.Both){const i=e===t.JingleSessionRole.Initiator;switch(n){case t.JingleContentSenders.Initiator:return i?t.JingleApplicationDirection.Send:t.JingleApplicationDirection.Receive;case t.JingleContentSenders.Responder:return i?t.JingleApplicationDirection.Receive:t.JingleApplicationDirection.Send;case t.JingleContentSenders.Both:return t.JingleApplicationDirection.SendReceive}return t.JingleApplicationDirection.Inactive},t.directionToSenders=function(e,n=t.JingleApplicationDirection.SendReceive){const i=e===t.JingleSessionRole.Initiator;switch(n){case t.JingleApplicationDirection.Send:return i?t.JingleContentSenders.Initiator:t.JingleContentSenders.Responder;case t.JingleApplicationDirection.Receive:return i?t.JingleContentSenders.Responder:t.JingleContentSenders.Initiator;case t.JingleApplicationDirection.SendReceive:return t.JingleContentSenders.Both}return t.JingleContentSenders.None}},1595:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NS_AVATAR_METADATA=t.NS_AVATAR_DATA=t.NS_ROSTER_DELIMITER=t.NS_GEOLOC=t.NS_AMP=t.NS_INBAND_REGISTRATION=t.NS_REGISTER=t.NS_XHTML_IM=t.NS_XHTML=t.NS_HTTP_AUTH=t.NS_OOB_TRANSFER=t.NS_OOB=t.NS_SOCKS5=t.NS_PUBSUB_OWNER=t.NS_PUBSUB_EVENT=t.NS_PUBSUB_ERRORS=t.NS_PUBSUB=t.NS_RSM=t.NS_SEARCH=t.NS_VCARD_TEMP=t.NS_ADHOC_COMMANDS=t.NS_PRIVATE=t.NS_BOOKMARKS=t.NS_IBB=t.NS_MUC_USER=t.NS_MUC_OWNER=t.NS_MUC_ADMIN=t.NS_MUC=t.NS_ADDRESS=t.NS_DISCO_ITEMS=t.NS_DISCO_INFO=t.NS_LEGACY_CHAT_EVENTS=t.NS_PRIVACY=t.NS_LAST_ACTIVITY=t.NS_RPC=t.NS_DATAFORM=t.NS_FRAMING=t.NS_SUBSCRIPTION_PREAPPROVAL=t.NS_ROSTER_VERSIONING=t.NS_ROSTER=t.NS_STARTTLS=t.NS_STREAMS=t.NS_STREAM=t.NS_STANZAS=t.NS_SESSION=t.NS_SERVER=t.NS_SASL=t.NS_CLIENT=t.NS_BIND=t.NS_ATOM=void 0,t.NS_JINGLE_FILE_TRANSFER_4=t.NS_JINGLE_FILE_TRANSFER_3=t.NS_SOFTWARE_INFO=t.NS_BOB=t.NS_ATTENTION_0=t.NS_DATAFORM_MEDIA=t.NS_DISCO_EXTERNAL_2=t.NS_DISCO_EXTERNAL_1=t.NS_BOSH_XMPP=t.NS_DELAY=t.NS_TIME=t.NS_PING=t.NS_SMACKS_3=t.NS_BLOCKING_ERRORS=t.NS_BLOCKING=t.NS_INVISIBLE_0=t.NS_RECEIPTS=t.NS_JINGLE_RAW_UDP_1=t.NS_JINGLE_ICE_UDP_1=t.NS_NICK=t.NS_LANG_TRANS_ITEMS=t.NS_LANG_TRANS=t.NS_JINGLE_RTP_VIDEO=t.NS_JINGLE_RTP_AUDIO=t.NS_JINGLE_RTP_INFO_1=t.NS_JINGLE_RTP_ERRORS_1=t.NS_JINGLE_RTP_1=t.NS_JINGLE_ERRORS_1=t.NS_JINGLE_1=t.NS_PEP_NOTIFY=t.NS_CAPTCHA=t.NS_ALT_CONNECTIONS_XBOSH=t.NS_ALT_CONNECTIONS_WEBSOCKET=t.NS_VCARD_TEMP_UPDATE=t.NS_REACH_0=t.NS_ROSTER_NOTES=t.NS_ROSTER_EXCHANGE=t.NS_DATAFORM_LAYOUT=t.NS_COMPRESSION=t.NS_COMPRESSION_FEATURE=t.NS_SHIM=t.NS_BOSH=t.NS_DATAFORM_VALIDATION=t.NS_TUNE=t.NS_DISCO_LEGACY_CAPS=t.NS_COMPONENT=t.NS_ACTIVITY=t.NS_MOOD=t.NS_VERSION=t.NS_CHAT_STATES=void 0,t.NS_OMEMO_AXOLOTL=t.NS_SPOILER_0=t.NS_EME_0=t.NS_REFERENCE_0=t.NS_JINGLE_ICE_0=t.NS_JINGLE_HTTP_UPLOAD_0=t.NS_JINGLE_HTTP_0=t.NS_HTTP_UPLOAD_0=t.NS_SID_0=t.NS_JINGLE_PUB_1=t.NS_PUSH_0=t.NS_DELEGATION_1=t.NS_JINGLE_MSG_INITIATE_0=t.NS_CSI_0=t.NS_JINGLE_DTLS_SCTP_1=t.NS_JINGLE_RTP_SSMA_0=t.NS_JINGLE_GROUPING_0=t.NS_JSON_0=t.NS_HINTS=t.NS_CHAT_MARKERS_0=t.NS_JINGLE_DTLS_0=t.NS_IDLE_1=t.NS_HATS_0=t.NS_MAM_2=t.NS_MAM_1=t.NS_MAM_0=t.NS_MAM_TMP=t.NS_PSA=t.NS_CORRECTION_0=t.NS_MUC_UNIQUE=t.NS_RTT_0=t.NS_HASH_NAME=t.NS_HASHES_2=t.NS_HASHES_1=t.NS_FORWARD_0=t.NS_JINGLE_RTP_HDREXT_0=t.NS_JINGLE_RTP_RTCP_FB_0=t.NS_CARBONS_2=t.NS_DECLOAKING_0=t.NS_THUMBS_1=t.NS_THUMBS_0=t.NS_JINGLE_RTP_ZRTP_1=t.NS_JINGLE_IBB_1=t.NS_JINGLE_SOCKS5_1=t.NS_SEC_LABEL_ESS_0=t.NS_SEC_LABEL_CATALOG_2=t.NS_SEC_LABEL_0=t.NS_MUC_DIRECT_INVITE=t.NS_JINGLE_XML_0=t.NS_JINGLE_FILE_TRANSFER_5=void 0,t.NS_JINGLE_RTP_MSID_0=t.NS_XRD=t.NS_JSON_MESSAGE_0=t.NS_OMEMO_AXOLOTL_BUNDLE=t.NS_OMEMO_AXOLOTL_BUNDLES=t.NS_OMEMO_AXOLOTL_DEVICELIST=void 0,t.NS_ATOM="http://www.w3.org/2005/Atom",t.NS_BIND="urn:ietf:params:xml:ns:xmpp-bind",t.NS_CLIENT="jabber:client",t.NS_SASL="urn:ietf:params:xml:ns:xmpp-sasl",t.NS_SERVER="jabber:server",t.NS_SESSION="urn:ietf:params:xml:ns:xmpp-session",t.NS_STANZAS="urn:ietf:params:xml:ns:xmpp-stanzas",t.NS_STREAM="http://etherx.jabber.org/streams",t.NS_STREAMS="urn:ietf:params:xml:ns:xmpp-streams",t.NS_STARTTLS="urn:ietf:params:xml:ns:xmpp-tls",t.NS_ROSTER="jabber:iq:roster",t.NS_ROSTER_VERSIONING="urn:xmpp:features:rosterver",t.NS_SUBSCRIPTION_PREAPPROVAL="urn:xmpp:features:pre-approval",t.NS_FRAMING="urn:ietf:params:xml:ns:xmpp-framing",t.NS_DATAFORM="jabber:x:data",t.NS_RPC="jabber:iq:rpc",t.NS_LAST_ACTIVITY="jabber:iq:last",t.NS_PRIVACY="jabber:iq:privacy",t.NS_LEGACY_CHAT_EVENTS="jabber:x:event",t.NS_DISCO_INFO="http://jabber.org/protocol/disco#info",t.NS_DISCO_ITEMS="http://jabber.org/protocol/disco#items",t.NS_ADDRESS="http://jabber.org/protocol/address",t.NS_MUC="http://jabber.org/protocol/muc",t.NS_MUC_ADMIN="http://jabber.org/protocol/muc#admin",t.NS_MUC_OWNER="http://jabber.org/protocol/muc#owner",t.NS_MUC_USER="http://jabber.org/protocol/muc#user",t.NS_IBB="http://jabber.org/protocol/ibb",t.NS_BOOKMARKS="storage:bookmarks",t.NS_PRIVATE="jabber:iq:private",t.NS_ADHOC_COMMANDS="http://jabber.org/protocol/commands",t.NS_VCARD_TEMP="vcard-temp",t.NS_SEARCH="jabber:iq:search",t.NS_RSM="http://jabber.org/protocol/rsm",t.NS_PUBSUB="http://jabber.org/protocol/pubsub",t.NS_PUBSUB_ERRORS="http://jabber.org/protocol/pubsub#errors",t.NS_PUBSUB_EVENT="http://jabber.org/protocol/pubsub#event",t.NS_PUBSUB_OWNER="http://jabber.org/protocol/pubsub#owner",t.NS_SOCKS5="http://jabber.org/protocol/bytestreams",t.NS_OOB="jabber:x:oob",t.NS_OOB_TRANSFER="jabber:iq:oob",t.NS_HTTP_AUTH="http://jabber.org/protocol/http-auth",t.NS_XHTML="http://www.w3.org/1999/xhtml",t.NS_XHTML_IM="http://jabber.org/protocol/xhtml-im",t.NS_REGISTER="jabber:iq:register",t.NS_INBAND_REGISTRATION="http://jabber.org/features/iq-register",t.NS_AMP="http://jabber.org/protocol/amp",t.NS_GEOLOC="http://jabber.org/protocol/geoloc",t.NS_ROSTER_DELIMITER="roster:delimiter",t.NS_AVATAR_DATA="urn:xmpp:avatar:data",t.NS_AVATAR_METADATA="urn:xmpp:avatar:metadata",t.NS_CHAT_STATES="http://jabber.org/protocol/chatstates",t.NS_VERSION="jabber:iq:version",t.NS_MOOD="http://jabber.org/protocol/mood",t.NS_ACTIVITY="http://jabber.org/protocol/activity",t.NS_COMPONENT="jabber:component:accept",t.NS_DISCO_LEGACY_CAPS="http://jabber.org/protocol/caps",t.NS_TUNE="http://jabber.org/protocol/tune",t.NS_DATAFORM_VALIDATION="http://jabber.org/protocol/xdata-validate",t.NS_BOSH="http://jabber.org/protocol/httpbind",t.NS_SHIM="http://jabber.org/protocol/shim",t.NS_COMPRESSION_FEATURE="http://jabber.org/features/compress",t.NS_COMPRESSION="http://jabber.org/protocol/compress",t.NS_DATAFORM_LAYOUT="http://jabber.org/protocol/xdata-layout",t.NS_ROSTER_EXCHANGE="http://jabber.org/protocol/rosterx",t.NS_ROSTER_NOTES="storage:rosternotes",t.NS_REACH_0="urn:xmpp:reach:0",t.NS_VCARD_TEMP_UPDATE="vcard-temp:x:update",t.NS_ALT_CONNECTIONS_WEBSOCKET="urn:xmpp:alt-connections:websocket",t.NS_ALT_CONNECTIONS_XBOSH="urn:xmpp:alt-connections:xbosh",t.NS_CAPTCHA="urn:xmpp:captcha";t.NS_PEP_NOTIFY=e=>`${e}+notify`,t.NS_JINGLE_1="urn:xmpp:jingle:1",t.NS_JINGLE_ERRORS_1="urn:xmpp:jingle:errors:1",t.NS_JINGLE_RTP_1="urn:xmpp:jingle:apps:rtp:1",t.NS_JINGLE_RTP_ERRORS_1="urn:xmpp:jingle:apps:rtp:errors:1",t.NS_JINGLE_RTP_INFO_1="urn:xmpp:jingle:apps:rtp:info:1",t.NS_JINGLE_RTP_AUDIO="urn:xmpp:jingle:apps:rtp:audio",t.NS_JINGLE_RTP_VIDEO="urn:xmpp:jingle:apps:rtp:video",t.NS_LANG_TRANS="urn:xmpp:langtrans",t.NS_LANG_TRANS_ITEMS="urn:xmpp:langtrans:items",t.NS_NICK="http://jabber.org/protocol/nick",t.NS_JINGLE_ICE_UDP_1="urn:xmpp:jingle:transports:ice-udp:1",t.NS_JINGLE_RAW_UDP_1="urn:xmpp:jingle:transports:raw-udp:1",t.NS_RECEIPTS="urn:xmpp:receipts",t.NS_INVISIBLE_0="urn:xmpp:invisible:0",t.NS_BLOCKING="urn:xmpp:blocking",t.NS_BLOCKING_ERRORS="urn:xmpp:blocking:errors",t.NS_SMACKS_3="urn:xmpp:sm:3",t.NS_PING="urn:xmpp:ping",t.NS_TIME="urn:xmpp:time",t.NS_DELAY="urn:xmpp:delay",t.NS_BOSH_XMPP="urn:xmpp:xbosh",t.NS_DISCO_EXTERNAL_1="urn:xmpp:extdisco:1",t.NS_DISCO_EXTERNAL_2="urn:xmpp:extdisco:2",t.NS_DATAFORM_MEDIA="urn:xmpp:media-element",t.NS_ATTENTION_0="urn:xmpp:attention:0",t.NS_BOB="urn:xmpp:bob",t.NS_SOFTWARE_INFO="urn:xmpp:dataforms:softwareinfo",t.NS_JINGLE_FILE_TRANSFER_3="urn:xmpp:jingle:apps:file-transfer:3",t.NS_JINGLE_FILE_TRANSFER_4="urn:xmpp:jingle:apps:file-transfer:4",t.NS_JINGLE_FILE_TRANSFER_5="urn:xmpp:jingle:apps:file-transfer:5",t.NS_JINGLE_XML_0="urn:xmpp:jingle:apps:xmlstream:0",t.NS_MUC_DIRECT_INVITE="jabber:x:conference",t.NS_SEC_LABEL_0="urn:xmpp:sec-label:0",t.NS_SEC_LABEL_CATALOG_2="urn:xmpp:sec-label:catalog:2",t.NS_SEC_LABEL_ESS_0="urn:xmpp:sec-label:ess:0",t.NS_JINGLE_SOCKS5_1="urn:xmpp:jingle:transports:s5b:1",t.NS_JINGLE_IBB_1="urn:xmpp:jingle:transports:ibb:1",t.NS_JINGLE_RTP_ZRTP_1="urn:xmpp:jingle:apps:rtp:zrtp:1",t.NS_THUMBS_0="urn:xmpp:thumbs:0",t.NS_THUMBS_1="urn:xmpp:thumbs:1",t.NS_DECLOAKING_0="urn:xmpp:decloaking:0",t.NS_CARBONS_2="urn:xmpp:carbons:2",t.NS_JINGLE_RTP_RTCP_FB_0="urn:xmpp:jingle:apps:rtp:rtcp-fb:0",t.NS_JINGLE_RTP_HDREXT_0="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",t.NS_FORWARD_0="urn:xmpp:forward:0",t.NS_HASHES_1="urn:xmpp:hashes:1",t.NS_HASHES_2="urn:xmpp:hashes:2";t.NS_HASH_NAME=e=>`urn:xmpp:hash-function-text-names:${e}`,t.NS_RTT_0="urn:xmpp:rtt:0",t.NS_MUC_UNIQUE="http://jabber.org/protocol/muc#unique",t.NS_CORRECTION_0="urn:xmpp:message-correct:0",t.NS_PSA="urn:xmpp:psa",t.NS_MAM_TMP="urn:xmpp:mam:tmp",t.NS_MAM_0="urn:xmpp:mam:0",t.NS_MAM_1="urn:xmpp:mam:1",t.NS_MAM_2="urn:xmpp:mam:2",t.NS_HATS_0="urn:xmpp:hats:0",t.NS_IDLE_1="urn:xmpp:idle:1",t.NS_JINGLE_DTLS_0="urn:xmpp:jingle:apps:dtls:0",t.NS_CHAT_MARKERS_0="urn:xmpp:chat-markers:0",t.NS_HINTS="urn:xmpp:hints",t.NS_JSON_0="urn:xmpp:json:0",t.NS_JINGLE_GROUPING_0="urn:xmpp:jingle:apps:grouping:0",t.NS_JINGLE_RTP_SSMA_0="urn:xmpp:jingle:apps:rtp:ssma:0",t.NS_JINGLE_DTLS_SCTP_1="urn:xmpp:jingle:transports:dtls-sctp:1",t.NS_CSI_0="urn:xmpp:csi:0",t.NS_JINGLE_MSG_INITIATE_0="urn:xmpp:jingle:jingle-message:0",t.NS_DELEGATION_1="urn:xmpp:delegation:1",t.NS_PUSH_0="urn:xmpp:push:0",t.NS_JINGLE_PUB_1="urn:xmpp:jinglepub:1",t.NS_SID_0="urn:xmpp:sid:0",t.NS_HTTP_UPLOAD_0="urn:xmpp:http:upload:0",t.NS_JINGLE_HTTP_0="urn:xmpp:jingle:transports:http:0",t.NS_JINGLE_HTTP_UPLOAD_0="urn:xmpp:jingle:transports:http:upload:0",t.NS_JINGLE_ICE_0="urn:xmpp:jingle:transports:ice:0",t.NS_REFERENCE_0="urn:xmpp:reference:0",t.NS_EME_0="urn:xmpp:eme:0",t.NS_SPOILER_0="urn:xmpp:spoiler:0",t.NS_OMEMO_AXOLOTL="eu.siacs.conversations.axolotl",t.NS_OMEMO_AXOLOTL_DEVICELIST="eu.siacs.conversations.axolotl.devicelist",t.NS_OMEMO_AXOLOTL_BUNDLES="eu.siacs.conversations.axolotl.bundles";t.NS_OMEMO_AXOLOTL_BUNDLE=e=>`${t.NS_OMEMO_AXOLOTL_BUNDLES}:${e}`,t.NS_JSON_MESSAGE_0="urn:xmpp:json-msg:0",t.NS_XRD="http://docs.oasis-open.org/ns/xri/xrd-1.0",t.NS_JINGLE_RTP_MSID_0="urn:xmpp:jingle:apps:rtp:msid:0"},7316:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.basicLanguageResolver=t.escapeXMLText=t.unescapeXML=t.escapeXML=void 0;const i=n(655).__importDefault(n(772)),r={'"':"&quot;","&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"},s={"&amp;":"&","&apos;":"'","&gt;":">","&lt;":"<","&quot;":'"'},o=/&([a-zA-Z0-9]+|#[0-9]+|#x[0-9a-fA-F]+);/g,a=/&|<|>|"|'/g,c=/&|<|>/g;function l(e){return r[e]}t.escapeXML=function(e){return e.replace(a,l)},t.unescapeXML=function(e){return e.replace(o,(e=>function(e){if(s[e])return s[e];const t=e.startsWith("&#x"),n=parseInt(e.substring(t?3:2,e.length-1),t?16:10);if(9===n||10===n||13===n||32<=n&&n<=55295||57344<=n&&n<=65533||65536<=n&&n<=1114111)return String.fromCodePoint(n);throw i.default.restrictedXML("Prohibited entity: "+e)}(e)))},t.escapeXMLText=function(e){return e.replace(c,l)},t.basicLanguageResolver=function(e,t=[],n=""){const i=new Set(e.map((e=>e.toLowerCase())));for(let e of t.map((e=>e.toLowerCase())))if("*"!==e)for(;e.length>0;){if(i.has(e))return e;e=e.substring(0,e.lastIndexOf("-")).toLowerCase(),e.lastIndexOf("-")===e.length-2&&(e=e.substring(0,e.lastIndexOf("-")))}return n}},8821:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(7316);class r{constructor(e,t={},n=[]){this.name=e,this.attributes=t,this.children=[],this.optionalNamespaces={};for(const e of n)if("string"!=typeof e){const t=new r(e.name,e.attributes,e.children);t.parent=this,this.children.push(t)}else this.children.push(e)}getName(){return this.name.indexOf(":")>=0?this.name.substr(this.name.indexOf(":")+1):this.name}getNamespace(){if(this.name.indexOf(":")>=0){const e=this.name.substr(0,this.name.indexOf(":"));return this.findNamespaceForPrefix(e)}return this.findNamespaceForPrefix()}getNamespaceContext(){let e={};this.parent&&(e=this.parent.getNamespaceContext());for(const[t,n]of Object.entries(this.attributes))if(t.startsWith("xmlns:")){const i=t.substr(6);e[n]=i}return e}getDefaultNamespace(){return this.attributes.xmlns?this.attributes.xmlns:this.parent?this.parent.getDefaultNamespace():""}getNamespaceRoot(e){if(this.parent){const t=this.parent.getNamespaceRoot(e);if(t)return t}for(const[t,n]of Object.entries(this.attributes))if(t.startsWith("xmlns:")&&n===e)return this;if(this.optionalNamespaces[e])return this}getAttribute(e,t){if(!t)return this.attributes[e];const n=this.getNamespaceContext();return n[t]?this.attributes[[n[t],e].join(":")]:void 0}getChild(e,t){return this.getChildren(e,t)[0]}getChildren(e,t){const n=[];for(const i of this.children)"string"==typeof i||i.getName()!==e||t&&i.getNamespace()!==t||n.push(i);return n}getText(){let e="";for(const t of this.children)"string"==typeof t&&(e+=t);return e}appendChild(e){return this.children.push(e),"string"!=typeof e&&(e.parent=this),e}setAttribute(e,t,n=!1){this.attributes[e]=t||void 0,""===t&&n&&(this.attributes[e]=t)}addOptionalNamespace(e,t){this.optionalNamespaces[t]=e}useNamespace(e,t){return this.optionalNamespaces[t]&&(e=this.optionalNamespaces[t]),this.setAttribute(`xmlns:${e}`,t),e}toJSON(){const e=this.children.map((e=>"string"==typeof e?e:e?e.toJSON():void 0)).filter((e=>!!e)),t={};for(const[e,n]of Object.entries(this.attributes))null!=n&&(t[e]=n);return{attributes:t,children:e,name:this.name}}toString(){let e=this.openTag(!0);if(this.children.length){for(const t of this.children)"string"==typeof t?e+=i.escapeXMLText(t):t&&(e+=t.toString());e+=this.closeTag()}return e}openTag(e=!1){let t="";t+=`<${this.name}`;for(const[e,n]of Object.entries(this.attributes))void 0!==n&&(t+=` ${e}="${i.escapeXML(n.toString())}"`);return e&&0===this.children.length?t+="/>":t+=">",t}closeTag(){return`</${this.name}>`}findNamespaceForPrefix(e){if(e){const t="xmlns:"+e;if(this.attributes[t])return this.attributes[t];if(this.parent)return this.parent.findNamespaceForPrefix(e)}else{if(this.attributes.xmlns)return this.attributes.xmlns;if(this.parent)return this.parent.findNamespaceForPrefix()}return""}}t.default=r},772:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.JXTErrorCondition=void 0,function(e){e.NotWellFormed="not-well-formed",e.RestrictedXML="restricted-xml",e.AlreadyClosed="already-closed",e.UnknownRoot="unknown-stream-root"}(n=t.JXTErrorCondition||(t.JXTErrorCondition={}));class i extends Error{constructor(e){super(e.text),this.isJXTError=!0,this.condition=e.condition,this.text=e.text}static notWellFormed(e){return new i({condition:n.NotWellFormed,text:e})}static restrictedXML(e){return new i({condition:n.RestrictedXML,text:e})}static alreadyClosed(e){return new i({condition:n.AlreadyClosed,text:e})}static unknownRoot(e){return new i({condition:n.UnknownRoot,text:e})}}t.default=i},3229:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pubsubItemContentAliases=t.extendStanzaError=t.extendStreamFeatures=t.extendIQ=t.extendPresence=t.extendMessage=t.addAlias=t.childJID=t.childJIDAttribute=t.JIDAttribute=void 0;const i=n(1595),r=n(3921);t.JIDAttribute=r.attribute,t.childJIDAttribute=r.childAttribute,t.childJID=r.childText,t.addAlias=function(e,t,n){return{aliases:Array.isArray(n)?n:[n],element:t,fields:{},namespace:e}},t.extendMessage=function(e){return{element:"message",fields:e,namespace:i.NS_CLIENT}},t.extendPresence=function(e){return{element:"presence",fields:e,namespace:i.NS_CLIENT}},t.extendIQ=function(e){return{element:"iq",fields:e,namespace:i.NS_CLIENT}},t.extendStreamFeatures=function(e){return{element:"features",fields:e,namespace:i.NS_STREAM}},t.extendStanzaError=function(e){return{element:"error",fields:e,namespace:i.NS_STANZAS,path:"stanzaError"}},t.pubsubItemContentAliases=function(){return[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}]}},4041:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;const i=n(655),r=n(7187),s=n(7316),o=i.__importDefault(n(8821)),a=i.__importDefault(n(772));function c(e){return 97<=e&&e<=122||65<=e&&e<=90||58===e||95===e}function l(e){return 192<=e&&e<=214||216<=e&&e<=246||248<=e&&e<=767||880<=e&&e<=893||895<=e&&e<=8191||8204<=e&&e<=8205||8304<=e&&e<=8591||11264<=e&&e<=12271||12289<=e&&e<=55295||65008<=e&&e<=65533||65536<=e&&e<=983039}function u(e){return c(e)||l(e)}function p(e){return c(e)||45===e||46===e||48<=e&&e<=57||183===e||768<=e&&e<=879||8255<=e&&e<=8256||l(e)}function d(e){return 32===e||10===e||13===e||9===e}class h extends r.EventEmitter{constructor(e={}){super(),this.allowComments=!0,this.attributes={},this.state=34,this.tagName="",this.haveDeclaration=!1,this.recordBuffer=[],void 0!==e.allowComments&&(this.allowComments=e.allowComments)}write(e){for(const t of e){const e=t.codePointAt(0);switch(this.state){case 34:if(60===e){let e;try{e=s.unescapeXML(this.endRecord())}catch(e){return void this.emit("error",e)}e&&this.emit("text",e),this.transition(31);continue}this.record(t);continue;case 31:if(47===e){this.transition(7);continue}if(33===e){this.transition(24);continue}if(63===e){this.haveDeclaration&&this.restrictedXML(),this.transition(25);continue}if(u(e)){this.transition(30),this.startRecord(t);continue}return this.notWellFormed();case 30:if(p(e)){this.record(t);continue}if(d(e)){this.startTag(),this.transition(32);continue}if(47===e){this.startTag(),this.transition(29);continue}if(62===e){this.startTag(),this.transition(34),this.emit("startElement",this.tagName,this.attributes);continue}return this.notWellFormed();case 29:if(62===e){this.emit("startElement",this.tagName,this.attributes),this.emit("endElement",this.tagName),this.transition(34);continue}return this.notWellFormed();case 33:if(d(e)){this.transition(32);continue}if(47===e){this.transition(29);continue}if(62===e){this.emit("startElement",this.tagName,this.attributes),this.transition(34);continue}return this.notWellFormed();case 32:if(d(e))continue;if(u(e)){this.startRecord(t),this.transition(0);continue}if(47===e){this.transition(29);continue}if(62===e){this.emit("startElement",this.tagName,this.attributes),this.transition(34);continue}return this.notWellFormed();case 7:if(u(e)){this.startRecord(t),this.transition(6);continue}return this.notWellFormed();case 6:if(p(e)){this.record(t);continue}if(d(e)){this.transition(8);continue}if(62===e){const e=this.endRecord();this.emit("endElement",e,this.attributes),this.transition(34);continue}return this.notWellFormed();case 8:if(d(e))continue;if(62===e){const e=this.endRecord();this.emit("endElement",e,this.attributes),this.transition(34);continue}return this.notWellFormed();case 0:if(p(e)){this.record(t);continue}if(61===e){this.addAttribute(),this.transition(4);continue}if(d(e)){this.addAttribute(),this.transition(3);continue}return this.notWellFormed();case 3:if(61===e){this.transition(4);continue}if(d(e))continue;return this.notWellFormed();case 4:if(34===e){this.startRecord(),this.transition(1);continue}if(39===e){this.startRecord(),this.transition(2);continue}if(d(e))continue;return this.notWellFormed();case 1:case 2:if(34===e&&1===this.state||39===e&&2===this.state){const e=this.endRecord();this.attributes[this.attributeName]=s.unescapeXML(e),this.transition(33);continue}if(60===e)return this.notWellFormed();this.record(t);continue;case 24:if(45===e){this.allowComments||this.restrictedXML(),this.transition(23);continue}if(91===e){this.transition(21);continue}return this.notWellFormed();case 23:if(45===e){this.transition(14);continue}return this.notWellFormed();case 14:45===e&&this.transition(12);continue;case 12:45===e?this.transition(11):this.transition(14);continue;case 11:62===e?this.transition(34):this.transition(14);continue;case 25:if(88===e||120===e){this.transition(28);continue}return this.notWellFormed();case 28:if(77===e||109===e){this.transition(27);continue}return this.notWellFormed();case 27:if(76===e||108===e){this.transition(26);continue}return this.notWellFormed();case 26:if(d(e)){this.haveDeclaration=!0,this.transition(15);continue}return this.notWellFormed();case 13:if(62===e){this.transition(34);continue}return this.notWellFormed();case 15:63===e&&this.transition(13);continue;case 21:this.wait(e,67,20);continue;case 20:this.wait(e,68,19);continue;case 19:this.wait(e,65,18);continue;case 18:this.wait(e,84,17);continue;case 17:this.wait(e,65,16);continue;case 16:this.wait(e,91,5);continue;case 5:if(93===e){this.transition(10);continue}this.record(t);continue;case 10:93===e?this.transition(9):(this.record(String.fromCodePoint(93)),this.record(t),this.transition(5));continue;case 9:if(62===e){const e=this.endRecord();e&&this.emit("text",e),this.transition(34)}else this.record(String.fromCodePoint(93)),this.record(String.fromCodePoint(93)),this.record(t),this.transition(5);continue}}}end(e){e&&this.write(e),this.write=()=>{}}record(e){this.recordBuffer.push(e)}startRecord(e){this.recordBuffer=[],e&&this.recordBuffer.push(e)}endRecord(){const e=this.recordBuffer;return this.recordBuffer=[],e.join("")}startTag(){this.tagName=this.endRecord(),this.attributes={}}addAttribute(){const e=this.endRecord();if(void 0!==this.attributes[e])return this.notWellFormed();this.attributeName=e,this.attributes[e]=""}wait(e,t,n){if(e!==t)return this.notWellFormed();this.transition(n)}transition(e){this.state=e,34===e&&this.startRecord()}notWellFormed(e){this.emit("error",a.default.notWellFormed(e))}restrictedXML(e){this.emit("error",a.default.restrictedXML(e))}}t.parse=function(e,t={}){const n=new h(t);let i,r,s=null;if(n.on("text",(e=>{r&&r.children.push(e)})),n.on("startElement",((e,t)=>{const n=new o.default(e,t);i||(i=n),r=r?r.appendChild(n):n})),n.on("endElement",(e=>{r?e===r.name?r.parent&&(r=r.parent):n.emit("error",a.default.notWellFormed("b")):n.emit("error",a.default.notWellFormed("a"))})),n.on("error",(e=>{s=e})),n.write(e),n.end(),s)throw s;return i},t.default=h},7046:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(655),r=n(7316),s=i.__importDefault(n(5335)),o=i.__importDefault(n(5587));t.default=class{constructor(){this.translators=new Map,this.root=new o.default,this.setLanguageResolver(r.basicLanguageResolver)}setLanguageResolver(e){this.languageResolver=e}import(e,t={registry:this}){if(!this.hasTranslator(e.getNamespace(),e.getName()))return;t.acceptLanguages||(t.acceptLanguages=[]),t.acceptLanguages=t.acceptLanguages.map((e=>e.toLowerCase())),t.lang&&(t.lang=t.lang.toLowerCase()),t.resolveLanguage||(t.resolveLanguage=this.languageResolver),t.path=this.getImportKey(e),t.sanitizers||(t.sanitizers={xhtmlim:s.default});return this.getOrCreateTranslator(e.getNamespace(),e.getName()).import(e,{...t,registry:this})}export(e,t,n={registry:this}){n.acceptLanguages||(n.acceptLanguages=[]),n.acceptLanguages=n.acceptLanguages.map((e=>e.toLowerCase())),n.lang&&(n.lang=n.lang.toLowerCase()),n.sanitizers||(n.sanitizers={xhtmlim:s.default}),n.path=e;const i=e.split(".").filter((e=>""!==e));let r=this.root;for(const e of i){const t=r.getChild(e);if(!t)return;r=t}return r.export(t,{...n,registry:this})}getImportKey(e,t=""){const n=t?this.walkToTranslator(t.split(".")):this.root;if(n)return n.getImportKey(e)}define(e){if(Array.isArray(e)){for(const t of e)"object"==typeof t?this.define(t):t(this);return}if("object"!=typeof e)return void e(this);const t=e;t.aliases=t.aliases||[],t.path&&!t.aliases.includes(t.path)&&t.aliases.push(t.path);const n=t.aliases.map((e=>"string"==typeof e?{path:e}:e)).sort(((e,t)=>{const n=e.path.split(".").length;return t.path.split(".").length-n}));let i;if(this.hasTranslator(t.namespace,t.element)&&(i=this.getOrCreateTranslator(t.namespace,t.element)),!i){let e;for(const t of n){const n=this.walkToTranslator(t.path.split("."));if(n&&!n.placeholder){i=n;break}n&&(e=n)}e&&!i&&(i=e,i.placeholder=!1)}i||(i=this.getOrCreateTranslator(t.namespace,t.element)),this.indexTranslator(t.namespace,t.element,i);const r=t.fields||{},s=new Map,o=new Map,a=new Map,c=new Map;t.typeField&&(i.typeField=t.typeField),t.defaultType&&(i.defaultType=t.defaultType),t.versionField&&(i.versionField=t.versionField),t.defaultVersion&&(i.defaultVersion=t.defaultVersion),t.languageField&&(i.languageField=t.languageField);for(const[e,t]of Object.entries(r))s.set(e,t.importer),a.set(e,t.importOrder||t.order||0),o.set(e,t.exporter),c.set(e,t.exportOrder||t.order||0);if(t.childrenExportOrder)for(const[e,n]of Object.entries(t.childrenExportOrder))c.set(e,n||0);const l=new Map;for(const[e,n]of Object.entries(t.optionalNamespaces||{}))l.set(e,n);i.updateDefinition({contexts:new Map,element:t.element,exporterOrdering:c,exporters:o,importerOrdering:a,importers:s,namespace:t.namespace,optionalNamespaces:l,type:t.type,version:t.version,typeOrder:t.typeOrder});for(const e of n)this.alias(t.namespace,t.element,e.path,e.multiple,e.selector,e.contextField,t.type,e.impliedType);for(const e of n){const t=this.walkToTranslator(e.path.split("."));t&&t!==i&&t.replaceWith(i)}}alias(e,t,n,i=!1,r,s,o,a=!1){const c=this.getOrCreateTranslator(e,t);c.placeholder=!1;const l=n.split(".").filter((e=>""!==e)),u=l.pop(),p=this.walkToTranslator(l,!0),d=`{${e}}${t}`;o&&(s||a)&&c.addContext(n,r,s,d,o,a),p.addChild(u,c,i,r,d)}walkToTranslator(e,t=!1){let n=this.root;for(const i of e){let e=n.getChild(i);if(!e){if(!t)return;e=new o.default,e.placeholder=!0,n.addChild(i,e)}n=e}return n}hasTranslator(e,t){return this.translators.has(`{${e}}${t}`)}getOrCreateTranslator(e,t){let n=this.translators.get(`{${e}}${t}`);return n||(n=new o.default,this.indexTranslator(e,t,n)),n}indexTranslator(e,t,n){this.translators.set(`{${e}}${t}`,n)}}},5696:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(655),r=n(8473),s=i.__importDefault(n(8821)),o=i.__importDefault(n(772)),a=i.__importDefault(n(4041));class c extends r.Transform{constructor(e){super({objectMode:!0}),this.closedStream=!1,this.wrappedStream=!1,this.registry=e.registry,this.acceptLanguages=e.acceptLanguages||[],e.wrappedStream&&(this.wrappedStream=!0,this.rootImportKey=e.rootKey),this.parser=new a.default({allowComments:e.allowComments}),this.parser.on("error",(e=>{this.destroy(e)})),this.parser.on("startElement",((e,t)=>{if(this.destroyed)return;if(this.closedStream)return this.destroy(o.default.alreadyClosed());const n=new s.default(e,t),i=this.registry.getImportKey(n);if(this.wrappedStream&&!this.rootElement){if(this.rootImportKey&&i!==this.rootImportKey)return this.destroy(o.default.unknownRoot());const e=this.registry.import(n,{acceptLanguages:this.acceptLanguages,lang:this.lang});return e?(this.rootElement=n,void this.push({event:"stream-start",kind:i,stanza:e,xml:n})):this.destroy(o.default.notWellFormed())}this.currentElement?this.currentElement=this.currentElement.appendChild(n):this.currentElement=n})),this.parser.on("endElement",(e=>{if(!this.destroyed){if(this.wrappedStream&&!this.currentElement)return this.rootElement&&e===this.rootElement.name?(this.closedStream=!0,this.push({event:"stream-end",kind:this.rootImportKey,stanza:{},xml:this.rootElement}),this.end()):(this.closedStream=!0,this.destroy(o.default.notWellFormed()));if(!this.currentElement||e!==this.currentElement.name)return this.closedStream=!0,this.destroy(o.default.notWellFormed());if(this.currentElement.parent)this.currentElement=this.currentElement.parent;else{this.wrappedStream&&(this.currentElement.parent=this.rootElement);const e=this.registry.getImportKey(this.currentElement),t=this.registry.import(this.currentElement,{acceptLanguages:this.acceptLanguages,lang:this.lang});t&&this.push({kind:e,stanza:t,xml:this.currentElement}),this.currentElement=void 0}}})),this.parser.on("text",(e=>{this.currentElement&&this.currentElement.children.push(e)}))}_transform(e,t,n){this.parser.write(e.toString()),n()}}t.default=c},5587:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3921);t.default=class{constructor(){this.parents=new Set,this.placeholder=!1,this.typeField="",this.versionField="",this.defaultType="",this.defaultVersion="",this.languageField="lang",this.typeValues=new Map,this.typeOrders=new Map,this.importers=new Map,this.exporters=new Map,this.children=new Map,this.childrenIndex=new Map,this.implicitChildren=new Set,this.contexts=new Map}addChild(e,t,n=!1,i,r){const s={multiple:n||!1,name:e,selector:i,translator:t},o=this.children.get(e);if(!o){s.translator.parents.add(this),this.children.set(e,s);for(const[n]of t.importers)this.implicitChildren.has(n)||this.childrenIndex.set(n,e);return void(r&&this.implicitChildren.add(r))}const a=o.translator;o.multiple=n,i&&o.selector&&i!==o.selector&&(o.selector=void 0);for(const[n,i]of t.importers){const[r,s]=(a.typeValues.get(n)||"").split("__v__");a.updateDefinition({contexts:t.contexts,element:i.element,exporterOrdering:new Map,exporters:new Map,importerOrdering:i.fieldOrders,importers:i.fields,namespace:i.namespace,optionalNamespaces:new Map,type:r,version:s}),this.implicitChildren.has(n)||this.childrenIndex.set(n,e)}for(const[e,n]of t.exporters){const[i,r]=e.split("__v__");a.updateDefinition({contexts:t.contexts,element:n.element,exporterOrdering:n.fieldOrders,exporters:n.fields,importerOrdering:new Map,importers:new Map,namespace:n.namespace,optionalNamespaces:n.optionalNamespaces,type:i,version:r})}}addContext(e,t,n,i,r,s){t&&(e=`${e}[${t}]`);let o=this.contexts.get(e);o||(o={typeField:"",versionField:"",typeValues:new Map}),s&&(o.impliedType=r),o.typeField=n||"",o.typeValues.set(i,r),this.contexts.set(e,o)}getChild(e){const t=this.children.get(e);if(t)return t.translator}getImportKey(e){return this.childrenIndex.get(`{${e.getNamespace()}}${e.getName()}`)}updateDefinition(e){const t=`{${e.namespace}}${e.element}`,n=e.type||this.defaultType,i=e.version||this.defaultVersion,r=i?`${n}__v__${i}`:n,s=this.importers.get(t)||{element:e.element,fieldOrders:new Map,fields:new Map,namespace:e.namespace};for(const[t,n]of e.importers)s.fields.set(t,n);for(const[t,n]of e.importerOrdering)s.fieldOrders.set(t,n);this.importers.set(t,s);const o=this.exporters.get(r)||{element:e.element,fieldOrders:new Map,fields:new Map,namespace:e.namespace,optionalNamespaces:e.optionalNamespaces};for(const[t,n]of e.exporters)o.fields.set(t,n);for(const[t,n]of e.exporterOrdering)o.fieldOrders.set(t,n);for(const[t,n]of e.optionalNamespaces)o.optionalNamespaces.set(t,n);this.exporters.set(r,o);for(const[t,n]of e.contexts){const e=this.contexts.get(t)||{impliedType:void 0,typeField:n.typeField,versionField:n.versionField,typeValues:new Map};e.typeField||(e.typeField=n.typeField),e.versionField||(e.versionField=n.versionField),e.impliedType||(e.impliedType=n.impliedType);for(const[t,i]of n.typeValues)e.typeValues.set(t,i);this.contexts.set(t,e)}if(e.type)this.typeValues.set(t,r),e.typeOrder&&e.type&&this.typeOrders.set(e.type,e.typeOrder);else if(this.typeField&&!e.type){for(const[,t]of this.importers){for(const[n,i]of e.importers)t.fields.set(n,i);for(const[n,i]of e.importerOrdering)t.fieldOrders.set(n,i)}for(const[,t]of this.exporters){for(const[n,i]of e.exporters)t.fields.set(n,i);for(const[n,i]of e.exporterOrdering)t.fieldOrders.set(n,i)}}}replaceWith(e){for(const[t,n]of this.children)e.children.set(t,n);for(const[t,n]of this.childrenIndex)e.childrenIndex.set(t,n);for(const[t,n]of this.contexts)e.contexts.set(t,n);for(const t of this.implicitChildren)e.implicitChildren.add(t);for(const t of this.parents)for(const n of t.children.values())n.translator===this&&(n.translator=e);this.parents=new Set}import(e,t){const n=`{${e.getNamespace()}}${e.getName()}`,i={},r=this.importers.get(n);if(!r)return;const s=this.typeValues.get(n)||"",[o,a]=s.split("__v__"),c=t.path||"";let l;if(t.pathSelector&&(l=this.contexts.get(`${c}[${t.pathSelector}]`)),l||(l=this.contexts.get(c)),l){if(!l.impliedType){const e=l.typeValues.get(n)||"";e&&(i[l.typeField]=e)}}else this.typeField&&o&&o!==this.defaultType&&(i[this.typeField]=o);this.versionField&&a&&a!==this.defaultVersion&&(i[this.versionField]=a);const u={...t,data:i,importer:r,lang:(e.getAttribute("xml:lang")||t.lang||"").toLowerCase(),pathSelector:o,translator:this},p=[...r.fieldOrders.entries()].sort(((e,t)=>e[1]>t[1]?-1:e[1]<t[1]?1:0)),d=p.filter((e=>e[1]>=0)),h=p.filter((e=>e[1]<0));for(const[n]of d){const s=r.fields.get(n);u.path=`${t.path}.${n}`;const o=s(e,u);null!=o&&(i[n]=o)}for(const n of e.children){if("string"==typeof n)continue;const e=`{${n.getNamespace()}}${n.getName()}`,r=this.childrenIndex.get(e);if(!r)continue;u.path=`${t.path}.${r}`;const{translator:s,multiple:a,selector:c}=this.children.get(r);if(!c||c===o){const e=s.import(n,u);void 0!==e&&(a?(i[r]||(i[r]=[]),i[r].push(e)):i[r]?i[r]=s.resolveCollision(i[r],e):i[r]=e)}}for(const[n]of h){const s=r.fields.get(n);u.path=`${t.path}.${n}`;const o=s(e,u);null!=o&&(i[n]=o)}return i}export(e,t){if(!e)return;let n=this.defaultType,r=this.defaultVersion;const s=t.path||"";let o;t.pathSelector&&(o=this.contexts.get(`${s}[${t.pathSelector}]`)),o||(o=this.contexts.get(s)),o?n=o.impliedType||e[o.typeField]||this.defaultType:this.typeField&&(n=e[this.typeField]||this.defaultType),this.versionField&&(r=e[this.versionField]||this.defaultVersion);const a=r?`${n}__v__${r}`:n,c=this.exporters.get(a);if(!c)return;const l=i.createElement(c.namespace,c.element,t.namespace,t.element);t.element&&(l.parent=t.element);for(const[e,t]of c.optionalNamespaces)l.addOptionalNamespace(e,t);const u={...t,data:e,element:l,exporter:c,lang:(e[this.languageField]||t.lang||"").toLowerCase(),namespace:l.getDefaultNamespace(),pathSelector:n,translator:this},p=c.fields.get(this.languageField);p&&p(l,e[this.languageField],t);const d=Object.keys(e);d.sort(((e,t)=>(c.fieldOrders.get(e)||1e5)-(c.fieldOrders.get(t)||1e5)));for(const i of d){if(i===this.languageField)continue;const r=e[i],s=c.fields.get(i);if(s){s(l,r,u);continue}const o=this.children.get(i);if(!o)continue;u.path=`${t.path?t.path+".":""}${i}`;const{translator:a,multiple:p,selector:d}=o;if(!d||d===n){let e;e=p?null!=r?r:[]:[r];for(const t of e){const e=a.export(t,u);e&&l.appendChild(e)}}}return l}resolveCollision(e,t){return(this.typeOrders.get(e[this.typeField]||this.defaultType)||0)<=(this.typeOrders.get(t[this.typeField]||this.defaultType)||0)?e:t}}},3921:function(e,t,n){"use strict";var i=n(8764).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.childAlternateLanguageRawElement=t.childLanguageRawElement=t.childRawElement=t.staticValue=t.splicePath=t.multipleChildEnum=t.multipleChildAlternateLanguageText=t.childAlternateLanguageText=t.multipleChildIntegerAttribute=t.multipleChildAttribute=t.multipleChildText=t.childDoubleEnum=t.childEnum=t.deepMultipleChildText=t.deepChildBoolean=t.deepChildInteger=t.deepChildText=t.childBoolean=t.childTimezoneOffset=t.childJSON=t.childFloat=t.childInteger=t.childDate=t.childTextBuffer=t.childText=t.childLanguageAttribute=t.languageAttribute=t.textBuffer=t.textJSON=t.text=t.childDateAttribute=t.childFloatAttribute=t.childIntegerAttribute=t.childBooleanAttribute=t.childAttribute=t.namespacedDateAttribute=t.namespacedFloatAttribute=t.namespacedIntegerAttribute=t.namespacedBooleanAttribute=t.namespacedAttribute=t.dateAttribute=t.floatAttribute=t.integerAttribute=t.booleanAttribute=t.attribute=t.findOrCreate=t.findAll=t.getTargetLang=t.getLang=t.createElement=void 0,t.parameterMap=void 0;const r=n(655).__importDefault(n(8821)),s=n(4041);function o(e,t,n,i){if(i){e=e||i.getNamespace();const n=i.getNamespaceRoot(e);if(n){t=`${n.useNamespace("",e)}:${t}`}}const s=new r.default(t);return t.indexOf(":")<0&&(!n||e!==n)&&s.setAttribute("xmlns",e),s}function a(e,t){return(e.getAttribute("xml:lang")||t||"").toLowerCase()}function c(e,t){const n=[];for(const i of e)n.push(a(i,t.lang));let i;return i=t.resolveLanguage?t.resolveLanguage(n,t.acceptLanguages||[],t.lang):t.lang,i||""}function l(e,t,n,i){const r=e.getChildren(n,t),s=a(e);return r.length?i?r.filter((e=>{if(a(e,s)===i)return!0})):r:[]}function u(e,t,n,i){t=t||e.getNamespace();const r=l(e,t,n,i);if(r.length)return r[0];const s=o(t,n,e.getDefaultNamespace(),e),c=a(e,i);return i&&c!==i&&s.setAttribute("xml:lang",i),e.appendChild(s),s}function p(e){return{importer(t){const n=t.getAttribute(e.name,e.namespace);return n?e.parseValue(n):e.dynamicDefault?e.dynamicDefault(n):e.staticDefault},exporter(t,n){if(void 0===n||n===e.staticDefault)return;const i=e.writeValue(n);if(i||e.emitEmpty)if(e.namespace&&e.prefix){let n;const r=t.getNamespaceRoot(e.namespace);if(r)n=r.useNamespace(e.prefix,e.namespace);else{const i=t.getNamespaceContext();i[e.namespace]||(n=t.useNamespace(e.prefix,e.namespace),i[e.namespace]=n)}t.setAttribute(`${n}:${e.name}`,i,e.emitEmpty)}else t.setAttribute(e.name,i,e.emitEmpty)}}}function d(e,t){return(n,i,r={})=>(r={staticDefault:i,...r},p({name:n,...e,...t?t(r):r}))}function h(e,t){return(n,i,r,s,o={})=>(o={staticDefault:s,...o},p({name:r,namespace:i,prefix:n,...e,...t?t(o):o}))}function f(e){const t=e.converter||p({...e,namespace:e.attributeNamespace});return{importer(n,i){const r=n.getChild(e.element,e.namespace||n.getNamespace());return r?t.importer(r,i):e.dynamicDefault?e.dynamicDefault():e.staticDefault},exporter(n,i,r){if(void 0!==i&&i!==e.staticDefault){const s=u(n,e.namespace||n.getNamespace(),e.element);t.exporter(s,i,r)}}}}function m(e,t){return(n,i,r,s,o={})=>(o={staticDefault:s,...o},f({element:i,name:r,namespace:n,...e,...t?t(o):o}))}function g(e){return{importer(t){const n=t.getText();return n?e.parseValue(n):e.dynamicDefault?e.dynamicDefault(n):e.staticDefault},exporter(t,n){if(!n&&e.emitEmpty)return void t.children.push("");if(void 0===n||n===e.staticDefault)return;const i=e.writeValue(n);i&&t.children.push(i)}}}function y(e){const t=g(e);return{importer(n,i){const r=l(n,e.namespace||n.getNamespace(),e.element),s=c(r,i);if(!r.length)return e.dynamicDefault?e.dynamicDefault():e.staticDefault;if(e.matchLanguage)for(const e of r)if(a(e,i.lang)===s)return t.importer(e,i);return t.importer(r[0],i)},exporter(n,i,r){if(i||!e.emitEmpty){if(void 0!==i&&i!==e.staticDefault){const s=u(n,e.namespace||n.getNamespace(),e.element,e.matchLanguage?r.lang:void 0);t.exporter(s,i,r)}}else u(n,e.namespace||n.getNamespace(),e.element,e.matchLanguage?r.lang:void 0)}}}t.createElement=o,t.getLang=a,t.getTargetLang=c,t.findAll=l,t.findOrCreate=u;const v={parseValue:e=>e,writeValue:e=>e},b={parseValue:e=>parseInt(e,10),writeValue:e=>e.toString()},_={parseValue:e=>parseFloat(e),writeValue:e=>e.toString()},w={parseValue:e=>"true"===e||"1"===e||"false"!==e&&"0"!==e&&void 0,writeValue:e=>e?"1":"0"},S={parseValue:e=>new Date(e),writeValue:e=>"string"==typeof e?e:e.toISOString()},x={parseValue:e=>JSON.parse(e),writeValue:e=>JSON.stringify(e)},T=(e="utf8")=>({parseValue:t=>("base64"===e&&"="===t&&(t=""),i.from(t.trim(),e)),writeValue:t=>{let n;return n="string"==typeof t?i.from(t).toString(e):t?t.toString(e):"","base64"===e&&(n=n||"="),n}}),E={parseValue:e=>{let t=-1;"-"===e.charAt(0)&&(t=1,e=e.slice(1));const n=e.split(":");return(60*parseInt(n[0],10)+parseInt(n[1],10))*t},writeValue:e=>{if("string"==typeof e)return e;{let t="-";e<0&&(e=-e,t="+");const n=e/60,i=e%60;return t+=(n<10?"0":"")+n+":"+(i<10?"0":"")+i,t}}};t.attribute=d(v,(e=>({dynamicDefault:e.emitEmpty?t=>""===t?"":e.staticDefault:void 0,...e}))),t.booleanAttribute=d(w),t.integerAttribute=d(b),t.floatAttribute=d(_),t.dateAttribute=d(S),t.namespacedAttribute=h(v),t.namespacedBooleanAttribute=h(w),t.namespacedIntegerAttribute=h(b),t.namespacedFloatAttribute=h(_),t.namespacedDateAttribute=h(S),t.childAttribute=m(v),t.childBooleanAttribute=m(w),t.childIntegerAttribute=m(b),t.childFloatAttribute=m(_),t.childDateAttribute=m(S);t.text=e=>g({staticDefault:e,...v});t.textJSON=()=>g({...x});function I(){return{importer:(e,t)=>a(e,t.lang),exporter(e,t,n){t&&t.toLowerCase()!==n.lang?e.setAttribute("xml:lang",t):e.setAttribute("xml:lang",void 0)}}}t.textBuffer=(e="utf8")=>g({...T(e)}),t.languageAttribute=I;t.childLanguageAttribute=(e,t)=>f({converter:I(),element:t,name:"xml:lang",namespace:e,...v});t.childText=(e,t,n,i=!1)=>y({element:t,emitEmpty:i,matchLanguage:!0,namespace:e,staticDefault:n,...v});t.childTextBuffer=(e,t,n="utf8")=>y({element:t,matchLanguage:!0,namespace:e,...T(n)});t.childDate=(e,t)=>y({element:t,namespace:e,...S});t.childInteger=(e,t,n)=>y({element:t,namespace:e,staticDefault:n,...b});t.childFloat=(e,t,n)=>y({element:t,namespace:e,staticDefault:n,..._});t.childJSON=(e,t)=>y({element:t,namespace:e,...x}),t.childTimezoneOffset=function(e,t){return y({element:t,namespace:e,staticDefault:0,...E})},t.childBoolean=function(e,t){return{importer(n){if(n.getChild(t,e||n.getNamespace()))return!0},exporter(n,i){i&&u(n,e||n.getNamespace(),t)}}};const N=(e,t,n)=>{if(!n)return;let i=t;for(const t of e)i=u(i,t.namespace||i.getNamespace(),t.element);i.children.push(n.toString())};t.deepChildText=function(e,t){return{importer(n){let i=n;for(const n of e)if(i=i.getChild(n.element,n.namespace||i.getNamespace()),!i)return t;return i.getText()||t},exporter(t,n){N(e,t,n)}}},t.deepChildInteger=function(e,t){return{importer(n){let i=n;for(const t of e)if(i=i.getChild(t.element,t.namespace||i.getNamespace()),!i)return;const r=i.getText();return r?parseInt(r,10):t||void 0},exporter(t,n){N(e,t,n)}}},t.deepChildBoolean=function(e){return{importer(t){let n=t;for(const t of e)if(n=n.getChild(t.element,t.namespace||n.getNamespace()),!n)return!1;return!0},exporter(t,n){if(!n)return;let i=t;for(const t of e)i=u(i,t.namespace||i.getNamespace(),t.element)}}},t.deepMultipleChildText=function(e){const t=e.pop();return{importer(n,i){let r=n;for(const t of e)if(r=r.getChild(t.element,t.namespace||r.getNamespace()),!r)return[];const s=[],o=l(r,t.namespace||r.getNamespace(),t.element),u=c(o,i);for(const e of o)a(e,i.lang)===u&&s.push(e.getText());return s},exporter(n,i,r){if(!i.length)return;let s=n;for(const t of e)s=u(s,t.namespace||s.getNamespace(),t.element);const{namespace:a,element:c}=t;for(const e of i){const t=o(a||s.getNamespace(),c,r.namespace,s);t.children.push(e),s.appendChild(t)}}}},t.childEnum=function(e,t,n){const i=new Map,r=new Map;for(const e of t)"string"==typeof e?(i.set(e,e),r.set(e,e)):(i.set(e[1],e[0]),r.set(e[0],e[1]));return{importer(t){for(const n of t.children)if("string"!=typeof n&&n.getNamespace()===(e||t.getNamespace())&&i.has(n.getName()))return i.get(n.getName());return n},exporter(t,n){r.has(n)&&u(t,e,r.get(n))}}},t.childDoubleEnum=function(e,t,n,i){const r=new Set(t),s=new Set(n);return{importer(t){for(const n of t.children)if("string"!=typeof n&&n.getNamespace()===(e||t.getNamespace())&&r.has(n.getName())){for(const i of n.children)if("string"!=typeof i&&i.getNamespace()===(e||t.getNamespace())&&s.has(i.getName()))return[n.getName(),i.getName()];return[n.getName()]}return i},exporter(t,n){const i=u(t,e,n[0]);n[1]&&u(i,e,n[1])}}},t.multipleChildText=function(e,t){return{importer(n,i){const r=[],s=l(n,e||n.getNamespace(),t),o=c(s,i);for(const e of s)a(e,i.lang)===o&&r.push(e.getText());return r},exporter(n,i,r){for(const s of i){const i=o(e||n.getNamespace(),t,r.namespace,n);i.children.push(s),n.appendChild(i)}}}},t.multipleChildAttribute=function(e,t,n){return{importer(i){const r=[],s=i.getChildren(t,e||i.getNamespace());for(const e of s){const t=e.getAttribute(n);void 0!==t&&r.push(t)}return r},exporter(i,r,s){for(const a of r){const r=o(e||i.getNamespace(),t,s.namespace,i);r.setAttribute(n,a),i.appendChild(r)}}}},t.multipleChildIntegerAttribute=function(e,t,n){return{importer(i){const r=[],s=i.getChildren(t,e||i.getNamespace());for(const e of s){const t=e.getAttribute(n);void 0!==t&&r.push(parseInt(t,10))}return r},exporter(i,r,s){for(const a of r){const r=o(e||i.getNamespace(),t,s.namespace,i);r.setAttribute(n,a.toString()),i.appendChild(r)}}}},t.childAlternateLanguageText=function(e,t){return{importer(n,i){const r=[],s=l(n,e||n.getNamespace(),t),o=new Set;for(const e of s){const t=e.getText();if(t){const n=a(e,i.lang);if(o.has(n))continue;r.push({lang:n,value:t}),o.add(n)}}return o.size>0?r:void 0},exporter(n,i,r){for(const s of i){const i=s.value;if(i){const a=o(e||n.getNamespace(),t,r.namespace,n);s.lang!==r.lang&&a.setAttribute("xml:lang",s.lang),a.children.push(i),n.appendChild(a)}}}}},t.multipleChildAlternateLanguageText=function(e,t){return{importer(n,i){const r=[],s=new Map;let o=!1;const c=l(n,e||n.getNamespace(),t);for(const e of c){const t=e.getText();if(t){const n=a(e,i.lang);let c=s.get(n);c||(c=[],s.set(n,c),r.push({lang:n,value:c})),c.push(t),o=!0}}return o?r:void 0},exporter(n,i,r){for(const s of i)for(const i of s.value){const a=o(e||n.getNamespace(),t,r.namespace,n);s.lang!==r.lang&&a.setAttribute("xml:lang",s.lang),a.children.push(i),n.appendChild(a)}}}},t.multipleChildEnum=function(e,t){const n=new Map,i=new Map;for(const e of t)"string"==typeof e?(n.set(e,e),i.set(e,e)):(n.set(e[1],e[0]),i.set(e[0],e[1]));return{importer(t){const i=[];for(const r of t.children)"string"!=typeof r&&r.getNamespace()===(e||t.getNamespace())&&n.has(r.getName())&&i.push(n.get(r.getName()));return i},exporter(t,n){for(const r of n)u(t,e,i.get(r))}}},t.splicePath=function(e,t,n,i=!1){return{importer(r,s){const o=r.getChild(t,e||r.getNamespace());if(!o)return;const a=[];for(const e of o.children)if("string"!=typeof e&&s.registry.getImportKey(e)===n){const t=s.registry.import(e);t&&a.push(t)}return i?a:a[0]},exporter(i,r,s){let o=[];o=Array.isArray(r)?r:[r];const a=[];for(const t of o){const r=s.registry.export(n,t,{...s,namespace:e||i.getNamespace()||void 0});r&&a.push(r)}if(a.length){const n=u(i,e||i.getNamespace(),t);for(const e of a)n.appendChild(e)}}}},t.staticValue=function(e){return{exporter:()=>{},importer:()=>e}},t.childRawElement=function(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=i.getChild(t,e||i.getNamespace());return s?n?r.sanitizers[n](s.toJSON()):s.toJSON():void 0},exporter(i,o,a){if("string"==typeof o){o=s.parse(`<${t} xmlns="${e||i.getNamespace()}">${o}</${t}>`).toJSON()}if(n){if(!a.sanitizers||!a.sanitizers[n])return;o=a.sanitizers[n](o)}o&&i.appendChild(new r.default(o.name,o.attributes,o.children))}}},t.childLanguageRawElement=function(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=l(i,e||i.getNamespace(),t),o=c(s,r);for(const e of s)if(a(e,r.lang)===o)return n?r.sanitizers[n](e.toJSON()):e.toJSON();return s[0]?n?r.sanitizers[n](s[0].toJSON()):s[0].toJSON():void 0},exporter(i,o,a){if("string"==typeof o){o=s.parse(`<${t} xmlns="${e||i.getNamespace()}">${o}</${t}>`).toJSON()}if(o&&n){if(!a.sanitizers||!a.sanitizers[n])return;o=a.sanitizers[n](o)}if(!o)return;const c=u(i,e||i.getNamespace(),t,a.lang);for(const e of o.children)"string"==typeof e?c.appendChild(e):e&&c.appendChild(new r.default(e.name,e.attributes,e.children))}}},t.childAlternateLanguageRawElement=function(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=[],o=new Set,c=l(i,e||i.getNamespace(),t);for(const e of c){let t=e.toJSON();if(n&&(t=r.sanitizers[n](t)),t){const n=a(e,r.lang);if(o.has(n))continue;s.push({lang:n,value:t}),o.add(n)}}return o.size>0?s:void 0},exporter(i,a,c){for(const l of a){let a=l.value;if("string"==typeof a){a=s.parse(`<${t} xmlns="${e||i.getNamespace()}">${a}</${t}>`).toJSON()}if(a&&n){if(!c.sanitizers||!c.sanitizers[n])continue;a=c.sanitizers[n](a)}if(a){const n=o(e||i.getNamespace(),t,c.namespace,i);i.appendChild(n),l.lang!==c.lang&&n.setAttribute("xml:lang",l.lang);for(const e of a.children)"string"==typeof e?n.appendChild(e):n.appendChild(new r.default(e.name,e.attributes,e.children))}}}}},t.parameterMap=function(e,n,i,r){return{importer(s,o){const a={},c=l(s,e,n),u=t.attribute(i).importer,p=t.attribute(r).importer;for(const e of c)a[u(e,o)]=p(e,o);return a},exporter(s,a,c){const l=t.attribute(i).exporter,u=t.attribute(r).exporter,p=e||s.getNamespace();for(const[e,t]of Object.entries(a)){const i=o(p,n,c.namespace,s);l(i,e,c),a[e]&&u(i,t,c),s.appendChild(i)}}}}},7583:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.define=t.XMLElement=t.Translator=t.Registry=t.StreamParser=t.parse=t.Parser=void 0;const i=n(655),r=i.__importDefault(n(8821));t.XMLElement=r.default;const s=i.__importDefault(n(7046));t.Registry=s.default;const o=i.__importDefault(n(5587));t.Translator=o.default,i.__exportStar(n(7316),t),i.__exportStar(n(3921),t),i.__exportStar(n(3229),t);var a=n(4041);Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return i.__importDefault(a).default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return a.parse}});var c=n(5696);Object.defineProperty(t,"StreamParser",{enumerable:!0,get:function(){return i.__importDefault(c).default}}),t.define=function(e){return t=>{t.define(e)}}},5335:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=new Set(["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul"]),i=new Set(["style"]),r=new Map([["a",new Set(["href","style"])],["body",new Set(["style","xml:lang"])],["blockquote",i],["br",i],["cite",i],["em",i],["img",new Set(["alt","height","src","style","width"])],["li",i],["ol",i],["p",i],["span",i],["strong",i],["ul",i]]),s=new Map([["font-style",/normal|italic|oblique|inherit/i],["font-weight",/normal|bold|bolder|lighter|inherit|\d\d\d/i],["text-decoration",/none|underline|overline|line-through|blink|inherit/i]]),o=e=>!!e.match(/^(https?|xmpp|cid|mailto|ftps?|im|ircs?|sips?|tel|geo|bitcoin|magnet):/i)&&e,a=e=>!!e.match(/^[0-9]*$/)&&e,c={alt:e=>e,height:a,href:o,src:o,style:e=>{const t=`;${e}`.replace(/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,"").replace(/\/\*.*/,"").replace(/\\([a-fA-F0-9]{1,6})\s?/,((e,t)=>String.fromCharCode(parseInt(t,16)))).match(/;\s*([a-z-]+)\s*:\s*([^;]*[^\s;])\s*/g),n=[];if(!t)return!1;for(const e of t){const t=e.match(/^;\s*([a-z-]+)\s*:\s*([^;]*[^\s])\s*$/);if(!t)continue;const i=s.get(t[1]);if(i){const e=t[2].match(i);e&&n.push(`${t[1]}:${e[0]}`)}}return!!n.length&&n.join("")},width:a};function l(e){if("string"==typeof e)return e;if(!n.has(e.name)){if("script"===e.name)return;return function(e){let t=[];for(const n of e.children)if("string"==typeof n)t.push(n);else{const e=l(n);e&&(Array.isArray(e)?t=t.concat(e):t.push(e))}return t}(e)}const t=e.children.map(l).filter((e=>void 0!==e)),i={};for(const[t,n]of Object.entries(e.attributes)){const s=r.get(e.name);if(!s||!s.has(t))continue;if(!n)continue;const o=c[t](n);o&&(i[t]=o)}return{attributes:i,children:t,name:e.name}}t.default=function(e){if("string"==typeof e)return;let t=[];for(const n of e.children){if(!n)continue;if("string"==typeof n){t.push(n);continue}const e=l(n);Array.isArray(e)?t=t.concat(e):e&&t.push(e)}const n={};return"body"===e.name?(void 0!==e.attributes.xmlns&&(n.xmlns=e.attributes.xmlns),e.attributes.style&&(n.style=e.attributes.style),void 0!==e.attributes["xml:lang"]&&(n["xml:lang"]=e.attributes["xml:lang"]),{attributes:n,children:t,name:"body"}):void 0}},1568:function(e,t,n){"use strict";n.d(t,{G6:function(){return at},Ku:function(){return Ns},eI:function(){return zl}});var i=n(655),r=n(4155);function s(e){return function(...t){var n=t.pop();return e.call(this,t,n)}}var o="function"==typeof queueMicrotask&&queueMicrotask,a="function"==typeof setImmediate&&setImmediate,c="object"==typeof r&&"function"==typeof r.nextTick;function l(e){setTimeout(e,0)}function u(e){return(t,...n)=>e((()=>t(...n)))}var p=u(o?queueMicrotask:a?setImmediate:c?r.nextTick:l);function d(e){return m(e)?function(...t){const n=t.pop();return h(e.apply(this,t),n)}:s((function(t,n){var i;try{i=e.apply(this,t)}catch(e){return n(e)}if(i&&"function"==typeof i.then)return h(i,n);n(null,i)}))}function h(e,t){return e.then((e=>{f(t,null,e)}),(e=>{f(t,e&&e.message?e:new Error(e))}))}function f(e,t,n){try{e(t,n)}catch(e){p((e=>{throw e}),e)}}function m(e){return"AsyncFunction"===e[Symbol.toStringTag]}function g(e){if("function"!=typeof e)throw new Error("expected a function");return m(e)?d(e):e}function y(e,t=e.length){if(!t)throw new Error("arity is undefined");return function(...n){return"function"==typeof n[t-1]?e.apply(this,n):new Promise(((i,r)=>{n[t-1]=(e,...t)=>{if(e)return r(e);i(t.length>1?t:t[0])},e.apply(this,n)}))}}function v(e){return function(t,...n){return y((function(i){var r=this;return e(t,((e,t)=>{g(e).apply(r,n.concat(t))}),i)}))}}function b(e,t,n,i){t=t||[];var r=[],s=0,o=g(n);return e(t,((e,t,n)=>{var i=s++;o(e,((e,t)=>{r[i]=t,n(e)}))}),(e=>{i(e,r)}))}function _(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0}const w={};function S(e){function t(...t){if(null!==e){var n=e;e=null,n.apply(this,t)}}return Object.assign(t,e),t}function x(e){if(_(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t,n,i,r,s=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()}(e);return s?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(s):(n=(t=e)?Object.keys(t):[],i=-1,r=n.length,function(){var e=n[++i];return i<r?{value:t[e],key:e}:null})}function T(e){return function(...t){if(null===e)throw new Error("Callback was already called.");var n=e;e=null,n.apply(this,t)}}function E(e,t,n,i){let r=!1,s=!1,o=!1,a=0,c=0;function l(){a>=t||o||r||(o=!0,e.next().then((({value:e,done:t})=>{if(!s&&!r){if(o=!1,t)return r=!0,void(a<=0&&i(null));a++,n(e,c,u),c++,l()}})).catch(p))}function u(e,t){if(a-=1,!s)return e?p(e):!1===e?(r=!0,void(s=!0)):t===w||r&&a<=0?(r=!0,i(null)):void l()}function p(e){s||(o=!1,r=!0,i(e))}l()}var I=e=>(t,n,i)=>{if(i=S(i),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return i(null);if("AsyncGenerator"===t[Symbol.toStringTag])return E(t,e,n,i);if(function(e){return"function"==typeof e[Symbol.asyncIterator]}(t))return E(t[Symbol.asyncIterator](),e,n,i);var r=x(t),s=!1,o=!1,a=0,c=!1;function l(e,t){if(!o)if(a-=1,e)s=!0,i(e);else if(!1===e)s=!0,o=!0;else{if(t===w||s&&a<=0)return s=!0,i(null);c||u()}}function u(){for(c=!0;a<e&&!s;){var t=r();if(null===t)return s=!0,void(a<=0&&i(null));a+=1,n(t.value,t.key,T(l))}c=!1}u()};var N=y((function(e,t,n,i){return I(t)(e,g(n),i)}),4);function k(e,t,n){n=S(n);var i=0,r=0,{length:s}=e,o=!1;function a(e,t){!1===e&&(o=!0),!0!==o&&(e?n(e):++r!==s&&t!==w||n(null))}for(0===s&&n(null);i<s;i++)t(e[i],i,T(a))}function A(e,t,n){return N(e,1/0,t,n)}var O=y((function(e,t,n){return(_(e)?k:A)(e,g(t),n)}),3);var j=y((function(e,t,n){return b(O,e,t,n)}),3);v(j);var C=y((function(e,t,n){return N(e,1,t,n)}),3);var R=y((function(e,t,n){return b(C,e,t,n)}),3);v(R);Symbol("promiseCallback");class P{constructor(){this.head=this.tail=null,this.length=0}removeLink(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e}empty(){for(;this.head;)this.shift();return this}insertAfter(e,t){t.prev=e,t.next=e.next,e.next?e.next.prev=t:this.tail=t,e.next=t,this.length+=1}insertBefore(e,t){t.prev=e.prev,t.next=e,e.prev?e.prev.next=t:this.head=t,e.prev=t,this.length+=1}unshift(e){this.head?this.insertBefore(this.head,e):L(this,e)}push(e){this.tail?this.insertAfter(this.tail,e):L(this,e)}shift(){return this.head&&this.removeLink(this.head)}pop(){return this.tail&&this.removeLink(this.tail)}toArray(){return[...this]}*[Symbol.iterator](){for(var e=this.head;e;)yield e.data,e=e.next}remove(e){for(var t=this.head;t;){var{next:n}=t;e(t)&&this.removeLink(t),t=n}return this}}function L(e,t){e.length=1,e.head=e.tail=t}function M(e,t,n){if(null==t)t=1;else if(0===t)throw new RangeError("Concurrency must not be zero");var i=g(e),r=0,s=[];const o={error:[],drain:[],saturated:[],unsaturated:[],empty:[]};function a(e,t){return e?t?void(o[e]=o[e].filter((e=>e!==t))):o[e]=[]:Object.keys(o).forEach((e=>o[e]=[]))}function c(e,...t){o[e].forEach((e=>e(...t)))}var l=!1;function u(e,t,n,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");var r,s;function o(e,...t){return e?n?s(e):r():t.length<=1?r(t[0]):void r(t)}y.started=!0;var a={data:e,callback:n?o:i||o};if(t?y._tasks.unshift(a):y._tasks.push(a),l||(l=!0,p((()=>{l=!1,y.process()}))),n||!i)return new Promise(((e,t)=>{r=e,s=t}))}function d(e){return function(t,...n){r-=1;for(var i=0,o=e.length;i<o;i++){var a=e[i],l=s.indexOf(a);0===l?s.shift():l>0&&s.splice(l,1),a.callback(t,...n),null!=t&&c("error",t,a.data)}r<=y.concurrency-y.buffer&&c("unsaturated"),y.idle()&&c("drain"),y.process()}}function h(e){return!(0!==e.length||!y.idle())&&(p((()=>c("drain"))),!0)}const f=e=>t=>{if(!t)return new Promise(((t,n)=>{!function(e,t){const n=(...i)=>{a(e,n),t(...i)};o[e].push(n)}(e,((e,i)=>{if(e)return n(e);t(i)}))}));a(e),function(e,t){o[e].push(t)}(e,t)};var m=!1,y={_tasks:new P,*[Symbol.iterator](){yield*y._tasks[Symbol.iterator]()},concurrency:t,payload:n,buffer:t/4,started:!1,paused:!1,push(e,t){if(Array.isArray(e)){if(h(e))return;return e.map((e=>u(e,!1,!1,t)))}return u(e,!1,!1,t)},pushAsync(e,t){if(Array.isArray(e)){if(h(e))return;return e.map((e=>u(e,!1,!0,t)))}return u(e,!1,!0,t)},kill(){a(),y._tasks.empty()},unshift(e,t){if(Array.isArray(e)){if(h(e))return;return e.map((e=>u(e,!0,!1,t)))}return u(e,!0,!1,t)},unshiftAsync(e,t){if(Array.isArray(e)){if(h(e))return;return e.map((e=>u(e,!0,!0,t)))}return u(e,!0,!0,t)},remove(e){y._tasks.remove(e)},process(){if(!m){for(m=!0;!y.paused&&r<y.concurrency&&y._tasks.length;){var e=[],t=[],n=y._tasks.length;y.payload&&(n=Math.min(n,y.payload));for(var o=0;o<n;o++){var a=y._tasks.shift();e.push(a),s.push(a),t.push(a.data)}r+=1,0===y._tasks.length&&c("empty"),r===y.concurrency&&c("saturated");var l=T(d(e));i(t,l)}m=!1}},length:()=>y._tasks.length,running:()=>r,workersList:()=>s,idle:()=>y._tasks.length+r===0,pause(){y.paused=!0},resume(){!1!==y.paused&&(y.paused=!1,p(y.process))}};return Object.defineProperties(y,{saturated:{writable:!1,value:f("saturated")},unsaturated:{writable:!1,value:f("unsaturated")},empty:{writable:!1,value:f("empty")},drain:{writable:!1,value:f("drain")},error:{writable:!1,value:f("error")}}),y}y((function(e,t,n,i){i=S(i);var r=g(n);return C(e,((e,n,i)=>{r(t,e,((e,n)=>{t=n,i(e)}))}),(e=>i(e,t)))}),4);var F=y((function(e,t,n,i){return b(I(t),e,n,i)}),4);var D=y((function(e,t,n,i){var r=g(n);return F(e,t,((e,t)=>{r(e,((e,...n)=>e?t(e):t(e,n)))}),((e,t)=>{for(var n=[],r=0;r<t.length;r++)t[r]&&(n=n.concat(...t[r]));return i(e,n)}))}),4);y((function(e,t,n){return D(e,1/0,t,n)}),3);y((function(e,t,n){return D(e,1,t,n)}),3);function q(e,t){return(n,i,r,s)=>{var o,a=!1;const c=g(r);n(i,((n,i,r)=>{c(n,((i,s)=>i||!1===i?r(i):e(s)&&!o?(a=!0,o=t(!0,n),r(null,w)):void r()))}),(e=>{if(e)return s(e);s(null,a?o:t(!1))}))}}y((function(e,t,n){return q((e=>e),((e,t)=>t))(O,e,t,n)}),3);y((function(e,t,n,i){return q((e=>e),((e,t)=>t))(I(t),e,n,i)}),4);y((function(e,t,n){return q((e=>e),((e,t)=>t))(I(1),e,t,n)}),3);function U(e){return(t,...n)=>g(t)(...n,((t,...n)=>{"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&n.forEach((t=>console[e](t))))}))}U("dir");y((function(e,t,n){n=T(n);var i,r=g(e),s=g(t);function o(e,...t){if(e)return n(e);!1!==e&&(i=t,s(...t,a))}function a(e,t){return e?n(e):!1!==e?t?void r(o):n(null,...i):void 0}return a(null,!0)}),3);function B(e){return(t,n,i)=>e(t,i)}y((function(e,t,n){return O(e,B(g(t)),n)}),3);var G=y((function(e,t,n,i){return I(t)(e,B(g(n)),i)}),4);var J=y((function(e,t,n){return G(e,1,t,n)}),3);function z(e){return m(e)?e:function(...t){var n=t.pop(),i=!0;t.push(((...e)=>{i?p((()=>n(...e))):n(...e)})),e.apply(this,t),i=!1}}y((function(e,t,n){return q((e=>!e),(e=>!e))(O,e,t,n)}),3);y((function(e,t,n,i){return q((e=>!e),(e=>!e))(I(t),e,n,i)}),4);y((function(e,t,n){return q((e=>!e),(e=>!e))(C,e,t,n)}),3);function X(e,t,n,i){var r=new Array(t.length);e(t,((e,t,i)=>{n(e,((e,n)=>{r[t]=!!n,i(e)}))}),(e=>{if(e)return i(e);for(var n=[],s=0;s<t.length;s++)r[s]&&n.push(t[s]);i(null,n)}))}function $(e,t,n,i){var r=[];e(t,((e,t,i)=>{n(e,((n,s)=>{if(n)return i(n);s&&r.push({index:t,value:e}),i(n)}))}),(e=>{if(e)return i(e);i(null,r.sort(((e,t)=>e.index-t.index)).map((e=>e.value)))}))}function V(e,t,n,i){return(_(t)?X:$)(e,t,g(n),i)}y((function(e,t,n){return V(O,e,t,n)}),3);y((function(e,t,n,i){return V(I(t),e,n,i)}),4);y((function(e,t,n){return V(C,e,t,n)}),3);y((function(e,t){var n=T(t),i=g(z(e));return function e(t){if(t)return n(t);!1!==t&&i(e)}()}),2);y((function(e,t,n,i){var r=g(n);return F(e,t,((e,t)=>{r(e,((n,i)=>n?t(n):t(n,{key:i,val:e})))}),((e,t)=>{for(var n={},{hasOwnProperty:r}=Object.prototype,s=0;s<t.length;s++)if(t[s]){var{key:o}=t[s],{val:a}=t[s];r.call(n,o)?n[o].push(a):n[o]=[a]}return i(e,n)}))}),4);U("log");y((function(e,t,n,i){i=S(i);var r={},s=g(n);return I(t)(e,((e,t,n)=>{s(e,t,((e,i)=>{if(e)return n(e);r[t]=i,n(e)}))}),(e=>i(e,r)))}),4);u(c?r.nextTick:a?setImmediate:l),y(((e,t,n)=>{var i=_(t)?[]:{};e(t,((e,t,n)=>{g(e)(((e,...r)=>{r.length<2&&([r]=r),i[t]=r,n(e)}))}),(e=>n(e,i)))}),3);function H(e,t){var n=g(e);return M(((e,t)=>{n(e[0],t)}),t,1)}class W{constructor(){this.heap=[],this.pushCount=Number.MIN_SAFE_INTEGER}get length(){return this.heap.length}empty(){return this.heap=[],this}percUp(e){let t;for(;e>0&&K(this.heap[e],this.heap[t=Q(e)]);){let n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,e=t}}percDown(e){let t;for(;(t=1+(e<<1))<this.heap.length&&(t+1<this.heap.length&&K(this.heap[t+1],this.heap[t])&&(t+=1),!K(this.heap[e],this.heap[t]));){let n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,e=t}}push(e){e.pushCount=++this.pushCount,this.heap.push(e),this.percUp(this.heap.length-1)}unshift(e){return this.heap.push(e)}shift(){let[e]=this.heap;return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.percDown(0),e}toArray(){return[...this]}*[Symbol.iterator](){for(let e=0;e<this.heap.length;e++)yield this.heap[e].data}remove(e){let t=0;for(let n=0;n<this.heap.length;n++)e(this.heap[n])||(this.heap[t]=this.heap[n],t++);this.heap.splice(t);for(let e=Q(this.heap.length-1);e>=0;e--)this.percDown(e);return this}}function Q(e){return(e+1>>1)-1}function K(e,t){return e.priority!==t.priority?e.priority<t.priority:e.pushCount<t.pushCount}function Y(e,t){var n=H(e,t),i=!1;return n._tasks=new W,n.push=function(e,t=0,r=(()=>{})){if("function"!=typeof r)throw new Error("task callback must be a function");if(n.started=!0,Array.isArray(e)||(e=[e]),0===e.length&&n.idle())return p((()=>n.drain()));for(var s=0,o=e.length;s<o;s++){var a={data:e[s],priority:t,callback:r};n._tasks.push(a)}i||(i=!0,p((()=>{i=!1,n.process()})))},delete n.unshift,n}y((function(e,t){if(t=S(t),!Array.isArray(e))return t(new TypeError("First argument to race must be an array of functions"));if(!e.length)return t();for(var n=0,i=e.length;n<i;n++)g(e[n])(t)}),2);function Z(e,t,n,i){const r=g(n);return V(e,t,((e,t)=>{r(e,((e,n)=>{t(e,!n)}))}),i)}y((function(e,t,n){return Z(O,e,t,n)}),3);y((function(e,t,n,i){return Z(I(t),e,n,i)}),4);y((function(e,t,n){return Z(C,e,t,n)}),3);y((function(e,t,n){return q(Boolean,(e=>e))(O,e,t,n)}),3);y((function(e,t,n,i){return q(Boolean,(e=>e))(I(t),e,n,i)}),4);y((function(e,t,n){return q(Boolean,(e=>e))(C,e,t,n)}),3);y((function(e,t,n){var i=g(t);return j(e,((e,t)=>{i(e,((n,i)=>{if(n)return t(n);t(n,{value:e,criteria:i})}))}),((e,t)=>{if(e)return n(e);n(null,t.sort(r).map((e=>e.value)))}));function r(e,t){var n=e.criteria,i=t.criteria;return n<i?-1:n>i?1:0}}),3);y((function(e,t){var n,i=null;return J(e,((e,t)=>{g(e)(((e,...r)=>{if(!1===e)return t(e);r.length<2?[n]=r:n=r,i=e,t(e?null:{})}))}),(()=>t(i,n)))}));y((function(e,t,n){n=T(n);var i=g(t),r=g(e),s=[];function o(e,...t){if(e)return n(e);s=t,!1!==e&&r(a)}function a(e,t){return e?n(e):!1!==e?t?void i(o):n(null,...s):void 0}return r(a)}),3);y((function(e,t){if(t=S(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var n=0;function i(t){g(e[n++])(...t,T(r))}function r(r,...s){if(!1!==r)return r||n===e.length?t(r,...s):void i(s)}i([])}));var ee=n(7187);const te=2147483647,ne=36,ie=/^xn--/,re=/[^\0-\x7E]/,se=/[\x2E\u3002\uFF0E\uFF61]/g,oe={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},ae=Math.floor,ce=String.fromCharCode;function le(e){throw new RangeError(oe[e])}function ue(e,t){const n=e.split("@");let i="";n.length>1&&(i=n[0]+"@",e=n[1]);const r=function(e,t){const n=[];let i=e.length;for(;i--;)n[i]=t(e[i]);return n}((e=e.replace(se,".")).split("."),t).join(".");return i+r}function pe(e){const t=[];let n=0;const i=e.length;for(;n<i;){const r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){const i=e.charCodeAt(n++);56320==(64512&i)?t.push(((1023&r)<<10)+(1023&i)+65536):(t.push(r),n--)}else t.push(r)}return t}const de=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},he=function(e,t,n){let i=0;for(e=n?ae(e/700):e>>1,e+=ae(e/t);e>455;i+=ne)e=ae(e/35);return ae(i+36*e/(e+38))},fe=function(e){const t=[],n=e.length;let i=0,r=128,s=72,o=e.lastIndexOf("-");o<0&&(o=0);for(let n=0;n<o;++n)e.charCodeAt(n)>=128&&le("not-basic"),t.push(e.charCodeAt(n));for(let c=o>0?o+1:0;c<n;){let o=i;for(let t=1,r=ne;;r+=ne){c>=n&&le("invalid-input");const o=(a=e.charCodeAt(c++))-48<10?a-22:a-65<26?a-65:a-97<26?a-97:ne;(o>=ne||o>ae((te-i)/t))&&le("overflow"),i+=o*t;const l=r<=s?1:r>=s+26?26:r-s;if(o<l)break;const u=ne-l;t>ae(te/u)&&le("overflow"),t*=u}const l=t.length+1;s=he(i-o,l,0==o),ae(i/l)>te-r&&le("overflow"),r+=ae(i/l),i%=l,t.splice(i++,0,r)}var a;return String.fromCodePoint(...t)},me=function(e){const t=[];let n=(e=pe(e)).length,i=128,r=0,s=72;for(const n of e)n<128&&t.push(ce(n));let o=t.length,a=o;for(o&&t.push("-");a<n;){let n=te;for(const t of e)t>=i&&t<n&&(n=t);const c=a+1;n-i>ae((te-r)/c)&&le("overflow"),r+=(n-i)*c,i=n;for(const n of e)if(n<i&&++r>te&&le("overflow"),n==i){let e=r;for(let n=ne;;n+=ne){const i=n<=s?1:n>=s+26?26:n-s;if(e<i)break;const r=e-i,o=ne-i;t.push(ce(de(i+r%o,0))),e=ae(r/o)}t.push(ce(de(e,0))),s=he(r,c,a==o),r=0,++a}++r,++i}return t.join("")};var ge={version:"2.1.0",ucs2:{decode:pe,encode:e=>String.fromCodePoint(...e)},decode:fe,encode:me,toASCII:function(e){return ue(e,(function(e){return re.test(e)?"xn--"+me(e):e}))},toUnicode:function(e){return ue(e,(function(e){return ie.test(e)?fe(e.slice(4).toLowerCase()):e}))}},ye=n(8473),ve=n(7539),be=n(8764).Buffer;const _e=Math.pow(2,32),we=(e,t)=>(e%t+t)%t;class Se extends ee.EventEmitter{constructor(){super(),this.allowResume=!0,this.lastAck=0,this.handled=0,this.unacked=[],this.inboundStarted=!1,this.outboundStarted=!1,this.id=void 0,this.jid=void 0,this.allowResume=!0,this.started=!1,this.cacheHandler=()=>{},this._reset()}get started(){return this.outboundStarted&&this.inboundStarted}set started(e){e||(this.outboundStarted=!1,this.inboundStarted=!1)}get resumable(){return this.started&&this.allowResume}load(e){var t;this.id=e.id,this.allowResume=null===(t=e.allowResume)||void 0===t||t,this.handled=e.handled,this.lastAck=e.lastAck,this.unacked=e.unacked,this.emit("prebound",e.jid)}cache(e){this.cacheHandler=e}bind(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.jid=e,yield this._cache()}))}enable(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.emit("send",{allowResumption:this.allowResume,type:"enable"})}))}resume(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.emit("send",{handled:this.handled,previousSession:this.id,type:"resume"})}))}enabled(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.id=e.id,this.handled=0,this.inboundStarted=!0,yield this._cache()}))}resumed(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.id=e.previousSession,this.inboundStarted=!0,yield this.process(e,!0),yield this._cache()}))}failed(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){yield this.process(e);for(const[e,t]of this.unacked)this.emit("failed",{kind:e,stanza:t});this._reset(),yield this._cache()}))}ack(){this.emit("send",{handled:this.handled,type:"ack"})}request(){this.emit("send",{type:"request"})}process(e,t=!1){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(void 0===e.handled)return;const n=we(e.handled-this.lastAck,_e);for(let e=0;e<n&&this.unacked.length>0;e++){const[e,t]=this.unacked.shift();this.emit("acked",{kind:e,stanza:t})}if(this.lastAck=e.handled,t){const e=this.unacked;if(this.unacked=[],e.length){this.emit("begin-resend");for(const[t,n]of e)this.emit("resend",{kind:t,stanza:n});this.emit("end-resend")}}yield this._cache()}))}track(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){return"sm"!==e||"enable"!==t.type&&"resume"!==t.type?!!this.outboundStarted&&(("message"===e||"presence"===e||"iq"===e)&&(this.unacked.push([e,t]),yield this._cache(),!0)):(this.handled=0,this.outboundStarted=!0,yield this._cache(),!1)}))}handle(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.inboundStarted&&(this.handled=we(this.handled+1,_e),yield this._cache())}))}hibernate(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(!this.resumable)return this.shutdown();for(const[e,t]of this.unacked)this.emit("hibernated",{kind:e,stanza:t})}))}shutdown(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){return this.failed({type:"failed"})}))}_cache(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){try{yield this.cacheHandler({allowResume:this.allowResume,handled:this.handled,id:this.id,jid:this.jid,lastAck:this.lastAck,unacked:this.unacked})}catch(e){console.error("Failed to cache stream state",e)}}))}_reset(){this.id="",this.inboundStarted=!1,this.outboundStarted=!1,this.lastAck=0,this.handled=0,this.unacked=[]}}const xe={"A.1":{r:"hk:if|le:lf|nf:nv|qg:qv|rg:rj|rm:rp|rr:rt|rv:s3|vn:vv|17m:17n|17q:17v|18g:19g|1an:1ao|1cb:1cg|1e5:1ef|1fb:1ff|1fl:1gb|1gd:1gq|1gs:1gu|1hr:1hv|1im:1iv|1ne:1nf|1pd:1pf|1qb:1rv|1ti:280|29q:29r|2ae:2af|2al:2an|2bh:2c0|2cd:2ce|2ch:2ci|2dj:2dl|2dq:2dr|2e5:2e6|2e9:2ea|2ee:2em|2eo:2er|2f4:2f5|2fr:2g1|2g3:2g4|2gb:2ge|2gh:2gi|2hq:2hr|2i3:2i6|2i9:2ia|2ie:2io|2iv:2j5|2jl:2k0|2lq:2lr|2me:2mf|2mh:2mv|2n1:2n5|2ng:2o0|2od:2oe|2oh:2oi|2pk:2pl|2pq:2pr|2q4:2q6|2q9:2qa|2qe:2ql|2qo:2qr|2r2:2r5|2rh:2s1|2sb:2sd|2sm:2so|2t0:2t2|2t5:2t7|2tb:2td|2tq:2tt|2u3:2u5|2ue:2um|2uo:2v6|2vj:300|31q:31t|32e:32k|32n:32v|332:335|33g:341|35q:35t|36e:36k|36n:36t|372:375|37g:381|39q:39t|3a4:3a5|3ae:3am|3ao:3av|3b2:3b5|3bg:3c1|3cn:3cp|3du:3dv|3e7:3e9|3eb:3ee|3f0:3fh|3fl:3g0|3hr:3hu|3is:3k0|3k5:3k6|3kb:3kc|3ke:3kj|3l8:3l9|3lu:3lv|3me:3mf|3mq:3mr|3mu:3nv|3rb:3rg|3sc:3sf|3ud:3ue|3ug:3vv|41j:41l|41q:41v|42q:44v|466:46f|47p:47q|47s:47v|4aq:4au|4d3:4d7|4fq:4fv|4ie:4if|4iu:4iv|4ke:4kf|4lm:4ln|4m6:4m7|4om:4on|4qr:4r0|4rt:4sv|4vl:500|5jn:5jv|5kt:5kv|5nh:5nv|5ol:5ov|5pn:5pv|5qk:5qv|5rk:5rv|5ut:5uv|5va:5vv|60q:60v|63o:63v|65a:7fv|7ks:7kv|7nq:7nv|7om:7on|7ou:7ov|7q6:7q7|7qe:7qf|7ru:7rv|7uk:7ul|7vg:7vh|82j:82m|82o:82u|834:839|83i:83j|84f:84v|85i:86f|87b:87v|89r:89s|8ac:8ai|8c4:8cf|8uf:8vv|917:91v|92b:92v|9gk:9gl|9ju:9jv|9ka:9o0|9oa:9ob|9qj:9ql|9qv:9r0|9sl:9sn|9tv:9uf|9vc:9vf|ao0:bjv|bnk:bnv|bum:bvf|bvs:bvv|c4n:c4o|c80:c84|c9d:c9g|cdo:cff|cgt:cgv|ci4:cig|cjs:cju|cmc:cmf|crn:crq|cuu:cuv|jdm:jfv|17t6:17vv|194d:194f|1967:1avv|1lt4:1lvv|1uhe:1uhf|1ujb:1unv|1uo7:1uoi|1uoo:1uos|1uti:1uui|1va0:1vaf|1vcg:1vch|1ve8:1vef|1vft:1vfv|1vgg:1vgv|1vh4:1vhf|1vi7:1vi8|1vjc:1vjf|1vnt:1vnu|1vtv:1vu1|1vu8:1vu9|1vug:1vuh|1vuo:1vup|1vut:1vuv|1vvf:1vvo|2000:20nv|20p4:20pf|20qb:20vv|2116:2117|212e:3jvv|3k7m:3k7v|3k97:3k99|3keu:3kvv|3l50:3l51|3l53:3l54|3l57:3l58|3l8b:3l8c|3la7:3la9|3ll4:3ll7|3lua:3lud|3m00:3vvt|59mn:5tvv|5ugu:5vvt|6000:7vvt|8000:9vvt|a000:bvvt|c000:dvvt|e000:fvvt|g000:hvvt|i000:jvvt|k000:lvvt|m000:nvvt|o000:pvvt|q000:rvvt|s002:s00v|s040:tvvt",s:"9p8|9qc|9qe|9qn|9tg|147|bkq|3l2l|3l4t|3l5d|3l5q|3l5s|3l61|3l64|3l86|3l8l|3l8t|3l9q|3l9v|3la5|3lah|16f|c20|ccf|cnv|cvv|1b0|1c8|1d2|1dq|1h0|1nv|1oe|284|2c4|2d9|2dh|2dt|2eu|2h9|2hh|2hk|2hn|2ht|2it|2k4|2kc|2ke|2ki|2l9|2lh|2lk|2m6|2ma|2o4|2p9|2ph|2qu|2s4|2sh|2sr|2st|2tm|2u9|304|30d|30h|319|31k|325|329|344|34d|34h|359|35k|365|369|36v|384|38d|38h|399|3a9|3c4|3di|3ds|3el|3en|3k3|3k9|3ko|3l0|3l4|3l6|3lc|3lq|3m5|3m7|3q8|3so|3tt|412|418|41b|4g7|4i7|4i9|4in|4ip|4k7|4k9|4lf|4lh|4lv|4m1|4mf|4mn|4nf|4of|4oh|4ov|4q7|h1|5od|5rd|5rh|60f|1upn|1upt|1upv|1uq2|1uq5|1vij|1vj7|1vjl|1vo0|1vv7|20ov|7qo|7qq|7qs|7qu|7tl|7u5|7us|7vl|7vv|sb|sd|s000|t2|97v|uf|9go|9o5"},"B.1":{r:"60b:60d|80b:80d|1vg0:1vgf",s:"5d|606|1vnv|830|qf"},"B.2":{m:"5l:ts|6v:3j;3j|9g:39;o7|a9:ls;3e|bv:3j|fg:3a;oc|q5:tp|rq:10;tp|sg:tp;o8;o1|tg:u5;o8;o1|u2:u3|ug:ti|uh:to|ui:u5|uj:ud|uk:ub|ul:u6|um:u0|vg:tq|vh:u1|vi:u3|vl:tl|1c7:1b5;1c2|7km:38;ph|7kn:3k;o8|7ko:3n;oa|7kp:3p;oa|7kq:31;lu|7kr:7j1|7qg:u5;oj|7qi:u5;oj;o0|7qk:u5;oj;o1|7qm:u5;oj;q2|7s0:7o0;tp|7s1:7o1;tp|7s2:7o2;tp|7s3:7o3;tp|7s4:7o4;tp|7s5:7o5;tp|7s6:7o6;tp|7s7:7o7;tp|7s8:7o0;tp|7s9:7o1;tp|7sa:7o2;tp|7sb:7o3;tp|7sc:7o4;tp|7sd:7o5;tp|7se:7o6;tp|7sf:7o7;tp|7sg:7p0;tp|7sh:7p1;tp|7si:7p2;tp|7sj:7p3;tp|7sk:7p4;tp|7sl:7p5;tp|7sm:7p6;tp|7sn:7p7;tp|7so:7p0;tp|7sp:7p1;tp|7sq:7p2;tp|7sr:7p3;tp|7ss:7p4;tp|7st:7p5;tp|7su:7p6;tp|7sv:7p7;tp|7t0:7r0;tp|7t1:7r1;tp|7t2:7r2;tp|7t3:7r3;tp|7t4:7r4;tp|7t5:7r5;tp|7t6:7r6;tp|7t7:7r7;tp|7t8:7r0;tp|7t9:7r1;tp|7ta:7r2;tp|7tb:7r3;tp|7tc:7r4;tp|7td:7r5;tp|7te:7r6;tp|7tf:7r7;tp|7ti:7rg;tp|7tj:th;tp|7tk:tc;tp|7tm:th;q2|7tn:th;q2;tp|7ts:th;tp|7tu:tp|7u2:7rk;tp|7u3:tn;tp|7u4:te;tp|7u6:tn;q2|7u7:tn;q2;tp|7uc:tn;tp|7ui:tp;o8;o0|7uj:tp;o8;o1|7um:tp;q2|7un:tp;o8;q2|7v2:u5;o8;o0|7v3:u5;o8;o1|7v4:u1;oj|7v6:u5;q2|7v7:u5;o8;q2|7vi:7rs;tp|7vj:u9;tp|7vk:ue;tp|7vm:u9;q2|7vn:u9;q2;tp|7vs:u9;tp|858:3i;3j|882:33|883:5g;33|887:ir|889:5g;36|88b:38|88c:38|88d:38|88g:39|88h:39|88i:3c|88l:3e|88m:3e;3f|88p:3g|88q:3h|88r:3i|88s:3i|88t:3i|890:3j;3d|891:3k;35;3c|892:3k;3d|894:3q|898:3q|89c:32|89d:33|89g:35|89h:36|89j:3d|89u:tj|89v:u0|8a5:34|crh:38;3g;31|crj:31;3l|crl:3f;3m|cs0:3g;31|cs1:3e;31|cs2:ts;31|cs3:3d;31|cs4:3b;31|cs5:3b;32|cs6:3d;32|cs7:37;32|csa:3g;36|csb:3e;36|csc:ts;36|csg:38;3q|csh:3b;38;3q|csi:3d;38;3q|csj:37;38;3q|csk:3k;38;3q|ct9:3g;31|cta:3b;3g;31|ctb:3d;3g;31|ctc:37;3g;31|ctk:3g;3m|ctl:3e;3m|ctm:ts;3m|ctn:3d;3m|cto:3b;3m|ctp:3d;3m|ctq:3g;3n|ctr:3e;3n|cts:ts;3n|ctt:3d;3n|ctu:3b;3n|ctv:3d;3n|cu0:3b;u9|cu1:3d;u9|cu3:32;3h|cu6:33;8gl;3b;37|cu7:33;3f;1e|cu8:34;32|cu9:37;3p|cub:38;3g|cud:3b;3b|cue:3b;3d|cun:3g;38|cup:3g;3g;3d|cuq:3g;3i|cus:3j;3m|cut:3n;32|1uo0:36;36|1uo1:36;39|1uo2:36;3c|1uo3:36;36;39|1uo4:36;36;3c|1uo5:3j;3k|1uo6:3j;3k|1uoj:1bk;1bm|1uok:1bk;1b5|1uol:1bk;1bb|1uom:1bu;1bm|1uon:1bk;1bd|3l00:31|3l01:32|3l02:33|3l03:34|3l04:35|3l05:36|3l06:37|3l07:38|3l08:39|3l09:3a|3l0a:3b|3l0b:3c|3l0c:3d|3l0d:3e|3l0e:3f|3l0f:3g|3l0g:3h|3l0h:3i|3l0i:3j|3l0j:3k|3l0k:3l|3l0l:3m|3l0m:3n|3l0n:3o|3l0o:3p|3l0p:3q|3l1k:31|3l1l:32|3l1m:33|3l1n:34|3l1o:35|3l1p:36|3l1q:37|3l1r:38|3l1s:39|3l1t:3a|3l1u:3b|3l1v:3c|3l20:3d|3l21:3e|3l22:3f|3l23:3g|3l24:3h|3l25:3i|3l26:3j|3l27:3k|3l28:3l|3l29:3m|3l2a:3n|3l2b:3o|3l2c:3p|3l2d:3q|3l38:31|3l39:32|3l3a:33|3l3b:34|3l3c:35|3l3d:36|3l3e:37|3l3f:38|3l3g:39|3l3h:3a|3l3i:3b|3l3j:3c|3l3k:3d|3l3l:3e|3l3m:3f|3l3n:3g|3l3o:3h|3l3p:3i|3l3q:3j|3l3r:3k|3l3s:3l|3l3t:3m|3l3u:3n|3l3v:3o|3l40:3p|3l41:3q|3l4s:31|3l4u:33|3l4v:34|3l52:37|3l55:3a|3l56:3b|3l59:3e|3l5a:3f|3l5b:3g|3l5c:3h|3l5e:3j|3l5f:3k|3l5g:3l|3l5h:3m|3l5i:3n|3l5j:3o|3l5k:3p|3l5l:3q|3l6g:31|3l6h:32|3l6i:33|3l6j:34|3l6k:35|3l6l:36|3l6m:37|3l6n:38|3l6o:39|3l6p:3a|3l6q:3b|3l6r:3c|3l6s:3d|3l6t:3e|3l6u:3f|3l6v:3g|3l70:3h|3l71:3i|3l72:3j|3l73:3k|3l74:3l|3l75:3m|3l76:3n|3l77:3o|3l78:3p|3l79:3q|3l84:31|3l85:32|3l87:34|3l88:35|3l89:36|3l8a:37|3l8d:3a|3l8e:3b|3l8f:3c|3l8g:3d|3l8h:3e|3l8i:3f|3l8j:3g|3l8k:3h|3l8m:3j|3l8n:3k|3l8o:3l|3l8p:3m|3l8q:3n|3l8r:3o|3l8s:3p|3l9o:31|3l9p:32|3l9r:34|3l9s:35|3l9t:36|3l9u:37|3la0:39|3la1:3a|3la2:3b|3la3:3c|3la4:3d|3la6:3f|3laa:3j|3lab:3k|3lac:3l|3lad:3m|3lae:3n|3laf:3o|3lag:3p|3lbc:31|3lbd:32|3lbe:33|3lbf:34|3lbg:35|3lbh:36|3lbi:37|3lbj:38|3lbk:39|3lbl:3a|3lbm:3b|3lbn:3c|3lbo:3d|3lbp:3e|3lbq:3f|3lbr:3g|3lbs:3h|3lbt:3i|3lbu:3j|3lbv:3k|3lc0:3l|3lc1:3m|3lc2:3n|3lc3:3o|3lc4:3p|3lc5:3q|3ld0:31|3ld1:32|3ld2:33|3ld3:34|3ld4:35|3ld5:36|3ld6:37|3ld7:38|3ld8:39|3ld9:3a|3lda:3b|3ldb:3c|3ldc:3d|3ldd:3e|3lde:3f|3ldf:3g|3ldg:3h|3ldh:3i|3ldi:3j|3ldj:3k|3ldk:3l|3ldl:3m|3ldm:3n|3ldn:3o|3ldo:3p|3ldp:3q|3lek:31|3lel:32|3lem:33|3len:34|3leo:35|3lep:36|3leq:37|3ler:38|3les:39|3let:3a|3leu:3b|3lev:3c|3lf0:3d|3lf1:3e|3lf2:3f|3lf3:3g|3lf4:3h|3lf5:3i|3lf6:3j|3lf7:3k|3lf8:3l|3lf9:3m|3lfa:3n|3lfb:3o|3lfc:3p|3lfd:3q|3lg8:31|3lg9:32|3lga:33|3lgb:34|3lgc:35|3lgd:36|3lge:37|3lgf:38|3lgg:39|3lgh:3a|3lgi:3b|3lgj:3c|3lgk:3d|3lgl:3e|3lgm:3f|3lgn:3g|3lgo:3h|3lgp:3i|3lgq:3j|3lgr:3k|3lgs:3l|3lgt:3m|3lgu:3n|3lgv:3o|3lh0:3p|3lh1:3q|3lhs:31|3lht:32|3lhu:33|3lhv:34|3li0:35|3li1:36|3li2:37|3li3:38|3li4:39|3li5:3a|3li6:3b|3li7:3c|3li8:3d|3li9:3e|3lia:3f|3lib:3g|3lic:3h|3lid:3i|3lie:3j|3lif:3k|3lig:3l|3lih:3m|3lii:3n|3lij:3o|3lik:3p|3lil:3q|3ljg:31|3ljh:32|3lji:33|3ljj:34|3ljk:35|3ljl:36|3ljm:37|3ljn:38|3ljo:39|3ljp:3a|3ljq:3b|3ljr:3c|3ljs:3d|3ljt:3e|3lju:3f|3ljv:3g|3lk0:3h|3lk1:3i|3lk2:3j|3lk3:3k|3lk4:3l|3lk5:3m|3lk6:3n|3lk7:3o|3lk8:3p|3lk9:3q|3ll8:th|3ll9:ti|3lla:tj|3llb:tk|3llc:tl|3lld:tm|3lle:tn|3llf:to|3llg:tp|3llh:tq|3lli:tr|3llj:ts|3llk:tt|3lll:tu|3llm:tv|3lln:u0|3llo:u1|3llp:to|3llq:u3|3llr:u4|3lls:u5|3llt:u6|3llu:u7|3llv:u8|3lm0:u9|3lmj:u3|3ln2:th|3ln3:ti|3ln4:tj|3ln5:tk|3ln6:tl|3ln7:tm|3ln8:tn|3ln9:to|3lna:tp|3lnb:tq|3lnc:tr|3lnd:ts|3lne:tt|3lnf:tu|3lng:tv|3lnh:u0|3lni:u1|3lnj:to|3lnk:u3|3lnl:u4|3lnm:u5|3lnn:u6|3lno:u7|3lnp:u8|3lnq:u9|3lod:u3|3los:th|3lot:ti|3lou:tj|3lov:tk|3lp0:tl|3lp1:tm|3lp2:tn|3lp3:to|3lp4:tp|3lp5:tq|3lp6:tr|3lp7:ts|3lp8:tt|3lp9:tu|3lpa:tv|3lpb:u0|3lpc:u1|3lpd:to|3lpe:u3|3lpf:u4|3lpg:u5|3lph:u6|3lpi:u7|3lpj:u8|3lpk:u9|3lq7:u3|3lqm:th|3lqn:ti|3lqo:tj|3lqp:tk|3lqq:tl|3lqr:tm|3lqs:tn|3lqt:to|3lqu:tp|3lqv:tq|3lr0:tr|3lr1:ts|3lr2:tt|3lr3:tu|3lr4:tv|3lr5:u0|3lr6:u1|3lr7:to|3lr8:u3|3lr9:u4|3lra:u5|3lrb:u6|3lrc:u7|3lrd:u8|3lre:u9|3ls1:u3|3lsg:th|3lsh:ti|3lsi:tj|3lsj:tk|3lsk:tl|3lsl:tm|3lsm:tn|3lsn:to|3lso:tp|3lsp:tq|3lsq:tr|3lsr:ts|3lss:tt|3lst:tu|3lsu:tv|3lsv:u0|3lt0:u1|3lt1:to|3lt2:u3|3lt3:u4|3lt4:u5|3lt5:u6|3lt6:u7|3lt7:u8|3lt8:u9|3ltr:u3",r:"23:2c|2i:2k|2m:2q|60:6m|6o:6u|bo:bp|c1:c2|c6:c7|c9:cb|ce:ch|cj:ck|cm:co|cs:ct|cv:d0|d6:d7|de:df|dh:dj|dn:do|e4:e5|e7:e8|ea:eb|fh:fi|fm:fo|s8:sa|se:sf|sh:t1|t3:tb|100:11f|19h:1am|7o8:7of|7oo:7ot|7p8:7pf|7po:7pv|7q8:7qd|7r8:7rf|7to:7tr|7u8:7ub|7uo:7ur|7v8:7vc|7vo:7vr|89a:89b|8b0:8bf|95m:96f|1vp1:1vpq|2100:2115",s:"v8|va|vc|ve|vk|130|132|134|136|138|13a|13c|13e|13g|13i|13k|13m|13o|13q|13s|13u|140|14a|14c|14e|14g|14i|14k|14m|14o|14q|14s|14u|150|152|154|156|158|15a|15c|15e|15g|15i|15k|15m|15o|15q|15s|15u|161|163|165|167|169|16b|16d|16g|16i|16k|16m|16o|16q|16s|16u|170|172|174|176|178|17a|17c|17e|17g|17i|17k|17o|180|182|184|186|188|18a|18c|18e|80|82|84|86|88|8a|8c|8e|8g|8i|8k|8m|8o|8q|8s|8u|90|92|94|96|98|9a|9c|9e|9i|9k|9m|9p|9r|9t|9v|a1|a3|a5|a7|aa|ac|ae|ag|ai|ak|am|ao|aq|as|au|b0|b2|b4|b6|b8|ba|bc|be|bg|bi|bk|bm|br|bt|c4|d2|d4|d9|dc|dl|ds|ed|ef|eh|ej|el|en|ep|er|eu|f0|f2|f4|f6|f8|fa|fc|fe|fk|fq|fs|fu|g0|g2|g4|g6|g8|ga|gc|ge|gg|gi|gk|gm|go|gq|gs|gu|h0|h2|h4|h6|h8|ha|hc|he|hg|hi|21|22|7g0|7g2|7g4|7g6|7g8|7ga|7gc|7ge|7gg|7gi|2d|7gk|7gm|7go|7gq|7gs|7gu|7h0|7h2|7h4|7h6|7h8|7ha|7hc|7he|7hg|7hi|7hk|7hm|7ho|7hq|7hs|7hu|7i0|7i2|7i4|7i6|7i8|7ia|7ic|7ie|7ig|7ii|7ik|7im|7io|7iq|7is|7iu|7j0|7j2|7j4|7j6|7j8|7ja|7jc|7je|7jg|7ji|7jk|7jm|2e|7jo|7jq|7js|7ju|7k0|7k2|7k4|7k6|7k8|7ka|7kc|7ke|7kg|7ki|7kk|7l0|7l2|7l4|7l6|7l8|7la|7lc|7le|7lg|7li|7lk|7lm|7lo|7lq|7ls|7lu|7m0|7m2|7m4|7m6|7m8|7ma|7mc|7me|7mg|7mi|7mk|7mm|7mo|7mq|2f|7ms|7mu|7n0|7n2|7n4|7n6|7n8|7na|7nc|7ne|7ng|7ni|7nk|7nm|7no|2g|7qp|7qr|7qt|7qv|2h|896|2l|s6|sc|uo|uq|us|uu|v0|v2|v4|v6"},"B.3":{m:"5l:ts|6v:3j;3j|9g:39;o7|a9:ls;3e|bv:3j|fg:3a;oc|q5:tp|sg:tp;o8;o1|tg:u5;o8;o1|u2:u3|ug:ti|uh:to|ul:u6|um:u0|vg:tq|vh:u1|vi:u3|vl:tl|1c7:1b5;1c2|7km:38;ph|7kn:3k;o8|7ko:3n;oa|7kp:3p;oa|7kq:31;lu|7kr:7j1|7qg:u5;oj|7qi:u5;oj;o0|7qk:u5;oj;o1|7qm:u5;oj;q2|7s0:7o0;tp|7s1:7o1;tp|7s2:7o2;tp|7s3:7o3;tp|7s4:7o4;tp|7s5:7o5;tp|7s6:7o6;tp|7s7:7o7;tp|7s8:7o0;tp|7s9:7o1;tp|7sa:7o2;tp|7sb:7o3;tp|7sc:7o4;tp|7sd:7o5;tp|7se:7o6;tp|7sf:7o7;tp|7sg:7p0;tp|7sh:7p1;tp|7si:7p2;tp|7sj:7p3;tp|7sk:7p4;tp|7sl:7p5;tp|7sm:7p6;tp|7sn:7p7;tp|7so:7p0;tp|7sp:7p1;tp|7sq:7p2;tp|7sr:7p3;tp|7ss:7p4;tp|7st:7p5;tp|7su:7p6;tp|7sv:7p7;tp|7t0:7r0;tp|7t1:7r1;tp|7t2:7r2;tp|7t3:7r3;tp|7t4:7r4;tp|7t5:7r5;tp|7t6:7r6;tp|7t7:7r7;tp|7t8:7r0;tp|7t9:7r1;tp|7ta:7r2;tp|7tb:7r3;tp|7tc:7r4;tp|7td:7r5;tp|7te:7r6;tp|7tf:7r7;tp|7ti:7rg;tp|7tj:th;tp|7tk:tc;tp|7tm:th;q2|7tn:th;q2;tp|7ts:th;tp|7tu:tp|7u2:7rk;tp|7u3:tn;tp|7u4:te;tp|7u6:tn;q2|7u7:tn;q2;tp|7uc:tn;tp|7ui:tp;o8;o0|7uj:tp;o8;o1|7um:tp;q2|7un:tp;o8;q2|7v2:u5;o8;o0|7v3:u5;o8;o1|7v4:u1;oj|7v6:u5;q2|7v7:u5;o8;q2|7vi:7rs;tp|7vj:u9;tp|7vk:ue;tp|7vm:u9;q2|7vn:u9;q2;tp|7vs:u9;tp|1uo0:36;36|1uo1:36;39|1uo2:36;3c|1uo3:36;36;39|1uo4:36;36;3c|1uo5:3j;3k|1uo6:3j;3k|1uoj:1bk;1bm|1uok:1bk;1b5|1uol:1bk;1bb|1uom:1bu;1bm|1uon:1bk;1bd",r:"23:2c|2i:2k|2m:2q|60:6m|6o:6u|bo:bp|c1:c2|c6:c7|c9:cb|ce:ch|cj:ck|cm:co|cs:ct|cv:d0|d6:d7|de:df|dh:dj|dn:do|e4:e5|e7:e8|ea:eb|fh:fi|fm:fo|s8:sa|se:sf|sh:t1|t3:tb|100:11f|19h:1am|7o8:7of|7oo:7ot|7p8:7pf|7po:7pv|7q8:7qd|7r8:7rf|7to:7tr|7u8:7ub|7uo:7ur|7v8:7vc|7vo:7vr|89a:89b|8b0:8bf|95m:96f|1vp1:1vpq|2100:2115",s:"v8|va|vc|ve|vk|130|132|134|136|138|13a|13c|13e|13g|13i|13k|13m|13o|13q|13s|13u|140|14a|14c|14e|14g|14i|14k|14m|14o|14q|14s|14u|150|152|154|156|158|15a|15c|15e|15g|15i|15k|15m|15o|15q|15s|15u|161|163|165|167|169|16b|16d|16g|16i|16k|16m|16o|16q|16s|16u|170|172|174|176|178|17a|17c|17e|17g|17i|17k|17o|180|182|184|186|188|18a|18c|18e|80|82|84|86|88|8a|8c|8e|8g|8i|8k|8m|8o|8q|8s|8u|90|92|94|96|98|9a|9c|9e|9i|9k|9m|9p|9r|9t|9v|a1|a3|a5|a7|aa|ac|ae|ag|ai|ak|am|ao|aq|as|au|b0|b2|b4|b6|b8|ba|bc|be|bg|bi|bk|bm|br|bt|c4|d2|d4|d9|dc|dl|ds|ed|ef|eh|ej|el|en|ep|er|eu|f0|f2|f4|f6|f8|fa|fc|fe|fk|fq|fs|fu|g0|g2|g4|g6|g8|ga|gc|ge|gg|gi|gk|gm|go|gq|gs|gu|h0|h2|h4|h6|h8|ha|hc|he|hg|hi|21|22|7g0|7g2|7g4|7g6|7g8|7ga|7gc|7ge|7gg|7gi|2d|7gk|7gm|7go|7gq|7gs|7gu|7h0|7h2|7h4|7h6|7h8|7ha|7hc|7he|7hg|7hi|7hk|7hm|7ho|7hq|7hs|7hu|7i0|7i2|7i4|7i6|7i8|7ia|7ic|7ie|7ig|7ii|7ik|7im|7io|7iq|7is|7iu|7j0|7j2|7j4|7j6|7j8|7ja|7jc|7je|7jg|7ji|7jk|7jm|2e|7jo|7jq|7js|7ju|7k0|7k2|7k4|7k6|7k8|7ka|7kc|7ke|7kg|7ki|7kk|7l0|7l2|7l4|7l6|7l8|7la|7lc|7le|7lg|7li|7lk|7lm|7lo|7lq|7ls|7lu|7m0|7m2|7m4|7m6|7m8|7ma|7mc|7me|7mg|7mi|7mk|7mm|7mo|7mq|2f|7ms|7mu|7n0|7n2|7n4|7n6|7n8|7na|7nc|7ne|7ng|7ni|7nk|7nm|7no|2g|7qp|7qr|7qt|7qv|2h|896|2l|s6|sc|uo|uq|us|uu|v0|v2|v4|v6"},"C.1.1":{s:"10"},"C.1.2":{r:"800:80b",s:"c00|50|5k0|81f|82v"},"C.2.1":{r:"0:v",s:"3v"},"C.2.2":{r:"40:4v|80c:80d|818:819|830:833|83a:83f|1vvp:1vvs|3kbj:3kbq",s:"1mt|1of|60e|1vnv"},"C.3":{r:"1o00:1u7v|u000:vvvt|10000:11vvt"},"C.4":{r:"1veg:1vff|1vvu:1vvv|3vvu:3vvv|5vvu:5vvv|7vvu:7vvv|9vvu:9vvv|bvvu:bvvv|dvvu:dvvv|fvvu:fvvv|hvvu:hvvv|jvvu:jvvv|lvvu:lvvv|nvvu:nvvv|pvvu:pvvv|rvvu:rvvv|tvvu:tvvv|vvvu:vvvv|11vvu:11vvv"},"C.5":{r:"1m00:1nvv"},"C.6":{r:"1vvp:1vvt"},"C.7":{r:"bvg:bvr"},"C.8":{r:"q0:q1|80e:80f|81a:81e|83a:83f"},"C.9":{r:"s010:s03v",s:"s001"},"D.1":{r:"1eg:1fa|1fg:1fk|1h1:1hq|1i0:1ia|1jd:1jf|1jh:1ml|1n5:1n6|1nq:1nu|1o0:1od|1oi:1pc|1s0:1t5|1uov:1up8|1upa:1upm|1upo:1ups|1uq0:1uq1|1uq3:1uq4|1uq6:1uth|1uuj:1v9t|1vag:1vcf|1vci:1ve7|1vfg:1vfs|1vjg:1vjk|1vjm:1vns",s:"1du|1e0|1e3|1gr|1gv|1mt|1og|1th|1uot|1upu|80f"},"D.2":{r:"21:2q|31:3q|60:6m|6o:7m|7o:h0|h2:hj|ig:ld|lg:lo|lr:m1|mg:mh|n0:n4|s8:sa|se:t1|t3:ue|ug:vl|100:142|14a:16e|16g:17l|17o:17p|180:18f|19h:1am|1ap:1av|1b1:1c7|285:29p|29t:2a0|2a9:2ac|2ao:2b1|2b4:2bg|2c2:2c3|2c5:2cc|2cf:2cg|2cj:2d8|2da:2dg|2dm:2dp|2du:2e0|2e7:2e8|2eb:2ec|2es:2et|2ev:2f1|2f6:2fh|2fk:2fq|2g5:2ga|2gf:2gg|2gj:2h8|2ha:2hg|2hi:2hj|2hl:2hm|2ho:2hp|2hu:2i0|2ip:2is|2j6:2jf|2ji:2jk|2k5:2kb|2kf:2kh|2kj:2l8|2la:2lg|2li:2lj|2ll:2lp|2lt:2m0|2mb:2mc|2n6:2nf|2o2:2o3|2o5:2oc|2of:2og|2oj:2p8|2pa:2pg|2pi:2pj|2pm:2pp|2pt:2pu|2q7:2q8|2qb:2qc|2qs:2qt|2qv:2r1|2r6:2rg|2s5:2sa|2se:2sg|2si:2sl|2sp:2sq|2su:2sv|2t3:2t4|2t8:2ta|2te:2tl|2tn:2tp|2tu:2tv|2u1:2u2|2u6:2u8|2ua:2uc|2v7:2vi|301:303|305:30c|30e:30g|30i:318|31a:31j|31l:31p|321:324|330:331|336:33f|342:343|345:34c|34e:34g|34i:358|35a:35j|35l:35p|360:364|367:368|36a:36b|36l:36m|370:371|376:37f|382:383|385:38c|38e:38g|38i:398|39a:39p|39u:3a0|3a6:3a8|3aa:3ac|3b0:3b1|3b6:3bf|3c2:3c3|3c5:3cm|3cq:3dh|3dj:3dr|3e0:3e6|3ef:3eh|3eo:3ev|3fi:3fk|3g1:3hg|3hi:3hj|3i0:3i6|3if:3ir|3k1:3k2|3k7:3k8|3kk:3kn|3kp:3kv|3l1:3l3|3la:3lb|3ld:3lg|3li:3lj|3m0:3m4|3mg:3mp|3ms:3mt|3o0:3on|3oq:3pk|3pu:3q7|3q9:3ra|3s8:3sb|3tu:3u5|3u7:3uc|400:411|413:417|419:41a|420:42n|450:465|46g:47o|480:4ap|4av:4d2|4d8:4fp|4g0:4g6|4g8:4i6|4ia:4id|4ig:4im|4iq:4it|4j0:4k6|4ka:4kd|4kg:4le|4li:4ll|4lo:4lu|4m2:4m5|4m8:4me|4mg:4mm|4mo:4ne|4ng:4oe|4oi:4ol|4oo:4ou|4p0:4q6|4q8:4qq|4r1:4rs|4t0:4vk|501:5jm|5k1:5kq|5l0:5ng|5o0:5oc|5oe:5oh|5p0:5ph|5pl:5pm|5q0:5qh|5r0:5rc|5re:5rg|5s0:5tm|5tu:5u5|5u7:5u8|5uk:5uq|5v0:5v9|60g:60p|610:63n|640:658|7g0:7kr|7l0:7np|7o0:7ol|7oo:7ot|7p0:7q5|7q8:7qd|7qg:7qn|7qv:7rt|7s0:7tk|7tm:7ts|7u2:7u4|7u6:7uc|7ug:7uj|7um:7ur|7v0:7vc|7vi:7vk|7vm:7vs|88a:88j|88p:88t|89a:89d|89f:89h|89j:89p|89t:89v|8a5:8a9|8b0:8c3|8pm:8rq|94s:979|c05:c07|c11:c19|c1h:c1l|c1o:c1s|c21:c4m|c4t:c4v|c51:c7q|c7s:c7v|c85:c9c|c9h:cce|ccg:cdn|cfg:cgs|ch0:ci3|cj0:cjr|cjv:clg|cm0:cmb|cmg:cnu|co0:crm|crr:cut|cv0:cvu|d00:jdl|jg0:17t5|1800:194c|1b00:1lt3|1m00:1uhd|1uhg:1uja|1uo0:1uo6|1uoj:1uon|1vp1:1vpq|1vq1:1vqq|1vr6:1vtu|1vu2:1vu7|1vua:1vuf|1vui:1vun|1vuq:1vus|20o0:20ou|20p0:20p3|20pg:20qa|2100:2115|2118:212d|3k00:3k7l|3k80:3k96|3k9a:3kb6|3kba:3kbi|3kc3:3kc4|3kcc:3kd9|3kde:3ket|3l00:3l2k|3l2m:3l4s|3l4u:3l4v|3l55:3l56|3l59:3l5c|3l5e:3l5p|3l5t:3l60|3l62:3l63|3l65:3l85|3l87:3l8a|3l8d:3l8k|3l8m:3l8s|3l8u:3l9p|3l9r:3l9u|3la0:3la4|3laa:3lag|3lai:3ll3|3ll8:3lu9|4000:59mm|5u00:5ugt|u000:vvvt|10000:11vvt",s:"3l52|3l5r|3la6|1c9|5a|5l|5q|283|2ag|2di|2en|2iu|2k3|2kd|2m9|2mg|2n0|2q0|2qn|2s3|2ss|2un|35u|36u|3an|3dt|3k4|3ka|3kd|3l5|3l7|3lt|3m6|3pm|3po|3rv|3s5|3uf|41c|41h|41o|47r|4i8|4io|4k8|4lg|4m0|4og|5us|ne|7qp|7qr|7qt|7tu|80e|83h|83v|882|887|88l|894|896|898|rq|s6|sc|8sl"}};class Te{constructor(e,t){this.singles=new Set,this.ranges=[],this.mappings=new Map;const n=xe[e];this.name=e,n?(n.s&&(this.singles=new Set(n.s.split("|").map((e=>parseInt(e,32))))),n.r&&(this.ranges=n.r.split("|").map((e=>{const[t,n]=e.split(":");return[parseInt(t,32),parseInt(n,32)]}))),n.m&&(this.mappings=new Map(n.m.split("|").map((e=>{const[t,n]=e.split(":"),i=n.split(";").map((e=>parseInt(e,32)));return[parseInt(t,32),i]}))))):t&&(this.singles=new Set(t))}contains(e){if(this.singles.has(e))return!0;let t=0,n=this.ranges.length-1;for(;t<=n;){const i=Math.floor((t+n)/2),r=this.ranges[i];if(e<r[0])n=i-1;else{if(!(e>r[1]))return!0;t=i+1}}return!1}hasMapping(e){return this.mappings.has(e)||this.contains(e)}map(e){return this.contains(e)&&!this.mappings.has(e)?String.fromCodePoint(e).toLowerCase().codePointAt(0):this.mappings.get(e)||null}}const Ee=new Te("A.1"),Ie=new Te("B.1"),Ne=new Te("B.2");new Te("B.3");const ke=new Te("C.1.1"),Ae=new Te("C.1.2"),Oe=new Te("C.2.1"),je=new Te("C.2.2"),Ce=new Te("C.3"),Re=new Te("C.4"),Pe=new Te("C.5"),Le=new Te("C.6"),Me=new Te("C.7"),Fe=new Te("C.8"),De=new Te("C.9"),qe=new Te("D.1"),Ue=new Te("D.2");function Be(e,t,n=""){const i=ge.ucs2.decode(n);let r=[];for(const n of i){if(!t&&e.unassigned.contains(n))throw new Error("Unassigned code point: x"+n.toString(16));let i=!1;for(const t of e.mappings){if(!t.hasMapping(n))continue;i=!0;const e=t.map(n);e&&(Array.isArray(e)?r=r.concat(e):r.push(e))}i||r.push(n)}let s=r;if(e.normalize){const e=ge.ucs2.encode(r).normalize("NFKC");s=ge.ucs2.decode(e)}let o=!1,a=!1;for(const n of s){for(const t of e.prohibited)if(t.contains(n))throw new Error("Prohibited code point: x"+n.toString(16));if(!t&&e.unassigned.contains(n))throw new Error("Prohibited code point: x"+n.toString(16));e.bidirectional&&(o=o||qe.contains(n),a=a||Ue.contains(n))}if(e.bidirectional){if(o&&a)throw new Error("String contained both LCat and RandALCat code points");if(o&&(!qe.contains(s[0])||!qe.contains(s[s.length-1])))throw new Error("String containing RandALCat code points must start and end with RandALCat code points")}return ge.ucs2.encode(s)}Ie.map=()=>null,ke.contains=e=>32===e,Ae.map=e=>Ae.contains(e)?32:null;const Ge={bidirectional:!0,mappings:[Ie,Ne],normalize:!0,prohibited:[Ae,je,Ce,Re,Pe,Le,Me,Fe,De],unassigned:Ee};const Je=new Te("NodePrepProhibited",[34,38,39,47,58,60,62,64]),ze={bidirectional:!0,mappings:[Ie,Ne],normalize:!0,prohibited:[ke,Ae,Oe,je,Ce,Re,Pe,Le,Me,Fe,De,Je],unassigned:Ee};const Xe={bidirectional:!0,mappings:[Ie],normalize:!0,prohibited:[Ae,Oe,je,Ce,Re,Pe,Le,Me,Fe,De],unassigned:Ee};const $e={bidirectional:!0,mappings:[Ae,Ie],normalize:!0,prohibited:[Ae,Oe,je,Ce,Re,Pe,Le,Me,Fe,De],unassigned:Ee};function Ve(e,t=!1){return Be($e,t,e)}function He(e=""){return e.replace(/^\s+|\s+$/g,"").replace(/\\5c/g,"\\5c5c").replace(/\\20/g,"\\5c20").replace(/\\22/g,"\\5c22").replace(/\\26/g,"\\5c26").replace(/\\27/g,"\\5c27").replace(/\\2f/g,"\\5c2f").replace(/\\3a/g,"\\5c3a").replace(/\\3c/g,"\\5c3c").replace(/\\3e/g,"\\5c3e").replace(/\\40/g,"\\5c40").replace(/ /g,"\\20").replace(/"/g,"\\22").replace(/&/g,"\\26").replace(/'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")}function We(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}function Qe(e){let t=e.local||"",n=e.domain,i=e.resource||"";return t&&(t=function(e,t=!0){return Be(ze,t,e)}(t)),i&&(i=function(e,t=!0){return Be(Xe,t,e)}(i)),"."===n[n.length-1]&&(n=n.slice(0,n.length-1)),n=function(e,t=!0){return Be(Ge,t,e)}(n.split(".").map(ge.toUnicode).join(".")),{domain:n,local:t,resource:i}}function Ke(e,t={}){let n=e.local;t.escaped||(n=He(e.local));const i=t.prepared?e:Qe({local:n,domain:e.domain,resource:e.resource}),r=n?`${n}@${i.domain}`:i.domain;return i.resource?`${r}/${i.resource}`:r}function Ye(e,t){return t?`${st(e)}/${t}`:st(e)}function Ze(e=""){let t="",n="",i="";const r=e.indexOf("/");r>0&&(i=e.slice(r+1),e=e.slice(0,r));const s=e.indexOf("@");s>0&&(t=e.slice(0,s),e=e.slice(s+1)),n=e;const o=Qe({domain:n,local:t,resource:i});return{bare:Ke({local:o.local,domain:o.domain},{escaped:!0,prepared:!0}),domain:o.domain,full:Ke(o,{escaped:!0,prepared:!0}),local:We(o.local),resource:o.resource}}function et(e,t){const n=new Set;if(n.add(void 0),n.add(""),e){const t=Ze(e);n.add(t.full),n.add(t.bare),n.add(t.domain)}if(t){const e=Ze(t);n.add(e.domain),n.add(e.bare),n.add(e.full)}return n}function tt(e,t){if(!e||!t)return!1;const n=Ze(e),i=Ze(t);return n.local===i.local&&n.domain===i.domain}function nt(e){return!!Ze(e).resource}function it(e=""){return Ze(e).domain}function rt(e=""){return Ze(e).resource}function st(e=""){return Ze(e).bare}var ot,at=Object.freeze({__proto__:null,escapeLocal:He,unescapeLocal:We,prepare:Qe,create:Ke,createFull:Ye,parse:Ze,allowedResponders:et,equal:function(e,t){if(!e||!t)return!1;const n=Ze(e),i=Ze(t);return n.local===i.local&&n.domain===i.domain&&n.resource===i.resource},equalBare:tt,isFull:nt,isBare:function(e){return!nt(e)},getLocal:function(e=""){return Ze(e).local},getDomain:it,getResource:rt,toBare:st,parseURI:function(e){const t=new URL(e);if("xmpp:"!==t.protocol)throw new Error("Invalid XMPP URI, wrong protocol: "+t.protocol);const n=t.hostname?t.username?Ke({domain:decodeURIComponent(t.hostname),local:decodeURIComponent(t.username)},{escaped:!0}):decodeURIComponent(t.hostname):void 0,i=Ze(decodeURIComponent(n?t.pathname.substr(1):t.pathname)).full,r=t.search&&t.search.indexOf(";")>=1,s=r?t.search.substr(t.search.indexOf(";")+1):"",o=t.search?decodeURIComponent(t.search.substr(1,r?t.search.indexOf(";")-1:void 0)):void 0,a={};for(const e of s.split(";")){const[t,n]=e.split("=").map(decodeURIComponent);if(a[t]){const e=a[t];Array.isArray(e)?e.push(n):a[t]=[e,n]}else a[t]=n}return{action:o,identity:n,jid:i,parameters:a}},toURI:function(e){const t=["xmpp:"],n=(e,n)=>{const i=Ze(e);i.local&&(t.push(encodeURIComponent(He(i.local))),t.push("@")),t.push(encodeURIComponent(i.domain)),n&&i.resource&&(t.push("/"),t.push(encodeURIComponent(i.resource)))};e.identity&&(t.push("//"),n(e.identity,!1),e.jid&&t.push("/")),e.jid&&n(e.jid,!0),e.action&&(t.push("?"),t.push(encodeURIComponent(e.action)));for(const[n,i]of Object.entries(e.parameters||{}))for(const e of Array.isArray(i)?i:[i])t.push(";"),t.push(encodeURIComponent(n)),void 0!==e&&(t.push("="),t.push(encodeURIComponent(e)));return t.join("")}});!function(e){e.NotWellFormed="not-well-formed",e.RestrictedXML="restricted-xml",e.AlreadyClosed="already-closed",e.UnknownRoot="unknown-stream-root"}(ot||(ot={}));class ct extends Error{constructor(e){super(e.text),this.isJXTError=!0,this.condition=e.condition,this.text=e.text}static notWellFormed(e){return new ct({condition:ot.NotWellFormed,text:e})}static restrictedXML(e){return new ct({condition:ot.RestrictedXML,text:e})}static alreadyClosed(e){return new ct({condition:ot.AlreadyClosed,text:e})}static unknownRoot(e){return new ct({condition:ot.UnknownRoot,text:e})}}const lt={'"':"&quot;","&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"},ut={"&amp;":"&","&apos;":"'","&gt;":">","&lt;":"<","&quot;":'"'},pt=/&([a-zA-Z0-9]+|#[0-9]+|#x[0-9a-fA-F]+);/g,dt=/&|<|>|"|'/g,ht=/&|<|>/g;function ft(e){return lt[e]}function mt(e){return e.replace(dt,ft)}function gt(e){return e.replace(pt,(e=>function(e){if(ut[e])return ut[e];const t=e.startsWith("&#x"),n=parseInt(e.substring(t?3:2,e.length-1),t?16:10);if(9===n||10===n||13===n||32<=n&&n<=55295||57344<=n&&n<=65533||65536<=n&&n<=1114111)return String.fromCodePoint(n);throw ct.restrictedXML("Prohibited entity: "+e)}(e)))}function yt(e){return e.replace(ht,ft)}function vt(e,t=[],n=""){const i=new Set(e.map((e=>e.toLowerCase())));for(let e of t.map((e=>e.toLowerCase())))if("*"!==e)for(;e.length>0;){if(i.has(e))return e;e=e.substring(0,e.lastIndexOf("-")).toLowerCase(),e.lastIndexOf("-")===e.length-2&&(e=e.substring(0,e.lastIndexOf("-")))}return n}class bt{constructor(e,t={},n=[]){this.name=e,this.attributes=t,this.children=[],this.optionalNamespaces={};for(const e of n)if("string"!=typeof e){const t=new bt(e.name,e.attributes,e.children);t.parent=this,this.children.push(t)}else this.children.push(e)}getName(){return this.name.indexOf(":")>=0?this.name.substr(this.name.indexOf(":")+1):this.name}getNamespace(){if(this.name.indexOf(":")>=0){const e=this.name.substr(0,this.name.indexOf(":"));return this.findNamespaceForPrefix(e)}return this.findNamespaceForPrefix()}getNamespaceContext(){let e={};this.parent&&(e=this.parent.getNamespaceContext());for(const[t,n]of Object.entries(this.attributes))if(t.startsWith("xmlns:")){const i=t.substr(6);e[n]=i}return e}getDefaultNamespace(){return this.attributes.xmlns?this.attributes.xmlns:this.parent?this.parent.getDefaultNamespace():""}getNamespaceRoot(e){if(this.parent){const t=this.parent.getNamespaceRoot(e);if(t)return t}for(const[t,n]of Object.entries(this.attributes))if(t.startsWith("xmlns:")&&n===e)return this;if(this.optionalNamespaces[e])return this}getAttribute(e,t){if(!t)return this.attributes[e];const n=this.getNamespaceContext();return n[t]?this.attributes[[n[t],e].join(":")]:void 0}getChild(e,t){return this.getChildren(e,t)[0]}getChildren(e,t){const n=[];for(const i of this.children)"string"==typeof i||i.getName()!==e||t&&i.getNamespace()!==t||n.push(i);return n}getText(){let e="";for(const t of this.children)"string"==typeof t&&(e+=t);return e}appendChild(e){return this.children.push(e),"string"!=typeof e&&(e.parent=this),e}setAttribute(e,t,n=!1){this.attributes[e]=t||void 0,""===t&&n&&(this.attributes[e]=t)}addOptionalNamespace(e,t){this.optionalNamespaces[t]=e}useNamespace(e,t){return this.optionalNamespaces[t]&&(e=this.optionalNamespaces[t]),this.setAttribute(`xmlns:${e}`,t),e}toJSON(){const e=this.children.map((e=>"string"==typeof e?e:e?e.toJSON():void 0)).filter((e=>!!e)),t={};for(const[e,n]of Object.entries(this.attributes))null!=n&&(t[e]=n);return{attributes:t,children:e,name:this.name}}toString(){let e=this.openTag(!0);if(this.children.length){for(const t of this.children)"string"==typeof t?e+=yt(t):t&&(e+=t.toString());e+=this.closeTag()}return e}openTag(e=!1){let t="";t+=`<${this.name}`;for(const[e,n]of Object.entries(this.attributes))void 0!==n&&(t+=` ${e}="${mt(n.toString())}"`);return e&&0===this.children.length?t+="/>":t+=">",t}closeTag(){return`</${this.name}>`}findNamespaceForPrefix(e){if(e){const t="xmlns:"+e;if(this.attributes[t])return this.attributes[t];if(this.parent)return this.parent.findNamespaceForPrefix(e)}else{if(this.attributes.xmlns)return this.attributes.xmlns;if(this.parent)return this.parent.findNamespaceForPrefix()}return""}}const _t=new Set(["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul"]),wt=new Set(["style"]),St=new Map([["a",new Set(["href","style"])],["body",new Set(["style","xml:lang"])],["blockquote",wt],["br",wt],["cite",wt],["em",wt],["img",new Set(["alt","height","src","style","width"])],["li",wt],["ol",wt],["p",wt],["span",wt],["strong",wt],["ul",wt]]),xt=new Map([["font-style",/normal|italic|oblique|inherit/i],["font-weight",/normal|bold|bolder|lighter|inherit|\d\d\d/i],["text-decoration",/none|underline|overline|line-through|blink|inherit/i]]),Tt=e=>!!e.match(/^(https?|xmpp|cid|mailto|ftps?|im|ircs?|sips?|tel|geo|bitcoin|magnet):/i)&&e,Et=e=>!!e.match(/^[0-9]*$/)&&e,It={alt:e=>e,height:Et,href:Tt,src:Tt,style:e=>{const t=`;${e}`.replace(/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,"").replace(/\/\*.*/,"").replace(/\\([a-fA-F0-9]{1,6})\s?/,((e,t)=>String.fromCharCode(parseInt(t,16)))).match(/;\s*([a-z-]+)\s*:\s*([^;]*[^\s;])\s*/g),n=[];if(!t)return!1;for(const e of t){const t=e.match(/^;\s*([a-z-]+)\s*:\s*([^;]*[^\s])\s*$/);if(!t)continue;const i=xt.get(t[1]);if(i){const e=t[2].match(i);e&&n.push(`${t[1]}:${e[0]}`)}}return!!n.length&&n.join("")},width:Et};function Nt(e){if("string"==typeof e)return e;if(!_t.has(e.name)){if("script"===e.name)return;return function(e){let t=[];for(const n of e.children)if("string"==typeof n)t.push(n);else{const e=Nt(n);e&&(Array.isArray(e)?t=t.concat(e):t.push(e))}return t}(e)}const t=e.children.map(Nt).filter((e=>void 0!==e)),n={};for(const[t,i]of Object.entries(e.attributes)){const r=St.get(e.name);if(!r||!r.has(t))continue;if(!i)continue;const s=It[t](i);s&&(n[t]=s)}return{attributes:n,children:t,name:e.name}}function kt(e){if("string"==typeof e)return;let t=[];for(const n of e.children){if(!n)continue;if("string"==typeof n){t.push(n);continue}const e=Nt(n);Array.isArray(e)?t=t.concat(e):e&&t.push(e)}const n={};return"body"===e.name?(void 0!==e.attributes.xmlns&&(n.xmlns=e.attributes.xmlns),e.attributes.style&&(n.style=e.attributes.style),void 0!==e.attributes["xml:lang"]&&(n["xml:lang"]=e.attributes["xml:lang"]),{attributes:n,children:t,name:"body"}):void 0}function At(e){return 97<=e&&e<=122||65<=e&&e<=90||58===e||95===e}function Ot(e){return 192<=e&&e<=214||216<=e&&e<=246||248<=e&&e<=767||880<=e&&e<=893||895<=e&&e<=8191||8204<=e&&e<=8205||8304<=e&&e<=8591||11264<=e&&e<=12271||12289<=e&&e<=55295||65008<=e&&e<=65533||65536<=e&&e<=983039}function jt(e){return At(e)||Ot(e)}function Ct(e){return At(e)||45===e||46===e||48<=e&&e<=57||183===e||768<=e&&e<=879||8255<=e&&e<=8256||Ot(e)}function Rt(e){return 32===e||10===e||13===e||9===e}class Pt extends ee.EventEmitter{constructor(e={}){super(),this.allowComments=!0,this.attributes={},this.state=34,this.tagName="",this.haveDeclaration=!1,this.recordBuffer=[],void 0!==e.allowComments&&(this.allowComments=e.allowComments)}write(e){for(const t of e){const e=t.codePointAt(0);switch(this.state){case 34:if(60===e){let e;try{e=gt(this.endRecord())}catch(e){return void this.emit("error",e)}e&&this.emit("text",e),this.transition(31);continue}this.record(t);continue;case 31:if(47===e){this.transition(7);continue}if(33===e){this.transition(24);continue}if(63===e){this.haveDeclaration&&this.restrictedXML(),this.transition(25);continue}if(jt(e)){this.transition(30),this.startRecord(t);continue}return this.notWellFormed();case 30:if(Ct(e)){this.record(t);continue}if(Rt(e)){this.startTag(),this.transition(32);continue}if(47===e){this.startTag(),this.transition(29);continue}if(62===e){this.startTag(),this.transition(34),this.emit("startElement",this.tagName,this.attributes);continue}return this.notWellFormed();case 29:if(62===e){this.emit("startElement",this.tagName,this.attributes),this.emit("endElement",this.tagName),this.transition(34);continue}return this.notWellFormed();case 33:if(Rt(e)){this.transition(32);continue}if(47===e){this.transition(29);continue}if(62===e){this.emit("startElement",this.tagName,this.attributes),this.transition(34);continue}return this.notWellFormed();case 32:if(Rt(e))continue;if(jt(e)){this.startRecord(t),this.transition(0);continue}if(47===e){this.transition(29);continue}if(62===e){this.emit("startElement",this.tagName,this.attributes),this.transition(34);continue}return this.notWellFormed();case 7:if(jt(e)){this.startRecord(t),this.transition(6);continue}return this.notWellFormed();case 6:if(Ct(e)){this.record(t);continue}if(Rt(e)){this.transition(8);continue}if(62===e){const e=this.endRecord();this.emit("endElement",e,this.attributes),this.transition(34);continue}return this.notWellFormed();case 8:if(Rt(e))continue;if(62===e){const e=this.endRecord();this.emit("endElement",e,this.attributes),this.transition(34);continue}return this.notWellFormed();case 0:if(Ct(e)){this.record(t);continue}if(61===e){this.addAttribute(),this.transition(4);continue}if(Rt(e)){this.addAttribute(),this.transition(3);continue}return this.notWellFormed();case 3:if(61===e){this.transition(4);continue}if(Rt(e))continue;return this.notWellFormed();case 4:if(34===e){this.startRecord(),this.transition(1);continue}if(39===e){this.startRecord(),this.transition(2);continue}if(Rt(e))continue;return this.notWellFormed();case 1:case 2:if(34===e&&1===this.state||39===e&&2===this.state){const e=this.endRecord();this.attributes[this.attributeName]=gt(e),this.transition(33);continue}if(60===e)return this.notWellFormed();this.record(t);continue;case 24:if(45===e){this.allowComments||this.restrictedXML(),this.transition(23);continue}if(91===e){this.transition(21);continue}return this.notWellFormed();case 23:if(45===e){this.transition(14);continue}return this.notWellFormed();case 14:45===e&&this.transition(12);continue;case 12:45===e?this.transition(11):this.transition(14);continue;case 11:62===e?this.transition(34):this.transition(14);continue;case 25:if(88===e||120===e){this.transition(28);continue}return this.notWellFormed();case 28:if(77===e||109===e){this.transition(27);continue}return this.notWellFormed();case 27:if(76===e||108===e){this.transition(26);continue}return this.notWellFormed();case 26:if(Rt(e)){this.haveDeclaration=!0,this.transition(15);continue}return this.notWellFormed();case 13:if(62===e){this.transition(34);continue}return this.notWellFormed();case 15:63===e&&this.transition(13);continue;case 21:this.wait(e,67,20);continue;case 20:this.wait(e,68,19);continue;case 19:this.wait(e,65,18);continue;case 18:this.wait(e,84,17);continue;case 17:this.wait(e,65,16);continue;case 16:this.wait(e,91,5);continue;case 5:if(93===e){this.transition(10);continue}this.record(t);continue;case 10:93===e?this.transition(9):(this.record(String.fromCodePoint(93)),this.record(t),this.transition(5));continue;case 9:if(62===e){const e=this.endRecord();e&&this.emit("text",e),this.transition(34)}else this.record(String.fromCodePoint(93)),this.record(String.fromCodePoint(93)),this.record(t),this.transition(5);continue}}}end(e){e&&this.write(e),this.write=()=>{}}record(e){this.recordBuffer.push(e)}startRecord(e){this.recordBuffer=[],e&&this.recordBuffer.push(e)}endRecord(){const e=this.recordBuffer;return this.recordBuffer=[],e.join("")}startTag(){this.tagName=this.endRecord(),this.attributes={}}addAttribute(){const e=this.endRecord();if(void 0!==this.attributes[e])return this.notWellFormed();this.attributeName=e,this.attributes[e]=""}wait(e,t,n){if(e!==t)return this.notWellFormed();this.transition(n)}transition(e){this.state=e,34===e&&this.startRecord()}notWellFormed(e){this.emit("error",ct.notWellFormed(e))}restrictedXML(e){this.emit("error",ct.restrictedXML(e))}}function Lt(e,t={}){const n=new Pt(t);let i,r,s=null;if(n.on("text",(e=>{r&&r.children.push(e)})),n.on("startElement",((e,t)=>{const n=new bt(e,t);i||(i=n),r=r?r.appendChild(n):n})),n.on("endElement",(e=>{r?e===r.name?r.parent&&(r=r.parent):n.emit("error",ct.notWellFormed("b")):n.emit("error",ct.notWellFormed("a"))})),n.on("error",(e=>{s=e})),n.write(e),n.end(),s)throw s;return i}function Mt(e,t,n,i){if(i){e=e||i.getNamespace();const n=i.getNamespaceRoot(e);if(n){t=`${n.useNamespace("",e)}:${t}`}}const r=new bt(t);return t.indexOf(":")<0&&(!n||e!==n)&&r.setAttribute("xmlns",e),r}function Ft(e,t){return(e.getAttribute("xml:lang")||t||"").toLowerCase()}function Dt(e,t){const n=[];for(const i of e)n.push(Ft(i,t.lang));let i;return i=t.resolveLanguage?t.resolveLanguage(n,t.acceptLanguages||[],t.lang):t.lang,i||""}function qt(e,t,n,i){const r=e.getChildren(n,t),s=Ft(e);return r.length?i?r.filter((e=>{if(Ft(e,s)===i)return!0})):r:[]}function Ut(e,t,n,i){t=t||e.getNamespace();const r=qt(e,t,n,i);if(r.length)return r[0];const s=Mt(t,n,e.getDefaultNamespace(),e),o=Ft(e,i);return i&&o!==i&&s.setAttribute("xml:lang",i),e.appendChild(s),s}function Bt(e){return{importer(t){const n=t.getAttribute(e.name,e.namespace);return n?e.parseValue(n):e.dynamicDefault?e.dynamicDefault(n):e.staticDefault},exporter(t,n){if(void 0===n||n===e.staticDefault)return;const i=e.writeValue(n);if(i||e.emitEmpty)if(e.namespace&&e.prefix){let n;const r=t.getNamespaceRoot(e.namespace);if(r)n=r.useNamespace(e.prefix,e.namespace);else{const i=t.getNamespaceContext();i[e.namespace]||(n=t.useNamespace(e.prefix,e.namespace),i[e.namespace]=n)}t.setAttribute(`${n}:${e.name}`,i,e.emitEmpty)}else t.setAttribute(e.name,i,e.emitEmpty)}}}function Gt(e,t){return(n,i,r={})=>(r=Object.assign({staticDefault:i},r),Bt(Object.assign(Object.assign({name:n},e),t?t(r):r)))}function Jt(e,t){return(n,i,r,s,o={})=>(o=Object.assign({staticDefault:s},o),Bt(Object.assign(Object.assign({name:r,namespace:i,prefix:n},e),t?t(o):o)))}function zt(e){const t=e.converter||Bt(Object.assign(Object.assign({},e),{namespace:e.attributeNamespace}));return{importer(n,i){const r=n.getChild(e.element,e.namespace||n.getNamespace());return r?t.importer(r,i):e.dynamicDefault?e.dynamicDefault():e.staticDefault},exporter(n,i,r){if(void 0!==i&&i!==e.staticDefault){const s=Ut(n,e.namespace||n.getNamespace(),e.element);t.exporter(s,i,r)}}}}function Xt(e,t){return(n,i,r,s,o={})=>(o=Object.assign({staticDefault:s},o),zt(Object.assign(Object.assign({element:i,name:r,namespace:n},e),t?t(o):o)))}function $t(e){return{importer(t){const n=t.getText();return n?e.parseValue(n):e.dynamicDefault?e.dynamicDefault(n):e.staticDefault},exporter(t,n){if(!n&&e.emitEmpty)return void t.children.push("");if(void 0===n||n===e.staticDefault)return;const i=e.writeValue(n);i&&t.children.push(i)}}}function Vt(e){const t=$t(e);return{importer(n,i){const r=qt(n,e.namespace||n.getNamespace(),e.element),s=Dt(r,i);if(!r.length)return e.dynamicDefault?e.dynamicDefault():e.staticDefault;if(e.matchLanguage)for(const e of r)if(Ft(e,i.lang)===s)return t.importer(e,i);return t.importer(r[0],i)},exporter(n,i,r){if(i||!e.emitEmpty){if(void 0!==i&&i!==e.staticDefault){const s=Ut(n,e.namespace||n.getNamespace(),e.element,e.matchLanguage?r.lang:void 0);t.exporter(s,i,r)}}else Ut(n,e.namespace||n.getNamespace(),e.element,e.matchLanguage?r.lang:void 0)}}}const Ht={parseValue:e=>e,writeValue:e=>e},Wt={parseValue:e=>parseInt(e,10),writeValue:e=>e.toString()},Qt={parseValue:e=>parseFloat(e),writeValue:e=>e.toString()},Kt={parseValue:e=>"true"===e||"1"===e||"false"!==e&&"0"!==e&&void 0,writeValue:e=>e?"1":"0"},Yt={parseValue:e=>new Date(e),writeValue:e=>"string"==typeof e?e:e.toISOString()},Zt={parseValue:e=>JSON.parse(e),writeValue:e=>JSON.stringify(e)},en=(e="utf8")=>({parseValue:t=>("base64"===e&&"="===t&&(t=""),be.from(t.trim(),e)),writeValue:t=>{let n;return n="string"==typeof t?be.from(t).toString(e):t?t.toString(e):"","base64"===e&&(n=n||"="),n}}),tn={parseValue:e=>{let t=-1;"-"===e.charAt(0)&&(t=1,e=e.slice(1));const n=e.split(":");return(60*parseInt(n[0],10)+parseInt(n[1],10))*t},writeValue:e=>{if("string"==typeof e)return e;{let t="-";e<0&&(e=-e,t="+");const n=e/60,i=e%60;return t+=(n<10?"0":"")+n+":"+(i<10?"0":"")+i,t}}},nn=Gt(Ht,(e=>Object.assign({dynamicDefault:e.emitEmpty?t=>""===t?"":e.staticDefault:void 0},e))),rn=Gt(Kt),sn=Gt(Wt),on=Gt(Qt),an=Gt(Yt),cn=Jt(Ht),ln=Jt(Kt),un=Jt(Wt),pn=Jt(Qt),dn=Jt(Yt),hn=Xt(Ht),fn=Xt(Kt),mn=Xt(Wt),gn=Xt(Qt),yn=Xt(Yt),vn=e=>$t(Object.assign({staticDefault:e},Ht)),bn=()=>$t(Object.assign({},Zt)),_n=(e="utf8")=>$t(Object.assign({},en(e)));function wn(){return{importer:(e,t)=>Ft(e,t.lang),exporter(e,t,n){t&&t.toLowerCase()!==n.lang?e.setAttribute("xml:lang",t):e.setAttribute("xml:lang",void 0)}}}const Sn=(e,t,n,i=!1)=>Vt(Object.assign({element:t,emitEmpty:i,matchLanguage:!0,namespace:e,staticDefault:n},Ht)),xn=(e,t,n="utf8")=>Vt(Object.assign({element:t,matchLanguage:!0,namespace:e},en(n))),Tn=(e,t)=>Vt(Object.assign({element:t,namespace:e},Yt)),En=(e,t,n)=>Vt(Object.assign({element:t,namespace:e,staticDefault:n},Wt)),In=(e,t,n)=>Vt(Object.assign({element:t,namespace:e,staticDefault:n},Qt)),Nn=(e,t)=>Vt(Object.assign({element:t,namespace:e},Zt));function kn(e,t){return Vt(Object.assign({element:t,namespace:e,staticDefault:0},tn))}function An(e,t){return{importer(n){if(n.getChild(t,e||n.getNamespace()))return!0},exporter(n,i){i&&Ut(n,e||n.getNamespace(),t)}}}const On=(e,t,n)=>{if(!n)return;let i=t;for(const t of e)i=Ut(i,t.namespace||i.getNamespace(),t.element);i.children.push(n.toString())};function jn(e,t){return{importer(n){let i=n;for(const n of e)if(i=i.getChild(n.element,n.namespace||i.getNamespace()),!i)return t;return i.getText()||t},exporter(t,n){On(e,t,n)}}}function Cn(e,t){return{importer(n){let i=n;for(const t of e)if(i=i.getChild(t.element,t.namespace||i.getNamespace()),!i)return;const r=i.getText();return r?parseInt(r,10):t||void 0},exporter(t,n){On(e,t,n)}}}function Rn(e){return{importer(t){let n=t;for(const t of e)if(n=n.getChild(t.element,t.namespace||n.getNamespace()),!n)return!1;return!0},exporter(t,n){if(!n)return;let i=t;for(const t of e)i=Ut(i,t.namespace||i.getNamespace(),t.element)}}}function Pn(e){const t=e.pop();return{importer(n,i){let r=n;for(const t of e)if(r=r.getChild(t.element,t.namespace||r.getNamespace()),!r)return[];const s=[],o=qt(r,t.namespace||r.getNamespace(),t.element),a=Dt(o,i);for(const e of o)Ft(e,i.lang)===a&&s.push(e.getText());return s},exporter(n,i,r){if(!i.length)return;let s=n;for(const t of e)s=Ut(s,t.namespace||s.getNamespace(),t.element);const{namespace:o,element:a}=t;for(const e of i){const t=Mt(o||s.getNamespace(),a,r.namespace,s);t.children.push(e),s.appendChild(t)}}}}function Ln(e,t,n){const i=new Map,r=new Map;for(const e of t)"string"==typeof e?(i.set(e,e),r.set(e,e)):(i.set(e[1],e[0]),r.set(e[0],e[1]));return{importer(t){for(const n of t.children)if("string"!=typeof n&&n.getNamespace()===(e||t.getNamespace())&&i.has(n.getName()))return i.get(n.getName());return n},exporter(t,n){r.has(n)&&Ut(t,e,r.get(n))}}}function Mn(e,t,n,i){const r=new Set(t),s=new Set(n);return{importer(t){for(const n of t.children)if("string"!=typeof n&&n.getNamespace()===(e||t.getNamespace())&&r.has(n.getName())){for(const i of n.children)if("string"!=typeof i&&i.getNamespace()===(e||t.getNamespace())&&s.has(i.getName()))return[n.getName(),i.getName()];return[n.getName()]}return i},exporter(t,n){const i=Ut(t,e,n[0]);n[1]&&Ut(i,e,n[1])}}}function Fn(e,t){return{importer(n,i){const r=[],s=qt(n,e||n.getNamespace(),t),o=Dt(s,i);for(const e of s)Ft(e,i.lang)===o&&r.push(e.getText());return r},exporter(n,i,r){for(const s of i){const i=Mt(e||n.getNamespace(),t,r.namespace,n);i.children.push(s),n.appendChild(i)}}}}function Dn(e,t,n){return{importer(i){const r=[],s=i.getChildren(t,e||i.getNamespace());for(const e of s){const t=e.getAttribute(n);void 0!==t&&r.push(t)}return r},exporter(i,r,s){for(const o of r){const r=Mt(e||i.getNamespace(),t,s.namespace,i);r.setAttribute(n,o),i.appendChild(r)}}}}function qn(e,t,n){return{importer(i){const r=[],s=i.getChildren(t,e||i.getNamespace());for(const e of s){const t=e.getAttribute(n);void 0!==t&&r.push(parseInt(t,10))}return r},exporter(i,r,s){for(const o of r){const r=Mt(e||i.getNamespace(),t,s.namespace,i);r.setAttribute(n,o.toString()),i.appendChild(r)}}}}function Un(e,t){return{importer(n,i){const r=[],s=qt(n,e||n.getNamespace(),t),o=new Set;for(const e of s){const t=e.getText();if(t){const n=Ft(e,i.lang);if(o.has(n))continue;r.push({lang:n,value:t}),o.add(n)}}return o.size>0?r:void 0},exporter(n,i,r){for(const s of i){const i=s.value;if(i){const o=Mt(e||n.getNamespace(),t,r.namespace,n);s.lang!==r.lang&&o.setAttribute("xml:lang",s.lang),o.children.push(i),n.appendChild(o)}}}}}function Bn(e,t){const n=new Map,i=new Map;for(const e of t)"string"==typeof e?(n.set(e,e),i.set(e,e)):(n.set(e[1],e[0]),i.set(e[0],e[1]));return{importer(t){const i=[];for(const r of t.children)"string"!=typeof r&&r.getNamespace()===(e||t.getNamespace())&&n.has(r.getName())&&i.push(n.get(r.getName()));return i},exporter(t,n){for(const r of n)Ut(t,e,i.get(r))}}}function Gn(e,t,n,i=!1){return{importer(r,s){const o=r.getChild(t,e||r.getNamespace());if(!o)return;const a=[];for(const e of o.children)if("string"!=typeof e&&s.registry.getImportKey(e)===n){const t=s.registry.import(e);t&&a.push(t)}return i?a:a[0]},exporter(i,r,s){let o=[];o=Array.isArray(r)?r:[r];const a=[];for(const t of o){const r=s.registry.export(n,t,Object.assign(Object.assign({},s),{namespace:e||i.getNamespace()||void 0}));r&&a.push(r)}if(a.length){const n=Ut(i,e||i.getNamespace(),t);for(const e of a)n.appendChild(e)}}}}function Jn(e){return{exporter:()=>{},importer:()=>e}}function zn(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=qt(i,e||i.getNamespace(),t),o=Dt(s,r);for(const e of s)if(Ft(e,r.lang)===o)return n?r.sanitizers[n](e.toJSON()):e.toJSON();return s[0]?n?r.sanitizers[n](s[0].toJSON()):s[0].toJSON():void 0},exporter(i,r,s){if("string"==typeof r){r=Lt(`<${t} xmlns="${e||i.getNamespace()}">${r}</${t}>`).toJSON()}if(r&&n){if(!s.sanitizers||!s.sanitizers[n])return;r=s.sanitizers[n](r)}if(!r)return;const o=Ut(i,e||i.getNamespace(),t,s.lang);for(const e of r.children)"string"==typeof e?o.appendChild(e):e&&o.appendChild(new bt(e.name,e.attributes,e.children))}}}function Xn(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=[],o=new Set,a=qt(i,e||i.getNamespace(),t);for(const e of a){let t=e.toJSON();if(n&&(t=r.sanitizers[n](t)),t){const n=Ft(e,r.lang);if(o.has(n))continue;s.push({lang:n,value:t}),o.add(n)}}return o.size>0?s:void 0},exporter(i,r,s){for(const o of r){let r=o.value;if("string"==typeof r){r=Lt(`<${t} xmlns="${e||i.getNamespace()}">${r}</${t}>`).toJSON()}if(r&&n){if(!s.sanitizers||!s.sanitizers[n])continue;r=s.sanitizers[n](r)}if(r){const n=Mt(e||i.getNamespace(),t,s.namespace,i);i.appendChild(n),o.lang!==s.lang&&n.setAttribute("xml:lang",o.lang);for(const e of r.children)"string"==typeof e?n.appendChild(e):n.appendChild(new bt(e.name,e.attributes,e.children))}}}}}function $n(e,t,n,i){return{importer(r,s){const o={},a=qt(r,e,t),c=nn(n).importer,l=nn(i).importer;for(const e of a)o[c(e,s)]=l(e,s);return o},exporter(r,s,o){const a=nn(n).exporter,c=nn(i).exporter,l=e||r.getNamespace();for(const[e,n]of Object.entries(s)){const i=Mt(l,t,o.namespace,r);a(i,e,o),s[e]&&c(i,n,o),r.appendChild(i)}}}}class Vn{constructor(){this.parents=new Set,this.placeholder=!1,this.typeField="",this.versionField="",this.defaultType="",this.defaultVersion="",this.languageField="lang",this.typeValues=new Map,this.typeOrders=new Map,this.importers=new Map,this.exporters=new Map,this.children=new Map,this.childrenIndex=new Map,this.implicitChildren=new Set,this.contexts=new Map}addChild(e,t,n=!1,i,r){const s={multiple:n||!1,name:e,selector:i,translator:t},o=this.children.get(e);if(!o){s.translator.parents.add(this),this.children.set(e,s);for(const[n]of t.importers)this.implicitChildren.has(n)||this.childrenIndex.set(n,e);return void(r&&this.implicitChildren.add(r))}const a=o.translator;o.multiple=n,i&&o.selector&&i!==o.selector&&(o.selector=void 0);for(const[n,i]of t.importers){const[r,s]=(a.typeValues.get(n)||"").split("__v__");a.updateDefinition({contexts:t.contexts,element:i.element,exporterOrdering:new Map,exporters:new Map,importerOrdering:i.fieldOrders,importers:i.fields,namespace:i.namespace,optionalNamespaces:new Map,type:r,version:s}),this.implicitChildren.has(n)||this.childrenIndex.set(n,e)}for(const[e,n]of t.exporters){const[i,r]=e.split("__v__");a.updateDefinition({contexts:t.contexts,element:n.element,exporterOrdering:n.fieldOrders,exporters:n.fields,importerOrdering:new Map,importers:new Map,namespace:n.namespace,optionalNamespaces:n.optionalNamespaces,type:i,version:r})}}addContext(e,t,n,i,r,s){t&&(e=`${e}[${t}]`);let o=this.contexts.get(e);o||(o={typeField:"",versionField:"",typeValues:new Map}),s&&(o.impliedType=r),o.typeField=n||"",o.typeValues.set(i,r),this.contexts.set(e,o)}getChild(e){const t=this.children.get(e);if(t)return t.translator}getImportKey(e){return this.childrenIndex.get(`{${e.getNamespace()}}${e.getName()}`)}updateDefinition(e){const t=`{${e.namespace}}${e.element}`,n=e.type||this.defaultType,i=e.version||this.defaultVersion,r=i?`${n}__v__${i}`:n,s=this.importers.get(t)||{element:e.element,fieldOrders:new Map,fields:new Map,namespace:e.namespace};for(const[t,n]of e.importers)s.fields.set(t,n);for(const[t,n]of e.importerOrdering)s.fieldOrders.set(t,n);this.importers.set(t,s);const o=this.exporters.get(r)||{element:e.element,fieldOrders:new Map,fields:new Map,namespace:e.namespace,optionalNamespaces:e.optionalNamespaces};for(const[t,n]of e.exporters)o.fields.set(t,n);for(const[t,n]of e.exporterOrdering)o.fieldOrders.set(t,n);for(const[t,n]of e.optionalNamespaces)o.optionalNamespaces.set(t,n);this.exporters.set(r,o);for(const[t,n]of e.contexts){const e=this.contexts.get(t)||{impliedType:void 0,typeField:n.typeField,versionField:n.versionField,typeValues:new Map};e.typeField||(e.typeField=n.typeField),e.versionField||(e.versionField=n.versionField),e.impliedType||(e.impliedType=n.impliedType);for(const[t,i]of n.typeValues)e.typeValues.set(t,i);this.contexts.set(t,e)}if(e.type)this.typeValues.set(t,r),e.typeOrder&&e.type&&this.typeOrders.set(e.type,e.typeOrder);else if(this.typeField&&!e.type){for(const[,t]of this.importers){for(const[n,i]of e.importers)t.fields.set(n,i);for(const[n,i]of e.importerOrdering)t.fieldOrders.set(n,i)}for(const[,t]of this.exporters){for(const[n,i]of e.exporters)t.fields.set(n,i);for(const[n,i]of e.exporterOrdering)t.fieldOrders.set(n,i)}}}replaceWith(e){for(const[t,n]of this.children)e.children.set(t,n);for(const[t,n]of this.childrenIndex)e.childrenIndex.set(t,n);for(const[t,n]of this.contexts)e.contexts.set(t,n);for(const t of this.implicitChildren)e.implicitChildren.add(t);for(const t of this.parents)for(const n of t.children.values())n.translator===this&&(n.translator=e);this.parents=new Set}import(e,t){const n=`{${e.getNamespace()}}${e.getName()}`,i={},r=this.importers.get(n);if(!r)return;const s=this.typeValues.get(n)||"",[o,a]=s.split("__v__"),c=t.path||"";let l;if(t.pathSelector&&(l=this.contexts.get(`${c}[${t.pathSelector}]`)),l||(l=this.contexts.get(c)),l){if(!l.impliedType){const e=l.typeValues.get(n)||"";e&&(i[l.typeField]=e)}}else this.typeField&&o&&o!==this.defaultType&&(i[this.typeField]=o);this.versionField&&a&&a!==this.defaultVersion&&(i[this.versionField]=a);const u=Object.assign(Object.assign({},t),{data:i,importer:r,lang:(e.getAttribute("xml:lang")||t.lang||"").toLowerCase(),pathSelector:o,translator:this}),p=[...r.fieldOrders.entries()].sort(((e,t)=>e[1]>t[1]?-1:e[1]<t[1]?1:0)),d=p.filter((e=>e[1]>=0)),h=p.filter((e=>e[1]<0));for(const[n]of d){const s=r.fields.get(n);u.path=`${t.path}.${n}`;const o=s(e,u);null!=o&&(i[n]=o)}for(const n of e.children){if("string"==typeof n)continue;const e=`{${n.getNamespace()}}${n.getName()}`,r=this.childrenIndex.get(e);if(!r)continue;u.path=`${t.path}.${r}`;const{translator:s,multiple:a,selector:c}=this.children.get(r);if(!c||c===o){const e=s.import(n,u);void 0!==e&&(a?(i[r]||(i[r]=[]),i[r].push(e)):i[r]?i[r]=s.resolveCollision(i[r],e):i[r]=e)}}for(const[n]of h){const s=r.fields.get(n);u.path=`${t.path}.${n}`;const o=s(e,u);null!=o&&(i[n]=o)}return i}export(e,t){if(!e)return;let n=this.defaultType,i=this.defaultVersion;const r=t.path||"";let s;t.pathSelector&&(s=this.contexts.get(`${r}[${t.pathSelector}]`)),s||(s=this.contexts.get(r)),s?n=s.impliedType||e[s.typeField]||this.defaultType:this.typeField&&(n=e[this.typeField]||this.defaultType),this.versionField&&(i=e[this.versionField]||this.defaultVersion);const o=i?`${n}__v__${i}`:n,a=this.exporters.get(o);if(!a)return;const c=Mt(a.namespace,a.element,t.namespace,t.element);t.element&&(c.parent=t.element);for(const[e,t]of a.optionalNamespaces)c.addOptionalNamespace(e,t);const l=Object.assign(Object.assign({},t),{data:e,element:c,exporter:a,lang:(e[this.languageField]||t.lang||"").toLowerCase(),namespace:c.getDefaultNamespace(),pathSelector:n,translator:this}),u=a.fields.get(this.languageField);u&&u(c,e[this.languageField],t);const p=Object.keys(e);p.sort(((e,t)=>(a.fieldOrders.get(e)||1e5)-(a.fieldOrders.get(t)||1e5)));for(const i of p){if(i===this.languageField)continue;const r=e[i],s=a.fields.get(i);if(s){s(c,r,l);continue}const o=this.children.get(i);if(!o)continue;l.path=`${t.path?t.path+".":""}${i}`;const{translator:u,multiple:p,selector:d}=o;if(!d||d===n){let e;e=p?null!=r?r:[]:[r];for(const t of e){const e=u.export(t,l);e&&c.appendChild(e)}}}return c}resolveCollision(e,t){return(this.typeOrders.get(e[this.typeField]||this.defaultType)||0)<=(this.typeOrders.get(t[this.typeField]||this.defaultType)||0)?e:t}}class Hn{constructor(){this.translators=new Map,this.root=new Vn,this.setLanguageResolver(vt)}setLanguageResolver(e){this.languageResolver=e}import(e,t={registry:this}){if(!this.hasTranslator(e.getNamespace(),e.getName()))return;t.acceptLanguages||(t.acceptLanguages=[]),t.acceptLanguages=t.acceptLanguages.map((e=>e.toLowerCase())),t.lang&&(t.lang=t.lang.toLowerCase()),t.resolveLanguage||(t.resolveLanguage=this.languageResolver),t.path=this.getImportKey(e),t.sanitizers||(t.sanitizers={xhtmlim:kt});return this.getOrCreateTranslator(e.getNamespace(),e.getName()).import(e,Object.assign(Object.assign({},t),{registry:this}))}export(e,t,n={registry:this}){n.acceptLanguages||(n.acceptLanguages=[]),n.acceptLanguages=n.acceptLanguages.map((e=>e.toLowerCase())),n.lang&&(n.lang=n.lang.toLowerCase()),n.sanitizers||(n.sanitizers={xhtmlim:kt}),n.path=e;const i=e.split(".").filter((e=>""!==e));let r=this.root;for(const e of i){const t=r.getChild(e);if(!t)return;r=t}return r.export(t,Object.assign(Object.assign({},n),{registry:this}))}getImportKey(e,t=""){const n=t?this.walkToTranslator(t.split(".")):this.root;if(n)return n.getImportKey(e)}define(e){if(Array.isArray(e)){for(const t of e)"object"==typeof t?this.define(t):t(this);return}if("object"!=typeof e)return void e(this);const t=e;t.aliases=t.aliases||[],t.path&&!t.aliases.includes(t.path)&&t.aliases.push(t.path);const n=t.aliases.map((e=>"string"==typeof e?{path:e}:e)).sort(((e,t)=>{const n=e.path.split(".").length;return t.path.split(".").length-n}));let i;if(this.hasTranslator(t.namespace,t.element)&&(i=this.getOrCreateTranslator(t.namespace,t.element)),!i){let e;for(const t of n){const n=this.walkToTranslator(t.path.split("."));if(n&&!n.placeholder){i=n;break}n&&(e=n)}e&&!i&&(i=e,i.placeholder=!1)}i||(i=this.getOrCreateTranslator(t.namespace,t.element)),this.indexTranslator(t.namespace,t.element,i);const r=t.fields||{},s=new Map,o=new Map,a=new Map,c=new Map;t.typeField&&(i.typeField=t.typeField),t.defaultType&&(i.defaultType=t.defaultType),t.versionField&&(i.versionField=t.versionField),t.defaultVersion&&(i.defaultVersion=t.defaultVersion),t.languageField&&(i.languageField=t.languageField);for(const[e,t]of Object.entries(r))s.set(e,t.importer),a.set(e,t.importOrder||t.order||0),o.set(e,t.exporter),c.set(e,t.exportOrder||t.order||0);if(t.childrenExportOrder)for(const[e,n]of Object.entries(t.childrenExportOrder))c.set(e,n||0);const l=new Map;for(const[e,n]of Object.entries(t.optionalNamespaces||{}))l.set(e,n);i.updateDefinition({contexts:new Map,element:t.element,exporterOrdering:c,exporters:o,importerOrdering:a,importers:s,namespace:t.namespace,optionalNamespaces:l,type:t.type,version:t.version,typeOrder:t.typeOrder});for(const e of n)this.alias(t.namespace,t.element,e.path,e.multiple,e.selector,e.contextField,t.type,e.impliedType);for(const e of n){const t=this.walkToTranslator(e.path.split("."));t&&t!==i&&t.replaceWith(i)}}alias(e,t,n,i=!1,r,s,o,a=!1){const c=this.getOrCreateTranslator(e,t);c.placeholder=!1;const l=n.split(".").filter((e=>""!==e)),u=l.pop(),p=this.walkToTranslator(l,!0),d=`{${e}}${t}`;o&&(s||a)&&c.addContext(n,r,s,d,o,a),p.addChild(u,c,i,r,d)}walkToTranslator(e,t=!1){let n=this.root;for(const i of e){let e=n.getChild(i);if(!e){if(!t)return;e=new Vn,e.placeholder=!0,n.addChild(i,e)}n=e}return n}hasTranslator(e,t){return this.translators.has(`{${e}}${t}`)}getOrCreateTranslator(e,t){let n=this.translators.get(`{${e}}${t}`);return n||(n=new Vn,this.indexTranslator(e,t,n)),n}indexTranslator(e,t,n){this.translators.set(`{${e}}${t}`,n)}}const Wn="http://www.w3.org/2005/Atom",Qn="urn:ietf:params:xml:ns:xmpp-bind",Kn="jabber:client",Yn="urn:ietf:params:xml:ns:xmpp-sasl",Zn="jabber:server",ei="urn:ietf:params:xml:ns:xmpp-session",ti="urn:ietf:params:xml:ns:xmpp-stanzas",ni="http://etherx.jabber.org/streams",ii="urn:ietf:params:xml:ns:xmpp-streams",ri="urn:ietf:params:xml:ns:xmpp-tls",si="jabber:iq:roster",oi="urn:xmpp:features:rosterver",ai="urn:xmpp:features:pre-approval",ci="urn:ietf:params:xml:ns:xmpp-framing",li="jabber:x:data",ui="jabber:iq:last",pi="jabber:iq:privacy",di="http://jabber.org/protocol/disco#info",hi="http://jabber.org/protocol/disco#items",fi="http://jabber.org/protocol/address",mi="http://jabber.org/protocol/muc",gi="http://jabber.org/protocol/muc#admin",yi="http://jabber.org/protocol/muc#owner",vi="http://jabber.org/protocol/muc#user",bi="http://jabber.org/protocol/ibb",_i="storage:bookmarks",wi="jabber:iq:private",Si="http://jabber.org/protocol/commands",xi="vcard-temp",Ti="jabber:iq:search",Ei="http://jabber.org/protocol/rsm",Ii="http://jabber.org/protocol/pubsub",Ni="http://jabber.org/protocol/pubsub#errors",ki="http://jabber.org/protocol/pubsub#event",Ai="http://jabber.org/protocol/pubsub#owner",Oi="http://jabber.org/protocol/bytestreams",ji="jabber:x:oob",Ci="jabber:iq:oob",Ri="http://www.w3.org/1999/xhtml",Pi="http://jabber.org/protocol/xhtml-im",Li="jabber:iq:register",Mi="http://jabber.org/features/iq-register",Fi="http://jabber.org/protocol/geoloc",Di="urn:xmpp:avatar:data",qi="urn:xmpp:avatar:metadata",Ui="http://jabber.org/protocol/chatstates",Bi="jabber:iq:version",Gi="http://jabber.org/protocol/mood",Ji="http://jabber.org/protocol/activity",zi="jabber:component:accept",Xi="http://jabber.org/protocol/caps",$i="http://jabber.org/protocol/tune",Vi="http://jabber.org/protocol/xdata-validate",Hi="http://jabber.org/protocol/httpbind",Wi="http://jabber.org/protocol/shim",Qi="http://jabber.org/features/compress",Ki="http://jabber.org/protocol/compress",Yi="http://jabber.org/protocol/xdata-layout",Zi="http://jabber.org/protocol/rosterx",er="vcard-temp:x:update",tr="urn:xmpp:alt-connections:websocket",nr="urn:xmpp:alt-connections:xbosh",ir="urn:xmpp:captcha",rr=e=>`${e}+notify`,sr="urn:xmpp:jingle:1",or="urn:xmpp:jingle:errors:1",ar="urn:xmpp:jingle:apps:rtp:1",cr="urn:xmpp:jingle:apps:rtp:info:1",lr="urn:xmpp:jingle:apps:rtp:audio",ur="urn:xmpp:jingle:apps:rtp:video",pr="http://jabber.org/protocol/nick",dr="urn:xmpp:jingle:transports:ice-udp:1",hr="urn:xmpp:jingle:transports:raw-udp:1",fr="urn:xmpp:receipts",mr="urn:xmpp:invisible:0",gr="urn:xmpp:blocking",yr="urn:xmpp:blocking:errors",vr="urn:xmpp:sm:3",br="urn:xmpp:ping",_r="urn:xmpp:time",wr="urn:xmpp:delay",Sr="urn:xmpp:xbosh",xr="urn:xmpp:extdisco:1",Tr="urn:xmpp:extdisco:2",Er="urn:xmpp:media-element",Ir="urn:xmpp:attention:0",Nr="urn:xmpp:bob",kr="urn:xmpp:jingle:apps:file-transfer:4",Ar="urn:xmpp:jingle:apps:file-transfer:5",Or="urn:xmpp:jingle:apps:xmlstream:0",jr="jabber:x:conference",Cr="urn:xmpp:jingle:transports:s5b:1",Rr="urn:xmpp:jingle:transports:ibb:1",Pr="urn:xmpp:thumbs:1",Lr="urn:xmpp:carbons:2",Mr="urn:xmpp:jingle:apps:rtp:rtcp-fb:0",Fr="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",Dr="urn:xmpp:forward:0",qr="urn:xmpp:hashes:1",Ur="urn:xmpp:hashes:2",Br=e=>`urn:xmpp:hash-function-text-names:${e}`,Gr="urn:xmpp:rtt:0",Jr="http://jabber.org/protocol/muc#unique",zr="urn:xmpp:message-correct:0",Xr="urn:xmpp:psa",$r="urn:xmpp:mam:1",Vr="urn:xmpp:mam:2",Hr="urn:xmpp:hats:0",Wr="urn:xmpp:idle:1",Qr="urn:xmpp:jingle:apps:dtls:0",Kr="urn:xmpp:chat-markers:0",Yr="urn:xmpp:hints",Zr="urn:xmpp:json:0",es="urn:xmpp:jingle:apps:grouping:0",ts="urn:xmpp:jingle:apps:rtp:ssma:0",ns="urn:xmpp:jingle:transports:dtls-sctp:1",is="urn:xmpp:csi:0",rs="urn:xmpp:push:0",ss="urn:xmpp:sid:0",os="urn:xmpp:http:upload:0",as="urn:xmpp:jingle:transports:ice:0",cs="urn:xmpp:reference:0",ls="urn:xmpp:eme:0",us="eu.siacs.conversations.axolotl",ps="eu.siacs.conversations.axolotl.devicelist",ds="eu.siacs.conversations.axolotl.bundles",hs="urn:xmpp:json-msg:0",fs="http://docs.oasis-open.org/ns/xri/xrd-1.0",ms="urn:xmpp:jingle:apps:rtp:msid:0";const gs=nn,ys=hn,vs=Sn;function bs(e,t,n){return{aliases:Array.isArray(n)?n:[n],element:t,fields:{},namespace:e}}function _s(e){return{element:"message",fields:e,namespace:Kn}}function ws(e){return{element:"presence",fields:e,namespace:Kn}}function Ss(e){return{element:"iq",fields:e,namespace:Kn}}function xs(e){return{element:"features",fields:e,namespace:ni}}function Ts(e){return{element:"error",fields:e,namespace:ti,path:"stanzaError"}}function Es(){return[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}]}class Is extends ye.Transform{constructor(e){super({objectMode:!0}),this.closedStream=!1,this.wrappedStream=!1,this.registry=e.registry,this.acceptLanguages=e.acceptLanguages||[],e.wrappedStream&&(this.wrappedStream=!0,this.rootImportKey=e.rootKey),this.parser=new Pt({allowComments:e.allowComments}),this.parser.on("error",(e=>{this.destroy(e)})),this.parser.on("startElement",((e,t)=>{if(this.destroyed)return;if(this.closedStream)return this.destroy(ct.alreadyClosed());const n=new bt(e,t),i=this.registry.getImportKey(n);if(this.wrappedStream&&!this.rootElement){if(this.rootImportKey&&i!==this.rootImportKey)return this.destroy(ct.unknownRoot());const e=this.registry.import(n,{acceptLanguages:this.acceptLanguages,lang:this.lang});return e?(this.rootElement=n,void this.push({event:"stream-start",kind:i,stanza:e,xml:n})):this.destroy(ct.notWellFormed())}this.currentElement?this.currentElement=this.currentElement.appendChild(n):this.currentElement=n})),this.parser.on("endElement",(e=>{if(!this.destroyed){if(this.wrappedStream&&!this.currentElement)return this.rootElement&&e===this.rootElement.name?(this.closedStream=!0,this.push({event:"stream-end",kind:this.rootImportKey,stanza:{},xml:this.rootElement}),this.end()):(this.closedStream=!0,this.destroy(ct.notWellFormed()));if(!this.currentElement||e!==this.currentElement.name)return this.closedStream=!0,this.destroy(ct.notWellFormed());if(this.currentElement.parent)this.currentElement=this.currentElement.parent;else{this.wrappedStream&&(this.currentElement.parent=this.rootElement);const e=this.registry.getImportKey(this.currentElement),t=this.registry.import(this.currentElement,{acceptLanguages:this.acceptLanguages,lang:this.lang});t&&this.push({kind:e,stanza:t,xml:this.currentElement}),this.currentElement=void 0}}})),this.parser.on("text",(e=>{this.currentElement&&this.currentElement.children.push(e)}))}_transform(e,t,n){this.parser.write(e.toString()),n()}}var Ns=Object.freeze({__proto__:null,Registry:Hn,Translator:Vn,XMLElement:bt,define:function(e){return t=>{t.define(e)}},Parser:Pt,parse:Lt,StreamParser:Is,escapeXML:mt,unescapeXML:gt,escapeXMLText:yt,basicLanguageResolver:vt,createElement:Mt,getLang:Ft,getTargetLang:Dt,findAll:qt,findOrCreate:Ut,attribute:nn,booleanAttribute:rn,integerAttribute:sn,floatAttribute:on,dateAttribute:an,namespacedAttribute:cn,namespacedBooleanAttribute:ln,namespacedIntegerAttribute:un,namespacedFloatAttribute:pn,namespacedDateAttribute:dn,childAttribute:hn,childBooleanAttribute:fn,childIntegerAttribute:mn,childFloatAttribute:gn,childDateAttribute:yn,text:vn,textJSON:bn,textBuffer:_n,languageAttribute:wn,childLanguageAttribute:(e,t)=>zt(Object.assign({converter:wn(),element:t,name:"xml:lang",namespace:e},Ht)),childText:Sn,childTextBuffer:xn,childDate:Tn,childInteger:En,childFloat:In,childJSON:Nn,childTimezoneOffset:kn,childBoolean:An,deepChildText:jn,deepChildInteger:Cn,deepChildBoolean:Rn,deepMultipleChildText:Pn,childEnum:Ln,childDoubleEnum:Mn,multipleChildText:Fn,multipleChildAttribute:Dn,multipleChildIntegerAttribute:qn,childAlternateLanguageText:Un,multipleChildAlternateLanguageText:function(e,t){return{importer(n,i){const r=[],s=new Map;let o=!1;const a=qt(n,e||n.getNamespace(),t);for(const e of a){const t=e.getText();if(t){const n=Ft(e,i.lang);let a=s.get(n);a||(a=[],s.set(n,a),r.push({lang:n,value:a})),a.push(t),o=!0}}return o?r:void 0},exporter(n,i,r){for(const s of i)for(const i of s.value){const o=Mt(e||n.getNamespace(),t,r.namespace,n);s.lang!==r.lang&&o.setAttribute("xml:lang",s.lang),o.children.push(i),n.appendChild(o)}}}},multipleChildEnum:Bn,splicePath:Gn,staticValue:Jn,childRawElement:function(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=i.getChild(t,e||i.getNamespace());return s?n?r.sanitizers[n](s.toJSON()):s.toJSON():void 0},exporter(i,r,s){if("string"==typeof r){r=Lt(`<${t} xmlns="${e||i.getNamespace()}">${r}</${t}>`).toJSON()}if(n){if(!s.sanitizers||!s.sanitizers[n])return;r=s.sanitizers[n](r)}r&&i.appendChild(new bt(r.name,r.attributes,r.children))}}},childLanguageRawElement:zn,childAlternateLanguageRawElement:Xn,parameterMap:$n,JIDAttribute:gs,childJIDAttribute:ys,childJID:vs,addAlias:bs,extendMessage:_s,extendPresence:ws,extendIQ:Ss,extendStreamFeatures:xs,extendStanzaError:Ts,pubsubItemContentAliases:Es});class ks extends ye.Transform{constructor(e,t,n="be"){super(),this._block=be.alloc(e),this._finalSize=t,this._blockSize=e,this._bigEndian="be"===n,this._len=0}_transform(e,t,n){let i=null;try{this.update(e,t)}catch(e){i=e}n(i)}_flush(e){let t=null;try{this.push(this.digest())}catch(e){t=e}e(t)}update(e,t){"string"==typeof e&&(t=t||"utf8",e=be.from(e,t));const n=this._block,i=this._blockSize,r=e.length;let s=this._len;for(let t=0;t<r;){const o=s%i,a=Math.min(r-t,i-o);for(let i=0;i<a;i++)n[o+i]=e[t+i];s+=a,t+=a,s%i==0&&this._update(n)}return this._len+=r,this}digest(e){const t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));const n=8*this._len;if(n<=4294967295)this._bigEndian?(this._block.writeUInt32BE(0,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)):(this._block.writeUInt32LE(n,this._blockSize-8),this._block.writeUInt32LE(0,this._blockSize-4));else{const e=(4294967295&n)>>>0,t=(n-e)/4294967296;this._bigEndian?(this._block.writeUInt32BE(t,this._blockSize-8),this._block.writeUInt32BE(e,this._blockSize-4)):(this._block.writeUInt32LE(e,this._blockSize-8),this._block.writeUInt32LE(t,this._blockSize-4))}this._update(this._block);const i=this._hash();return e?i.toString(e):i}_update(e){throw new Error("_update must be implemented by subclass")}_hash(){throw new Error("_update must be implemented by subclass")}}function As(e,t){return e<<t|e>>>32-t}function Os(e,t,n,i,r,s,o){return As(e+(t&n|~t&i)+r+s|0,o)+t|0}function js(e,t,n,i,r,s,o){return As(e+(t&i|n&~i)+r+s|0,o)+t|0}function Cs(e,t,n,i,r,s,o){return As(e+(t^n^i)+r+s|0,o)+t|0}function Rs(e,t,n,i,r,s,o){return As(e+(n^(t|~i))+r+s|0,o)+t|0}const Ps=[1518500249,1859775393,-1894007588,-899497514];function Ls(e){return e<<5|e>>>27}function Ms(e){return e<<30|e>>>2}function Fs(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}class Ds extends ks{constructor(){super(64,56),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this._w=new Array(80)}_update(e){const t=this._w;let n,i=0|this._a,r=0|this._b,s=0|this._c,o=0|this._d,a=0|this._e;for(n=0;n<16;++n)t[n]=e.readInt32BE(4*n);for(;n<80;++n)t[n]=(c=t[n-3]^t[n-8]^t[n-14]^t[n-16])<<1|c>>>31;var c;for(let e=0;e<80;++e){const n=~~(e/20),c=Ls(i)+Fs(n,r,s,o)+a+t[e]+Ps[n]|0;a=o,o=s,s=Ms(r),r=i,i=c}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=a+this._e|0}_hash(){const e=be.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e}}const qs=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Us(e,t,n){return n^e&(t^n)}function Bs(e,t,n){return e&t|n&(e|t)}function Gs(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function Js(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function zs(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}class Xs extends ks{constructor(){super(64,56),this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this._w=new Array(64)}_update(e){const t=this._w;let n,i=0|this._a,r=0|this._b,s=0|this._c,o=0|this._d,a=0|this._e,c=0|this._f,l=0|this._g,u=0|this._h;for(n=0;n<16;++n)t[n]=e.readInt32BE(4*n);for(;n<64;++n)t[n]=0|(((p=t[n-2])>>>17|p<<15)^(p>>>19|p<<13)^p>>>10)+t[n-7]+zs(t[n-15])+t[n-16];var p;for(let e=0;e<64;++e){const n=u+Js(a)+Us(a,c,l)+qs[e]+t[e]|0,p=Gs(i)+Bs(i,r,s)|0;u=l,l=c,c=a,a=o+n|0,o=s,s=r,r=i,i=n+p|0}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=a+this._e|0,this._f=c+this._f|0,this._g=l+this._g|0,this._h=u+this._h|0}_hash(){const e=be.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e}}const $s=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Vs(e,t,n){return n^e&(t^n)}function Hs(e,t,n){return e&t|n&(e|t)}function Ws(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function Qs(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function Ks(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function Ys(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function Zs(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function eo(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function to(e,t){return e>>>0<t>>>0?1:0}class no extends ks{constructor(){super(128,112),this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this._w=new Array(160)}_update(e){const t=this._w;let n,i,r=0|this._ah,s=0|this._bh,o=0|this._ch,a=0|this._dh,c=0|this._eh,l=0|this._fh,u=0|this._gh,p=0|this._hh,d=0|this._al,h=0|this._bl,f=0|this._cl,m=0|this._dl,g=0|this._el,y=0|this._fl,v=0|this._gl,b=0|this._hl,_=0;for(_=0;_<32;_+=2)t[_]=e.readInt32BE(4*_),t[_+1]=e.readInt32BE(4*_+4);for(;_<160;_+=2){let e=t[_-30],r=t[_-30+1];const s=Ks(e,r),o=Ys(r,e);e=t[_-4],r=t[_-4+1];const a=Zs(e,r),c=eo(r,e),l=t[_-14],u=t[_-14+1],p=t[_-32],d=t[_-32+1];i=o+u|0,n=s+l+to(i,o)|0,i=i+c|0,n=n+a+to(i,c)|0,i=i+d|0,n=n+p+to(i,d)|0,t[_]=n,t[_+1]=i}for(let e=0;e<160;e+=2){n=t[e],i=t[e+1];const _=Hs(r,s,o),w=Hs(d,h,f),S=Ws(r,d),x=Ws(d,r),T=Qs(c,g),E=Qs(g,c),I=$s[e],N=$s[e+1],k=Vs(c,l,u),A=Vs(g,y,v);let O=b+E|0,j=p+T+to(O,b)|0;O=O+A|0,j=j+k+to(O,A)|0,O=O+N|0,j=j+I+to(O,N)|0,O=O+i|0,j=j+n+to(O,i)|0;const C=x+w|0,R=S+_+to(C,x)|0;p=u,b=v,u=l,v=y,l=c,y=g,g=m+O|0,c=a+j+to(g,m)|0,a=o,m=f,o=s,f=h,s=r,h=d,d=O+C|0,r=j+R+to(d,O)|0}this._al=this._al+d|0,this._bl=this._bl+h|0,this._cl=this._cl+f|0,this._dl=this._dl+m|0,this._el=this._el+g|0,this._fl=this._fl+y|0,this._gl=this._gl+v|0,this._hl=this._hl+b|0,this._ah=this._ah+r+to(this._al,d)|0,this._bh=this._bh+s+to(this._bl,h)|0,this._ch=this._ch+o+to(this._cl,f)|0,this._dh=this._dh+a+to(this._dl,m)|0,this._eh=this._eh+c+to(this._el,g)|0,this._fh=this._fh+l+to(this._fl,y)|0,this._gh=this._gh+u+to(this._gl,v)|0,this._hh=this._hh+p+to(this._hl,b)|0}_hash(){const e=be.allocUnsafe(64);function t(t,n,i){e.writeInt32BE(t,i),e.writeInt32BE(n,i+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e}}const io=new Map([["md5",class extends ks{constructor(){super(64,56,"le"),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._m=new Array(16)}_update(e){const t=this._m;for(let n=0;n<16;++n)t[n]=e.readInt32LE(4*n);let n=this._a,i=this._b,r=this._c,s=this._d;n=Os(n,i,r,s,t[0],3614090360,7),s=Os(s,n,i,r,t[1],3905402710,12),r=Os(r,s,n,i,t[2],606105819,17),i=Os(i,r,s,n,t[3],3250441966,22),n=Os(n,i,r,s,t[4],4118548399,7),s=Os(s,n,i,r,t[5],1200080426,12),r=Os(r,s,n,i,t[6],2821735955,17),i=Os(i,r,s,n,t[7],4249261313,22),n=Os(n,i,r,s,t[8],1770035416,7),s=Os(s,n,i,r,t[9],2336552879,12),r=Os(r,s,n,i,t[10],4294925233,17),i=Os(i,r,s,n,t[11],2304563134,22),n=Os(n,i,r,s,t[12],1804603682,7),s=Os(s,n,i,r,t[13],4254626195,12),r=Os(r,s,n,i,t[14],2792965006,17),i=Os(i,r,s,n,t[15],1236535329,22),n=js(n,i,r,s,t[1],4129170786,5),s=js(s,n,i,r,t[6],3225465664,9),r=js(r,s,n,i,t[11],643717713,14),i=js(i,r,s,n,t[0],3921069994,20),n=js(n,i,r,s,t[5],3593408605,5),s=js(s,n,i,r,t[10],38016083,9),r=js(r,s,n,i,t[15],3634488961,14),i=js(i,r,s,n,t[4],3889429448,20),n=js(n,i,r,s,t[9],568446438,5),s=js(s,n,i,r,t[14],3275163606,9),r=js(r,s,n,i,t[3],4107603335,14),i=js(i,r,s,n,t[8],1163531501,20),n=js(n,i,r,s,t[13],2850285829,5),s=js(s,n,i,r,t[2],4243563512,9),r=js(r,s,n,i,t[7],1735328473,14),i=js(i,r,s,n,t[12],2368359562,20),n=Cs(n,i,r,s,t[5],4294588738,4),s=Cs(s,n,i,r,t[8],2272392833,11),r=Cs(r,s,n,i,t[11],1839030562,16),i=Cs(i,r,s,n,t[14],4259657740,23),n=Cs(n,i,r,s,t[1],2763975236,4),s=Cs(s,n,i,r,t[4],1272893353,11),r=Cs(r,s,n,i,t[7],4139469664,16),i=Cs(i,r,s,n,t[10],3200236656,23),n=Cs(n,i,r,s,t[13],681279174,4),s=Cs(s,n,i,r,t[0],3936430074,11),r=Cs(r,s,n,i,t[3],3572445317,16),i=Cs(i,r,s,n,t[6],76029189,23),n=Cs(n,i,r,s,t[9],3654602809,4),s=Cs(s,n,i,r,t[12],3873151461,11),r=Cs(r,s,n,i,t[15],530742520,16),i=Cs(i,r,s,n,t[2],3299628645,23),n=Rs(n,i,r,s,t[0],4096336452,6),s=Rs(s,n,i,r,t[7],1126891415,10),r=Rs(r,s,n,i,t[14],2878612391,15),i=Rs(i,r,s,n,t[5],4237533241,21),n=Rs(n,i,r,s,t[12],1700485571,6),s=Rs(s,n,i,r,t[3],2399980690,10),r=Rs(r,s,n,i,t[10],4293915773,15),i=Rs(i,r,s,n,t[1],2240044497,21),n=Rs(n,i,r,s,t[8],1873313359,6),s=Rs(s,n,i,r,t[15],4264355552,10),r=Rs(r,s,n,i,t[6],2734768916,15),i=Rs(i,r,s,n,t[13],1309151649,21),n=Rs(n,i,r,s,t[4],4149444226,6),s=Rs(s,n,i,r,t[11],3174756917,10),r=Rs(r,s,n,i,t[2],718787259,15),i=Rs(i,r,s,n,t[9],3951481745,21),this._a=this._a+n|0,this._b=this._b+i|0,this._c=this._c+r|0,this._d=this._d+s|0}_hash(){const e=be.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e}}],["sha-1",Ds],["sha-256",Xs],["sha-512",no],["sha1",Ds],["sha256",Xs],["sha512",no]]);function ro(e){e=e.toLowerCase();const t=io.get(e);if(t)return new t;throw new Error("Unsupported hash algorithm: "+e)}const so=be.alloc(128);class oo extends ye.Transform{constructor(e,t){super(),"string"==typeof t&&(t=be.from(t));const n="sha512"===e?128:64;this._alg=e,t.length>n?t=ro(e).update(t).digest():t.length<n&&(t=be.concat([t,so],n)),this._ipad=be.alloc(n),this._opad=be.alloc(n);for(let e=0;e<n;e++)this._ipad[e]=54^t[e],this._opad[e]=92^t[e];this._hash=ro(e).update(this._ipad)}_transform(e,t,n){let i;try{this.update(e,t)}catch(e){i=e}finally{n(i)}}_flush(e){let t;try{this.push(this._final())}catch(e){t=e}e(t)}_final(){const e=this._hash.digest();return ro(this._alg).update(this._opad).update(e).digest()}update(e,t){return this._hash.update(e,t),this}digest(e){const t=this._final()||be.alloc(0);return e?t.toString(e):t}}let ao;function co(e){const t=new Uint8Array(e);return e>0&&(ao.crypto||ao.msCrypto).getRandomValues(t),be.from(t.buffer)}"undefined"!=typeof window?ao=window:void 0!==n.g&&(ao=n.g);const lo=fetch,uo=WebSocket,po=ao.RTCPeerConnection;class ho{constructor(e){this.authenticated=!1,this.mutuallyAuthenticated=!1,this.name=e}getCacheableCredentials(){return null}processChallenge(e){}processSuccess(e){this.authenticated=!0}finalize(){const e={authenticated:this.authenticated,mutuallyAuthenticated:this.mutuallyAuthenticated};return this.errorData&&(e.errorData=this.errorData),e}}class fo{constructor(){this.mechanisms=[]}register(e,t,n){this.mechanisms.push({constructor:t,name:e.toUpperCase(),priority:n}),this.mechanisms.sort(((e,t)=>t.priority-e.priority))}disable(e){const t=e.toUpperCase();this.mechanisms=this.mechanisms.filter((e=>e.name!==t))}createMechanism(e){const t=e.map((e=>e.toUpperCase()));for(const e of this.mechanisms)for(const n of t)if(n===e.name)return new e.constructor(e.name);return null}}function mo(e=32){return co(e).toString("hex")}function go(e,t){const n=[];for(let i=0;i<e.length;i++)n.push(e[i]^t[i]);return be.from(n)}function yo(e,t){return ro(t).update(e).digest()}function vo(e,t,n){return function(e,t){return new oo(e.toLowerCase(),t)}(n,e).update(t).digest()}function bo(e,t,n,i){let r=vo(e,be.concat([t,be.from("00000001","hex")]),i),s=r;for(let t=0;t<n-1;t++)r=vo(e,r,i),s=go(s,r);return s}function _o(e){const t={},n=e.toString().split(/,(?=(?:[^"]|"[^"]*")*$)/);for(let e=0,i=n.length;e<i;e++){const i=/(\w+)=["]?([^"]+)["]?$/.exec(n[e]);i&&(t[i[1]]=i[2])}return t}function wo(e){const t=[];for(const n of e)","===n?t.push("=2C"):"="===n?t.push("=3D"):t.push(n);return t.join("")}class So extends ho{getExpectedCredentials(){return{optional:["trace"],required:[]}}createResponse(e){return be.from(e.trace||"")}}class xo extends ho{getExpectedCredentials(){return{optional:["authzid"],required:[]}}createResponse(e){return be.from(e.authzid||"")}}class To extends ho{getExpectedCredentials(){return{optional:["authzid"],required:["username","password"]}}createResponse(e){return be.from((e.authzid||"")+"\0"+e.username+"\0"+(e.password||e.token))}}class Eo extends ho{constructor(e){super(e),this.failed=!1,this.name=e}getExpectedCredentials(){return{optional:["authzid"],required:["token"]}}createResponse(e){if(this.failed)return be.from("");const t=`n,${wo(Ve(e.authzid))},`,n=`auth=Bearer ${e.token}`;return be.from(t+""+n+"","utf8")}processChallenge(e){this.failed=!0,this.errorData=JSON.parse(e.toString("utf8"))}}class Io extends ho{constructor(e){super(e),this.providesMutualAuthentication=!1,this.state="INITIAL",this.name=e}processChallenge(e){this.state="CHALLENGE";const t=_o(e);this.authenticated=!!t.rspauth,this.realm=t.realm,this.nonce=t.nonce,this.charset=t.charset}getExpectedCredentials(){return{optional:["authzid","clientNonce","realm"],required:["host","password","serviceName","serviceType","username"]}}createResponse(e){if("INITIAL"===this.state||this.authenticated)return null;let t=e.serviceType+"/"+e.host;e.serviceName&&e.host!==e.serviceName&&(t+="/"+e.serviceName);const n=e.realm||this.realm||"",i=e.clientNonce||mo(16),r="00000001",s="auth";let o="";o+='username="'+e.username+'"',n&&(o+=',realm="'+n+'"'),o+=',nonce="'+this.nonce+'"',o+=',cnonce="'+i+'"',o+=",nc="+r,o+=",qop=auth",o+=',digest-uri="'+t+'"';const a=ro("md5").update(e.username).update(":").update(n).update(":").update(e.password).digest(),c=ro("md5").update(a).update(":").update(this.nonce).update(":").update(i);e.authzid&&c.update(":").update(e.authzid);const l=c.digest("hex"),u=ro("md5").update("AUTHENTICATE:").update(t).digest("hex");return o+=",response="+ro("md5").update(l).update(":").update(this.nonce).update(":").update(r).update(":").update(i).update(":").update(s).update(":").update(u).digest("hex"),"utf-8"===this.charset&&(o+=",charset=utf-8"),e.authzid&&(o+=',authzid="'+e.authzid+'"'),be.from(o)}}class No{constructor(e){this.providesMutualAuthentication=!0,this.name=e,this.state="INITIAL",this.useChannelBinding=this.name.toLowerCase().endsWith("-plus"),this.algorithm=this.name.toLowerCase().split("scram-")[1].split("-plus")[0]}getExpectedCredentials(){const e=["username","password"];return this.useChannelBinding&&e.push("tlsUnique"),{optional:["authzid","clientNonce"],required:e}}getCacheableCredentials(){return this.cache}createResponse(e){return"INITIAL"===this.state?this.initialResponse(e):this.challengeResponse(e)}processChallenge(e){const t=_o(e);this.salt=be.from(t.s||"","base64"),this.iterationCount=parseInt(t.i,10),this.nonce=t.r,this.verifier=t.v,this.error=t.e,this.challenge=e}processSuccess(e){this.processChallenge(e)}finalize(){return this.verifier?this.serverSignature.toString("base64")!==this.verifier?{authenticated:!1,error:"Mutual authentication failed",mutuallyAuthenticated:!1}:{authenticated:!0,mutuallyAuthenticated:!0}:{authenticated:!1,error:this.error,mutuallyAuthenticated:!1}}initialResponse(e){const t=wo(Ve(e.authzid)),n=wo(Ve(e.username));this.clientNonce=e.clientNonce||mo();let i="n";e.tlsUnique&&(i=this.useChannelBinding?"p=tls-unique":"y"),this.gs2Header=be.from(t?`${i},a=${t},`:`${i},,`),this.clientFirstMessageBare=be.from(`n=${n},r=${this.clientNonce}`);const r=be.concat([this.gs2Header,this.clientFirstMessageBare]);return this.state="CHALLENGE",r}challengeResponse(e){const t=be.from("Client Key"),n=be.from("Server Key"),i=be.concat([this.gs2Header,e.tlsUnique||be.from("")]).toString("base64"),r=be.from(`c=${i},r=${this.nonce}`);let s,o,a;const c=e.salt&&0===be.compare(e.salt,this.salt);c&&e.clientKey&&e.serverKey?(o=be.from(e.clientKey),a=be.from(e.serverKey)):c&&e.saltedPassword?(s=be.from(e.saltedPassword),o=vo(s,t,this.algorithm),a=vo(s,n,this.algorithm)):(s=bo(be.from(Ve(e.password)),this.salt,this.iterationCount,this.algorithm),o=vo(s,t,this.algorithm),a=vo(s,n,this.algorithm));const l=yo(o,this.algorithm),u=be.from(","),p=be.concat([this.clientFirstMessageBare,u,this.challenge,u,r]),d=go(o,vo(l,p,this.algorithm)).toString("base64");this.serverSignature=vo(a,p,this.algorithm);const h=be.concat([r,be.from(`,p=${d}`)]);return this.state="FINAL",this.cache={clientKey:o,salt:this.salt,saltedPassword:s,serverKey:a},h}}function ko(e){e.getAccountInfo=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({account:{},to:t,type:"get"})).account})),e.updateAccount=(t,n)=>e.sendIQ({account:n,to:t,type:"set"}),e.deleteAccount=t=>e.sendIQ({account:{remove:!0},to:t,type:"set"}),e.getPrivateData=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({privateStorage:{[t]:{}},type:"get"})).privateStorage[t]})),e.setPrivateData=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return e.sendIQ({privateStorage:{[t]:n},type:"set"})})),e.getVCard=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({to:t,type:"get",vcard:{format:xi}})).vcard})),e.publishVCard=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",vcard:t})})),e.enableNotifications=(t,n,i=[])=>e.sendIQ({push:{action:"enable",form:{fields:[{name:"FORM_TYPE",type:"hidden",value:"http://jabber.org/protocol/pubsub#publish-options"},...i],type:"submit"},jid:t,node:n},type:"set"}),e.disableNotifications=(t,n)=>e.sendIQ({push:{action:"disable",jid:t,node:n},type:"set"})}function Ao(e){e.disco.addFeature(rr(qi)),e.on("pubsub:published",(t=>{if(t.pubsub.items.node!==qi)return;const n=t.pubsub.items.published[0].content;e.emit("avatar",{avatars:n.versions||[],jid:t.from,source:"pubsub"})})),e.on("presence",(t=>{t.vcardAvatar&&"string"==typeof t.vcardAvatar&&e.emit("avatar",{avatars:[{id:t.vcardAvatar}],jid:t.from,source:"vcard"})})),e.publishAvatar=(t,n)=>e.publish("",Di,{data:n,itemType:Di},t),e.useAvatars=(t,n=[])=>e.publish("",qi,{itemType:qi,pointers:n,versions:t},"current"),e.getAvatar=(t,n)=>e.getItem(t,Di,n)}function Oo(e){e.registerFeature("bind",300,((t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{const i=yield e.sendIQ({bind:{resource:e.config.resource},type:"set"});e.features.negotiated.bind=!0,e.emit("session:prebind",i.bind.jid);const r=!t.legacySession||t.legacySession&&t.legacySession.optional;return!e.sessionStarted&&r&&e.emit("session:started",e.jid),n()}catch(e){return console.error(e),n("disconnect","JID binding failed")}})))),e.registerFeature("legacySession",1e3,((t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if(e.sessionStarted||t.legacySession&&t.legacySession.optional)return e.features.negotiated.session=!0,n();try{return yield e.sendIQ({legacySession:!0,type:"set"}),e.features.negotiated.session=!0,e.sessionStarted||(e.sessionStarted=!0,e.emit("session:started",e.jid)),n()}catch(e){return n("disconnect","Session requeset failed")}})))),e.on("session:started",(()=>{e.sessionStarted=!0})),e.on("session:prebind",(t=>{e.jid=t,e.emit("session:bound",e.jid)})),e.on("--reset-stream-features",(()=>{e.sessionStarted=!1,e.features.negotiated.bind=!1,e.features.negotiated.session=!1}))}function jo(e){e.disco.addFeature(Si),e.disco.addItem({name:"Ad-Hoc Commands",node:Si}),e.getCommands=t=>e.getDiscoItems(t,Si)}const Co=[];for(let e=0;e<256;++e)Co[e]=(e+256).toString(16).substr(1);function Ro(e,t,n=(()=>{})){return(0,i.__awaiter)(this,void 0,void 0,(function*(){let i;const r=yield Promise.race([e,new Promise(((e,r)=>{i=setTimeout((()=>r(n())),t)}))]);return clearTimeout(i),r}))}function Po(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){return new Promise((t=>{setTimeout((()=>t()),e)}))}))}function Lo(e,t){const n="string"==typeof e?be.from(e,"utf8"):e,i="string"==typeof t?be.from(t,"utf8"):t;return n.compare(i)}function Mo(){const e=co(16);e[6]=15&e[6]|64,e[8]=63&e[8]|128;let t=0;return[Co[e[t++]],Co[e[t++]],Co[e[t++]],Co[e[t++]],"-",Co[e[t++]],Co[e[t++]],"-",Co[e[t++]],Co[e[t++]],"-",Co[e[t++]],Co[e[t++]],"-",Co[e[t++]],Co[e[t++]],Co[e[t++]],Co[e[t++]],Co[e[t++]],Co[e[15]]].join("")}new Set(["date","expires","httpUploadRetry","idleSince","published","since","stamp","timestamp","updated","utc"]);function Fo(e,t){e.features.negotiated.clientStateIndication&&e.send("csi",{type:t})}function Do(e){e.disco.addFeature(br),e.on("iq:get:ping",(t=>{e.sendIQResult(t)})),e.on("--reset-stream-features",(()=>{e._stopKeepAliveInterval(),e.features.negotiated.streamManagement=!1,e.features.negotiated.clientStateIndication=!1})),e.markActive=()=>Fo(e,"active"),e.markInactive=()=>Fo(e,"inactive"),e.ping=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){yield e.sendIQ({ping:!0,to:t,type:"get"})})),e.enableKeepAlive=(t={})=>{e._keepAliveOptions=t;const n=t.interval||300,r=t.timeout||e.config.timeout||15;clearInterval(e._keepAliveInterval),e._keepAliveInterval=setInterval((function(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(e.sessionStarted)try{yield Ro(function(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(e.sm.started)return new Promise((t=>{e.once("stream:management:ack",(()=>t())),e.sm.request()}));try{yield e.ping()}catch(e){if(e.error&&"timeout"!==e.error.condition)return;throw e}}))}(e),1e3*r)}catch(t){e.emit("stream:error",{condition:"connection-timeout",text:"Server did not respond in "+r+" seconds"}),e.transport&&(e.transport.hasStream=!1,e.transport.disconnect(!1))}}))}),1e3*n)},e._stopKeepAliveInterval=()=>{e._keepAliveInterval&&(clearInterval(e._keepAliveInterval),delete e._keepAliveInterval)},e.disableKeepAlive=()=>{delete e._keepAliveOptions,e._stopKeepAliveInterval()},e.on("stream:management:resumed",(()=>{e._keepAliveOptions&&e.enableKeepAlive(e._keepAliveOptions)})),e.on("stream:start",(()=>{e._keepAliveOptions&&e.enableKeepAlive(e._keepAliveOptions)}));const t=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if(!e.config.useStreamManagement)return n();const t=r=>(0,i.__awaiter)(this,void 0,void 0,(function*(){switch(r.type){case"enabled":return yield e.sm.enabled(r),e.features.negotiated.streamManagement=!0,e.off("sm",t),n();case"resumed":return yield e.sm.resumed(r),e.features.negotiated.streamManagement=!0,e.features.negotiated.bind=!0,e.sessionStarted=!0,e.sessionStarting=!1,e.off("sm",t),e.emit("stream:management:resumed",r),n("break");case"failed":yield e.sm.failed(r),e.off("sm",t),e.emit("session:end"),n()}}));e.on("sm",t),e.sm.id?e.sm.id&&e.sm.allowResume?yield e.sm.resume():(e.off("sm",t),n()):e.features.negotiated.bind?yield e.sm.enable():(e.off("sm",t),n())}));e.registerFeature("streamManagement",200,t),e.registerFeature("streamManagement",500,t),e.registerFeature("clientStateIndication",400,((t,n)=>{e.features.negotiated.clientStateIndication=!0,n()}))}function qo(e){return be.from(e.replace(/</g,"&lt;"),"utf-8")}function Uo(e=[]){const t=[];for(const n of e)"FORM_TYPE"!==n.name&&(n.rawValues?t.push({name:qo(n.name),values:n.rawValues.map((e=>qo(e))).sort(Lo)}):Array.isArray(n.value)?t.push({name:qo(n.name),values:n.value.map((e=>qo(e))).sort(Lo)}):!0===n.value||!1===n.value?t.push({name:qo(n.name),values:[qo(n.value?"1":"0")]}):t.push({name:qo(n.name),values:[qo(n.value||"")]}));t.sort(((e,t)=>Lo(e.name,t.name)));const n=[];for(const e of t){n.push(e.name);for(const t of e.values)n.push(t)}return n}function Bo(e,t){const n=[],i=be.from("<","utf8"),r=e=>{n.push(e),n.push(i)},s=function(e=[]){const t=[],n=new Set;for(const{category:i,type:r,lang:s,name:o}of e){const e=`${i}/${r}/${s||""}/${o||""}`;if(n.has(e))return null;n.add(e),t.push(qo(e))}return t.sort(Lo),t}(e.identities),o=function(e=[]){const t=[],n=new Set;for(const i of e){if(n.has(i))return null;n.add(i),t.push(qo(i))}return t.sort(Lo),t}(e.features),a=function(e=[]){const t=[],n=new Set;for(const i of e){let e;for(const t of i.fields||[])if("FORM_TYPE"===t.name&&"hidden"===t.type){if(t.rawValues&&1===t.rawValues.length){e=qo(t.rawValues[0]);break}if(t.value&&"string"==typeof t.value){e=qo(t.value);break}}if(e){if(n.has(e.toString()))return null;n.add(e.toString()),t.push({type:e,form:i})}}t.sort(((e,t)=>Lo(e.type,t.type)));const i=[];for(const e of t){i.push(e.type);const t=Uo(e.form.fields);for(const e of t)i.push(e)}return i}(e.extensions);if(!s||!o||!a)return null;for(const e of s)r(e);for(const e of o)r(e);for(const e of a)r(e);return ro(t).update(be.concat(n)).digest("base64")}class Go{constructor(){this.capsAlgorithms=["sha-1"],this.features=new Map,this.identities=new Map,this.extensions=new Map,this.items=new Map,this.caps=new Map,this.features.set("",new Set),this.identities.set("",[]),this.extensions.set("",[])}getNodeInfo(e){return{extensions:[...this.extensions.get(e)||[]],features:[...this.features.get(e)||[]],identities:[...this.identities.get(e)||[]]}}addFeature(e,t=""){this.features.has(t)||this.features.set(t,new Set),this.features.get(t).add(e)}addIdentity(e,t=""){this.identities.has(t)||this.identities.set(t,[]),this.identities.get(t).push(e)}addItem(e,t=""){this.items.has(t)||this.items.set(t,[]),this.items.get(t).push(e)}addExtension(e,t=""){this.extensions.has(t)||this.extensions.set(t,[]),this.extensions.get(t).push(e)}updateCaps(e,t=this.capsAlgorithms){const n={extensions:[...this.extensions.get("")],features:[...this.features.get("")],identities:[...this.identities.get("")],type:"info"};for(const i of t){const t=Bo(n,i);if(!t){this.caps.delete(i);continue}this.caps.set(i,{algorithm:i,node:e,value:t});const r=`${e}#${t}`;for(const e of n.features)this.addFeature(e,r);for(const e of n.identities)this.addIdentity(e,r);for(const e of n.extensions)this.addExtension(e,r);this.identities.set(r,n.identities),this.features.set(r,new Set(n.features)),this.extensions.set(r,n.extensions)}return[...this.caps.values()]}getCaps(){return[...this.caps.values()]}}function Jo(e){e.disco=new Go,e.disco.addFeature(di),e.disco.addFeature(hi),e.disco.addIdentity({category:"client",type:"web"}),e.registerFeature("caps",100,((t,n)=>{const i=it(e.jid)||e.config.server;e.emit("disco:caps",{caps:t.legacyCapabilities||[],jid:i}),e.features.negotiated.caps=!0,n()})),e.getDiscoInfo=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=yield e.sendIQ({disco:{node:n,type:"info"},to:t,type:"get"});return Object.assign({extensions:[],features:[],identities:[]},i.disco)})),e.getDiscoItems=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=yield e.sendIQ({disco:{node:n,type:"items"},to:t,type:"get"});return Object.assign({items:[]},i.disco)})),e.updateCaps=()=>{const t=e.config.capsNode||"https://stanzajs.org";return e.disco.updateCaps(t)},e.getCurrentCaps=()=>{const t=e.disco.getCaps();if(!t)return;const n=`${t[0].node}#${t[0].value}`;return{info:e.disco.getNodeInfo(n),legacyCapabilities:t}},e.on("presence",(t=>{t.legacyCapabilities&&e.emit("disco:caps",{caps:t.legacyCapabilities,jid:t.from})})),e.on("iq:get:disco",(t=>{const{type:n,node:i}=t.disco;"info"===n&&e.sendIQResult(t,{disco:Object.assign(Object.assign({},e.disco.getNodeInfo(i||"")),{node:i,type:"info"})}),"items"===n&&e.sendIQResult(t,{disco:{items:e.disco.items.get(i||"")||[],type:"items"}})}))}const zo="12.17.2",Xo="not-authorized",$o={Bosh:Hi,Client:Kn,Component:zi,Server:Zn},Vo={AccountDisabled:"account-disabled",CredentialsExpired:"credentials-expired",EncryptionRequired:"encryption-required",IncorrectEncoding:"incorrect-encoding",InvalidAuthzid:"invalid-authzid",InvalidMechanism:"invalid-mechanism",MalformedRequest:"malformed-request",MechanismTooWeak:"mechanism-too-weak",NotAuthorized:Xo,TemporaryAuthFailure:"temporary-auth-failure"},Ho={BadFormat:"bad-format",BadNamespacePrefix:"bad-namespace-prefix",Conflict:"conflict",ConnectionTimeout:"connection-timeout",HostGone:"host-gone",HostUnknown:"host-unknown",ImproperAddressing:"improper-addressing",InternalServerError:"internal-server-error",InvalidFrom:"invalid-from",InvalidId:"invalid-id",InvalidNamespace:"invalid-namespace",InvalidXML:"invalid-xml",NotAuthorized:Xo,NotWellFormed:"not-well-formed",PolicyViolation:"policy-violation",RemoteConnectionFailed:"remote-connection-failed",Reset:"reset",ResourceConstraint:"resource-constraint",RestrictedXML:"restricted-xml",SeeOtherHost:"see-other-host",SystemShutdown:"system-shutdown",UndefinedCondition:"undefined-condition",UnsupportedEncoding:"unsupported-encoding",UnsupportedStanzaType:"unsupported-stanza-type",UnsupportedVersion:"unsupported-version"},Wo={BadRequest:"bad-request",Conflict:"conflict",FeatureNotImplemented:"feature-not-implemented",Forbidden:"forbidden",Gone:"gone",InternalServerError:"internal-server-error",ItemNotFound:"item-not-found",JIDMalformed:"jid-malformed",NotAcceptable:"not-acceptable",NotAllowed:"not-allowed",NotAuthorized:Xo,PolicyViolation:"policy-violation",RecipientUnavailable:"recipient-unavailable",Redirect:"redirect",RegistrationRequired:"registration-required",RemoteServerNotFound:"remote-server-not-found",RemoteServerTimeout:"remote-server-timeout",ResourceConstraint:"resource-constraint",ServiceUnavailable:"service-unavailable",SubscriptionRequired:"subscription-required",UndefinedCondition:"undefined-condition",UnexpectedRequest:"unexpected-request"},Qo={Boolean:"boolean",Fixed:"fixed",Hidden:"hidden",JID:"jid-single",JIDMultiple:"jid-multi",List:"list-single",ListMultiple:"list-multi",Password:"text-private",Text:"text-single",TextMultiple:"text-multi",TextPrivate:"text-private"},Ko={AffiliationChanged:"101",AffiliationLost:"321",Banned:"301",Error:"333",Kicked:"307",LoggingDisabled:"171",LoggingEnabled:"170",MembershipLost:"322",NickChanged:"303",NickChangedByService:"210",NonAnonymous:"172",NonAnonymousRoom:"100",NonPrivacyConfigurationChange:"104",RoomCreated:"201",SelfPresence:"110",SemiAnonymous:"173",Shutdown:"332",UnavailableMembersListed:"102",UnavailableMembersNotListed:"103"},Yo={ClosedNode:"closed-node",ConfigurationRequired:"configuration-required",InvalidJID:"invalid-jid",InvalidOptions:"invalid-options",InvalidPayload:"invalid-payload",InvalidSubscriptionId:"invalid-subid",ItemForbidden:"item-forbidden",ItemRequired:"item-required",JIDRequired:"jid-required",MaxItemsExceeded:"max-items-exceeded",MaxNodesExceeded:"max-nodes-exceeded",NodeIdRequired:"nodeid-required",NotInRosterGroup:"not-in-roster-group",NotSubscribed:"not-subscribed",PayloadRequired:"payload-required",PayloadTooBig:"payload-too-big",PendingSubscription:"pending-subscription",PresenceSubscriptionRequired:"presence-subscription-required",SubscriptionIdRequired:"subid-required",TooManySubscriptions:"too-many-subscriptions",Unsupported:"unsupported",UnsupportedAccessModel:"unsupported-access-model"},Zo={Active:"active",Composing:"composing",Gone:"gone",Inactive:"inactive",Paused:"paused"},ea={Initiator:"initiator",Responder:"responder"},ta={Inactive:"inactive",Receive:"recvonly",Send:"sendonly",SendReceive:"sendrecv"},na={Both:"both",Initiator:"initiator",None:"none",Responder:"responder"},ia={ContentAccept:"content-accept",ContentAdd:"content-add",ContentModify:"content-modify",ContentReject:"content-reject",ContentRemove:"content-remove",DescriptionInfo:"description-info",SecurityInfo:"security-info",SessionAccept:"session-accept",SessionInfo:"session-info",SessionInitiate:"session-initiate",SessionTerminate:"session-terminate",TransportAccept:"transport-accept",TransportInfo:"transport-info",TransportReject:"transport-reject",TransportReplace:"transport-replace"},ra={OutOfOrder:"out-of-order",TieBreak:"tie-break",UnknownContent:"unknown-content",UnknownSession:"unknown-session",UnsupportedInfo:"unsupported-info"},sa={AlternativeSession:"alternative-session",Busy:"busy",Cancel:"cancel",ConnectivityError:"connectivity-error",Decline:"decline",Expired:"expired",FailedApplication:"failed-application",FailedTransport:"failed-transport",GeneralError:"general-error",Gone:"gone",IncompatibleParameters:"incompatible-parameters",MediaError:"media-error",SecurityError:"security-error",Success:"success",Timeout:"timeout",UnsupportedApplications:"unsupported-applications",UnsupportedTransports:"unsupported-transports"},oa=["afraid","amazed","amorous","angry","annoyed","anxious","aroused","ashamed","bored","brave","calm","cautious","cold","confident","confused","contemplative","contented","cranky","crazy","creative","curious","dejected","depressed","disappointed","disgusted","dismayed","distracted","embarrassed","envious","excited","flirtatious","frustrated","grateful","grieving","grumpy","guilty","happy","hopeful","hot","humbled","humiliated","hungry","hurt","impressed","in_awe","in_love","indignant","interested","intoxicated","invincible","jealous","lonely","lost","lucky","mean","moody","nervous","neutral","offended","outraged","playful","proud","relaxed","relieved","remorseful","restless","sad","sarcastic","satisfied","serious","shocked","shy","sick","sleepy","spontaneous","stressed","strong","surprised","thankful","thirsty","tired","undefined","weak","worried"],aa=["doing_chores","drinking","eating","exercising","grooming","having_appointment","inactive","relaxing","talking","traveling","undefined","working"],ca=["at_the_spa","brushing_teeth","buying_groceries","cleaning","coding","commuting","cooking","cycling","cycling","dancing","day_off","doing_maintenance","doing_the_dishes","doing_the_laundry","driving","fishing","gaming","gardening","getting_a_haircut","going_out","hanging_out","having_a_beer","having_a_snack","having_breakfast","having_coffee","having_dinner","having_lunch","having_tea","hiding","hiking","in_a_car","in_a_meeting","in_real_life","jogging","on_a_bus","on_a_plane","on_a_train","on_a_trip","on_the_phone","on_vacation","on_video_phone","other","partying","playing_sports","praying","reading","rehearsing","running","running_an_errand","scheduled_holiday","shaving","shopping","skiing","sleeping","smoking","socializing","studying","sunbathing","swimming","taking_a_bath","taking_a_shower","thinking","walking","walking_the_dog","watching_a_movie","watching_tv","working_out","writing"],la=(e,t)=>`{${e}}${t}`,ua=la(cr,"mute"),pa=la(cr,"unmute"),da=la(cr,"hold"),ha=la(cr,"unhold"),fa=la(cr,"active"),ma=la(cr,"ringing"),ga=la(Ar,"checksum");la(Ar,"received");function ya(e,t=na.Both){const n=e===ea.Initiator;switch(t){case na.Initiator:return n?ta.Send:ta.Receive;case na.Responder:return n?ta.Receive:ta.Send;case na.Both:return ta.SendReceive}return ta.Inactive}function va(e,t=ta.SendReceive){const n=e===ea.Initiator;switch(t){case ta.Send:return n?na.Initiator:na.Responder;case ta.Receive:return n?na.Responder:na.Initiator;case ta.SendReceive:return na.Both}return na.None}function ba(e){e.disco.addFeature("jid\\20escaping"),e.disco.addFeature(wr),e.disco.addFeature(ls),e.disco.addFeature(Dr),e.disco.addFeature(Ur),e.disco.addFeature(qr),e.disco.addFeature(Wr),e.disco.addFeature(Zr),e.disco.addFeature(ji),e.disco.addFeature(Xr),e.disco.addFeature(cs),e.disco.addFeature(Wi),e.disco.addFeature(li),e.disco.addFeature(Er),e.disco.addFeature(Vi),e.disco.addFeature(Yi);const t=["sha-1","sha-256","sha-512","md5"];for(const n of t)e.disco.addFeature(Br(n));e.disco.addFeature(_r),e.disco.addFeature(Bi),e.on("iq:get:softwareVersion",(t=>e.sendIQResult(t,{softwareVersion:e.config.softwareVersion||{name:"stanzajs.org",version:zo}}))),e.on("iq:get:time",(t=>{const n=new Date;e.sendIQResult(t,{time:{tzo:n.getTimezoneOffset(),utc:n}})})),e.getSoftwareVersion=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({softwareVersion:{},to:t,type:"get"})).softwareVersion})),e.getTime=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({time:{},to:t,type:"get"})).time})),e.getLastActivity=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({lastActivity:{},to:t,type:"get"})).lastActivity}))}function _a(e){e.features={handlers:Object.create(null),negotiated:Object.create(null),order:[]},e.registerFeature=function(t,n,i){this.features.order.push({name:t,priority:n}),this.features.order.sort(((e,t)=>e.priority-t.priority)),this.features.handlers[t]=i.bind(e)},e.on("features",(t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const n=e.features.negotiated,i=e.features.handlers,r=[];for(const{name:s}of e.features.order)t[s]&&i[s]&&!n[s]&&r.push(s);function s(e){return new Promise((n=>{i[e](t,((e,t)=>{n(e?{command:e,message:t}:null)}))}))}for(const t of r){if(n[t])continue;let i="",r="";try{const e=yield s(t);e&&(i=e.command,r=e.message||"")}catch(e){i="disconnect",r=e.message,console.error(e)}if(i)return"restart"===i&&e.transport&&e.transport.restart(),void("disconnect"===i&&(e.emit("stream:error",{condition:"policy-violation",text:"Failed to negotiate stream features: "+r}),e.disconnect()))}}))))}function wa(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){"string"==typeof t&&(t={host:t});const n=Object.assign({json:!0,ssl:!0,xrd:!0},t),r=n.ssl?"https://":"http://";return function(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){try{const t=yield Promise.all(e.map((e=>e.then((e=>Promise.reject(e)),(e=>Promise.resolve(e))))));return Promise.reject(t)}catch(e){return Promise.resolve(e)}}))}([lo(`${r}${n.host}/.well-known/host-meta.json`).then((e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if(!e.ok)throw new Error("could-not-fetch-json");return e.json()})))),lo(`${r}${n.host}/.well-known/host-meta`).then((t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if(!t.ok)throw new Error("could-not-fetch-xml");const n=Lt(yield t.text());if(n)return e.import(n)}))))])}))}function Sa(e,t){e.discoverBindings=e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{const n=yield wa(t,e),i={bosh:[],websocket:[]},r=n.links||[];for(const e of r)e.href&&e.rel===tr&&i.websocket.push(e.href),e.href&&e.rel===nr&&i.bosh.push(e.href);return i}catch(e){return{}}}))}function xa(e){const t=ve.getMediaSections(e),n=ve.getDescription(e),i={groups:[],media:[]};ve.matchPrefix(n,"a=ice-lite").length>0&&(i.iceLite=!0);for(const e of ve.matchPrefix(n,"a=group:")){const t=e.split(" "),n=t.shift().substr(8);i.groups.push({mids:t,semantics:n})}for(const e of t){const t=ve.getKind(e),r=ve.isRejected(e),s=ve.parseMLine(e),o={direction:ve.getDirection(e,n),kind:t,mid:ve.getMid(e),protocol:s.protocol};if(r||(o.iceParameters=ve.getIceParameters(e,n),o.dtlsParameters=ve.getDtlsParameters(e,n),o.setup=ve.matchPrefix(e,"a=setup:")[0].substr(8),i.iceLite&&(o.iceParameters.iceLite=!0)),"audio"===t||"video"===t){o.rtpParameters=ve.parseRtpParameters(e),o.rtpEncodingParameters=ve.parseRtpEncodingParameters(e),o.rtcpParameters=ve.parseRtcpParameters(e);const t=ve.parseMsid(e);o.streams=t?[t]:[]}else"application"===t&&(o.sctp=ve.parseSctpDescription(e));o.candidates=ve.matchPrefix(e,"a=candidate:").map(ve.parseCandidate),i.media.push(o)}return i}function Ta(e){const t=[];t.push(ve.writeSessionBoilerplate(e.sessionId,e.sessionVersion),"a=msid-semantic:WMS *\r\n"),(e.iceLite||e.media.filter((e=>e.iceParameters&&e.iceParameters.iceLite)).length>0)&&t.push("a=ice-lite\r\n");for(const n of e.groups||[])t.push(`a=group:${n.semantics} ${n.mids.join(" ")}\r\n`);for(const n of e.media||[]){const e=!(n.iceParameters&&n.dtlsParameters);if("application"===n.kind&&n.sctp)t.push(ve.writeSctpDescription(n,n.sctp));else if(n.rtpParameters){let i=ve.writeRtpDescription(n.kind,n.rtpParameters);e&&(i=i.replace(`m=${n.kind} 9 `,`m=${n.kind} 0 `)),t.push(i),t.push(`a=${n.direction||"sendrecv"}\r\n`);for(const e of n.streams||[])t.push(`a=msid:${e.stream} ${e.track}\r\n`);if(n.rtcpParameters&&(t.push(ve.writeRtcpParameters(n.rtcpParameters)),n.rtcpParameters.cname&&n.rtpEncodingParameters&&n.rtpEncodingParameters[0].rtx)){const e=n.rtpEncodingParameters[0];t.push(`a=ssrc-group:FID ${e.ssrc} ${e.rtx.ssrc}\r\n`),t.push(`a=ssrc:${e.rtx.ssrc} cname:${n.rtcpParameters.cname}\r\n`)}}if(void 0!==n.mid&&t.push(`a=mid:${n.mid}\r\n`),n.iceParameters&&t.push(ve.writeIceParameters({usernameFragment:n.iceParameters.usernameFragment,password:n.iceParameters.password})),n.dtlsParameters&&n.setup&&t.push(ve.writeDtlsParameters(n.dtlsParameters,n.setup)),n.candidates&&n.candidates.length)for(const e of n.candidates)t.push(`a=${ve.writeCandidate(e)}\r\n`)}return t.join("")}function Ea(e,t){const n=e.rtpParameters,i=e.rtcpParameters||{},r=e.rtpEncodingParameters||[];let s=!1;r&&r.length&&(s=!!r[0].ssrc);const o={applicationType:ar,codecs:[],headerExtensions:[],media:e.kind,rtcpMux:i.mux,rtcpReducedSize:i.reducedSize,sourceGroups:[],sources:[],ssrc:s?r[0].ssrc.toString():void 0,streams:[]};for(const e of n.headerExtensions||[]){const n={id:e.id,uri:e.uri};e.direction&&"sendrecv"!==e.direction&&(n.senders=va(t,e.direction)),o.headerExtensions.push(n)}i.ssrc&&i.cname&&(o.sources=[{parameters:{cname:i.cname},ssrc:i.ssrc.toString()}]),s&&r[0]&&r[0].rtx&&(o.sourceGroups=[{semantics:"FID",sources:[r[0].ssrc.toString(),r[0].rtx.ssrc.toString()]}]);for(const t of e.streams||[])o.streams.push({id:t.stream,track:t.track});for(const e of n.codecs||[]){const t={channels:e.channels,clockRate:e.clockRate,id:e.payloadType.toString(),name:e.name,parameters:e.parameters,rtcpFeedback:e.rtcpFeedback};e.maxptime&&(t.maxptime=e.maxptime),e.parameters&&e.parameters.ptime&&(t.ptime=parseInt(e.parameters.ptime,10)),o.codecs.push(t)}return o}function Ia(e){let t;return t="rtp"===e.component?1:"rtcp"===e.component?2:e.component,{component:t,foundation:e.foundation,generation:void 0,id:void 0,ip:e.ip,network:void 0,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,tcpType:e.tcpType,type:e.type}}function Na(e){return{address:e.ip,component:1===e.component?"rtp":2===e.component?"rtcp":e.component,foundation:e.foundation,ip:e.ip,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,tcpType:e.tcpType,type:e.type}}function ka(e,t){const n=e.iceParameters,i=e.dtlsParameters,r={candidates:[],transportType:t};n&&(r.usernameFragment=n.usernameFragment,r.password=n.password,n.iceLite&&(r.iceLite=!0)),i&&(r.fingerprints=i.fingerprints.map((t=>({algorithm:t.algorithm,setup:e.setup,value:t.value})))),e.sctp&&(r.sctp=e.sctp);for(const t of e.candidates||[])r.candidates.push(Ia(t));return r}function Aa(e,t,n){return{contents:e.media.map((e=>({application:"audio"===e.kind||"video"===e.kind?Ea(e,t):{applicationType:"datachannel",protocol:e.protocol},creator:ea.Initiator,name:e.mid,senders:va(t,e.direction),transport:ka(e,n)}))),groups:e.groups?e.groups.map((e=>({contents:e.mids,semantics:e.semantics}))):[]}}function Oa(e,t){const n=e.application||{},i=e.transport,r=n&&n.applicationType===ar,s={direction:ya(t,e.senders),kind:n.media||"application",mid:e.name,protocol:r?"UDP/TLS/RTP/SAVPF":"UDP/DTLS/SCTP"};if(r){if(s.rtcpParameters={compound:!n.rtcpReducedSize,mux:n.rtcpMux,reducedSize:n.rtcpReducedSize},n.sources&&n.sources.length){const e=n.sources[0];s.rtcpParameters.ssrc=parseInt(e.ssrc,10),e.parameters&&(s.rtcpParameters.cname=e.parameters.cname)}if(s.rtpParameters={codecs:[],fecMechanisms:[],headerExtensions:[],rtcp:[]},n.streams){s.streams=[];for(const e of n.streams)s.streams.push({stream:e.id,track:e.track})}if(n.ssrc&&(s.rtpEncodingParameters=[{ssrc:parseInt(n.ssrc,10)}],n.sourceGroups&&n.sourceGroups.length)){const e=n.sourceGroups[0];s.rtpEncodingParameters[0].rtx={ssrc:parseInt(e.sources[1],10)}}let e=!1,i=!1;for(const t of n.codecs||[]){const n=t.parameters||{},r=[];for(const e of t.rtcpFeedback||[])r.push({parameter:e.parameter,type:e.type});if("red"===t.name||"ulpfec"===t.name){e=e||"red"===t.name,i=i||"ulpfec"===t.name;const n=t.name.toUpperCase();s.rtpParameters.fecMechanisms.includes(n)||s.rtpParameters.fecMechanisms.push(n)}s.rtpParameters.codecs.push({channels:t.channels,clockRate:t.clockRate,name:t.name,numChannels:t.channels,parameters:n,payloadType:parseInt(t.id,10),rtcpFeedback:r})}for(const e of n.headerExtensions||[])s.rtpParameters.headerExtensions.push({direction:ya(t,e.senders||"both"),id:e.id,uri:e.uri})}if(i){if(i.usernameFragment&&i.password&&(s.iceParameters={password:i.password,usernameFragment:i.usernameFragment},i.iceLite&&(s.iceParameters.iceLite=!0)),i.fingerprints&&i.fingerprints.length){s.dtlsParameters={fingerprints:[],role:"auto"};for(const e of i.fingerprints)s.dtlsParameters.fingerprints.push({algorithm:e.algorithm,value:e.value});i.sctp&&(s.sctp=i.sctp),s.setup=i.fingerprints[0].setup}s.candidates=(i.candidates||[]).map(Na)}return s}function ja(e,t){const n={groups:[],media:[]};for(const t of e.groups||[])n.groups.push({mids:t.contents,semantics:t.semantics});for(const i of e.contents||[])n.media.push(Oa(i,t));return n}const Ca={condition:Wo.BadRequest},Ra={condition:Wo.FeatureNotImplemented,jingleError:ra.UnsupportedInfo,type:"modify"};class Pa{constructor(e){this.parent=e.parent,this.sid=e.sid||Mo(),this.peerID=e.peerID,this.role=e.initiator?ea.Initiator:ea.Responder,this._sessionState="starting",this._connectionState="starting",this.pendingApplicationTypes=e.applicationTypes||[],this.pendingAction=void 0,this.processingQueue=Y(((e,t)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if("ended"===this.state)return"local"===e.type&&e.reject&&e.reject(new Error("Session ended")),void(t&&t());if("local"===e.type){this._log("debug","Processing local action:",e.name);try{const t=yield e.handler();e.resolve(t)}catch(t){e.reject(t)}return void(t&&t())}const{action:n,changes:i,cb:r}=e;return this._log("debug","Processing remote action:",n),new Promise((e=>{const s=(n,i)=>{r(n,i),t&&t(),e()};switch(n){case ia.ContentAccept:return this.onContentAccept(i,s);case ia.ContentAdd:return this.onContentAdd(i,s);case ia.ContentModify:return this.onContentModify(i,s);case ia.ContentReject:return this.onContentReject(i,s);case ia.ContentRemove:return this.onContentRemove(i,s);case ia.DescriptionInfo:return this.onDescriptionInfo(i,s);case ia.SecurityInfo:return this.onSecurityInfo(i,s);case ia.SessionAccept:return this.onSessionAccept(i,s);case ia.SessionInfo:return this.onSessionInfo(i,s);case ia.SessionInitiate:return this.onSessionInitiate(i,s);case ia.SessionTerminate:return this.onSessionTerminate(i,s);case ia.TransportAccept:return this.onTransportAccept(i,s);case ia.TransportInfo:return this.onTransportInfo(i,s);case ia.TransportReject:return this.onTransportReject(i,s);case ia.TransportReplace:return this.onTransportReplace(i,s);default:this._log("error","Invalid or unsupported action: "+n),s({condition:Wo.BadRequest})}}))}))),1)}get isInitiator(){return this.role===ea.Initiator}get peerRole(){return this.isInitiator?ea.Responder:ea.Initiator}get state(){return this._sessionState}set state(e){e!==this._sessionState&&(this._log("info","Changing session state to: "+e),this._sessionState=e,this.parent&&this.parent.emit("sessionState",this,e))}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._log("info","Changing connection state to: "+e),this._connectionState=e,this.parent&&this.parent.emit("connectionState",this,e))}send(e,t){(t=t||{}).sid=this.sid,t.action=e;new Set([ia.ContentAccept,ia.ContentAdd,ia.ContentModify,ia.ContentReject,ia.ContentRemove,ia.SessionAccept,ia.SessionInitiate,ia.TransportAccept,ia.TransportReject,ia.TransportReplace]).has(e)?this.pendingAction=e:this.pendingAction=void 0,this.parent.signal(this,{id:Mo(),jingle:t,to:this.peerID,type:"set"})}processLocal(e,t){return new Promise(((n,i)=>{this.processingQueue.push({handler:t,name:e,reject:i,resolve:n,type:"local"},1)}))}process(e,t,n){this.processingQueue.push({action:e,cb:n,changes:t,type:"remote"},2)}start(e,t){this._log("error","Can not start base sessions"),this.end("unsupported-applications",!0)}accept(e,t){this._log("error","Can not accept base sessions"),this.end("unsupported-applications")}cancel(){this.end("cancel")}decline(){this.end("decline")}end(e="success",t=!1){this.state="ended",this.processingQueue.kill(),"string"==typeof e&&(e={condition:e}),t||this.send("session-terminate",{reason:e}),this.parent.emit("terminated",this,e),this.parent.forgetSession(this)}_log(e,t,...n){this.parent&&(t=this.sid+": "+t,this.parent.emit("log",e,t,...n),this.parent.emit("log:"+e,t,...n))}onSessionInitiate(e,t){t()}onSessionAccept(e,t){t()}onSessionTerminate(e,t){this.end(e.reason,!0),t()}onSessionInfo(e,t){e.info?t(Ra):t()}onSecurityInfo(e,t){t(Ra)}onDescriptionInfo(e,t){t(Ra)}onTransportInfo(e,t){t(Ra)}onContentAdd(e,t){t(),this.send(ia.ContentReject,{reason:{condition:sa.FailedApplication,text:"content-add is not supported"}})}onContentAccept(e,t){t(Ca)}onContentReject(e,t){t(Ca)}onContentModify(e,t){t(Ca)}onContentRemove(e,t){t(Ca)}onTransportReplace(e,t){t(),this.send(ia.TransportReject,{reason:{condition:sa.FailedTransport,text:"transport-replace is not supported"}})}onTransportAccept(e,t){t(Ca)}onTransportReject(e,t){t(Ca)}}class La extends Pa{constructor(e){super(e),this.bitrateLimit=0,this.candidateBuffer=[],this.transportType=dr,this.restartingIce=!1,this.usingRelay=!1,this.maxRelayBandwidth=e.maxRelayBandwidth,this.pc=this.parent.createPeerConnection(this,Object.assign(Object.assign({},e.config),{iceServers:e.iceServers})),this.pc.oniceconnectionstatechange=()=>{this.onIceStateChange()},this.pc.onicecandidate=e=>{e.candidate?this.onIceCandidate(e):this.onIceEndOfCandidates()},this.restrictRelayBandwidth()}end(e="success",t=!1){this.pc.close(),super.end(e,t)}restartIce(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(this.isInitiator){void 0!==this._maybeRestartingIce&&clearTimeout(this._maybeRestartingIce),this.restartingIce=!0;try{yield this.processLocal("restart-ice",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.pc.createOffer({iceRestart:!0}),t=xa(e.sdp);this.send(ia.TransportInfo,{contents:t.media.map((e=>({creator:ea.Initiator,name:e.mid,transport:ka(e,this.transportType)}))),sid:this.sid}),yield this.pc.setLocalDescription(e)}))))}catch(e){this._log("error","Could not create WebRTC offer",e),this.end(sa.FailedTransport,!0)}}}))}setMaximumBitrate(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.maximumBitrate&&(e=Math.min(e,this.maximumBitrate)),this.currentBitrate=e;const t=this.pc.getSenders().find((e=>!!e.track&&"video"===e.track.kind));if(t&&t.getParameters)try{yield this.processLocal("set-bitrate",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const n=t.getParameters();n.encodings&&n.encodings.length||(n.encodings=[{}]),0===e?delete n.encodings[0].maxBitrate:n.encodings[0].maxBitrate=e,yield t.setParameters(n)}))))}catch(e){this._log("error","Set maximumBitrate failed",e)}}))}onTransportInfo(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(e.contents&&e.contents[0]&&e.contents[0].transport.gatheringComplete){const n={sdpMid:e.contents[0].name,candidate:""};try{"stable"===this.pc.signalingState?yield this.pc.addIceCandidate(n):this.candidateBuffer.push(n)}catch(e){this._log("debug","Could not add null end-of-candidate")}finally{t()}return}if(this.pc.remoteDescription){const n=this.pc.remoteDescription,i=xa(n.sdp),r=i.media.find((t=>t.mid===e.contents[0].name)).iceParameters.usernameFragment,s=e.contents[0].transport.usernameFragment;if(s&&r!==s){for(const[t,n]of e.contents.entries()){const e=n.transport;i.media[t].iceParameters={password:e.password,usernameFragment:e.usernameFragment},i.media[t].candidates=[]}try{if(yield this.pc.setRemoteDescription({type:n.type,sdp:Ta(i)}),yield this.processBufferedCandidates(),"offer"===n.type){const e=yield this.pc.createAnswer();yield this.pc.setLocalDescription(e);const t=xa(e.sdp);this.send(ia.TransportInfo,{contents:t.media.map((e=>({creator:ea.Initiator,name:e.mid,transport:ka(e,this.transportType)}))),sid:this.sid})}else this.restartingIce=!1}catch(e){return this._log("error","Could not do remote ICE restart",e),t(e),void this.end(sa.FailedTransport)}}}const n=(e.contents||[]).map((e=>{const t=e.name,n=(e.transport.candidates||[]).map((e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const n=ve.writeCandidate(Na(e));if(this.pc.remoteDescription&&"stable"===this.pc.signalingState)try{yield this.pc.addIceCandidate({sdpMid:t,candidate:n})}catch(e){this._log("error","Could not add ICE candidate",e)}else this.candidateBuffer.push({sdpMid:t,candidate:n})}))));return Promise.all(n)}));try{yield Promise.all(n),t()}catch(e){this._log("error",`Could not process transport-info: ${e}`),t(e)}}))}onSessionAccept(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.state="active";const n=Ta(ja(e,this.peerRole));try{yield this.pc.setRemoteDescription({type:"answer",sdp:n}),yield this.processBufferedCandidates(),this.parent.emit("accepted",this,void 0),t()}catch(e){this._log("error",`Could not process WebRTC answer: ${e}`),t({condition:"general-error"})}}))}onSessionTerminate(e,t){this._log("info","Terminating session"),this.pc.close(),super.end(e.reason,!0),t()}onIceCandidate(e){if(!e.candidate||!e.candidate.candidate)return;const t=ve.parseCandidate(e.candidate.candidate),n={contents:[{creator:ea.Initiator,name:e.candidate.sdpMid,transport:{candidates:[Ia(t)],transportType:this.transportType,usernameFragment:t.usernameFragment}}]};this._log("info","Discovered new ICE candidate",n),this.send(ia.TransportInfo,n)}onIceEndOfCandidates(){this._log("info","ICE end of candidates");const e=xa(this.pc.localDescription.sdp).media[0];this.send(ia.TransportInfo,{contents:[{creator:ea.Initiator,name:e.mid,transport:{gatheringComplete:!0,transportType:this.transportType,usernameFragment:e.iceParameters.usernameFragment}}]})}onIceStateChange(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected";break;case"disconnected":if("stable"===this.pc.signalingState?this.connectionState="interrupted":this.connectionState="disconnected",this.restartingIce)return void this.end(sa.FailedTransport);this.maybeRestartIce();break;case"failed":if("failed"===this.connectionState||this.restartingIce)return void this.end(sa.FailedTransport);this.connectionState="failed",this.restartIce();break;case"closed":this.connectionState="disconnected",this.restartingIce?this.end(sa.FailedTransport):this.end()}}processBufferedCandidates(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){for(const e of this.candidateBuffer)try{yield this.pc.addIceCandidate(e)}catch(e){this._log("error","Could not add ICE candidate",e)}this.candidateBuffer=[]}))}restrictRelayBandwidth(){this.pc.addEventListener("iceconnectionstatechange",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if("completed"!==this.pc.iceConnectionState&&"connected"!==this.pc.iceConnectionState)return;const e=yield this.pc.getStats();let t;if(e.forEach((n=>{"transport"===n.type&&(t=e.get(n.selectedCandidatePairId))})),t||e.forEach((e=>{"candidate-pair"===e.type&&e.selected&&(t=e)})),!t)return;let n=!1,i="",r="";if(t.remoteCandidateId){const n=e.get(t.remoteCandidateId);n&&(r=n.candidateType)}if(t.localCandidateId){const n=e.get(t.localCandidateId);n&&(i=n.candidateType)}"relay"!==i&&"relay"!==r||(n=!0),this.usingRelay=n,this.parent.emit("iceConnectionType",this,{localCandidateType:i,relayed:n,remoteCandidateType:r}),n&&void 0!==this.maxRelayBandwidth&&(this.maximumBitrate=this.maxRelayBandwidth,this.currentBitrate?this.setMaximumBitrate(Math.min(this.currentBitrate,this.maximumBitrate)):this.setMaximumBitrate(this.maximumBitrate))}))))}maybeRestartIce(){this.isInitiator&&(void 0!==this._maybeRestartingIce&&clearTimeout(this._maybeRestartingIce),this._maybeRestartingIce=setTimeout((()=>{this._maybeRestartingIce=void 0,"disconnected"===this.pc.iceConnectionState&&this.restartIce()}),2e3))}}class Ma extends ee.EventEmitter{constructor(e={}){super(),this.config=Object.assign({chunkSize:16384,hash:"sha-1"},e),this.file=void 0,this.channel=void 0,this.hash=ro(this.config.hash)}send(e,t){if(this.file&&this.channel)return;this.file=e,this.channel=t,this.channel.binaryType="arraybuffer";const n=new FileReader;let i=0,r=!1;const s=()=>{if(r||i>=e.size)return;r=!0;const t=e.slice(i,i+this.config.chunkSize);n.readAsArrayBuffer(t)};t.bufferedAmountLowThreshold=8*this.config.chunkSize,t.onbufferedamountlow=()=>{s()},n.addEventListener("load",(t=>{const n=t.target.result;r=!1,i+=n.byteLength,this.channel.send(n),this.hash.update(new Uint8Array(n)),this.emit("progress",i,e.size,n),i<e.size?this.channel.bufferedAmount<=this.channel.bufferedAmountLowThreshold&&s():(this.emit("progress",e.size,e.size,null),this.emit("sentFile",{algorithm:this.config.hash,name:e.name,size:e.size,value:this.hash.digest()}))})),s()}}class Fa extends ee.EventEmitter{constructor(e={}){super(),this.config=Object.assign({hash:"sha-1"},e),this.receiveBuffer=[],this.received=0,this.channel=void 0,this.hash=ro(this.config.hash)}receive(e,t){this.metadata=e,this.channel=t,this.channel.binaryType="arraybuffer",this.channel.onmessage=e=>{const t=e.data.byteLength;this.received+=t,this.receiveBuffer.push(e.data),e.data&&this.hash.update(new Uint8Array(e.data)),this.emit("progress",this.received,this.metadata.size,e.data),this.received===this.metadata.size?(this.metadata.actualhash=this.hash.digest("hex"),this.emit("receivedFile",new Blob(this.receiveBuffer),this.metadata),this.receiveBuffer=[]):this.received>this.metadata.size&&(console.error("received more than expected, discarding..."),this.receiveBuffer=[])}}}class Da extends La{constructor(e){super(e),this.sender=void 0,this.receiver=void 0,this.file=void 0}start(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(t=t||(()=>{}),!e||"function"==typeof e)throw new Error("File object required");this.state="pending",this.role="initiator",this.file=e,this.sender=new Ma,this.sender.on("progress",((e,t)=>{this._log("info","Send progress "+e+"/"+t)})),this.sender.on("sentFile",(e=>{this._log("info","Sent file",e.name),this.send(ia.SessionInfo,{info:{creator:ea.Initiator,file:{hashes:[{algorithm:e.algorithm,value:e.value}]},infoType:ga,name:this.contentName}}),this.parent.emit("sentFile",this,e)})),this.channel=this.pc.createDataChannel("filetransfer",{ordered:!0}),this.channel.onopen=()=>{this.sender.send(this.file,this.channel)};try{yield this.processLocal(ia.SessionInitiate,(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.pc.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1}),n=Aa(xa(t.sdp),this.role,this.transportType);this.contentName=n.contents[0].name,n.sid=this.sid,n.action=ia.SessionInitiate,n.contents[0].application={applicationType:Ar,file:{date:e.lastModified?new Date(e.lastModified):void 0,hashesUsed:[{algorithm:"sha-1"}],name:e.name,size:e.size}},this.send("session-initiate",n),yield this.pc.setLocalDescription(t)})))),t()}catch(e){return this._log("error","Could not create WebRTC offer",e),this.end("failed-application",!0)}}))}accept(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this._log("info","Accepted incoming session"),this.role="responder",this.state="active",e=e||(()=>{});try{yield this.processLocal(ia.SessionAccept,(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.pc.createAnswer(),t=Aa(xa(e.sdp),this.role,this.transportType);t.sid=this.sid,t.action="session-accept";for(const e of t.contents)e.creator="initiator";this.contentName=t.contents[0].name,this.send("session-accept",t),yield this.pc.setLocalDescription(e),yield this.processBufferedCandidates()})))),e()}catch(e){this._log("error","Could not create WebRTC answer",e),this.end("failed-application")}}))}onSessionInitiate(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this._log("info","Initiating incoming session"),this.role="responder",this.state="pending",this.transportType=e.contents[0].transport.transportType;const n=Ta(ja(e,this.peerRole)),i=e.contents[0].application,r=i.file.hashesUsed?i.file.hashesUsed:i.file.hashes||[];this.receiver=new Fa({hash:r[0]&&r[0].algorithm}),this.receiver.on("progress",((e,t)=>{this._log("info","Receive progress "+e+"/"+t)})),this.receiver.on("receivedFile",(e=>{this.receivedFile=e,this._maybeReceivedFile()})),this.receiver.metadata=i.file,this.pc.addEventListener("datachannel",(e=>{this.channel=e.channel,this.receiver.receive(this.receiver.metadata,e.channel)}));try{yield this.pc.setRemoteDescription({type:"offer",sdp:n}),yield this.processBufferedCandidates(),t()}catch(e){this._log("error","Could not create WebRTC answer",e),t({condition:"general-error"})}}))}onSessionInfo(e,t){const n=e.info;n&&n.file&&n.file.hashes&&(this.receiver.metadata.hashes=n.file.hashes,this.receiver.metadata.actualhash&&this._maybeReceivedFile(),t())}_maybeReceivedFile(){if(this.receiver.metadata.hashes&&this.receiver.metadata.hashes.length){for(const e of this.receiver.metadata.hashes||[])if(e.value&&e.value.toString("hex")===this.receiver.metadata.actualhash)return this._log("info","File hash matches"),this.parent.emit("receivedFile",this,this.receivedFile,this.receiver.metadata),void this.end("success");this._log("error","File hash does not match"),this.end("media-error")}}}function qa(e){const t=e.application;if(t.streams&&t.streams.length&&t.sources&&t.sources.length){const e=t.streams[0];t.sources[0].parameters.msid=`${e.id} ${e.track}`,t.sourceGroups&&t.sourceGroups.length>0&&t.sources.push({parameters:{cname:t.sources[0].parameters.cname,msid:`${e.id} ${e.track}`},ssrc:t.sourceGroups[0].sources[1]})}}class Ua extends La{constructor(e){if(super(e),this.includesAudio=!1,this.includesVideo=!1,this._ringing=!1,this.pc.addEventListener("track",(e=>{this.onAddTrack(e.track,e.streams[0])})),e.stream)for(const t of e.stream.getTracks())this.addTrack(t,e.stream)}get ringing(){return this._ringing}set ringing(e){e!==this._ringing&&(this._ringing=e)}get streams(){return"closed"!==this.pc.signalingState?this.pc.getRemoteStreams():[]}start(e,t){return(0,i.__awaiter)(this,arguments,void 0,(function*(){this.state="pending",1===arguments.length&&"function"==typeof e&&(t=e,e={}),t=t||(()=>{}),e=e||{},this.role="initiator",this.offerOptions=e;try{yield this.processLocal(ia.SessionInitiate,(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.pc.createOffer(e),n=Aa(xa(t.sdp),this.role,this.transportType);n.sid=this.sid,n.action=ia.SessionInitiate;for(const e of n.contents||[])e.creator="initiator",qa(e);yield this.pc.setLocalDescription(t),this.send("session-initiate",n)})))),t()}catch(e){this._log("error","Could not create WebRTC offer",e),this.end("failed-application",!0)}}))}accept(e,t){return(0,i.__awaiter)(this,arguments,void 0,(function*(){1===arguments.length&&"function"==typeof e&&(t=e,e={}),t=t||(()=>{}),e=e||{},this._log("info","Accepted incoming session"),this.state="active",this.role="responder";try{yield this.processLocal(ia.SessionAccept,(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.pc.createAnswer(e),n=Aa(xa(t.sdp),this.role,this.transportType);n.sid=this.sid,n.action=ia.SessionAccept;for(const e of n.contents||[])e.creator="initiator";yield this.pc.setLocalDescription(t),yield this.processBufferedCandidates(),this.send("session-accept",n)})))),t()}catch(e){this._log("error","Could not create WebRTC answer",e),this.end("failed-application")}}))}end(e="success",t=!1){for(const e of this.pc.getReceivers())this.onRemoveTrack(e.track);super.end(e,t)}ring(){return this.processLocal("ring",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){this._log("info","Ringing on incoming session"),this.ringing=!0,this.send(ia.SessionInfo,{info:{infoType:ma}})}))))}mute(e,t){return this.processLocal("mute",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){this._log("info","Muting",t),this.send(ia.SessionInfo,{info:{creator:e,infoType:ua,name:t}})}))))}unmute(e,t){return this.processLocal("unmute",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){this._log("info","Unmuting",t),this.send(ia.SessionInfo,{info:{creator:e,infoType:pa,name:t}})}))))}hold(){return this.processLocal("hold",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){this._log("info","Placing on hold"),this.send("session-info",{info:{infoType:da}})}))))}resume(){return this.processLocal("resume",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){this._log("info","Resuming from hold"),this.send("session-info",{info:{infoType:fa}})}))))}addTrack(e,t,n){return"audio"===e.kind&&(this.includesAudio=!0),"video"===e.kind&&(this.includesVideo=!0),this.processLocal("addtrack",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){this.pc.addTrack?this.pc.addTrack(e,t):this.pc.addStream(t),n&&n()}))))}removeTrack(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){return this.processLocal("removetrack",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if(this.pc.removeTrack(e),t)return t()}))))}))}onAddTrack(e,t){this._log("info","Track added"),this.parent.emit("peerTrackAdded",this,e,t)}onRemoveTrack(e){this._log("info","Track removed"),this.parent.emit("peerTrackRemoved",this,e)}onSessionInitiate(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this._log("info","Initiating incoming session"),this.state="pending",this.role="responder",this.transportType=e.contents[0].transport.transportType;const n=ja(e,this.peerRole);for(const e of n.media)"audio"===e.kind&&(this.includesAudio=!0),"video"===e.kind&&(this.includesVideo=!0),e.streams||(e.streams=[{stream:"legacy",track:e.kind}]);const i=Ta(n);try{return yield this.pc.setRemoteDescription({type:"offer",sdp:i}),yield this.processBufferedCandidates(),t()}catch(e){return this._log("error","Could not create WebRTC answer",e),t({condition:"general-error"})}}))}onSessionTerminate(e,t){for(const e of this.pc.getReceivers())this.onRemoveTrack(e.track);super.onSessionTerminate(e,t)}onSessionInfo(e,t){const n=e.info||{infoType:""};switch(n.infoType){case ma:return this._log("info","Outgoing session is ringing"),this.ringing=!0,this.parent.emit("ringing",this),t();case da:return this._log("info","On hold"),this.parent.emit("hold",this),t();case ha:case fa:return this._log("info","Resuming from hold"),this.parent.emit("resumed",this),t();case ua:return this._log("info","Muting",n),this.parent.emit("mute",this,n),t();case pa:return this._log("info","Unmuting",n),this.parent.emit("unmute",this,n),t()}return t()}}const Ba=786432;class Ga extends ee.EventEmitter{constructor(e={}){super(),e=e||{},this.selfID=e.selfID,this.sessions={},this.peers={},this.iceServers=e.iceServers||[],this.prepareSession=e.prepareSession||(e=>{if(this.config.hasRTCPeerConnection)return e.applicationTypes.indexOf(ar)>=0?new Ua(e):e.applicationTypes.indexOf(Ar)>=0?new Da(e):void 0}),this.performTieBreak=e.performTieBreak||((e,t)=>{const n=(t.jingle.contents||[]).map((e=>{if(e.application)return e.application.applicationType}));return(e.pendingApplicationTypes||[]).filter((e=>n.includes(e))).length>0}),this.createPeerConnection=e.createPeerConnection||((e,t)=>{if(po)return new po(t)}),this.config=Object.assign({debug:!1,hasRTCPeerConnection:!!po,peerConnectionConfig:{bundlePolicy:e.bundlePolicy||"balanced",iceTransportPolicy:e.iceTransportPolicy||"all",rtcpMuxPolicy:e.rtcpMuxPolicy||"require",sdpSemantics:e.sdpSemantics},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]}},e)}addICEServer(e){if("string"==typeof e)return void this.iceServers.push({urls:e});if(!(t=e).type&&(t.urls||t.url))return void this.iceServers.push(e);var t;let n=e.host||"";n.indexOf(":")>=0&&(n=`[${n}]`);let i=`${e.type}:${n}`;e.port&&(i+=`:${e.port}`),e.transport&&(i+=`?transport=${e.transport}`),"turn"===e.type||"turns"===e.type?this.iceServers.push({credential:e.password,urls:[i],username:e.username}):"stun"!==e.type&&"stuns"!==e.type||this.iceServers.push({urls:[i]})}resetICEServers(){this.iceServers=[]}addSession(e){e.parent=this;const t=e.sid,n=e.peerID;return this.sessions[t]=e,this.peers[n]||(this.peers[n]=[]),this.peers[n].push(e),this.emit("createdSession",e),e}forgetSession(e){const t=this.peers[e.peerID]||[];t.length&&t.splice(t.indexOf(e),1),delete this.sessions[e.sid]}createMediaSession(e,t,n){const i=new Ua({config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!0,maxRelayBandwidth:Ba,parent:this,peerID:e,sid:t,stream:n});return this.addSession(i),i}createFileTransferSession(e,t){const n=new Da({config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!0,maxRelayBandwidth:Ba,parent:this,peerID:e,sid:t});return this.addSession(n),n}endPeerSessions(e,t,n=!1){const i=this.peers[e]||[];delete this.peers[e];for(const e of i)e.end(t||"gone",n)}endAllSessions(e,t=!1){for(const n of Object.keys(this.peers))this.endPeerSessions(n,e,t)}process(e){const t=e.jingle?e.jingle.sid:void 0;let n=t?this.sessions[t]:void 0;const i=e.id,r=e.from;if(!r)return;if("error"===e.type){if(this._log("error","Received error response",e),n&&e.error&&"unknown-session"===e.error.jingleError)return n.end("gone",!0);const t=e.error&&"tie-break"===e.error.jingleError;return n&&"pending"===n.state&&t?n.end("alternative-session",!0):void(n&&(n.pendingAction=void 0))}if("result"===e.type)return void(n&&(n.pendingAction=void 0));const s=e.jingle.action,o=e.jingle.contents||[],a=o.map((e=>e.application?e.application.applicationType:void 0)),c=o.map((e=>e.transport?e.transport.transportType:void 0));if(s!==ia.SessionInitiate){if(!n)return"session-terminate"===s?void this.emit("send",{id:i,to:r,type:"result"}):(this._log("error","Unknown session",t),this._sendError(r,i,{condition:"item-not-found",jingleError:"unknown-session"}));if(n.peerID!==r||"ended"===n.state)return this._log("error","Session has ended, or action has wrong sender"),this._sendError(r,i,{condition:"item-not-found",jingleError:"unknown-session"});if("session-accept"===s&&"pending"!==n.state)return this._log("error","Tried to accept session twice",t),this._sendError(r,i,{condition:"unexpected-request",jingleError:"out-of-order"});if("session-terminate"!==s&&s===n.pendingAction&&(this._log("error","Tie break during pending request"),n.isInitiator))return this._sendError(r,i,{condition:"conflict",jingleError:"tie-break"})}else if(n){if(n.peerID!==r)return this._log("error","Duplicate sid from new sender"),this._sendError(r,i,{condition:"service-unavailable"});if("pending"!==n.state)return this._log("error","Someone is doing this wrong"),this._sendError(r,i,{condition:"unexpected-request",jingleError:"out-of-order"});if(this.selfID&&this.selfID>n.peerID&&this.performTieBreak(n,e))return this._log("error","Tie break new session because of duplicate sids"),this._sendError(r,i,{condition:"conflict",jingleError:"tie-break"})}else if(this.peers[r]&&this.peers[r].length)for(let n=0,s=this.peers[r].length;n<s;n++){const s=this.peers[r][n];if(s&&"pending"===s.state&&t&&Lo(s.sid,t)>0&&this.performTieBreak(s,e))return this._log("info","Tie break session-initiate"),this._sendError(r,i,{condition:"conflict",jingleError:"tie-break"})}if("session-initiate"===s){if(!o.length)return this._sendError(r,i,{condition:"bad-request"});n=this._createIncomingSession({applicationTypes:a,config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!1,parent:this,peerID:r,sid:t,transportTypes:c},e)}n.process(s,e.jingle,(t=>{t?(this._log("error","Could not process request",e,t),this._sendError(r,i,t)):(this.emit("send",{id:i,to:r,type:"result"}),"session-initiate"===s&&this.emit("incoming",n))}))}signal(e,t){const n=t.jingle&&t.jingle.action;e.isInitiator&&n===ia.SessionInitiate&&this.emit("outgoing",e),this.emit("send",t)}_createIncomingSession(e,t){let n;return this.prepareSession&&(n=this.prepareSession(e,t)),n||(n=new Pa(e)),this.addSession(n),n}_sendError(e,t,n){n.type||(n.type="cancel"),this.emit("send",{error:n,id:t,to:e,type:"error"})}_log(e,t,...n){this.emit("log",e,t,...n),this.emit("log:"+e,t,...n)}}function Ja(e){const t=!!po,n={advertiseAudio:t,advertiseFileTransfer:t,advertiseVideo:t,bundlePolicy:"balanced",hasRTCPeerConnection:t,iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceTransportPolicy:"all",rtcpMuxPolicy:"require",trickleIce:!0},r=e.config.jingle,s=Object.assign(Object.assign({},n),r),o=e.jingle=new Ga(s),a=[sr];s.hasRTCPeerConnection&&(a.push(as,dr,ns,Qr,"urn:ietf:rfc:5888"),!1===s.trickleIce&&a.push("urn:ietf:rfc:3264"),(s.advertiseAudio||s.advertiseVideo)&&a.push(ar,Mr,Fr,"urn:ietf:rfc:5576"),s.advertiseAudio&&a.push(lr),s.advertiseVideo&&a.push(ur),s.advertiseFileTransfer&&a.push(kr,Ar));for(const t of a)e.disco.addFeature(t);const c=["outgoing","incoming","accepted","terminated","ringing","mute","unmute","hold","resumed"];for(const t of c)o.on(t,((n,i)=>{e.emit("jingle:"+t,n,i)}));o.on("createdSession",(t=>{e.emit("jingle:created",t)})),o.on("send",(t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{if("set"===t.type){const n=yield e.sendIQ(t);n.jingle||(n.jingle={}),n.jingle.sid=t.jingle.sid,o.process(n)}"result"===t.type&&e.sendIQResult({type:"set",id:t.id,from:t.to},t),"error"===t.type&&e.sendIQError({type:"set",id:t.id,from:t.to},t)}catch(e){e.jingle||(e.jingle=t.jingle),e.jingle.sid=t.jingle.sid,o.process(e)}})))),e.on("session:bound",(e=>{o.selfID=e})),e.on("iq:set:jingle",(e=>{o.process(e)})),e.on("unavailable",(e=>{o.endPeerSessions(e.from,void 0,!0)})),e.getServices=(t,n,r)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=(yield e.sendIQ({externalServices:{type:n,version:r},to:t,type:"get"})).externalServices;return i.services=i.services||[],i})),e.getServiceCredentials=(t,n,r,s,o)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({externalServiceCredentials:{host:n,port:s,type:r,version:o},to:t,type:"get"})).externalServiceCredentials})),e.discoverICEServers=(t={})=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{const n=(yield e.getServices(e.config.server,void 0,t.version)).services||[],i=[];for(const t of n)e.jingle.addICEServer(t);return i}catch(e){return[]}}))}function za(e,t){const n=[],i=new Map;for(const e of t)e.name&&i.set(e.name,e);const r=new Set;for(const t of e)t.name&&i.has(t.name)?(n.push(Object.assign(Object.assign({},t),i.get(t.name))),r.add(t.name)):n.push(Object.assign({},t));for(const e of t)(!e.name||e.name&&!r.has(e.name))&&n.push(Object.assign({},e));return n}function Xa(e){e.getHistorySearchForm=(t,n={})=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({archive:{type:"query",version:n.version},to:t,type:"get"})).archive.form})),e.searchHistory=(t,n={})=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=e.nextId();let r="";"string"==typeof t?r=t:(r=t.to||"",n=t),n.queryId=i;const s=n.form||{};s.type="submit";const o=s.fields||[],a=[{name:"FORM_TYPE",type:"hidden",value:Vr}];n.with&&a.push({name:"with",type:"text-single",value:n.with}),n.start&&a.push({name:"start",type:"text-single",value:n.start.toISOString()}),n.end&&a.push({name:"end",type:"text-single",value:n.end.toISOString()}),s.fields=za(a,o),n.form=s;const c=et(e.jid,r),l=[],u=e=>{c.has(e.from)&&e.archive&&e.archive.queryId===i&&l.push(e.archive)};e.on("mam:item",u);try{const t=yield e.sendIQ({archive:n,id:i,to:r,type:"set"});return Object.assign(Object.assign({},t.archive),{results:l})}finally{e.off("mam:item",u)}})),e.getHistoryPreferences=()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({archive:{type:"preferences"},type:"get"})).archive})),e.setHistoryPreferences=t=>e.sendIQ({archive:Object.assign({type:"preferences"},t),type:"set"}),e.on("message",(t=>{t.archive&&e.emit("mam:item",t)}))}const $a=new Set(["chat","groupchat","headline","normal"]),Va=new Set(["chat","groupchat","normal"]),Ha=new Map([["markable",0],["received",1],["displayed",2],["acknowledged",3]]),Wa=(e,t)=>{var n;return e.marker&&(Ha.get(e.marker.type)<Ha.get(t)||"markable"===(null===(n=e.marker)||void 0===n?void 0:n.type))};function Qa(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){yield e.sendIQ({carbons:{action:t},type:"set"})}))}function Ka(e){e.disco.addFeature(Ir),e.disco.addFeature(Kr),e.disco.addFeature(Ui),e.disco.addFeature(zr),e.disco.addFeature(fr),e.disco.addFeature(Gr),e.enableCarbons=()=>Qa(e,"enable"),e.disableCarbons=()=>Qa(e,"disable"),e.markReceived=t=>e.sendMarker(t,"received"),e.markDisplayed=t=>e.sendMarker(t,"displayed"),e.markAcknowledged=t=>e.sendMarker(t,"acknowledged"),e.getAttention=(t,n={})=>e.sendMessage(Object.assign(Object.assign({},n),{requestingAttention:!0,to:t,type:"headline"})),e.sendMarker=(t,n,i)=>{if(!Wa(t,n)&&!i)return;const r=!1!==e.config.groupchatMarkersUseStanzaID;let s=t.id;if("groupchat"===t.type&&t.stanzaIds&&r){const e=t.stanzaIds.find((e=>tt(e.by,t.from)));e&&(s=e.id)}e.sendMessage({marker:{id:s,type:n},to:"groupchat"===t.type?st(t.from):t.from,type:t.type})},e.on("message",(t=>{if(t.carbon&&tt(t.from,e.jid)){const n=t.carbon.forward.message;n.delay||(n.delay=t.carbon.forward.delay||{timestamp:new Date(Date.now())}),(e=>!!e.carbon&&"received"===e.carbon.type)(t)&&(e.emit("carbon:received",t),e.emit("message",n)),(e=>!!e.carbon&&"sent"===e.carbon.type)(t)&&(e.emit("carbon:sent",t),e.emit("message:sent",n,!0))}(e=>!!e.forms&&e.forms.length>0)(t)&&e.emit("dataform",t),t.requestingAttention&&e.emit("attention",t),(e=>!!e.rtt)(t)&&e.emit("rtt",t),(e=>!!e.replace)(t)&&e.emit("replace",t),(e=>!!e.chatState)(t)&&Va.has(t.type||"normal")&&e.emit("chat:state",t);const n=!1!==e.config.sendReceipts,i=!1!==e.config.sendMUCReceipts,r=!1!==e.config.chatMarkers,s=!1!==e.config.groupchatMarkersUseStanzaID,o=(e=>{var t;return!!e.receipt&&"request"===e.receipt.type&&$a.has(null!==(t=e.type)&&void 0!==t?t:"normal")})(t),a=Wa(t,"received"),c=o&&n&&("groupchat"!==t.type||i);if(c||r&&a){const n="groupchat"===t.type?st(t.from):t.from;let i=t.id;if("groupchat"===t.type&&t.stanzaIds&&s){const e=t.stanzaIds.find((e=>tt(e.by,t.from)));e&&(i=e.id)}e.sendMessage({receipt:c?{id:t.id,type:"received"}:void 0,marker:r&&a?{id:i,type:"received"}:void 0,to:n,type:t.type})}t.receipt&&"received"===t.receipt.type&&e.emit("receipt",t),t.marker&&"markable"!==t.marker.type&&e.emit(`marker:${t.marker.type}`,t)}))}function Ya(e){e.disco.addFeature(mi),e.disco.addFeature(jr),e.disco.addFeature(Hr),e.joinedRooms=new Map,e.joiningRooms=new Map,e.leavingRooms=new Map,e.on("session:started",(function(){const t=e.joiningRooms;e.joiningRooms=new Map;for(const[n,i]of t)e.joinRoom(n,i);const n=e.joinedRooms;e.joinedRooms=new Map;for(const[t,i]of n)e.joinRoom(t,i)})),e.on("message",(t=>{if("groupchat"===t.type&&t.hasSubject)e.emit("muc:topic",{from:t.from,room:st(t.from),topic:t.subject||""});else if(t.muc)if("direct-invite"===t.muc.type||!t.muc.invite&&t.legacyMUC){const n="direct-invite"===t.muc.type?t.muc:t.legacyMUC;e.emit("muc:invite",{from:t.from,password:n.password,reason:n.reason,room:n.jid,thread:n.thread,type:"direct"})}else t.muc.invite?e.emit("muc:invite",{from:t.muc.invite[0].from,password:t.muc.password,reason:t.muc.invite[0].reason,room:t.from,thread:t.muc.invite[0].thread,type:"mediated"}):t.muc.decline?e.emit("muc:declined",{from:t.muc.decline.from,reason:t.muc.decline.reason,room:t.from}):e.emit("muc:other",t)})),e.on("presence",(t=>{const n=st(t.from);if(e.joiningRooms.has(n)&&"error"===t.type)return e.joiningRooms.delete(n),e.emit("muc:failed",t),void e.emit("muc:error",t);if(!function(e){return!!e.muc}(t))return;const i=t.muc.statusCodes&&t.muc.statusCodes.indexOf(Ko.SelfPresence)>=0,r=t.muc.statusCodes&&t.muc.statusCodes.indexOf(Ko.NickChanged)>=0;if("error"===t.type)return void e.emit("muc:error",t);if("unavailable"===t.type)return e.emit("muc:unavailable",t),i&&(r?e.joinedRooms.set(n,t.muc.nick):(e.emit("muc:leave",t),e.joinedRooms.delete(n),e.leavingRooms.delete(n))),void(t.muc.destroy&&e.emit("muc:destroyed",{newRoom:t.muc.destroy.jid,password:t.muc.destroy.password,reason:t.muc.destroy.reason,room:n}));e.emit("muc:available",t);const s=e.joiningRooms.has(n)||!e.joinedRooms.has(n);i&&(e.joinedRooms.set(n,rt(t.from)),s&&(e.joiningRooms.delete(n),e.emit("muc:join",t)))})),e.joinRoom=(t,n,r={})=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if(t=st(t),e.joiningRooms.set(t,n||""),!n)try{n=yield e.getReservedNick(t),e.joiningRooms.set(t,n)}catch(e){throw new Error("Room nick required")}return new Promise(((i,s)=>{function o(n){tt(n.from,t)&&(e.off("muc:join",o),e.off("muc:failed",a),i(n))}function a(n){tt(n.from,t)&&(e.off("muc:join",o),e.off("muc:failed",a),s(n))}e.on("muc:join",o),e.on("muc:failed",a),e.sendPresence(Object.assign(Object.assign({},r),{muc:Object.assign(Object.assign({},r.muc),{type:"join"}),to:Ye(t,n)}))}))})),e.leaveRoom=(t,n,i={})=>(t=st(t),n=n||e.joinedRooms.get(t),e.leavingRooms.set(t,n),new Promise(((r,s)=>{const o=i.id||Mo(),a=et(t);function c(n){tt(n.from,t)&&(e.off("muc:leave",c),e.off("presence:error",l),r(n))}function l(n){n.id===o&&a.has(n.from)&&(e.joinedRooms.has(t)||e.leavingRooms.delete(t),e.off("muc:leave",c),e.off("presence:error",l),s(n))}e.on("muc:leave",c),e.on("presence:error",l),e.sendPresence(Object.assign(Object.assign({},i),{id:o,to:Ye(t,n),type:"unavailable"}))}))),e.ban=(t,n,i)=>e.setRoomAffiliation(t,n,"outcast",i),e.kick=(t,n,i)=>e.setRoomRole(t,n,"none",i),e.invite=(t,n=[])=>{Array.isArray(n)||(n=[n]),e.sendMessage({muc:{invite:n,type:"info"},to:t})},e.directInvite=(t,n,i={})=>{e.sendMessage({muc:Object.assign(Object.assign({},i),{jid:t,type:"direct-invite"}),to:n})},e.declineInvite=(t,n,i)=>{e.sendMessage({muc:{decline:{reason:i,to:n},type:"info"},to:t})},e.changeNick=(t,n)=>{const i=Mo(),r=Ye(t,n),s=et(t);return new Promise(((t,n)=>{function o(n){s.has(st(n.from))&&n.muc.statusCodes&&n.muc.statusCodes.includes(Ko.SelfPresence)&&(e.off("muc:available",o),e.off(`presence:id:${i}`,a),t(n))}function a(r){s.has(st(r.from))&&r.id===i&&(e.off("muc:available",o),e.off(`presence:id:${i}`,a),"error"===r.type?n(r):t(r))}e.on("muc:available",o),e.on(`presence:id:${i}`,a),e.sendPresence({id:i,to:r})}))},e.setSubject=(t,n)=>{e.sendMessage({subject:n,to:t,type:"groupchat"})},e.getReservedNick=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{const n=(yield e.getDiscoInfo(t,"x-roomuser-item")).identities[0];if(n.name)return n.name;throw new Error("No nickname reserved")}catch(e){throw new Error("No nickname reserved")}})),e.requestRoomVoice=t=>{e.sendMessage({forms:[{fields:[{name:"FORM_TYPE",type:"hidden",value:"http://jabber.org/protocol/muc#request"},{name:"muc#role",type:"text-single",value:"participant"}],type:"submit"}],to:t})},e.setRoomAffiliation=(t,n,i,r)=>e.sendIQ({muc:{type:"user-list",users:[{affiliation:i,jid:n,reason:r}]},to:t,type:"set"}),e.setRoomRole=(t,n,i,r)=>e.sendIQ({muc:{type:"user-list",users:[{nick:n,reason:r,role:i}]},to:t,type:"set"}),e.getRoomMembers=(t,n={affiliation:"member"})=>e.sendIQ({muc:{type:"user-list",users:[n]},to:t,type:"get"}),e.getRoomConfig=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const n=yield e.sendIQ({muc:{type:"configure"},to:t,type:"get"});if(!n.muc.form)throw new Error("No configuration form returned");return n.muc.form})),e.configureRoom=(t,n={})=>e.sendIQ({muc:{form:Object.assign(Object.assign({},n),{type:"submit"}),type:"configure"},to:t,type:"set"}),e.destroyRoom=(t,n={})=>e.sendIQ({muc:{destroy:n,type:"configure"},to:t,type:"set"}),e.getUniqueRoomName=function(e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.sendIQ({muc:{type:"unique"},to:e,type:"get"});if(!t.muc.name)throw new Error("No unique name returned");return t.muc.name}))},e.getBookmarks=()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=yield e.getPrivateData("bookmarks");return t&&t.rooms?t.rooms:[]})),e.setBookmarks=t=>e.setPrivateData("bookmarks",{rooms:t}),e.addBookmark=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const n=yield e.getBookmarks(),i=[];let r=!1;for(const e of n)tt(e.jid,t.jid)?(i.push(Object.assign(Object.assign({},e),t)),r=!0):i.push(e);return r||i.push(t),e.setBookmarks(i)})),e.removeBookmark=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const n=(yield e.getBookmarks()).filter((e=>!tt(e.jid,t)));return e.setBookmarks(n)}))}function Za(e){e.disco.addFeature(Ji),e.disco.addFeature(Fi),e.disco.addFeature(Gi),e.disco.addFeature(pr),e.disco.addFeature($i),e.disco.addFeature(rr(Ji)),e.disco.addFeature(rr(Fi)),e.disco.addFeature(rr(Gi)),e.disco.addFeature(rr(pr)),e.disco.addFeature(rr($i)),e.publishActivity=t=>e.publish("",Ji,Object.assign({itemType:Ji},t)),e.publishGeoLoc=t=>e.publish("",Fi,Object.assign({itemType:Fi},t)),e.publishMood=t=>e.publish("",Gi,Object.assign({itemType:Gi},t)),e.publishNick=t=>e.publish("",pr,{itemType:pr,nick:t}),e.publishTune=t=>e.publish("",$i,Object.assign({itemType:$i},t)),e.on("pubsub:published",(t=>{const n=t.pubsub.items.published[0].content;switch(t.pubsub.items.node){case Ji:return e.emit("activity",{activity:n,jid:t.from});case Fi:return e.emit("geoloc",{geoloc:n,jid:t.from});case Gi:return e.emit("mood",{jid:t.from,mood:n});case pr:return e.emit("nick",{jid:t.from,nick:n.nick});case $i:return e.emit("tune",{jid:t.from,tune:t.pubsub.items.published[0].content})}}))}function ec(e){e.disco.addFeature(`${Wi}#SubID`,Wi),e.on("message",(t=>{!function(e){return!!e.pubsub&&!(e.pubsub.context&&"user"!==e.pubsub.context||!e.pubsub.affiliations)}(t)?function(e){return!!e.pubsub}(t)&&(e.emit("pubsub:event",t),!function(e){return!!e.pubsub.items&&!!e.pubsub.items.published}(t)?!function(e){return!!e.pubsub.items&&!!e.pubsub.items.retracted}(t)?!function(e){return"purge"===e.pubsub.eventType}(t)?!function(e){return"delete"===e.pubsub.eventType}(t)?!function(e){return"subscription"===e.pubsub.eventType}(t)?function(e){return"configuration"===e.pubsub.eventType}(t)&&e.emit("pubsub:config",t):e.emit("pubsub:subscription",t):e.emit("pubsub:deleted",t):e.emit("pubsub:purged",t):e.emit("pubsub:retracted",t):e.emit("pubsub:published",t)):e.emit("pubsub:affiliations",t)})),e.subscribeToNode=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i={};let r;"string"==typeof n?(i.node=n,i.jid=st(e.jid)):(i.node=n.node,i.jid=n.jid||(n.useBareJID?st(e.jid):e.jid),r=n.options);const s=yield e.sendIQ({pubsub:{context:"user",subscribe:i,subscriptionOptions:r?{form:r}:void 0},to:t,type:"set"}),o=s.pubsub.subscription||{};return s.pubsub.subscriptionOptions&&(o.options=s.pubsub.subscriptionOptions.form),o})),e.unsubscribeFromNode=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i={};"string"==typeof n?(i.node=n,i.jid=st(e.jid)):(i.node=n.node,i.subid=n.subid,i.jid=n.jid||(n.useBareJID?st(e.jid):e.jid));const r=yield e.sendIQ({pubsub:{context:"user",unsubscribe:i},to:t,type:"set"});return r.pubsub&&r.pubsub.subscription?r.pubsub.subscription:Object.assign(Object.assign({},i),{state:"none"})})),e.publish=(t,n,i,r)=>e.sendIQ({pubsub:{context:"user",publish:{item:{content:i,id:r},node:n}},to:t,type:"set"}),e.getItem=(t,n,r)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"user",fetch:{items:[{id:r}],node:n}},to:t,type:"get"})).pubsub.fetch.items[0]})),e.getItems=(t,n,r={})=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=yield e.sendIQ({pubsub:{context:"user",fetch:{max:r.max,node:n},paging:r},to:t,type:"get"}),s=i.pubsub.fetch;return s.paging=i.pubsub.paging,s})),e.retract=(t,n,i,r)=>e.sendIQ({pubsub:{context:"user",retract:{id:i,node:n,notify:r}},to:t,type:"set"}),e.purgeNode=(t,n)=>e.sendIQ({pubsub:{context:"owner",purge:n},to:t,type:"set"}),e.deleteNode=(t,n,i)=>e.sendIQ({pubsub:{context:"owner",destroy:{node:n,redirect:i}},to:t,type:"set"}),e.createNode=(t,n,r)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=yield e.sendIQ({pubsub:{configure:r?{form:r}:void 0,context:"user",create:{node:n}},to:t,type:"set"});return i.pubsub&&i.pubsub.create?i.pubsub.create:{node:n}})),e.getSubscriptions=(t,n={})=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"user",subscriptions:n},to:t,type:"get"})).pubsub.subscriptions})),e.getAffiliations=(t,n)=>e.sendIQ({pubsub:{affiliations:{node:n}},to:t,type:"get"}),e.getNodeSubscribers=(t,n,i={})=>("string"==typeof n?i.node=n:i=Object.assign(Object.assign({},i),n),e.sendIQ({pubsub:{context:"owner",subscriptions:i},to:t,type:"get"})),e.updateNodeSubscriptions=(t,n,i)=>e.sendIQ({pubsub:{context:"owner",subscriptions:{items:i,node:n}},to:t,type:"set"}),e.getNodeAffiliations=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{affiliations:{node:n},context:"owner"},to:t,type:"get"})).pubsub.affiliations})),e.updateNodeAffiliations=(t,n,i)=>e.sendIQ({pubsub:{affiliations:{items:i,node:n},context:"owner"},to:t,type:"set"}),e.getNodeConfig=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{configure:{node:n},context:"owner"},to:t,type:"get"})).pubsub.configure.form||{}})),e.getDefaultNodeConfig=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"owner",defaultConfiguration:{}},to:t,type:"get"})).pubsub.defaultConfiguration.form||{}})),e.configureNode=(t,n,r)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return e.sendIQ({pubsub:{configure:{form:r,node:n},context:"owner"},to:t,type:"set"})})),e.getDefaultSubscriptionOptions=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{defaultSubscriptionOptions:{}},to:t,type:"get"})).pubsub.defaultSubscriptionOptions.form||{}}))}function tc(e){function t(t,n){return(0,i.__awaiter)(this,void 0,void 0,(function*(){yield e.sendIQ({blockList:{action:t,jids:[n]},type:"set"})}))}e.on("iq:set:roster",(t=>{if(!et(e.jid).has(t.from))return e.sendIQError(t,{error:{condition:"service-unavailable",type:"cancel"}});e.emit("roster:update",t),e.sendIQResult(t)})),e.on("iq:set:blockList",(t=>{if(!et(e.jid).has(t.from))return e.sendIQError(t,{error:{condition:"service-unavailable",type:"cancel"}});const n=t.blockList;e.emit(n.action,{jids:n.jids||[]}),e.sendIQResult(t)})),e.getRoster=()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=yield e.sendIQ({roster:{version:e.config.rosterVer},type:"get"});if(t.roster){const n=t.roster.version;return n&&(e.config.rosterVer=n,e.emit("roster:ver",n)),t.roster.items=t.roster.items||[],t.roster}return{items:[]}})),e.updateRosterItem=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){yield e.sendIQ({roster:{items:[t]},type:"set"})})),e.removeRosterItem=t=>e.updateRosterItem({jid:t,subscription:"remove"}),e.subscribe=t=>{e.sendPresence({type:"subscribe",to:t})},e.unsubscribe=t=>{e.sendPresence({type:"unsubscribe",to:t})},e.acceptSubscription=t=>{e.sendPresence({type:"subscribed",to:t})},e.denySubscription=t=>{e.sendPresence({type:"unsubscribed",to:t})},e.getBlocked=()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=yield e.sendIQ({blockList:{action:"list"},type:"get"});return Object.assign({jids:[]},t.blockList)})),e.block=e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return t("block",e)})),e.unblock=e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return t("unblock",e)})),e.goInvisible=(t=!1)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",visiblity:{probe:t,type:"invisible"}})})),e.goVisible=()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",visiblity:{type:"visible"}})}))}function nc(e){e.registerFeature("sasl",100,((t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const r=e.sasl.createMechanism(t.sasl.mechanisms),s=t=>(0,i.__awaiter)(this,void 0,void 0,(function*(){if(r)switch(t.type){case"success":return e.features.negotiated.sasl=!0,e.off("sasl",s),e.emit("auth:success",e.config.credentials),e.transport&&(e.transport.authenticated=!0),void n("restart");case"challenge":r.processChallenge(t.value);try{const t=yield e.getCredentials(),n=r.createResponse(t);n||""===n?e.send("sasl",{type:"response",value:n}):e.send("sasl",{type:"response"});const i=r.getCacheableCredentials();i&&(e.config.credentials||(e.config.credentials={}),e.config.credentials=Object.assign(Object.assign({},e.config.credentials),i),e.emit("credentials:update",e.config.credentials))}catch(t){console.error(t),e.send("sasl",{type:"abort"})}return;case"failure":case"abort":return e.off("sasl",s),e.emit("auth:failed"),void n("disconnect","authentication failed")}}));if(!r)return e.off("sasl",s),e.emit("auth:failed"),n("disconnect","authentication failed");e.on("sasl",s),e.once("--reset-stream-features",(()=>{e.features.negotiated.sasl=!1,e.off("sasl",s)}));try{const t=yield e.getCredentials();e.send("sasl",{mechanism:r.name,type:"auth",value:r.createResponse(t)})}catch(t){console.error(t),e.send("sasl",{type:"abort"})}}))))}function ic(e){function t(t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const n=yield e.getDiscoInfo(t);if(!n.features||!n.features.includes(os))return;let i;for(const e of n.extensions||[]){const n=e.fields||[];if(n.some((e=>"FORM_TYPE"===e.name&&e.value===os))){const e=n.find((e=>"max-file-size"===e.name));return e&&(i=parseInt(e.value,10)),{jid:t,maxSize:i}}}}))}e.disco.addFeature(Nr),e.getBits=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({bits:{cid:n},to:t,type:"get"})).bits})),e.getUploadService=(n=it(e.jid))=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const i=yield t(n);if(i)return i;const r=yield e.getDiscoItems(n);for(const e of r.items||[]){if(!e.jid)continue;const n=yield t(e.jid);if(n)return n}throw new Error("No upload service discovered on: "+n)})),e.getUploadSlot=(t,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){return(yield e.sendIQ({httpUpload:Object.assign({type:"request"},n),to:t,type:"get"})).httpUpload}))}function rc(e){e.use(_a),e.use(Jo),e.use(Oo),e.use(Do),e.use(Sa),e.use(nc)}function sc(e){e.use(ko),e.use(Ka),e.use(Ao),e.use(jo),e.use(ba),e.use(Ja),e.use(Xa),e.use(Ya),e.use(Za),e.use(ec),e.use(tc),e.use(ic)}const oc={aliases:["features.legacySession","iq.legacySession"],element:"session",fields:{optional:An(null,"optional")},namespace:ei},ac=[{aliases:["atomentry",{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"entry",fields:{id:Sn(null,"id"),published:Tn(null,"published"),updated:Tn(null,"updated")},namespace:Wn,type:Wn,typeField:"itemType"},{element:"summary",fields:{text:vn(),type:nn("type","text")},namespace:Wn,path:"atomentry.summary"},{element:"title",fields:{text:vn(),type:nn("type","text")},namespace:Wn,path:"atomentry.title"},{aliases:[{path:"atomentry.links",multiple:!0}],element:"link",fields:{href:nn("href"),mediaType:nn("type"),rel:nn("rel")},namespace:Wn},{aliases:[{path:"atomentry.authors",multiple:!0}],element:"author",fields:{name:Sn(null,"name"),uri:Sn(null,"uri"),email:Sn(null,"email")},namespace:Wn},{aliases:[{path:"atomentry.contributors",multiple:!0}],element:"contributor",fields:{name:Sn(null,"name"),uri:Sn(null,"uri"),email:Sn(null,"email")},namespace:Wn},{aliases:[{path:"atomentry.categories",multiple:!0}],element:"category",fields:{term:nn("term"),scheme:nn("scheme"),label:nn("label")},namespace:Wn},{element:"content",fields:{text:vn(),type:nn("type","text")},namespace:Wn,path:"atomentry.content"},{element:"rights",fields:{text:vn(),type:nn("type","text")},namespace:Wn,path:"atomentry.rights"}],cc={defaultType:"stream",element:"stream",fields:{from:nn("from"),id:nn("id"),lang:wn(),to:nn("to"),version:nn("version")},namespace:ni,path:"stream",type:"stream",typeField:"action"},lc={element:"features",namespace:ni,path:"features"},uc={element:"error",fields:{alternateLanguageText:Un(ii,"text"),condition:Ln(ii,Object.values(Ho),Ho.UndefinedCondition),seeOtherHost:Sn(ii,Ho.SeeOtherHost),text:Sn(ii,"text")},namespace:ni,path:"streamError"},pc=Object.values($o).map((e=>({aliases:["stanzaError","message.error","presence.error","iq.error"],defaultType:Kn,element:"error",fields:{alternateLanguageText:Un(ti,"text"),by:gs("by"),condition:Ln(ti,Object.values(Wo),Wo.UndefinedCondition),gone:Sn(ti,Wo.Gone),redirect:Sn(ti,Wo.Redirect),text:Sn(ti,"text"),type:nn("type")},namespace:e,type:e,typeField:"streamType"}))),dc=new Set(["from","id","lang","to","type","payloadType","error","streamType"]),hc=Object.values($o).map((e=>({childrenExportOrder:{error:2e5},defaultType:Kn,element:"iq",fields:{from:gs("from"),id:nn("id"),lang:wn(),payloadType:{order:-1e4,importer(e,t){if("get"!==t.data.type&&"set"!==t.data.type)return;if(1!==e.children.filter((e=>"string"!=typeof e)).length)return"invalid-payload-count";const n=Object.keys(t.data).filter((e=>!dc.has(e)));return 1!==n.length?"unknown-payload":n[0]}},to:gs("to"),type:nn("type")},namespace:e,path:"iq",type:e,typeField:"streamType"}))),fc=Object.values($o).map((e=>({childrenExportOrder:{error:2e5},defaultType:Kn,element:"message",fields:{from:gs("from"),id:nn("id"),lang:wn(),to:gs("to")},namespace:e,path:"message",type:e,typeField:"streamType"}))),mc=Object.values($o).map((e=>({childrenExportOrder:{error:2e5},defaultType:Kn,element:"presence",fields:{from:gs("from"),id:nn("id"),lang:wn(),to:gs("to")},namespace:e,path:"presence",type:e,typeField:"streamType"}))),gc=[cc,lc,uc,...pc,...[{element:"mechanisms",fields:{mechanisms:Fn(null,"mechanism")},namespace:Yn,path:"features.sasl"},{element:"abort",namespace:Yn,path:"sasl",type:"abort",typeField:"type"},{element:"auth",fields:{mechanism:nn("mechanism"),value:_n("base64")},namespace:Yn,path:"sasl",type:"auth",typeField:"type"},{element:"challenge",fields:{value:_n("base64")},namespace:Yn,path:"sasl",type:"challenge",typeField:"type"},{element:"response",fields:{value:_n("base64")},namespace:Yn,path:"sasl",type:"response",typeField:"type"},{element:"success",fields:{value:_n("base64")},namespace:Yn,path:"sasl",type:"success",typeField:"type"},{element:"failure",fields:{alternateLanguageText:Un(Yn,"text"),condition:Ln(Yn,Object.values(Vo)),text:Sn(Yn,"text")},namespace:Yn,path:"sasl",type:"failure",typeField:"type"}],...[{aliases:["features.tls"],defaultType:"start",element:"starttls",fields:{required:An(null,"required")},namespace:ri,path:"tls",type:"start",typeField:"type"},{element:"proceed",namespace:ri,path:"tls",type:"proceed",typeField:"type"},{element:"failure",namespace:ri,path:"tls",type:"failure",typeField:"type"}],...hc,...fc,...mc,{aliases:["features.bind","iq.bind"],element:"bind",fields:{jid:Sn(null,"jid"),resource:Sn(null,"resource")},namespace:Qn}],yc=[xs({rosterPreApproval:An(ai,"sub"),rosterVersioning:An(oi,"ver")}),_s({alternateLanguageBodies:Un(null,"body"),alternateLanguageSubjects:Un(null,"subject"),body:Sn(null,"body"),hasSubject:An(null,"subject"),parentThread:hn(null,"thread","parent"),subject:Sn(null,"subject"),thread:Sn(null,"thread"),type:nn("type")}),ws({alternateLanguageStatuses:Un(null,"status"),priority:En(null,"priority",0),show:Sn(null,"show"),status:Sn(null,"status"),type:nn("type")}),{element:"query",fields:{version:nn("ver",void 0,{emitEmpty:!0})},namespace:si,path:"iq.roster"},{aliases:[{path:"iq.roster.items",multiple:!0}],element:"item",fields:{groups:Fn(null,"group"),jid:gs("jid"),name:nn("name"),pending:nn("ask"),preApproved:rn("approved"),subscription:nn("subscription")},namespace:si}],vc=[{element:"open",fields:{from:nn("from"),id:nn("id"),lang:wn(),to:nn("to"),version:nn("version")},namespace:ci,path:"stream",type:"open"},{element:"close",fields:{seeOtherURI:nn("see-other-uri")},namespace:ci,path:"stream",type:"close"}],bc=[{aliases:[{path:"message.forms",multiple:!0}],element:"x",fields:{instructions:Object.assign(Object.assign({},Fn(null,"instructions")),{exportOrder:2}),reported:Object.assign(Object.assign({},Gn(null,"reported","dataformField",!0)),{exportOrder:3}),title:Object.assign(Object.assign({},Sn(null,"title")),{exportOrder:1}),type:nn("type")},namespace:li,optionalNamespaces:{xdv:Vi},path:"dataform"},{aliases:[{path:"dataform.fields",multiple:!0},{path:"dataform.items.fields",multiple:!0}],element:"field",fields:{description:Sn(null,"desc"),label:nn("label"),name:nn("var"),rawValues:Object.assign(Object.assign({},Fn(null,"value")),{exporter:()=>null}),required:An(null,"required"),type:nn("type"),value:{importer(e,t){const n=e.getAttribute("type"),i=Fn(li,"value").importer(e,t),r=i[0];switch(n){case Qo.TextMultiple:case Qo.ListMultiple:case Qo.JIDMultiple:return i;case Qo.Hidden:case Qo.Fixed:return 1===i.length?r:i;case Qo.Boolean:if(r)return"1"===r||"true"===r;break;default:return r}},exporter(e,t,n){const i=Fn(null,"value");let r=[];const s=n.data&&n.data.rawValues?n.data.rawValues[0]:void 0;if("boolean"==typeof t)r="true"===s||"false"===s?[s]:[t?"1":"0"];else if(Array.isArray(t))for(const e of t)r.push(e.toString());else r=[t.toString()];i.exporter(e,r,Object.assign({},n,{namespace:li}))}}},namespace:li,path:"dataformField"},{aliases:[{path:"dataform.fields.options",multiple:!0}],element:"option",fields:{label:nn("label"),value:Sn(null,"value")},namespace:li},{aliases:[{path:"dataform.items",multiple:!0}],element:"item",namespace:li},{element:"validate",fields:{listMax:mn(null,"list-range","max"),listMin:mn(null,"list-range","min"),method:Ln(null,["basic","open","range","regex"],"basic"),rangeMax:hn(null,"range","max"),rangeMin:hn(null,"range","min"),regex:Sn(null,"regex"),type:nn("datatype","xs:string")},namespace:Vi,path:"dataform.fields.validation"}],_c=[{aliases:["presence.legacyLastActivity","iq.lastActivity"],element:"query",fields:{seconds:sn("seconds"),status:vn()},namespace:ui}],wc=[{element:"query",fields:{activeList:hn(null,"active","name"),defaultList:hn(null,"default","name")},namespace:pi,path:"iq.privacy"},{aliases:[{path:"iq.privacy.lists",multiple:!0}],element:"list",fields:{name:nn("name")},namespace:pi},{aliases:[{path:"iq.privacy.lists.items",multiple:!0}],element:"item",fields:{action:nn("action"),incomingPresence:An(null,"presence-in"),iq:An(null,"iq"),messages:An(null,"message"),order:sn("order"),outgoingPresence:An(null,"presence-out"),type:nn("type"),value:nn("value")},namespace:pi}],Sc=[{aliases:["iq.disco","message.disco","features.disco"],childrenExportOrder:{identities:1,features:2,extensions:3},element:"query",fields:{features:Dn(null,"feature","var"),node:nn("node")},namespace:di,path:"disco",type:"info",typeField:"type"},{aliases:[{path:"disco.identities",selector:"info",multiple:!0}],element:"identity",fields:{category:nn("category"),lang:wn(),name:nn("name"),type:nn("type")},namespace:di},{aliases:[{path:"disco.items",multiple:!0,selector:"items"}],element:"item",fields:{jid:gs("jid"),name:nn("name"),node:nn("node")},namespace:hi},{aliases:[{path:"disco.items",multiple:!0,selector:"info"}],element:"item",fields:{category:gs("category"),lang:wn(),name:nn("name"),type:nn("type")},namespace:di},bs(li,"x",[{path:"disco.extensions",multiple:!0,selector:"info"}]),bs(Ei,"set",[{path:"disco.paging",selector:"items"}]),{aliases:["iq.disco","message.disco","features.disco"],element:"query",fields:{node:nn("node")},namespace:hi,path:"disco",type:"items",typeField:"type"}],xc=[_s({addresses:Gn(fi,"addresses","extendedAddress",!0)}),ws({addresses:Gn(fi,"addresses","extendedAddress",!0)}),{element:"address",fields:{alternateLanguageDescriptions:Un(null,"desc"),delivered:rn("delivered"),description:nn("desc"),jid:gs("jid"),node:nn("node"),type:nn("type"),uri:nn("uri")},namespace:fi,path:"extendedAddress"}],Tc=[bs(li,"x",[{path:"iq.muc.form",selector:"configure"}]),{defaultType:"info",element:"x",fields:{password:Sn(null,"password")},namespace:mi,path:"presence.muc",type:"join",typeField:"type"},{aliases:[{path:"presence.muc.history",selector:"join"}],element:"history",fields:{maxCharacters:sn("maxchars"),maxStanzas:sn("maxstanzas"),seconds:sn("seconds"),since:an("since")},namespace:mi},{aliases:["presence.muc","message.muc"],defaultType:"info",element:"x",fields:{action:Ln(null,["invite","decline","destroy"]),actor:Gn(null,"item","mucactor"),affiliation:hn(null,"item","affiliation"),jid:ys(null,"item","jid"),nick:hn(null,"item","nick"),password:Sn(null,"password"),reason:jn([{namespace:null,element:"item"},{namespace:null,element:"reason"}]),role:hn(null,"item","role"),statusCodes:Dn(null,"status","code")},namespace:vi,type:"info",typeField:"type",typeOrder:1},{element:"actor",fields:{jid:gs("jid"),nick:nn("nick")},namespace:vi,path:"mucactor"},{element:"destroy",fields:{jid:gs("jid"),password:Sn(null,"password"),reason:Sn(null,"reason")},namespace:vi,path:"presence.muc.destroy"},{aliases:[{path:"message.muc.invite",multiple:!0}],element:"invite",fields:{continue:An(null,"continue"),from:gs("from"),reason:Sn(null,"reason"),thread:hn(null,"continue","thread"),to:gs("to")},namespace:vi},{element:"decline",fields:{from:gs("from"),reason:Sn(null,"reason"),to:gs("to")},namespace:vi,path:"message.muc",type:"decline"},{element:"query",namespace:gi,path:"iq.muc",type:"user-list",typeField:"type"},{aliases:[{path:"iq.muc.users",multiple:!0,selector:"user-list"}],element:"item",fields:{affiliation:nn("affiliation"),jid:gs("jid"),nick:nn("nick"),reason:Sn(null,"reason"),role:nn("role")},namespace:gi},{aliases:["iq.muc.users.actor"],element:"actor",fields:{jid:gs("jid"),nick:nn("nick")},namespace:gi},{element:"query",namespace:yi,path:"iq.muc",type:"configure",typeField:"type"},{aliases:[{path:"iq.muc.destroy",selector:"configure"}],element:"destroy",fields:{jid:gs("jid"),password:Sn(null,"password"),reason:Sn(null,"reason")},namespace:yi},{element:"x",fields:{action:Jn("invite"),continue:rn("continue"),jid:gs("jid"),legacyReason:vn(),password:nn("password"),reason:nn("reason"),thread:nn("thread")},namespace:jr,path:"message.muc",type:"direct-invite",typeOrder:2},{element:"unique",fields:{name:vn()},namespace:Jr,path:"iq.muc",type:"unique"},_s({legacyMUC:{exporter(e,t,n){const i=n.registry?n.registry.export("message.muc",Object.assign(Object.assign({},t),{type:"direct-invite"})):void 0;i&&e.appendChild(i)},exportOrder:100001,importer(e,t){if(!qt(e,vi,"x")[0])return;const n=qt(e,jr,"x")[0];return n&&t.registry?t.registry.import(n,Object.assign(Object.assign({},t),{path:"message"})):void 0},importOrder:-1}})],Ec=[{aliases:["iq.ibb","message.ibb"],element:"open",fields:{ack:{importer:(e,t)=>"message"!==nn("stanza","iq").importer(e,t),exporter(e,t,n){nn("stanza").exporter(e,t?"iq":"message",n)}},blockSize:sn("block-size"),sid:nn("sid")},namespace:bi,type:"open",typeField:"action"},{aliases:["iq.ibb","message.ibb"],element:"close",fields:{sid:nn("sid")},namespace:bi,type:"close",typeField:"action"},{aliases:["iq.ibb","message.ibb"],element:"data",fields:{data:_n("base64"),seq:sn("seq"),sid:nn("sid")},namespace:bi,type:"data",typeField:"action"}],Ic=[{aliases:[{path:"bookmarkStorage",impliedType:!0},{path:"iq.privateStorage.bookmarks",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"storage",namespace:_i,type:_i,typeField:"itemType"},{aliases:[{path:"bookmarkStorage.rooms",multiple:!0}],element:"conference",fields:{autoJoin:rn("autojoin"),jid:gs("jid"),name:nn("name"),nick:Sn(null,"nick"),password:Sn(null,"password")},namespace:_i}],Nc={element:"query",namespace:wi,path:"iq.privateStorage"},kc=[bs(li,"x",["iq.command.form"]),Ts({commandError:Ln(Si,["bad-action","bad-locale","bad-payload","bad-sessionid","malformed-action","session-expired"])}),{element:"command",fields:{action:nn("action"),node:nn("node"),sid:nn("sessionid"),status:nn("status")},namespace:Si,path:"iq.command"},{element:"actions",fields:{complete:An(null,"complete"),execute:nn("execute"),next:An(null,"next"),prev:An(null,"prev")},namespace:Si,path:"iq.command.availableActions"},{aliases:[{path:"iq.command.notes",multiple:!0}],element:"note",fields:{type:nn("type"),value:vn()},namespace:Si}],Ac="vcardTemp.records";function Oc(e,t){return{aliases:[{multiple:!0,path:Ac}],element:e,fields:{value:vn()},namespace:xi,type:t,typeField:"type"}}const jc=[{aliases:[{path:"iq.vcard"}],defaultType:xi,element:"vCard",fields:{fullName:Sn(null,"FN")},namespace:xi,path:"vcardTemp",type:xi,typeField:"format"},{element:"N",fields:{additional:Object.assign(Object.assign({},Sn(null,"MIDDLE")),{order:3}),family:Object.assign(Object.assign({},Sn(null,"FAMILY")),{order:1}),given:Object.assign(Object.assign({},Sn(null,"GIVEN")),{order:2}),prefix:Object.assign(Object.assign({},Sn(null,"PREFIX")),{order:4}),suffix:Object.assign(Object.assign({},Sn(null,"SUFFIX")),{order:5})},namespace:xi,path:"vcardTemp.name"},Oc("NICKNAME","nickname"),Oc("BDAY","birthday"),Oc("JABBERID","jid"),Oc("TZ","timezone"),Oc("TITLE","title"),Oc("ROLE","role"),Oc("URL","url"),Oc("NOTE","note"),Oc("SORT-STRING","sort"),Oc("UID","uid"),Oc("REV","revision"),Oc("PRODID","productId"),Oc("DESC","description"),{aliases:[{multiple:!0,path:Ac}],element:"EMAIL",fields:{preferred:An(null,"PREF"),types:Bn(null,[["home","HOME"],["work","WORK"],["internet","INTERNET"]]),value:Sn(null,"USERID")},namespace:xi,type:"email"},{aliases:[{path:Ac,multiple:!0}],element:"ORG",fields:{units:Object.assign(Object.assign({},Fn(null,"ORGUNIT")),{order:2}),value:Object.assign(Object.assign({},Sn(null,"ORGNAME")),{order:1})},namespace:xi,type:"organization",typeField:"type"},{aliases:[{multiple:!0,path:Ac}],element:"ADR",fields:{city:Sn(null,"LOCALITY"),code:Sn(null,"PCODE"),country:Sn(null,"CTRY"),pobox:Sn(null,"POBOX"),preferred:An(null,"PREF"),region:Sn(null,"REGION"),street:Sn(null,"STREET"),street2:Sn(null,"EXTADD"),types:Bn(null,[["home","HOME"],["work","WORK"],["domestic","DOM"],["international","INTL"],["postal","POSTAL"],["parcel","PARCEL"]])},namespace:xi,type:"address",typeField:"type"},{aliases:[{multiple:!0,path:Ac}],element:"LABEL",fields:{lines:Fn(null,"LINE"),preferred:An(null,"PREF"),types:Bn(null,[["home","HOME"],["work","WORK"]])},namespace:xi,type:"addressLabel",typeField:"type"},{aliases:[{multiple:!0,path:Ac}],element:"TEL",fields:{preferred:An(null,"PREF"),types:Bn(null,[["home","HOME"],["work","WORK"],["cell","CELL"],["fax","FAX"],["voice","VOICE"],["msg","MSG"]]),value:Sn(null,"NUMBER","",!0)},namespace:xi,type:"tel",typeField:"type"},{aliases:[{multiple:!0,path:Ac}],element:"PHOTO",fields:{data:Sn(null,"BINVAL"),mediaType:Sn(null,"TYPE"),url:Sn(null,"EXTVAL")},namespace:xi,type:"photo",typeField:"type"},{aliases:[{multiple:!0,path:Ac}],element:"LOGO",fields:{data:Sn(null,"BINVAL"),mediaType:Sn(null,"TYPE"),url:Sn(null,"EXTVAL")},namespace:xi,type:"logo",typeField:"type"},{aliases:[{multiple:!0,path:Ac}],element:"CATEGORIES",fields:{value:Fn(null,"KEYWORD")},namespace:xi,type:"categories",typeField:"type"}],Cc=[bs(li,"x",["iq.search.form"]),bs(Ei,"set",["iq.search.paging"]),{element:"query",fields:{email:Sn(null,"email"),familyName:Sn(null,"last"),givenName:Sn(null,"first"),instructions:Sn(null,"instructions"),nick:Sn(null,"nick")},namespace:Ti,path:"iq.search"},{aliases:[{path:"iq.search.items",multiple:!0}],element:"item",fields:{email:Sn(null,"email"),familyName:Sn(null,"last"),givenName:Sn(null,"first"),jid:gs("jid"),nick:Sn(null,"nick")},namespace:Ti}],Rc={aliases:["iq.pubsub.paging"],element:"set",fields:{after:Sn(null,"after"),before:Sn(null,"before"),count:En(null,"count"),first:Sn(null,"first"),firstIndex:mn(null,"first","index"),index:En(null,"index"),last:Sn(null,"last"),max:En(null,"max")},namespace:Ei,path:"paging"},Pc={configurable:An(null,"subscribe-options"),configurationRequired:Rn([{namespace:null,element:"subscribe-options"},{namespace:null,element:"required"}]),jid:gs("jid"),node:nn("node"),state:nn("subscription"),subid:nn("subid")},Lc={node:nn("node")},Mc=[{aliases:["pubsub","iq.pubsub","message.pubsub"],childrenExportOrder:{configure:0,create:100,publish:100,subscribe:100,subscriptionOptions:0},defaultType:"user",element:"pubsub",fields:{publishOptions:Gn(null,"publish-options","dataform")},namespace:Ii,type:"user",typeField:"context"},{aliases:["pubsub","iq.pubsub","message.pubsub"],defaultType:"user",element:"pubsub",fields:{purge:hn(null,"purge","node")},namespace:Ai,type:"owner",typeField:"context"},bs(li,"x",["iq.pubsub.configure.form","iq.pubsub.defaultConfiguration.form","iq.pubsub.defaultSubscriptionOptions.form","iq.pubsub.subscriptionOptions.form","message.pubsub.configuration.form"]),bs(Ei,"set",["iq.pubsub.fetch.paging"]),Ts({pubsubError:Ln(Ni,Object.values(Yo)),pubsubUnsupportedFeature:hn(Ni,"unsupported","feature")}),{element:"subscribe",fields:{jid:gs("jid"),node:nn("node")},namespace:Ii,path:"iq.pubsub.subscribe"},{element:"unsubscribe",fields:{jid:gs("jid"),node:nn("node"),subid:nn("subid")},namespace:Ii,path:"iq.pubsub.unsubscribe"},{element:"options",fields:{jid:gs("jid"),node:nn("node"),subid:nn("subid")},namespace:Ii,path:"iq.pubsub.subscriptionOptions"},{aliases:[{path:"iq.pubsub.subscriptions",selector:"user",impliedType:!0}],element:"subscriptions",fields:{jid:gs("jid"),node:nn("node")},namespace:Ii,type:"user"},{aliases:[{path:"iq.pubsub.subscriptions",selector:"owner",impliedType:!0}],element:"subscriptions",fields:{jid:gs("jid"),node:nn("node")},namespace:Ai,type:"owner"},{aliases:[{path:"iq.pubsub.subscription",selector:"owner"},{impliedType:!0,multiple:!0,path:"iq.pubsub.subscriptions.items",selector:"owner"}],element:"subscription",fields:Pc,namespace:Ii},{aliases:[{path:"iq.pubsub.subscription",selector:"user"},{impliedType:!0,multiple:!0,path:"iq.pubsub.subscriptions.items",selector:"user"}],element:"subscription",fields:Pc,namespace:Ii,type:"user"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.subscriptions.items",selector:"owner"}],element:"subscription",fields:Pc,namespace:Ai,type:"owner"},{aliases:[{path:"iq.pubsub.affiliations",selector:"user",impliedType:!0},{path:"message.pubsub.affiliations",selector:"user",impliedType:!0}],element:"affiliations",fields:Lc,namespace:Ii,type:"user"},{aliases:[{path:"iq.pubsub.affiliations",selector:"owner",impliedType:!0}],element:"affiliations",fields:Lc,namespace:Ai,type:"owner"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.affiliations.items",selector:"user"},{impliedType:!0,multiple:!0,path:"message.pubsub.affiliations.items",selector:"user"}],element:"affiliation",fields:{affiliation:nn("affiliation"),jid:gs("jid"),node:nn("node")},namespace:Ii,type:"user"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.affiliations.items",selector:"owner"}],element:"affiliation",fields:{affiliation:nn("affiliation"),jid:gs("jid"),node:nn("node")},namespace:Ai,type:"owner"},{element:"create",fields:Lc,namespace:Ii,path:"iq.pubsub.create"},{aliases:[{path:"iq.pubsub.destroy",selector:"owner"}],element:"delete",fields:{node:nn("node"),redirect:hn(null,"redirect","uri")},namespace:Ai},{aliases:[{path:"iq.pubsub.configure",selector:"owner",impliedType:!0}],element:"configure",fields:Lc,namespace:Ai,type:"owner"},{aliases:[{path:"iq.pubsub.configure",selector:"user",impliedType:!0}],element:"configure",fields:Lc,namespace:Ii,type:"user"},{element:"default",fields:{node:nn("node")},namespace:Ii,path:"iq.pubsub.defaultSubscriptionOptions"},{element:"default",fields:{},namespace:Ai,path:"iq.pubsub.defaultConfiguration"},{element:"publish",fields:Lc,namespace:Ii,path:"iq.pubsub.publish"},{element:"retract",fields:{id:hn(null,"item","id"),node:nn("node"),notify:rn("notify")},namespace:Ii,path:"iq.pubsub.retract"},{element:"items",fields:{max:sn("max_items"),node:nn("node")},namespace:Ii,path:"iq.pubsub.fetch"},{aliases:["pubsubitem","iq.pubsub.publish.item",{multiple:!0,path:"iq.pubsub.fetch.items"}],element:"item",fields:{id:nn("id"),publisher:gs("publisher")},namespace:Ii},{element:"event",fields:{eventType:Ln(null,["purge","delete","subscription","configuration","items"])},namespace:ki,path:"message.pubsub",type:"event",typeField:"context"},{aliases:[{path:"message.pubsub.items.published",multiple:!0}],element:"item",fields:{id:nn("id"),publisher:gs("publisher")},namespace:ki,path:"pubsubeventitem"},{element:"purge",fields:Lc,namespace:ki,path:"message.pubsub.purge"},{element:"delete",fields:{node:nn("node"),redirect:hn(null,"redirect","uri")},namespace:ki,path:"message.pubsub.delete"},{aliases:[{path:"message.pubsub.subscription",selector:"event",impliedType:!0}],element:"subscription",fields:{expires:(Fc="expiry",{importer(e){const t=e.getAttribute(Fc);return"presence"===t?t:t?new Date(t):void 0},exporter(e,t){let n;n="string"==typeof t?t:t.toISOString(),e.setAttribute(Fc,n)}}),jid:gs("jid"),node:nn("node"),subid:nn("subid"),type:nn("subscription")},namespace:ki,type:"event"},{element:"configuration",fields:Lc,namespace:ki,path:"message.pubsub.configuration"},{element:"items",fields:{node:nn("node"),retracted:Dn(null,"retract","id")},namespace:ki,path:"message.pubsub.items"}];var Fc;const Dc=[{element:"query",fields:{activate:Sn(null,"activate"),address:nn("dstaddr"),candidateUsed:ys(null,"streamhost-used","jid"),mode:nn("mode","tcp"),sid:nn("sid"),udpSuccess:hn(null,"udpsuccess","dstaddr")},namespace:Oi,path:"iq.socks5"},{aliases:[{multiple:!0,path:"iq.socks5.candidates"}],element:"streamhost",fields:{host:nn("host"),jid:gs("jid"),port:sn("port"),uri:nn("uri")},namespace:Oi}],qc=[{aliases:[{multiple:!0,path:"message.links"}],element:"x",fields:{description:Sn(null,"desc"),url:Sn(null,"url")},namespace:ji},{element:"query",fields:{description:Sn(null,"desc"),url:Sn(null,"url")},namespace:Ci,path:"iq.transferLink"}],Uc={element:"html",fields:{alternateLanguageBodies:Xn(Ri,"body","xhtmlim"),body:zn(Ri,"body","xhtmlim")},namespace:Pi,path:"message.html"},Bc=[xs({inbandRegistration:An(Mi,"register")}),bs(li,"x",["iq.account.form"]),bs(ji,"x",["iq.account.registrationLink"]),{element:"query",fields:{address:Sn(null,"address"),date:Tn(null,"date"),email:Sn(null,"email"),familyName:Sn(null,"last"),fullName:Sn(null,"name"),givenName:Sn(null,"first"),instructions:Sn(null,"instructions"),key:Sn(null,"key"),locality:Sn(null,"city"),misc:Sn(null,"misc"),nick:Sn(null,"nick"),password:Sn(null,"password"),phone:Sn(null,"phone"),postalCode:Sn(null,"zip"),region:Sn(null,"state"),registered:An(null,"registered"),remove:An(null,"remove"),text:Sn(null,"text"),uri:Sn(null,"uri"),username:Sn(null,"username")},namespace:Li,path:"iq.account"}],Gc={aliases:[{path:"message.geoloc",impliedType:!0},{path:"dataform.fields.geoloc",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"geoloc",fields:{accuracy:In(null,"accuracy"),altitude:In(null,"alt"),altitudeAccuracy:In(null,"altaccuracy"),area:Sn(null,"area"),building:Sn(null,"building"),country:Sn(null,"country"),countryCode:Sn(null,"countrycode"),datum:Sn(null,"datum"),description:Sn(null,"description"),error:In(null,"error"),floor:Sn(null,"floor"),heading:In(null,"bearing"),lang:wn(),latitude:In(null,"lat"),locality:Sn(null,"locality"),longitude:In(null,"lon"),postalCode:Sn(null,"postalcode"),region:Sn(null,"region"),room:Sn(null,"room"),speed:In(null,"speed"),street:Sn(null,"street"),text:Sn(null,"text"),timestamp:Tn(null,"timestamp"),tzo:kn(null,"tzo"),uri:Sn(null,"uri")},namespace:Fi,type:Fi},Jc=[{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"data",fields:{data:_n("base64")},namespace:Di,path:"avatar",type:Di,typeField:"itemType"},{aliases:[{path:"avatar",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"metadata",namespace:qi,type:qi,typeField:"itemType",childrenExportOrder:{versions:1,pointers:2}},{aliases:[{multiple:!0,path:"avatar.versions",selector:qi}],element:"info",fields:{bytes:sn("bytes"),height:sn("height"),id:nn("id"),mediaType:nn("type"),uri:nn("url"),width:sn("width")},namespace:qi},{aliases:[{multiple:!0,path:"avatar.pointers",selector:qi}],element:"pointer",fields:{bytes:sn("bytes"),height:sn("height"),id:nn("id"),mediaType:nn("type"),width:sn("width")},namespace:qi}];var zc=_s({chatState:Ln(Ui,Object.values(Zo))});const Xc={element:"query",fields:{name:Sn(null,"name"),os:Sn(null,"os"),version:Sn(null,"version")},namespace:Bi,path:"iq.softwareVersion"},$c={aliases:[{path:"message.mood",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"mood",fields:{alternateLanguageText:Un(null,"text"),text:Sn(null,"text"),value:Ln(null,oa)},namespace:Gi,type:Gi},Vc={aliases:[{path:"activity",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"activity",fields:{activity:Mn(null,aa,ca),alternateLanguageText:Un(null,"text"),text:Sn(null,"text")},namespace:Ji,type:Ji},Hc={element:"handshake",fields:{value:_n("hex")},namespace:zi,path:"handshake"},Wc={aliases:[{path:"presence.legacyCapabilities",multiple:!0},{path:"features.legacyCapabilities",multiple:!0}],element:"c",fields:{algorithm:nn("hash"),legacy:Jn(!0),node:nn("node"),value:nn("ver")},namespace:Xi},Qc={aliases:[{impliedType:!0,path:"tune"},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"tune",fields:{artist:Sn(null,"artist"),length:En(null,"length"),rating:En(null,"rating"),source:Sn(null,"source"),title:Sn(null,"title"),track:Sn(null,"track"),uri:Sn(null,"uri")},namespace:$i,type:$i},Kc=["dataformLayout",{multiple:!0,path:"dataformLayout.contents"},{multiple:!0,path:"dataform.layout.contents"}],Yc=[{aliases:[{multiple:!0,path:"dataform.layout"}],element:"page",fields:{label:nn("label")},namespace:Yi},{aliases:Kc,element:"section",fields:{label:nn("label")},namespace:Yi,type:"section",typeField:"type"},{aliases:Kc,element:"text",fields:{value:vn()},namespace:Yi,type:"text",typeField:"type"},{aliases:Kc,element:"fieldref",fields:{field:nn("var")},namespace:Yi,type:"fieldref",typeField:"type"},{aliases:Kc,element:"reportedref",namespace:Yi,type:"reportedref",typeField:"type"}],Zc={element:"body",fields:{acceptMediaTypes:nn("accept"),ack:sn("ack"),authId:nn("authid"),characterSets:nn("charsets"),condition:nn("condition"),from:gs("from"),key:nn("key"),lang:wn(),maxClientRequests:sn("requests"),maxHoldOpen:sn("hold"),maxInactivityTime:sn("inactivity"),maxSessionPause:sn("maxpause"),maxWaitTime:sn("wait"),mediaType:nn("content"),minPollingInterval:sn("polling"),newKey:nn("newkey"),pauseSession:sn("pause"),report:sn("report"),rid:sn("rid"),route:nn("string"),seeOtherURI:Sn(null,"uri"),sid:nn("sid"),stream:nn("stream"),time:sn("time"),to:gs("to"),type:nn("type"),version:nn("ver"),xmppRestart:ln("xmpp",Sr,"restart",void 0,{writeValue:e=>e?"true":"false"}),xmppRestartLogic:ln("xmpp",Sr,"restartlogic",void 0,{writeValue:e=>e?"true":"false"}),xmppVersion:cn("xmpp",Sr,"version")},namespace:Hi,path:"bosh"},el=[_s({headers:Gn(Wi,"headers","header",!0)}),ws({headers:Gn(Wi,"headers","header",!0)}),{element:"header",fields:{name:nn("name"),value:vn()},namespace:Wi,path:"header"}],tl=[{element:"compression",fields:{methods:Fn(null,"method")},namespace:Qi,path:"features.compression"},{element:"compress",fields:{method:Sn(null,"method")},namespace:Ki,path:"compression",type:"start",typeField:"type"},{aliases:["error.compressionError"],element:"failure",fields:{condition:Ln(null,["unsupported-method","setup-failed","processing-failed"])},namespace:Ki,path:"compression",type:"failure",typeField:"type"},{element:"compressed",namespace:Ki,path:"compression",type:"success",typeField:"type"}],nl=[_s({rosterExchange:Gn(Zi,"x","rosterExchange",!0)}),Ss({rosterExchange:Gn(Zi,"x","rosterExchange",!0)}),{element:"item",fields:{action:nn("action"),groups:Fn(null,"group"),jid:gs("jid"),name:nn("name")},namespace:Zi,path:"rosterExchange"}];var il=ws({vcardAvatar:{importer(e){const t=qt(e,er,"x");if(!t.length)return;const n=qt(t[0],er,"photo");return!n.length||n[0].getText()},exporter(e,t){const n=Ut(e,er,"x");if(""===t)Ut(n,er,"photo");else{if(!0===t)return;if(t){Ut(n,er,"photo").children.push(t)}}}}});const rl=[_s({captcha:Gn(ir,"captcha","dataform")}),Ss({captcha:Gn(ir,"captcha","dataform")})],sl=[Ts({jingleError:Ln(or,Object.values(ra))}),{element:"jingle",fields:{action:nn("action"),initiator:gs("initiator"),responder:gs("responder"),sid:nn("sid")},namespace:sr,path:"iq.jingle"},{aliases:[{multiple:!0,path:"iq.jingle.contents"}],element:"content",fields:{creator:nn("creator"),disposition:nn("disposition","session"),name:nn("name"),senders:nn("senders","both")},namespace:sr},{element:"reason",fields:{alternativeSession:Sn(null,"alternative-session"),condition:Ln(null,Object.values(sa)),text:Sn(null,"text")},namespace:sr,path:"iq.jingle.reason"}];function ol(){return{importer(e,t){let n=qt(e,Mr,"rtcp-fb");const i=nn("type").importer,r=nn("subtype").importer,s=nn("value").importer,o=[];for(const e of n){const n=i(e,t),s=r(e,t);o.push(s?{type:n,parameter:s}:{type:n})}n=qt(e,Mr,"rtcp-fb-trr-int");for(const e of n){const n=s(e,t);o.push(n?{type:"trr-int",parameter:n}:{type:"trr-int"})}return o},exporter(e,t,n){const i=nn("type").exporter,r=nn("subtype").exporter,s=nn("value").exporter;for(const o of t){let t;"trr-int"===o.type?(t=Mt(Mr,"rtcp-fb-trr-int",n.namespace,e),o.parameter&&s(t,o.parameter,n)):(t=Mt(Mr,"rtcp-fb",n.namespace,e),i(t,o.type,n),o.parameter&&r(t,o.parameter,n)),e.appendChild(t)}}}}const al="iq.jingle.info",cl=[{aliases:["iq.jingle.contents.application"],childrenExportOrder:{codecs:4,encryption:5,headerExtensions:6,sourceGroups:8,sources:7,streams:9},element:"description",fields:{media:nn("media"),rtcpFeedback:Object.assign(Object.assign({},ol()),{exportOrder:3}),rtcpMux:Object.assign(Object.assign({},An(null,"rtcp-mux")),{exportOrder:1}),rtcpReducedSize:Object.assign(Object.assign({},An(null,"rtcp-reduced-size")),{exportOrder:2}),ssrc:nn("ssrc")},namespace:ar,optionalNamespaces:{rtcpf:Mr,rtph:Fr},type:ar},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.headerExtensions",selector:ar}],element:"rtp-hdrext",fields:{id:sn("id"),senders:nn("senders"),uri:nn("uri")},namespace:Fr},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.codecs",selector:ar},"rtpcodec"],element:"payload-type",fields:{channels:sn("channels"),clockRate:sn("clockrate"),id:nn("id"),maxptime:sn("maxptime"),name:nn("name"),parameters:$n(ar,"parameter","name","value"),ptime:sn("ptime"),rtcpFeedback:ol()},namespace:ar},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.sources",selector:ar}],element:"source",fields:{parameters:$n(ts,"parameter","name","value"),ssrc:nn("ssrc")},namespace:ts},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.sourceGroups",selector:ar}],element:"ssrc-group",fields:{semantics:nn("semantics"),sources:Dn(null,"source","ssrc")},namespace:ts},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.streams",selector:ar}],element:"stream",fields:{id:nn("id"),track:nn("track")},namespace:ms},{aliases:[{path:"iq.jingle.contents.application.encryption",selector:ar}],element:"encryption",fields:{required:rn("required")},namespace:ar},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.encryption.sdes",selector:ar}],element:"crypto",fields:{cryptoSuite:nn("crypto-suite"),keyParameters:nn("key-params"),sessionParameters:nn("session-params"),tag:sn("tag")},namespace:ar},{aliases:[{path:"iq.jingle.contents.application.encryption.zrtp",selector:ar}],element:"zrtp-hash",fields:{value:_n("hex"),version:nn("version")},namespace:ar},{element:"mute",fields:{creator:nn("creator"),name:nn("name")},namespace:cr,path:al,type:ua},{element:"unmute",fields:{creator:nn("creator"),name:nn("name")},namespace:cr,path:al,type:pa},{element:"hold",namespace:cr,path:al,type:da},{element:"unhold",namespace:cr,path:al,type:ha},{element:"active",namespace:cr,path:al,type:fa},{element:"ringing",namespace:cr,path:al,type:ma}],ll=[_s({nick:Sn(pr,"nick")}),ws({nick:Sn(pr,"nick")}),{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"nick",fields:{nick:vn()},namespace:pr,type:pr}],ul=e=>[{element:"transport",fields:{gatheringComplete:An(null,"gathering-complete"),password:nn("pwd"),usernameFragment:nn("ufrag")},namespace:e,path:"iq.jingle.contents.transport",type:e,typeField:"transportType"},{aliases:[{impliedType:!0,path:"iq.jingle.contents.transport.remoteCandidate",selector:e}],element:"remote-candidate",fields:{component:sn("component"),ip:nn("ip"),port:sn("port")},namespace:e,type:e,typeField:"transportType"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:e}],element:"candidate",fields:{component:sn("component"),foundation:nn("foundation"),generation:sn("generation"),id:nn("id"),ip:nn("ip"),network:sn("network"),port:sn("port"),priority:sn("priority"),protocol:nn("protocol"),relatedAddress:nn("rel-addr"),relatedPort:nn("rel-port"),tcpType:nn("tcptype"),type:nn("type")},namespace:e,type:e,typeField:"transportType"}],pl=[...ul(as),...ul(dr)],dl=[{element:"transport",fields:{gatheringComplete:An(null,"gathering-complete"),password:nn("pwd"),usernameFragment:nn("ufrag")},namespace:hr,path:"iq.jingle.contents.transport",type:hr,typeField:"transportType"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:hr}],element:"candidate",fields:{component:sn("component"),foundation:nn("foundation"),generation:sn("generation"),id:nn("id"),ip:nn("ip"),port:sn("port"),type:nn("type")},namespace:hr,type:hr,typeField:"transportType"}],hl=[{element:"request",namespace:fr,path:"message.receipt",type:"request",typeField:"type"},{element:"received",fields:{id:nn("id")},namespace:fr,path:"message.receipt",type:"received",typeField:"type"}],fl=[{element:"invisible",fields:{probe:rn("probe")},namespace:mr,path:"iq.visibility",type:"invisible",typeField:"type"},{element:"visible",namespace:mr,path:"iq.visibility",type:"visible"}],ml=[Ts({blocked:An(yr,"blocked")}),{element:"blocklist",fields:{jids:Dn(null,"item","jid")},namespace:gr,path:"iq.blockList",type:"list",typeField:"action"},{element:"block",fields:{jids:Dn(null,"item","jid")},namespace:gr,path:"iq.blockList",type:"block",typeField:"action"},{element:"unblock",fields:{jids:Dn(null,"item","jid")},namespace:gr,path:"iq.blockList",type:"unblock",typeField:"action"}],gl=[xs({streamManagement:An(vr,"sm")}),{element:"a",fields:{handled:sn("h")},namespace:vr,path:"sm",type:"ack",typeField:"type"},{element:"r",namespace:vr,path:"sm",type:"request",typeField:"type"},{element:"enable",fields:{allowResumption:rn("resume")},namespace:vr,path:"sm",type:"enable",typeField:"type"},{element:"enabled",fields:{id:nn("id"),resume:rn("resume")},namespace:vr,path:"sm",type:"enabled",typeField:"type"},{element:"resume",fields:{handled:sn("h"),previousSession:nn("previd")},namespace:vr,path:"sm",type:"resume",typeField:"type"},{element:"resumed",fields:{handled:sn("h"),previousSession:nn("previd")},namespace:vr,path:"sm",type:"resumed",typeField:"type"},{element:"failed",fields:{handled:sn("h")},namespace:vr,path:"sm",type:"failed",typeField:"type"}];var yl=Ss({ping:An(br,"ping")});const vl={element:"time",fields:{tzo:kn(null,"tzo"),utc:Tn(null,"utc")},namespace:_r,path:"iq.time"},bl={aliases:["message.delay","presence.delay"],element:"delay",fields:{from:gs("from"),reason:vn(),timestamp:an("stamp")},namespace:wr},_l={2:Tr,1:xr},wl=[];for(const[e,t]of Object.entries(_l))wl.push({aliases:["iq.externalServiceCredentials"],defaultType:"2",element:"credentials",fields:{expires:yn(null,"service","expires"),host:hn(null,"service","host"),name:hn(null,"service","name"),password:hn(null,"service","password"),port:mn(null,"service","port"),restricted:fn(null,"service","restricted"),transport:hn(null,"service","transport"),type:hn(null,"service","type"),username:hn(null,"service","username")},namespace:t,type:e,typeField:"version"},{aliases:["iq.externalServices"],defaultType:"2",element:"services",fields:{type:nn("type")},namespace:t,type:e,typeField:"version"},{aliases:[{path:"iq.externalServices.services",multiple:!0}],defaultType:"2",element:"service",fields:{expires:an("expires"),host:nn("host"),name:nn("name"),password:nn("password"),port:sn("port"),restricted:rn("restricted"),transport:nn("transport"),type:nn("type"),username:nn("username")},namespace:t,type:e,typeField:"version"});const Sl=[{element:"media",fields:{height:sn("height"),width:sn("width")},namespace:Er,path:"dataform.fields.media"},{aliases:[{multiple:!0,path:"dataform.fields.media.sources"}],element:"uri",fields:{mediaType:nn("type"),uri:vn()},namespace:Er}];var xl=_s({requestingAttention:An(Ir,"attention")});const Tl={aliases:["iq.bits",{path:"message.bits",multiple:!0},{path:"presence.bits",multiple:!0},{path:"iq.jingle.bits",multiple:!0}],element:"data",fields:{cid:nn("cid"),data:_n("base64"),maxAge:sn("max-age"),mediaType:nn("type")},namespace:Nr};let El=[bs(Ur,"hash",[{path:"file.hashes",multiple:!0},{path:"file.range.hashes",multiple:!0}]),bs(qr,"hash",[{path:"file.hashes",multiple:!0},{path:"file.range.hashes",multiple:!0}]),bs(Ur,"hash-used",[{path:"file.hashesUsed",multiple:!0}]),bs(Pr,"thumbnail",[{path:"file.thumbnails",multiple:!0}])];for(const e of[kr,Ar])El=El.concat([{aliases:["file",{impliedType:!0,path:"iq.jingle.contents.application.file",selector:e},{impliedType:!0,path:"iq.jingle.info.file",selector:`{${e}}checksum`}],defaultType:Ar,element:"file",fields:{date:Tn(null,"date"),description:Sn(null,"desc"),mediaType:Sn(null,"media-type"),name:Sn(null,"name"),size:En(null,"size")},namespace:e,type:e,typeField:"version"},{aliases:[{impliedType:!0,path:"file.range",selector:e}],defaultType:Ar,element:"range",fields:{length:sn("length"),offset:sn("offset",0)},namespace:e,type:e,typeField:"version"},{element:"description",namespace:e,path:"iq.jingle.contents.application",type:e,typeField:"applicationType"},{element:"received",fields:{creator:nn("creator"),name:nn("name")},namespace:e,path:"iq.jingle.info",type:`{${e}}received`,typeField:"infoType"},{element:"checksum",fields:{creator:nn("creator"),name:nn("name")},namespace:e,path:"iq.jingle.info",type:`{${e}}checksum`,typeField:"infoType"}]);var Il=El;const Nl={element:"description",namespace:Or,path:"iq.jingle.contents.application",type:Or,typeField:"applicationType"},kl=[{element:"transport",fields:{activated:hn(null,"activated","cid"),address:nn("dstaddr"),candidateError:An(null,"candidate-error"),candidateUsed:hn(null,"candidate-used","cid"),mode:nn("mode","tcp"),proxyError:An(null,"proxy-error"),sid:nn("sid")},namespace:Cr,path:"iq.jingle.contents.transport",type:Cr,typeField:"transportType"},{aliases:[{multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:Cr}],element:"candidate",fields:{cid:nn("cid"),host:nn("host"),jid:gs("jid"),port:sn("port"),priority:sn("priority"),type:nn("type"),uri:nn("uri")},namespace:Cr}],Al={element:"transport",fields:{ack:{importer:(e,t)=>"message"!==nn("stanza","iq").importer(e,t),exporter(e,t,n){!1===t&&nn("stanza").exporter(e,"message",n)}},blockSize:sn("block-size"),sid:nn("sid")},namespace:Rr,path:"iq.jingle.contents.transport",type:Rr,typeField:"transportType"},Ol=[bs(Nr,"data",[{path:"iq.jingle.bits",multiple:!0}]),{element:"thumbnail",fields:{height:sn("height"),mediaType:nn("media-type"),uri:nn("uri"),width:sn("width")},namespace:Pr,path:"thumbnail"}],jl=[bs(Dr,"forwarded",["message.carbon.forward"]),{element:"enable",namespace:Lr,path:"iq.carbons",type:"enable",typeField:"action"},{element:"disable",namespace:Lr,path:"iq.carbons",type:"disable",typeField:"action"},{element:"sent",namespace:Lr,path:"message.carbon",type:"sent",typeField:"type"},{element:"received",namespace:Lr,path:"message.carbon",type:"received",typeField:"type"}],Cl=[...Object.values($o).map((e=>bs(e,"message",["forward.message"]))),...Object.values($o).map((e=>bs(e,"presence",["forward.presence"]))),...Object.values($o).map((e=>bs(e,"iq",["forward.iq"]))),bs(wr,"delay",["forward.delay"]),{aliases:["message.forward"],element:"forwarded",namespace:Dr,path:"forward"}],Rl=[{defaultType:"2",element:"hash",fields:{algorithm:nn("algo"),value:_n("base64"),version:Jn("2")},namespace:Ur,path:"hash",type:"2",typeField:"version"},{element:"hash-used",fields:{algorithm:nn("algo"),version:Jn("2")},namespace:Ur,path:"hashUsed"},{element:"hash",fields:{algorithm:nn("algo"),value:_n("hex"),version:Jn("1")},namespace:qr,path:"hash",type:"1",typeField:"version"}],Pl=[{element:"rtt",fields:{event:nn("event","edit"),id:nn("id"),seq:sn("seq")},namespace:Gr,path:"message.rtt"},{aliases:[{path:"message.rtt.actions",multiple:!0}],element:"t",fields:{position:sn("p"),text:vn()},namespace:Gr,type:"insert",typeField:"type"},{aliases:[{path:"message.rtt.actions",multiple:!0}],element:"e",fields:{length:sn("n",1),position:sn("p")},namespace:Gr,type:"erase",typeField:"type"},{aliases:[{multiple:!0,path:"message.rtt.actions"}],element:"w",fields:{duration:sn("n",0)},namespace:Gr,type:"wait",typeField:"type"}];var Ll=_s({replace:hn(zr,"replace","id")});const Ml={2:Vr,1:$r},Fl=[bs(li,"x",["iq.archive.form"]),bs(Dr,"forwarded",["message.archive.item"]),bs(Ei,"set",["iq.archive.paging"])];for(const[e,t]of Object.entries(Ml))Fl.push({defaultType:"query",defaultVersion:"2",element:"query",fields:{node:nn("node"),queryId:nn("queryid")},namespace:t,path:"iq.archive",type:"query",typeField:"type",version:e,versionField:"version"},{element:"fin",fields:{complete:rn("complete"),stable:rn("stable")},namespace:t,path:"iq.archive",type:"result",version:e},{element:"prefs",fields:{default:nn("default"),always:Pn([{namespace:null,element:"always"},{namespace:null,element:"jid"}]),never:Pn([{namespace:null,element:"never"},{namespace:null,element:"jid"}])},namespace:t,path:"iq.archive",type:"preferences",version:e},{element:"result",defaultType:"2",fields:{id:nn("id"),queryId:nn("queryid")},namespace:t,path:"message.archive",type:e,typeField:"version"});const Dl="message.marker";const ql=[oc,ac,gc,yc,vc,bc,_c,wc,Sc,xc,Tc,Ec,Ic,Nc,kc,jc,Cc,Rc,Mc,Dc,qc,Uc,Bc,Gc,Jc,zc,Xc,$c,Vc,Hc,Wc,Qc,Zc,el,tl,Yc,nl,il,rl,sl,cl,ll,pl,dl,hl,fl,ml,gl,yl,vl,bl,wl,Sl,xl,Tl,Il,Nl,kl,Al,Ol,jl,Cl,Rl,Pl,Ll,Fl,[ws({hats:Gn(Hr,"hats","hat",!0)}),{element:"hat",fields:{id:nn("name"),name:nn("displayName")},namespace:Hr,path:"hat"}],ws({idleSince:Tn(Wr,"since")}),{aliases:[{multiple:!0,path:"iq.jingle.contents.transport.fingerprints",selector:dr},{multiple:!0,path:"iq.jingle.contents.transport.fingerprints",selector:as},{multiple:!0,path:"iq.jingle.contents.application.encryption.dtls",selector:ar}],element:"fingerprint",fields:{algorithm:nn("hash"),setup:nn("setup"),value:vn()},namespace:Qr},[{element:"markable",namespace:Kr,path:Dl,type:"markable",typeField:"type"},{element:"received",fields:{id:nn("id")},namespace:Kr,path:Dl,type:"received"},{element:"displayed",fields:{id:nn("id")},namespace:Kr,path:Dl,type:"displayed"},{element:"acknowledged",fields:{id:nn("id")},namespace:Kr,path:Dl,type:"acknowledged"}],_s({processingHints:{importer(e){const t={};let n=!1;for(const i of e.children)if("string"!=typeof i&&i.getNamespace()===Yr)switch(i.getName()){case"no-copy":t.noCopy=!0,n=!0;break;case"no-permanent-store":t.noPermanentStore=!0,n=!0;break;case"no-store":t.noStore=!0,n=!0;break;case"store":t.store=!0,n=!0}return n?t:void 0},exporter(e,t,n){t.noCopy&&e.appendChild(Mt(Yr,"no-copy",n.namespace,e)),t.noPermanentStore&&e.appendChild(Mt(Yr,"no-permanent-store",n.namespace,e)),t.noStore&&e.appendChild(Mt(Yr,"no-store",n.namespace,e)),t.store&&e.appendChild(Mt(Yr,"store",n.namespace,e))}}}),[_s({json:Nn(Zr,"json")}),{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"json",fields:{json:bn()},namespace:Zr,type:Zr},{aliases:[{path:"message.jsonPayloads",multiple:!0}],element:"payload",fields:{type:nn("datatype"),data:Nn(Zr,"json")},namespace:hs}],[{aliases:[{path:"iq.jingle.groups",multiple:!0}],element:"group",fields:{contents:Dn(null,"content","name"),semantics:nn("semantics")},namespace:es}],{aliases:[{path:"iq.jingle.contents.transport.sctp",selector:dr},{path:"iq.jingle.contents.transport.sctp",selector:as}],element:"sctpmap",fields:{port:sn("number"),protocol:nn("protocol"),streams:nn("streams")},namespace:ns},[{element:"active",namespace:is,path:"csi",type:"active",typeField:"state"},{element:"inactive",namespace:is,path:"csi",type:"inactive",typeField:"state"}],[bs(li,"x",["iq.push.form","pushNotification.form"]),{element:"enable",fields:{jid:gs("jid"),node:nn("node")},namespace:rs,path:"iq.push",type:"enable",typeField:"action"},{element:"disable",fields:{jid:gs("jid"),node:nn("node")},namespace:rs,path:"iq.push",type:"disable",typeField:"action"},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"notification",namespace:rs,path:"pushNotification",type:rs,typeField:"itemType"}],[_s({originId:hn(ss,"origin-id","id")}),{aliases:[{path:"message.stanzaIds",multiple:!0}],element:"stanza-id",fields:{by:gs("by"),id:nn("id")},namespace:ss}],[Ts({httpUploadError:Ln(os,["file-too-large","retry"]),httpUploadMaxFileSize:Cn([{namespace:os,element:"file-too-large"},{namespace:os,element:"max-file-size"}]),httpUploadRetry:yn(os,"retry","stamp")}),{element:"request",fields:{mediaType:nn("content-type"),name:nn("filename"),size:sn("size")},namespace:os,path:"iq.httpUpload",type:"request",typeField:"type"},{element:"slot",fields:{download:hn(null,"get","url")},namespace:os,path:"iq.httpUpload",type:"slot"},{aliases:[{path:"iq.httpUpload.upload",selector:"slot"}],element:"put",fields:{url:nn("url")},namespace:os},{aliases:[{path:"iq.httpUpload.upload.headers",multiple:!0}],element:"header",fields:{name:nn("name"),value:vn()},namespace:os}],{element:"encryption",fields:{id:nn("namespace"),name:nn("name")},namespace:ls,path:"message.encryptionMethod"},[{aliases:["message.omemo"],element:"encrypted",fields:{payload:xn(null,"payload","base64")},namespace:us,path:"omemo"},{element:"header",fields:{iv:xn(null,"iv","base64"),sid:sn("sid")},namespace:us,path:"omemo.header"},{aliases:[{path:"omemo.header.keys",multiple:!0}],element:"key",fields:{preKey:rn("prekey"),rid:sn("rid"),value:_n("base64")},namespace:us},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"list",fields:{devices:qn(null,"device","id")},namespace:us,type:ps,typeField:"itemType"},{element:"preKeyPublic",fields:{id:sn("preKeyId"),value:_n("base64")},namespace:us,path:"omemoPreKey"},{element:"signedPreKeyPublic",fields:{id:sn("signedPreKeyId"),value:_n("base64")},namespace:us,path:"omemoDevice.signedPreKeyPublic"},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"bundle",fields:{identityKey:xn(null,"identityKey","base64"),preKeys:Gn(null,"prekeys","omemoPreKey",!0),signedPreKeySignature:xn(null,"signedPreKeySignature","base64")},namespace:us,path:"omemoDevice",type:ds,typeField:"itemType"}],[{element:"XRD",fields:{subject:Sn(null,"Subject")},namespace:fs,path:"xrd"},{aliases:[{path:"xrd.links",multiple:!0}],element:"Link",fields:{href:nn("href"),rel:nn("rel"),type:nn("type")},namespace:fs}]];class Ul{constructor(e){this.active=!1,this.maxRetries=5,this.stream=e,this.maxTimeout=1100*this.stream.maxWaitTime}send(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.rid=e,this.active=!0;let n=0;for(;n<=this.maxRetries;){n+=1;try{const e=yield Ro(lo(this.stream.url,{body:t,headers:{"Content-Type":this.stream.contentType},method:"POST"}),this.maxTimeout,(()=>new Error("Request timed out")));if(!e.ok)throw new Error("HTTP Status Error: "+e.status);const n=yield e.text();return this.active=!1,n}catch(e){if(1===n)continue;if(n<this.maxRetries){const e=Math.min(this.maxTimeout,1e3*Math.pow(n,2));yield Po(e+1e3*Math.random());continue}throw this.active=!1,e}}throw new Error("Request failed")}))}}class Bl extends ye.Duplex{constructor(e,t,n){super({objectMode:!0}),this.rid=Math.floor(4294967295*Math.random()),this.sid="",this.maxHoldOpen=2,this.maxWaitTime=30,this.contentType="text/xml; charset=utf-8",this.channels=[new Ul(this),new Ul(this)],this.activeChannelID=0,this.queue=[],this.isEnded=!1,this.client=e,this.sm=t,this.stanzas=n,this.on("data",(e=>{this.client.emit("stream:data",e.stanza,e.kind)})),this.on("end",(()=>{this.isEnded=!0,clearTimeout(this.idleTimeout),this.client.transport===this&&this.client.emit("--transport-disconnected")}))}_write(e,t,n){this.queue.push([e,n]),this.scheduleRequests()}_writev(e,t){this.queue.push([e.map((e=>e.chunk)).join(""),t]),this.scheduleRequests()}_read(){}process(e){const t=new Is({acceptLanguages:this.config.acceptLanguages,allowComments:!1,lang:this.config.lang,registry:this.stanzas,rootKey:"bosh",wrappedStream:!0});t.on("error",(e=>{const t={condition:Ho.InvalidXML};return this.client.emit("stream:error",t,e),this.send("error",t),this.disconnect()})),t.on("data",(e=>{if("stream-start"===e.event)return this.stream=e.stanza,void("terminate"===e.stanza.type?(this.hasStream=!1,this.rid=void 0,this.sid=void 0,this.isEnded||(this.isEnded=!0,this.client.emit("bosh:terminate",e.stanza),this.client.emit("stream:end"),this.push(null))):this.hasStream||(this.hasStream=!0,this.stream=e.stanza,this.sid=e.stanza.sid||this.sid,this.maxWaitTime=e.stanza.maxWaitTime||this.maxWaitTime,this.client.emit("stream:start",e.stanza)));e.event||this.push({kind:e.kind,stanza:e.stanza})})),this.client.emit("raw","incoming",e),t.write(e),this.scheduleRequests()}connect(e){if(this.config=e,this.url=e.url,e.rid&&(this.rid=e.rid),e.sid&&(this.sid=e.sid),e.wait&&(this.maxWaitTime=e.wait),e.maxHoldOpen&&(this.maxHoldOpen=e.maxHoldOpen),this.sid)return this.hasStream=!0,this.stream={},this.client.emit("connected"),this.client.emit("session:prebind",this.config.jid),void this.client.emit("session:started");this._send({lang:e.lang,maxHoldOpen:this.maxHoldOpen,maxWaitTime:this.maxWaitTime,to:e.server,version:"1.6",xmppVersion:"1.0"})}restart(){this.hasStream=!1,this._send({to:this.config.server,xmppRestart:!0})}disconnect(e=!0){this.hasStream&&e?this._send({type:"terminate"}):(this.stream=void 0,this.sid=void 0,this.rid=void 0,this.client.emit("--transport-disconnected"))}send(e,t){var n;return(0,i.__awaiter)(this,void 0,void 0,(function*(){let i;if(t&&(i=null===(n=this.stanzas.export(e,t))||void 0===n?void 0:n.toString()),i)return new Promise(((e,t)=>{this.write(i,"utf8",(n=>n?t(n):e()))}))}))}get sendingChannel(){return this.channels[this.activeChannelID]}get pollingChannel(){return this.channels[0===this.activeChannelID?1:0]}toggleChannel(){this.activeChannelID=0===this.activeChannelID?1:0}_send(e,t=""){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(this.isEnded)return;const n=this.rid++,i=this.stanzas.export("bosh",Object.assign(Object.assign({},e),{rid:n,sid:this.sid}));let r;r=t?[i.openTag(),t,i.closeTag()].join(""):i.toString(),this.client.emit("raw","outgoing",r),this.sendingChannel.send(n,r).then((e=>{this.process(e)})).catch((e=>{this.end(e)})),this.toggleChannel()}))}_poll(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){if(this.isEnded)return;const e=this.rid++,t=this.stanzas.export("bosh",{rid:e,sid:this.sid}).toString();this.client.emit("raw","outgoing",t),this.pollingChannel.send(e,t).then((e=>{this.process(e)})).catch((e=>{this.end(e)}))}))}scheduleRequests(){clearTimeout(this.idleTimeout),this.idleTimeout=setTimeout((()=>{this.fireRequests()}),10)}fireRequests(){if(!this.isEnded)if(this.queue.length)if(this.sendingChannel.active)this.scheduleRequests();else{const[e,t]=this.queue.shift();this._send({},e),t()}else!this.authenticated||this.channels[0].active||this.channels[1].active||this._poll()}}class Gl extends ye.Duplex{constructor(e,t,n){super({objectMode:!0}),this.sm=t,this.stanzas=n,this.closing=!1,this.client=e,this.on("data",(e=>{this.client.emit("stream:data",e.stanza,e.kind)})),this.on("error",(()=>{this.end()})),this.on("end",(()=>{this.client.transport===this&&this.client.emit("--transport-disconnected")}))}_read(){}_write(e,t,n){if(!this.socket||1!==this.socket.readyState)return n(new Error("Socket closed"));const i=be.from(e,"utf8").toString();this.client.emit("raw","outgoing",i),this.socket.send(i),n()}connect(e){this.config=e,this.hasStream=!1,this.closing=!1,this.parser=new Is({acceptLanguages:this.config.acceptLanguages,allowComments:!1,lang:this.config.lang,registry:this.stanzas,wrappedStream:!1}),this.parser.on("data",(e=>{const t=e.kind,n=e.stanza;if("stream"===t){if("open"===n.action)return this.hasStream=!0,this.stream=n,this.client.emit("stream:start",n);if("close"===n.action)return this.client.emit("stream:end"),this.disconnect()}this.push({kind:e.kind,stanza:e.stanza})})),this.parser.on("error",(e=>{const t={condition:Ho.InvalidXML};return this.client.emit("stream:error",t,e),this.write(this.stanzas.export("error",t).toString()),this.disconnect()})),this.socket=new uo(e.url,"xmpp"),this.socket.onopen=()=>{this.emit("connect"),this.sm.started=!1,this.client.emit("connected"),this.write(this.startHeader())},this.socket.onmessage=e=>{const t=be.from(e.data,"utf8").toString();this.client.emit("raw","incoming",t),this.parser&&this.parser.write(t)},this.socket.onclose=()=>{this.push(null)}}disconnect(e=!0){this.socket&&!this.closing&&this.hasStream&&e?(this.closing=!0,this.write(this.closeHeader())):(this.hasStream=!1,this.stream=void 0,this.socket&&(this.end(),this.socket.close(),this.client.transport===this&&this.client.emit("--transport-disconnected")),this.socket=void 0)}send(e,t){var n;return(0,i.__awaiter)(this,void 0,void 0,(function*(){let i;if(t&&(i=null===(n=this.stanzas.export(e,t))||void 0===n?void 0:n.toString()),i)return new Promise(((e,t)=>{this.write(i,"utf8",(n=>n?t(n):e()))}))}))}restart(){this.hasStream=!1,this.write(this.startHeader())}startHeader(){return this.stanzas.export("stream",{action:"open",lang:this.config.lang,to:this.config.server,version:"1.0"}).toString()}closeHeader(){return this.stanzas.export("stream",{action:"close"}).toString()}}class Jl extends ee.EventEmitter{constructor(e={}){super(),this.reconnectAttempts=0,this.setMaxListeners(100),this.off=this.removeListener,this.updateConfig(e),this.jid="",this.sasl=new fo,this.sasl.register("EXTERNAL",xo,1e3),this.sasl.register("SCRAM-SHA-256-PLUS",No,350),this.sasl.register("SCRAM-SHA-256",No,300),this.sasl.register("SCRAM-SHA-1-PLUS",No,250),this.sasl.register("SCRAM-SHA-1",No,200),this.sasl.register("DIGEST-MD5",Io,100),this.sasl.register("OAUTHBEARER",Eo,100),this.sasl.register("X-OAUTH2",To,50),this.sasl.register("PLAIN",To,1),this.sasl.register("ANONYMOUS",So,0),this.stanzas=new Hn,this.stanzas.define(ql),this.use(rc),this.sm=new Se,void 0!==this.config.allowResumption&&(this.sm.allowResume=this.config.allowResumption),this.sm.on("prebound",(e=>{this.jid=e,this.emit("session:bound",e)})),this.on("session:bound",(e=>this.sm.bind(e))),this.sm.on("send",(e=>this.send("sm",e))),this.sm.on("acked",(e=>this.emit("stanza:acked",e))),this.sm.on("failed",(e=>this.emit("stanza:failed",e))),this.sm.on("hibernated",(e=>this.emit("stanza:hibernated",e))),this.sm.on("begin-resend",(()=>this.outgoingDataQueue.pause())),this.sm.on("resend",(({kind:e,stanza:t})=>this.send(e,t,!0))),this.sm.on("end-resend",(()=>this.outgoingDataQueue.resume()));for(const e of["acked","hibernated","failed"])this.on(`stanza:${e}`,(t=>{"message"===t.kind&&this.emit(`message:${e}`,t.stanza)}));this.transports={bosh:Bl,websocket:Gl},this.incomingDataQueue=Y(((e,t)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const{kind:n,stanza:i}=e;this.emit(n,i),i.id&&this.emit(n+":id:"+i.id,i),"message"===n||"presence"===n||"iq"===n?(this.emit("stanza",i),yield this.sm.handle()):"sm"===n&&("ack"===i.type&&(yield this.sm.process(i),this.emit("stream:management:ack",i)),"request"===i.type&&this.sm.ack()),t&&t()}))),1);const t=(e,t)=>{["message","presence","iq"].includes(e)&&(this.sm.started&&this.sm.resumable?this.sm.resumable&&!this.transport&&this.emit("stanza:hibernated",{kind:e,stanza:t}):this.emit("stanza:failed",{kind:e,stanza:t}))};this.outgoingDataQueue=Y(((e,n)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){var i;const{kind:r,stanza:s,replay:o}=e,a=o||(yield this.sm.track(r,s));if("message"===r&&(o?this.emit("message:retry",s):this.emit("message:sent",s,!1)),this.transport)try{yield this.transport.send(r,s),a&&(null===(i=this.transport)||void 0===i||i.send("sm",{type:"request"}))}catch(e){console.error(e),t(r,s)}else t(r,s);n&&n()}))),1),this.on("stream:data",((e,t)=>{this.incomingDataQueue.push({kind:t,stanza:e},0)})),this.on("--transport-disconnected",(()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const e=[];this.incomingDataQueue.idle()||e.push(this.incomingDataQueue.drain()),this.outgoingDataQueue.idle()||e.push(this.outgoingDataQueue.drain()),yield Promise.all(e),yield this.sm.hibernate(),this.transport&&delete this.transport,this.emit("--reset-stream-features"),!this.sessionTerminating&&this.config.autoReconnect&&(this.reconnectAttempts+=1,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout((()=>{this.connect()}),1e3*Math.min(Math.pow(2,this.reconnectAttempts)+Math.random(),this.config.maxReconnectBackoff||32))),this.emit("disconnected")})))),this.on("iq",(e=>{const t=e.type,n=e.payloadType,i="iq:"+t+":"+n;if("get"===t||"set"===t){if("invalid-payload-count"===n)return this.sendIQError(e,{error:{condition:"bad-request",type:"modify"}});if("unknown-payload"===n||0===this.listenerCount(i))return this.sendIQError(e,{error:{condition:"service-unavailable",type:"cancel"}});this.emit(i,e)}})),this.on("message",(e=>{const t=e.alternateLanguageBodies&&e.alternateLanguageBodies.length||e.links&&e.links.length,n=e.marker&&"markable"!==e.marker.type;t&&!n&&("chat"===e.type||"normal"===e.type?this.emit("chat",e):"groupchat"===e.type&&this.emit("groupchat",e)),"error"===e.type&&this.emit("message:error",e)})),this.on("presence",(e=>{let t=e.type||"available";"error"===t&&(t="presence:error"),this.emit(t,e)})),this.on("session:started",(()=>{this.sessionStarting=!1,this.reconnectAttempts=0,this.reconnectTimer&&clearTimeout(this.reconnectTimer)}))}updateConfig(e={}){const t=this.config||{};this.config=Object.assign(Object.assign({allowResumption:!0,jid:"",transports:{bosh:!0,websocket:!0},useStreamManagement:!0},t),e),this.config.server||(this.config.server=it(this.config.jid)),this.config.password&&(this.config.credentials=this.config.credentials||{},this.config.credentials.password=this.config.password,delete this.config.password)}get stream(){return this.transport?this.transport.stream:void 0}emit(e,...t){const n=super.emit(e,...t);return"raw"===e?(super.emit(`raw:${t[0]}`,t[1]),super.emit("raw:*",`raw:${t[0]}`,t[1]),super.emit("*",`raw:${t[0]}`,t[1])):super.emit("*",e,...t),n}use(e){"function"==typeof e&&e(this,this.stanzas,this.config)}nextId(){return Mo()}getCredentials(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){return this._getConfiguredCredentials()}))}connect(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.sessionTerminating=!1,this.sessionStarting=!0,this.emit("--reset-stream-features"),this.transport&&this.transport.disconnect(!1);const e=["websocket","bosh"];let t;for(const n of e){let e=this.config.transports[n];if(e){if("string"==typeof e)e={url:e};else if(!0===e){if(!t)try{t=yield this.discoverBindings(this.config.server)}catch(e){console.error(e);continue}if(t[n]=(t[n]||[]).filter((e=>e.startsWith("wss:")||e.startsWith("https:"))),!t[n]||!t[n].length)continue;e={url:t[n][0]}}return this.transport=new this.transports[n](this,this.sm,this.stanzas),void this.transport.connect(Object.assign({acceptLanguages:this.config.acceptLanguages||["en"],jid:this.config.jid,lang:this.config.lang||"en",server:this.config.server,url:e.url},e))}}console.error("No endpoints found for the requested transports."),this.emit("--transport-disconnected")}))}disconnect(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.sessionTerminating=!0,clearTimeout(this.reconnectTimer),this.outgoingDataQueue.pause(),this.sessionStarted&&!this.sm.started&&this.emit("session:end"),this.emit("--reset-stream-features"),this.sessionStarted=!1,this.transport?this.transport.disconnect():this.emit("--transport-disconnected"),this.outgoingDataQueue.resume(),this.outgoingDataQueue.idle()||(yield this.outgoingDataQueue.drain()),yield this.sm.shutdown()}))}send(e,t,n=!1){return(0,i.__awaiter)(this,void 0,void 0,(function*(){return new Promise(((i,r)=>{this.outgoingDataQueue.push({kind:e,stanza:t,replay:n},n?0:1,(e=>e?r(e):i()))}))}))}sendMessage(e){const t=e.id||this.nextId(),n=Object.assign({id:t,originId:t},e);return this.send("message",n),n.id}sendPresence(e={}){const t=Object.assign({id:this.nextId()},e);return this.send("presence",t),t.id}sendIQ(e){const t=Object.assign({id:this.nextId()},e),n=et(this.jid,e.to),i="iq:id:"+t.id,r=new Promise(((e,t)=>{const r=s=>{n.has(s.from)&&("result"!==s.type&&"error"!==s.type||(this.off(i,r),"result"===s.type?e(s):t(s)))};this.on(i,r)}));this.send("iq",t);const s=this.config.timeout||15;return Ro(r,1e3*s,(()=>Object.assign(Object.assign({},t),{to:void 0,from:void 0,error:{condition:"timeout",text:`Request timed out after ${s} seconds.`},id:t.id,type:"error"})))}sendIQResult(e,t){this.send("iq",Object.assign(Object.assign({},t),{id:e.id,to:e.from,type:"result"}))}sendIQError(e,t){this.send("iq",Object.assign(Object.assign({},t),{id:e.id,to:e.from,type:"error"}))}sendStreamError(e){this.emit("stream:error",e),this.send("error",e),this.disconnect()}_getConfiguredCredentials(){const e=this.config.credentials||{},t=Ze(this.config.jid||""),n=e.username||t.local,i=e.host||t.domain;return Object.assign({host:i,password:this.config.password,realm:i,serviceName:i,serviceType:"xmpp",username:n},e)}}Symbol.asyncIterator;function zl(e){const t=new Jl(e);return t.use(sc),t}},2553:function(e,t,n){"use strict";var i=n(396).Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=p,t=3;break;default:return this.write=d,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function p(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.s=s,s.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},s.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=o(t[i]);if(r>=0)return r>0&&(e.lastNeed=r-1),r;if(--i<n||-2===r)return 0;if((r=o(t[i]))>=0)return r>0&&(e.lastNeed=r-2),r;if(--i<n||-2===r)return 0;if((r=o(t[i]))>=0)return r>0&&(2===r?r=0:e.lastNeed=r-3),r;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},396:function(e,t,n){var i=n(8764),r=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(s(i,t),t.Buffer=o),s(r,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},5475:function(e,t,n){var i=void 0!==n.g&&n.g||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new s(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(4889),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==n.g&&n.g.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==n.g&&n.g.clearImmediate||this&&this.clearImmediate},8203:function(e,t,n){"use strict";n.r(t),n.d(t,{DeltapathStdLib:function(){return s}});var i=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},r=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},s=function(){function e(){}return e.prototype.connect=function(){throw new Error("Method not implemented.")},e.prototype.disconnect=function(){throw new Error("Method not implemented.")},e.prototype.dispatch=function(e){throw new Error("Method not implemented.")},e.prototype.getCallList=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return"GET",[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/list"+(e?"/moreinfo":""),{method:"GET"})];case 1:return[2,t.sent()]}}))}))},e.prototype.makeCall=function(e,t,n){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return"POST",i=JSON.stringify({to:e,device:t,account_code:n}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/make",{method:"POST",body:i})];case 1:return[2,r.sent()]}}))}))},e.prototype.answerCall=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return"POST",n=JSON.stringify({channelid:e,mac:t}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/answer",{method:"POST",body:n})];case 1:return[2,i.sent()]}}))}))},e.prototype.holdCall=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return"POST",n=JSON.stringify({channelid:e,mac:t}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/hold",{method:"POST",body:n})];case 1:return[2,i.sent()]}}))}))},e.prototype.resumeCall=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return"POST",n=JSON.stringify({channelid:e,mac:t}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/resume",{method:"POST",body:n})];case 1:return[2,i.sent()]}}))}))},e.prototype.hangupCall=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return"POST",n=JSON.stringify({channelid:e,multiple:t}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/hangup",{method:"POST",body:n})];case 1:return[2,i.sent()]}}))}))},e.prototype.agentLogin=function(e,t,n,s){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return"POST",i=JSON.stringify({switchboardDevice:e,agent:t,queue:n,initial:s}),[4,this.http.fetch(this.restUrl+"/put/frsipswitchboard/frsipswitchboard/device",{method:"POST",body:i})];case 1:return[2,r.sent()]}}))}))},e.prototype.agentLogout=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return"POST",t=JSON.stringify({agentId:e}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/completesignoutagent",{method:"POST",body:t})];case 1:return[2,n.sent()]}}))}))},e.prototype.agentLogoutByQueue=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return"POST",n=JSON.stringify({queueId:e,device:t}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/signoutagent",{method:"POST",body:n})];case 1:return[2,i.sent()]}}))}))},e.prototype.agentPause=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return"POST",t=JSON.stringify({device:e,pause:"yes"}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/completepauseagent",{method:"POST",body:t})];case 1:return[2,n.sent()]}}))}))},e.prototype.agentPauseByQueue=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return"POST",n=JSON.stringify({queueId:e,device:t,pause:"yes"}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/pauseagent",{method:"POST",body:n})];case 1:return[2,i.sent()]}}))}))},e.prototype.agentUnpause=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return"POST",t=JSON.stringify({device:e,pause:"no"}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/completepauseagent",{method:"POST",body:t})];case 1:return[2,n.sent()]}}))}))},e.prototype.agentUnpauseByQueue=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return"POST",n=JSON.stringify({queueId:e,device:t,pause:"no"}),[4,this.http.fetch(this.restUrl+"/frsipswitchboard/call/pauseagent",{method:"POST",body:n})];case 1:return[2,i.sent()]}}))}))},e.prototype.getCallHistory=function(e,t,n,s){return i(this,void 0,void 0,(function(){var i,o;return r(this,(function(r){switch(r.label){case 0:return"GET",i=new URL(this.restUrl+"/v1/get/frsipswitchboard/frsipswitchboard/view/callhistory/list"),o=n?JSON.stringify([n]):void 0,this.http.buildQueryParams(i,{start:e,limit:t,query:s,sort:o}),[4,this.http.fetch(i.href,{method:"GET"})];case 1:return[2,r.sent()]}}))}))},e}()},5601:function(e,t,n){"use strict";n.r(t),n.d(t,{LANG:function(){return i},IM:function(){return r}});var i={TOKEN_DESTROYED:"Token destroyed, please connect again.",WS_NOT_INITIALIZED:"WebSocket not initialized.",NOT_CONNECTED:"Not connected.",INVALID_ARGUMENT_ON_INDEX:function(e){return"Invalid arguments: argument ["+e+"] cannot be empty"},TOO_FEW_ARGUMENTS:"Too few arguments",INVALID_PROTOCOL:"Invalid protocol",INVALID_ACTION_TIMEOUT:"Invalid action timeout",INVALID_RECONNECT_INTERVAL:"Invalid reconnection interval",ALREADY_CONNECTING:"Already connecting.",ALREADY_CONNECTED:"Already connected.",FAIL_TO_REFRESH_TOKEN:"Failed to refresh token.",USER_QUIT:function(e){return e+" quit"},AUTH_FAILED:"Authentication failed.",INVALID_PACKET:"Invalid packet.",ACTION_TIMEOUT:"Action timeout.",PLUGIN_ENABLE_NOT_ALLOWED:"Plugin can only be enabled while disconnected.",INVALID_PLUGIN_TYPE:"Invalid plugin type",METHOD_NOT_IMPLEMENTED:"Method not implemented.",PLUGIN_DISABLE_NOT_ALLOWED:"Plugin can only be disabled while disconnected.",PLUGIN_NOT_USED:function(e){return'Plugin "'+e+'" is not used.'},PLUGIN_NOT_IN_USE:function(e){return'Plugin "'+e+'" is not in-use.'},XMPP_CLIENT_NOT_INITIALIZED:"XMPP client is not initialized.",PLUGIN_UNLOAD_WITH_WARNING:"Plugin unmount with warning",XMPP_CLIENT_INIT_FAILED:"Failed to init XMPP Client",XMPP_CLIENT_CONN_FAILED:"Failed to connect to XMPP Server",XMPP_SESSION_NOT_INITIALIZED:"XMPP session is not initialized.",XMPP_MESSAGE_ATTACHMENT_FAILED_TO_UPLOAD:"Failed to upload message attachment.",XMPP_FAILED_TO_FETCH_REMOTE_DATA:"XMPP client failed to fetch server data.",XMPP_NOT_A_RECEIVED_MSG:"Object is not a valid XMPP received message.",XMPP_FAILED_TO_DECODE:"Failed to decode xml into json data.",XMPP_FAILED_TO_ENCODE:"Failed to encode json data into xml."},r={frSIPURL:"http://www.deltapath.com/im",format:"app",conferencePrefix:"conference."}},5600:function(e,t,n){"use strict";n.r(t),n.d(t,{DeltapathEventDispatcherClient:function(){return s}});var i=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},r=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},s=function(){function e(e){this.deltapath=e}return e.prototype.getAgentStatus=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getAgentStatus"})];case 1:return[2,e.sent()]}}))}))},e.prototype.getCallStatus=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getCallStatus"})];case 1:return[2,e.sent()]}}))}))},e.prototype.getDeviceStatus=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getDeviceStatus"})];case 1:return[2,e.sent()]}}))}))},e.prototype.getMeetme=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getMeetme"})];case 1:return[2,e.sent()]}}))}))},e.prototype.getPcPresence=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getPcPresence"})];case 1:return[2,e.sent()]}}))}))},e.prototype.getPcPresenceWithStatus=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getPcPresenceWithStatus"})];case 1:return[2,e.sent()]}}))}))},e.prototype.getQueueCallStatus=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getQueueCallStatus"})];case 1:return[2,e.sent()]}}))}))},e.prototype.getQueueStatus=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getQueueStatus"})];case 1:return[2,e.sent()]}}))}))},e.prototype.getVMStatus=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.deltapath.dispatch({cmd:"getVMStatus"})];case 1:return[2,e.sent()]}}))}))},e.prototype.monitorExt=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.deltapath.dispatch({cmd:"monitorExt",extensions:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.pcPresence=function(e,t){return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,this.deltapath.dispatch({cmd:"pcPresence",state:e,status:t})];case 1:return[2,n.sent()]}}))}))},e}()},8519:function(e,t,n){"use strict";n.r(t),n.d(t,{Deltapath:function(){return d}});n(5475);var i,r=n(2241),s=n(7029),o=n(6940),a=n(172),c=n(2023),l=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},p=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},d=function(e){function t(n,i,r,l,u,p,d){void 0===l&&(l="http"),void 0===u&&(u=30),void 0===p&&(p=1);var h=e.call(this)||this;h.hostname=n,h.username=i,h.protocol=l,h.actionTimeout=u,h.reconnectInterval=p,h.authMode=d,h.uuid=0,h.handlers=[],h.http=new t.HTTP(h),h.ws=new t.Socket(h),h.mutex=new t.Mutex,h.isConnected=!1,h.isConnecting=!1,h.ed=new o.DeltapathEventDispatcherClient(h),h.plugins=new a.PluginRegistry(h);var f=0;for(var m in arguments){if(parseInt(m)<3){var g=arguments[m];if(null==g||""===g)throw new Error(s.LANG.INVALID_ARGUMENT_ON_INDEX(m))}f++}if(f<3)throw new Error(s.LANG.TOO_FEW_ARGUMENTS);if("http"!==l&&"https"!==l)throw new Error(s.LANG.INVALID_PROTOCOL);if(null!=u&&""!==u.toString()||(h.actionTimeout=u=30),null!=p&&""!==p.toString()||(h.reconnectInterval=p=1),NaN==u||u<0)throw new Error(s.LANG.INVALID_ACTION_TIMEOUT);if(NaN==p||p<0)throw new Error(s.LANG.INVALID_RECONNECT_INTERVAL);if("prebind"===d)h.secret=r.trim();else h.secret=(0,c.md5)((0,c.md5)(r)+"@deltapath");return h.restUrl=l+"://"+n+"/RESTful/index.php",h.wsUrl=("http"===l?"ws":"wss")+"://"+n+":"+("http"===l?"12121":"12122")+"/sockjs/websocket",h.token=new t.Token(h),h}return l(t,e),t.prototype.getEventDispatcherClient=function(){return this.ed},t.prototype.getPlugins=function(){return this.plugins},t.prototype.connect=function(){return u(this,void 0,void 0,(function(){var e,t,n,i=this;return p(this,(function(r){switch(r.label){case 0:return[4,this.mutex.lock()];case 1:e=r.sent();try{if(this.isConnecting)return[2,new Error(s.LANG.ALREADY_CONNECTING)];this.isConnecting=!0}finally{e()}r.label=2;case 2:return r.trys.push([2,8,,10]),this.isConnected?(this.isConnecting=!1,[2,new Error(s.LANG.ALREADY_CONNECTED)]):[4,this.token.refresh(!0)];case 3:return r.sent()?[4,this.plugins.load()]:(this.isConnecting=!1,[2,new Error(s.LANG.FAIL_TO_REFRESH_TOKEN)]);case 4:return(t=r.sent())instanceof Error?[4,this.plugins.unload()]:[3,6];case 5:return r.sent(),this.isConnecting=!1,[2,t];case 6:return[4,new Promise((function(e){var t=null,n={onclose:function(r){switch(!0){case!i.isConnected:case 4999===r.code&&(!r.reason||r.reason===s.LANG.USER_QUIT(i.username)):case i.reconnectInterval<1:return i.isConnected=!1,i.isConnecting=!1,void e(null!=t?t:new Error(r.toString()))}u(i,void 0,void 0,(function(){var e,t=this;return p(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),4888!==r.code||r.reason&&r.reason!==s.LANG.AUTH_FAILED?[3,2]:[4,this.token.refresh()];case 1:i.sent(),i.label=2;case 2:return[3,4];case 3:return(e=i.sent())instanceof Error&&e.message===s.LANG.TOKEN_DESTROYED?[2]:[3,4];case 4:return setTimeout((function(){t.ws.open(n)}),1e3*this.reconnectInterval),[2]}}))}))},onerror:function(e){t=new Error(e.toString()),i.ws.close(1011,e.toString())},onmessage:function(e){var t,n,r,s,o,a,c=0;try{a=JSON.parse(e.data)}catch(e){return}a.uuid&&(c=parseInt(a.uuid)),NaN!=c&&i.handlers[c]&&i.handlers[c](a);var l="string"==typeof a.e?a.e:"";l?((l.includes("CallStatus")||"Meetme"===l)&&(null===(r=i.onCallUpdate)||void 0===r||r.call(i,a)),"PcPresence"===l&&(null===(s=i.onPresenceUpdate)||void 0===s||s.call(i,a)),null===(o=i.defaultEventHandler)||void 0===o||o.call(i,a)):"reload"===a.clientCmd&&(null===(t=i.onWebServerPush)||void 0===t||t.call(i,a),null===(n=i.defaultEventHandler)||void 0===n||n.call(i,a))},onopen:function(n){t=null,u(i,void 0,void 0,(function(){var t,n,i,r=this;return p(this,(function(o){switch(o.label){case 0:return n=(t=this.ws).send,i={cmd:"apiAuth"},[4,this.token.string()];case 1:return n.apply(t,[(i.token=o.sent(),i.subscribeOnly=["PcPresence","Meetme","VMStatus","QueueStatus","CallStatus","AgentStatus","QueueCallStatus"],i),function(t){var n;if(!0===t.success){var i=r.isConnected;r.isConnected=!0,r.isConnecting=!1,e(null),i||null===(n=r.onInitialize)||void 0===n||n.call(r,t)}else e(new Error(s.LANG.AUTH_FAILED)),r.ws.close(4888,s.LANG.AUTH_FAILED)}]),[2]}}))}))}};i.ws.open(n)}))];case 7:return[2,r.sent()];case 8:return n=r.sent(),[4,this.disconnect()];case 9:return r.sent(),this.isConnected=!1,this.isConnecting=!1,n instanceof Error?[2,n]:[2,new Error(n)];case 10:return[2]}}))}))},t.prototype.disconnect=function(){return u(this,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:return[4,this.plugins.unload()];case 1:return e.sent(),this.ws.close(4999,s.LANG.USER_QUIT(this.username)),[4,this.token.destroy()];case 2:return[2,e.sent()]}}))}))},t.prototype.dispatch=function(e){return u(this,void 0,void 0,(function(){var t=this;return p(this,(function(n){switch(n.label){case 0:if(!this.isConnected)throw new Error(s.LANG.NOT_CONNECTED);if("object"!=typeof e||null===e||Array.isArray(e))throw new Error(s.LANG.INVALID_PACKET);return[4,new Promise((function(n,i){t.ws.send(e,(function(e){return n(e)})),setTimeout((function(){i(new Error(s.LANG.ACTION_TIMEOUT))}),1e3*t.actionTimeout)}))];case 1:return[2,n.sent()]}}))}))},t.Mutex=function(){function e(){this.current=Promise.resolve()}return e.prototype.lock=function(){var e,t=new Promise((function(t){e=function(){return t()}})),n=this.current.then((function(){return e}));return this.current=t,n},e}(),t.Token=function(){function e(e){this.deltapath=e,this.destroyed=!1,this._t="","prebind"===e.authMode&&(this._t=e.secret)}return e.prototype.string=function(){return u(this,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:return[4,this.deltapath.mutex.lock()];case 1:e=t.sent();try{if(this.destroyed)throw new Error(s.LANG.TOKEN_DESTROYED);return[2,this._t]}finally{e()}return[2]}}))}))},e.prototype.refresh=function(e){return u(this,void 0,void 0,(function(){var t,n,i,r,o,a;return p(this,(function(c){switch(c.label){case 0:return[4,this.deltapath.mutex.lock()];case 1:t=c.sent(),c.label=2;case 2:if(c.trys.push([2,8,9,10]),this.destroyed){if(!0!==e)throw new Error(s.LANG.TOKEN_DESTROYED);this.destroyed=!1}return n=this.deltapath.restUrl,i=new Headers({"Content-Type":"application/json"}),r=void 0,o=void 0,this._t?[3,4]:[4,fetch(n+"/api/token/request",{method:"POST",headers:i,body:JSON.stringify({username:this.deltapath.username,data:this.deltapath.secret})})];case 3:return r=c.sent(),[3,6];case 4:return i.append("X-frSIP-API-Token",this._t),[4,fetch(n+"/put/api/token/refresh",{method:"POST",headers:i,body:JSON.stringify({username:this.deltapath.username})})];case 5:r=c.sent(),c.label=6;case 6:return[4,r.json()];case 7:return(o=c.sent()).success?(this._t=o.token,[2,!0]):[2,!1];case 8:if((a=c.sent())instanceof Error&&a.message===s.LANG.TOKEN_DESTROYED)throw a;return[2,!1];case 9:return t(),[7];case 10:return[2]}}))}))},e.prototype.destroy=function(){return u(this,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:return[4,this.deltapath.mutex.lock()];case 1:e=t.sent(),t.label=2;case 2:return t.trys.push([2,,4,5]),this.destroyed||(this.destroyed=!0),"prebind"===this.deltapath.authMode?[2]:[4,fetch(this.deltapath.restUrl+"/delete/api/token/expire",{method:"POST",headers:{"X-frSIP-API-Token":this._t,"Content-Type":"application/json"},body:JSON.stringify({username:this.deltapath.username})})];case 3:return t.sent(),this._t="",[3,5];case 4:return e(),[7];case 5:return[2]}}))}))},e}(),t.Socket=function(){function e(e){this.deltapath=e,this._sock=null,this.pid=0,this.fanouts=new Map}return e.prototype.pipeOn=function(e){return this.fanouts.set(++this.pid,e),this.pid},e.prototype.pipeOff=function(e){this.fanouts.delete(e)},e.prototype.open=function(e){var t=this;this._sock=new WebSocket(this.deltapath.wsUrl),this._sock.onclose=e.onclose,this._sock.onerror=e.onerror,this._sock.onmessage=function(n){setImmediate((function(){return t.fanouts.forEach((function(e){return e(n)}))})),e.onmessage(n)},this._sock.onopen=e.onopen},e.prototype.close=function(e,t){this._sock&&this._sock.close(e,t)},e.prototype.send=function(e,t){if(!this._sock)throw new Error(s.LANG.WS_NOT_INITIALIZED);this.deltapath.handlers[++this.deltapath.uuid]=t,e.uuid=this.deltapath.uuid.toString(),this._sock.send(JSON.stringify(e))},e}(),t.HTTP=function(){function e(e){this.deltapath=e,this.isUnsafe=!1}return e.prototype.assertUnsafe=function(e){this.isUnsafe=e},e.prototype.fetch=function(e,t,n){return u(this,void 0,void 0,(function(){var i=this;return p(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r,o){var a=new AbortController,c=a.signal;t.signal=c,u(i,void 0,void 0,(function(){var i,a,c,l,u,d;return p(this,(function(p){switch(p.label){case 0:p.trys.push([0,6,,7]),p.label=1;case 1:if(!this.isUnsafe&&!this.deltapath.isConnected)throw new Error(s.LANG.NOT_CONNECTED);return t.method||(t.method="GET"),a=Headers.bind,d={"Content-Type":"application/json"},c="X-frSIP-API-Token",[4,this.deltapath.token.string()];case 2:return i=new(a.apply(Headers,[void 0,(d[c]=p.sent(),d)])),("POST"!==t.method.toUpperCase()&&"PUT"!==t.method.toUpperCase()||n)&&i.delete("Content-Type"),t.headers=i,[4,fetch(e,t)];case 3:return 401!==(l=p.sent()).status?(r(l),[2]):[4,this.deltapath.token.refresh()];case 4:return p.sent(),[3,1];case 5:return[3,7];case 6:return(u=p.sent())instanceof Error?o(u):o(new Error(u.toString())),[2];case 7:return[2]}}))})),setTimeout((function(){a.abort()}),1e3*i.deltapath.actionTimeout)}))];case 1:return[2,r.sent()]}}))}))},e.prototype.buildQueryParams=function(e,t){if(t&&Object.keys(t).length&&t.constructor===Object)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&null!=t[n]&&e.searchParams.set(n,t[n])},e}(),t}(r.DeltapathStdLib)},2210:function(e,t,n){"use strict";n.r(t),n.d(t,{Reg:function(){return s}});var i=n(3082),r=n(7848),s=function(){function e(){}return e.xmpp=r.DeltapathXMPP,e.hook=i.Hook,e}()},871:function(e,t,n){"use strict";n.r(t),n.d(t,{Hook:function(){return s}});var i=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},r=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},s=function(){function e(){}return e.prototype.setHooker=function(e){this.hooker=e},e.prototype.doLoad=function(){var e,t;return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,null===(e=this.hooker)||void 0===e?void 0:e.doLoad()];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},e.prototype.doUnload=function(){var e;return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,null===(e=this.hooker)||void 0===e?void 0:e.doUnload()];case 1:return[2,t.sent()]}}))}))},e}()},1444:function(e,t,n){"use strict";n.r(t),n.d(t,{PluginRegistry:function(){return a}});var i=n(7029),r=n(1694),s=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},o=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},a=function(){function e(e){this.deltapath=e,this.container={}}return e.prototype.use=function(e){var t=this;if(this.deltapath.isConnected||this.deltapath.isConnecting)throw new Error(i.LANG.PLUGIN_ENABLE_NOT_ALLOWED);if(null!=this.container[e])return this.container[e];var n=function(){switch(e){case"xmpp":return new r.Reg.xmpp(t.deltapath);case"hook":return new r.Reg.hook;default:return new(function(){function e(){throw new Error(i.LANG.INVALID_PLUGIN_TYPE)}return e.prototype.doLoad=function(){throw new Error(i.LANG.METHOD_NOT_IMPLEMENTED)},e.prototype.doUnload=function(){throw new Error(i.LANG.METHOD_NOT_IMPLEMENTED)},e}())}}();return this.container[e]=n,n},e.prototype.unuse=function(e){if(this.deltapath.isConnected||this.deltapath.isConnecting)throw new Error(i.LANG.PLUGIN_DISABLE_NOT_ALLOWED);if(null==this.container[e])throw new Error(i.LANG.PLUGIN_NOT_USED(e));delete this.container[e]},e.prototype.get=function(e){var t=this.container[e];if(null==t)throw new Error(i.LANG.PLUGIN_NOT_IN_USE(e));return t},e.prototype.load=function(){return s(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:if(!Object.values(this.container).length)return[2,null];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,Promise.all(Object.values(this.container).map((function(e){return e.doLoad()})))];case 2:return[2,t.sent().reduce((function(e,t){return e instanceof Error?e:t instanceof Error?t:null}))];case 3:return(e=t.sent())instanceof Error?[2,e]:[2,new Error(e.toString())];case 4:return[2]}}))}))},e.prototype.unload=function(){return s(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),Object.values(this.container).length?[4,Promise.allSettled(Object.values(this.container).map((function(e){return e.doUnload()})))]:[2];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),console.error(i.LANG.PLUGIN_UNLOAD_WITH_WARNING,e),[3,3];case 3:return[2]}}))}))},e}()},8404:function(e,t,n){"use strict";n.r(t),n.d(t,{DeltapathXMPP:function(){return v}});var i,r=n(1568),s=n(7029),o=n(9566),a=n(9420),c=n(956),l=n(2729),u=n(5836),p=n(2526),d=n(2456),h=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(){return f=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},f.apply(this,arguments)},m=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},g=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},y=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,s=t.length;r<s;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},v=function(e){function t(t){var n=e.call(this)||this;return n.deltapath=t,n.isLoaded=!1,n.im=new p.DeltapathIM(n),n}return h(t,e),t.prototype.getCurrentSession=function(){return!this.session||(0,a.isEmpty)(this.session)?null:f({},this.session)},t.prototype.xml2rawWithTemplate=function(e,t){return(0,a.throwOnNull)(this.client,s.LANG.XMPP_CLIENT_NOT_INITIALIZED),this.im.xml2rawWithTemplate(this.client.stanzas,e,t)},t.prototype.xml2raw=function(e,t,n){return(0,a.throwOnNull)(this.client,s.LANG.XMPP_CLIENT_NOT_INITIALIZED),this.im.xml2raw(this.client.stanzas,e,t,n)},t.prototype.raw2xml=function(e){return(0,a.throwOnNull)(this.client,s.LANG.XMPP_CLIENT_NOT_INITIALIZED),this.im.raw2xml(this.client.stanzas,e)},t.prototype.rawMessageToReceivedMessage=function(e){return(0,a.throwOnNull)(this.client,s.LANG.XMPP_CLIENT_NOT_INITIALIZED),this.im.rawMessageToReceivedMessage(e)},t.prototype.parseJID=function(e){return{full:e,bare:r.G6.toBare(e),node:r.G6.getLocal(e),domain:r.G6.getDomain(e),resource:r.G6.getResource(e)}},t.prototype.sendRaw=function(e){return(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),null==e.id&&(e.id=this.im.getMessageUniqueId()),this.client.sendMessage(f(f({},e),{receipt:{type:"request"}}))},t.prototype.sendMessage=function(e,t,n,i){var r,s,o,a;return(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),"chat"===(n=n||-1!==e.indexOf(this.session.conferenceDomain)?"groupchat":"chat")&&(null===(r=this.client)||void 0===r||r.sendMessage({id:this.im.getMessageUniqueId(),from:null===(s=this.session)||void 0===s?void 0:s.jid.full,to:null===(o=this.session)||void 0===o?void 0:o.jid.bare,type:n,body:t,outgoing:e,replyTo:i})),this.client.sendMessage({id:this.im.getMessageUniqueId(),from:null===(a=this.session)||void 0===a?void 0:a.jid.full,to:e,type:n,body:t,replyTo:i,receipt:{type:"request"}})},t.prototype.sendFile=function(e,t,n,i,r){var o,c,l,u;return m(this,void 0,void 0,(function(){var p,h,f,m,y,v;return g(this,(function(g){switch(g.label){case 0:(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),i=i||-1!==e.indexOf(this.session.conferenceDomain)?"groupchat":"chat",g.label=1;case 1:return g.trys.push([1,4,,5]),[4,this.im.uploadAttachment(t)];case 2:return(h=g.sent()).ok||(0,a.throwResponse)(h),[4,h.json()];case 3:return f=g.sent(),m=f.success,y=f.meta,(0,a.throwOnEmpty)(m,s.LANG.XMPP_MESSAGE_ATTACHMENT_FAILED_TO_UPLOAD),(0,a.throwOnEmpty)(y,s.LANG.XMPP_MESSAGE_ATTACHMENT_FAILED_TO_UPLOAD),y.thumbnail=!0===y.thumbnail?"1":"0",p=y,[3,5];case 4:if((v=g.sent())instanceof Error)throw v;throw new Error(s.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return"chat"===i&&(null===(o=this.client)||void 0===o||o.sendMessage({id:this.im.getMessageUniqueId(),from:null===(c=this.session)||void 0===c?void 0:c.jid.full,to:null===(l=this.session)||void 0===l?void 0:l.jid.bare,type:i,body:n,attachment:p,outgoing:e,replyTo:r})),[2,this.client.sendMessage({id:this.im.getMessageUniqueId(),from:null===(u=this.session)||void 0===u?void 0:u.jid.full,to:e,type:i,body:n,attachment:p,replyTo:r,receipt:{type:"request"}})]}}))}))},t.prototype.sendLocation=function(e,t,n,i,r,s,o){var a,c,l,u;(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session);var p={latitude:t,longitude:n,isLive:i};return"chat"===(s=s||-1!==e.indexOf(this.session.conferenceDomain)?"groupchat":"chat")&&(null===(a=this.client)||void 0===a||a.sendMessage({id:this.im.getMessageUniqueId(),from:null===(c=this.session)||void 0===c?void 0:c.jid.full,to:null===(l=this.session)||void 0===l?void 0:l.jid.bare,type:s,body:r,location:p,outgoing:e,replyTo:o})),this.client.sendMessage({id:this.im.getMessageUniqueId(),from:null===(u=this.session)||void 0===u?void 0:u.jid.full,to:e,type:s,body:r,location:p,replyTo:o,receipt:{type:"request"}})},t.prototype.sendRawReplyTo=function(e,t){return this.sendRaw(f(f({},t),{replyTo:e}))},t.prototype.sendMessageReplyTo=function(e,t,n,i){return this.sendMessage(t,n,i,e)},t.prototype.sendFileReplyTo=function(e,t,n,i,r){return m(this,void 0,void 0,(function(){return g(this,(function(s){return[2,this.sendFile(t,n,i,r,e)]}))}))},t.prototype.sendLocationReplyTo=function(e,t,n,i,r,s,o){return this.sendLocation(t,n,i,r,s,o,e)},t.prototype.sendCommand=function(e,t,n,i){var s;void 0===i&&(i="normal"),(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session);var o=this.im.getMessageUniqueId(),a="updateGroup"===e?(i="groupchat",r.G6.toBare(t)):n,c={type:e,text:this.im.stripLocalConfDomainFromJid(t)},l=null===(s=this.session)||void 0===s?void 0:s.jid.full;return this.client.sendMessage({id:o,from:l,to:a,command:c,type:i})},t.prototype.sendViewConversationNotif=function(e,t,n){var i,r;return(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),this.client.sendMessage({from:null===(i=this.session)||void 0===i?void 0:i.jid.full,to:null===(r=this.session)||void 0===r?void 0:r.jid.bare,type:"normal",id:this.im.getMessageUniqueId(),viewConversation:{target:e,isGroup:t,lastMsgId:n}})},t.prototype.sendReadConversationNotif=function(e,t,n){var i;return(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),this.client.sendMessage({from:null===(i=this.session)||void 0===i?void 0:i.jid.full,to:e,type:"1"===t?"groupchat":"normal",id:this.im.getMessageUniqueId(),readConversation:{target:e,isGroup:t,lastMsgId:n}})},t.prototype.block=function(e){return m(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),[4,this.client.block(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.unblock=function(e){return m(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return(0,d.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),[4,this.client.unblock(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.emit=function(e){for(var t,n,i,r,s,o,a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];null===(t=this.listeners[e])||void 0===t||t.forEach((function(e){return e.apply(void 0,a)}));var l=e.split(":")[0];switch(l){case"message":null===(n=this.listeners["message:*"])||void 0===n||n.forEach((function(t){return t.apply(void 0,y([e],a,!1))}));break;case"user":null===(i=this.listeners["user:*"])||void 0===i||i.forEach((function(t){return t.apply(void 0,y([e],a,!1))}));break;case"group":null===(r=this.listeners["group:*"])||void 0===r||r.forEach((function(t){return t.apply(void 0,y([e],a,!1))}));break;case"command":null===(s=this.listeners["command:*"])||void 0===s||s.forEach((function(t){return t.apply(void 0,y([e],a,!1))}));break;case"webpush":null===(o=this.listeners["webpush:*"])||void 0===o||o.forEach((function(t){return t.apply(void 0,y([e],a,!1))}))}},t.prototype.doLoad=function(){return m(this,void 0,void 0,(function(){var e,t,n,i,o,l,u,p,d,h=this;return g(this,(function(v){switch(v.label){case 0:e="",t="","https"===this.deltapath.protocol?(e="wss://"+this.deltapath.hostname+":5281/websocket",t="https://"+this.deltapath.hostname+":5281/http-bind/"):(e="ws://"+this.deltapath.hostname+":5280/websocket",t="http://"+this.deltapath.hostname+":5280/http-bind/"),v.label=1;case 1:return v.trys.push([1,,3,4]),this.deltapath.http.assertUnsafe(!0),[4,this.deltapath.http.fetch(this.deltapath.restUrl+"/im/user/"+this.deltapath.username+"/init",{method:"POST",body:JSON.stringify({contact:1,blocklist:1,nickname:1,linkedservers:1,remotegroups:1,format:s.IM.format})})];case 2:return n=v.sent(),[3,4];case 3:return this.deltapath.http.assertUnsafe(!1),[7];case 4:if(!n.ok)throw new Error(s.LANG.XMPP_CLIENT_INIT_FAILED);return[4,n.json()];case 5:return i=v.sent(),o=i.auth.username+"@"+i.settings.domain,l=i.settings.domain,u=""+s.IM.conferencePrefix+i.settings.domain,p=f({},i),d={jid:o,password:i.auth.PIN,timeout:this.deltapath.actionTimeout,autoReconnect:this.deltapath.reconnectInterval>0,maxReconnectBackoff:this.deltapath.reconnectInterval||32,transports:{websocket:e,bosh:t}},[4,new Promise((function(e,t){var n=r.eI(d);n.enableKeepAlive(),(0,c.defineDeltapathJXT)(n.stanzas);var v=!1,b=function(e){v=!0;try{n.removeAllListeners(),n.disconnect()}finally{e instanceof Error?t(e):t(new Error(s.LANG.XMPP_CLIENT_CONN_FAILED)),delete h.client,delete h.session,h.im.unforkEventDispatcher()}};h.isLoaded||(h.dieTimer=setTimeout((function(){return!h.isLoaded&&b()}),1e3*Math.max(h.deltapath.actionTimeout,60))),n.on("disconnected",(function(e){!v&&h.isLoaded&&h.deltapath.reconnectInterval>0?setTimeout((function(){n.connect()}),1e3*h.deltapath.reconnectInterval):b(e)})),n.on("session:started",(function(t){return m(h,void 0,void 0,(function(){var s,c,d=this;return g(this,(function(h){switch(h.label){case 0:t||(t=n.jid),this.session={username:i.auth.username,PIN:i.auth.PIN,jid:{full:t,bare:r.G6.toBare(t),node:r.G6.getLocal(t),domain:r.G6.getDomain(t),resource:r.G6.getResource(t)},ownContact:o,domain:l,conferenceDomain:u},p.jid=f({},this.session.jid),p.session=f({},this.session),n.sendPresence(),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Promise.all(p.groupchat.map((function(e){var i=e.unique_id;if(!t)return Promise.reject();var r=t;return i=i.indexOf("@")>=0?i:i+"@"+u,n.joinRoom(i,r,{from:t,muc:{type:"join",history:{maxCharacters:0}}})})))];case 2:return h.sent(),[3,4];case 3:return h.sent(),[2,b()];case 4:p.peerJid={},p.contact.forEach((function(e){p.peerJid[e.contact]=d.im.getPeerJIDFromContact(e),(0,a.isEmpty)(e.message)?e.message=null:(e.message.pojo=d.im.rawMessageToReceivedMessage(d.xml2raw(e.message.xml,e.message.fromJid,e.message.toJid)),e.message.time&&"XMPPMessage"===e.message.pojo.isa&&(e.message.pojo.time=parseInt(e.message.time)))})),h.label=5;case 5:return h.trys.push([5,8,,9]),[4,n.getRoster()];case 6:return s=h.sent(),[4,n.getVCard(this.session.jid.bare)];case 7:return c=h.sent(),[3,9];case 8:return h.sent(),[3,9];case 9:return this.isLoaded||this.emit("load",f(f({},p),{roster:s,vcard:c})),this.isLoaded=!0,e(null),[2]}}))}))})),n.on("connected",(function(){h.isLoaded&&h.emit("reconnect")})),n.on("*",(function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];switch(e){case"message:sent":case"message:error":case"message:failed":case"message:acked":case"message:retry":case"message:hibernated":h.emit.apply(h,y([e,t[0]],t.slice(1),!1))}})),h.im.attachTo("message",n),h.im.attachTo("presence",n),h.im.attachTo("iq",n),h.im.forkEventDispatcher(),n.on("chat",(function(e){h.emit("chat",e)})),n.on("groupchat",(function(e){h.emit("groupchat",e)})),n.connect(),h.client=n}))];case 6:return[2,v.sent()]}}))}))},t.prototype.doUnload=function(){return m(this,void 0,void 0,(function(){var e=this;return g(this,(function(t){switch(t.label){case 0:return t.trys.push([0,,2,3]),this.isLoaded=!1,this.client?[4,new Promise((function(t){var n,i,r;null===(i=null===(n=e.client)||void 0===n?void 0:n.removeAllListeners())||void 0===i||i.once("disconnected",(function(){t()})),null===(r=e.client)||void 0===r||r.disconnect();var s=setInterval((function(){e.client&&!e.client.sessionTerminating||(t(),clearInterval(s))}),500)}))]:[2];case 1:return t.sent(),[3,3];case 2:return this.dieTimer&&clearTimeout(this.dieTimer),delete this.client,delete this.session,this.im.unforkEventDispatcher(),this.emit("unload"),[7];case 3:return[2]}}))}))},t}((0,o.Mixin)(l.DeltapathXMPPEvent,u.DeltapathXMPPHTTP))},3286:function(e,t,n){"use strict";n.r(t),n.d(t,{defineDeltapathJXT:function(){return k}});var i=n(1568),r=n(7583),s=n(7029),o=function(){return o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},a=s.IM.frSIPURL,c=i.Ku.extendMessage({outgoing:(0,r.childText)(a,"outgoing"),replyTo:(0,r.childText)(a,"reply-to")}),l={namespace:a,element:"attachment",aliases:[{path:"message.attachment"}],fields:{fid:(0,r.childText)(null,"fid"),fileName:(0,r.childText)(null,"fileName"),fileSize:(0,r.childText)(null,"fileSize"),fileType:(0,r.childText)(null,"fileType"),thumbnail:(0,r.childText)(null,"thumbnail"),attachmentType:(0,r.childText)(null,"attachmentType")}},u={namespace:a,element:"command",aliases:[{path:"message.command"}],fields:{type:(0,r.attribute)("type"),text:(0,r.text)()}},p={namespace:a,element:"view-conversation",aliases:[{path:"message.viewConversation"}],fields:{target:(0,r.childText)(null,"target"),isGroup:(0,r.childText)(null,"isGroup"),lastMsgId:(0,r.childText)(null,"lastMsgId")}},d={namespace:a,element:"read-conversation",aliases:[{path:"message.readConversation"}],fields:{target:(0,r.childText)(null,"target"),isGroup:(0,r.childText)(null,"isGroup"),lastMsgId:(0,r.childText)(null,"lastMsgId")}};function h(e,t,n){var i,r=null===(i=n.registry)||void 0===i?void 0:i.import(t);return r?o(o({},r),{action:e}):void 0}function f(e,t,n,i,r){var s,o=null===(s=i.registry)||void 0===s?void 0:s.export(e,n,r);o&&(r&&r.namespace&&o.setAttribute("xmlns",r.namespace),t.appendChild(o))}var m,g=i.Ku.extendMessage({fromServerName:(0,r.childText)(a,"fromServerName"),group:{importer:function(e,t){var n=e.getChild("avatar",a);if(n)return h("avatar",n,t);var i=e.getChild("title",a);if(i)return h("title",i,t);var r=e.getChild("kick",a);if(r)return h("kick",r,t);var s=e.getChild("kicked",a);if(s)return h("kicked",s,t);var o=e.getChild("group",a);if(o)switch(o.getAttribute("action")){case"invite":return h("invite",o,t);case"leave":return h("leave",o,t);default:return}var c=e.getChild("muc",a);if(c)switch(c.getAttribute("action")){case"leave":return h("left",c,t);case"join":return h("join",c,t);default:return}},exporter:function(e,t,n){if(t.action&&"string"==typeof t.action)switch(t.action){case"avatar":f("group.avatar",e,t,n);break;case"title":f("group.title",e,t,n);break;case"kick":f("group.kick",e,t,n);break;case"kicked":f("group.kicked",e,t,n);break;case"invite":f("group.invite",e,t,n,o(o({},n),{namespace:a}));break;case"leave":f("group.leave",e,t,n);break;case"left":f("group.left",e,t,n,o(o({},n),{namespace:a}));break;case"join":f("group.join",e,t,n,o(o({},n),{namespace:a}))}}}}),y={namespace:a,element:"avatar",path:"group.avatar",fields:{time:(0,r.integerAttribute)("time"),isAvatarUpdated:(0,r.text)()}},v={namespace:a,element:"title",path:"group.title",fields:{time:(0,r.integerAttribute)("time"),newTitle:(0,r.text)()}},b={namespace:a,element:"group",path:"group.invite",fields:{action:(0,r.attribute)("action"),time:(0,r.integerAttribute)("time"),msgId:(0,r.childText)(a,"msgId")}},_={namespace:a,element:"creator",path:"group.invite.creator",fields:{serverName:(0,r.attribute)("serverName"),finalTarget:(0,r.text)()}},w={namespace:a,element:"jid",aliases:[{path:"group.invite.jids",multiple:!0},{path:"group.join.jids",multiple:!0},{path:"group.left.jids",multiple:!0}],fields:{serverName:(0,r.attribute)("serverName"),finalTarget:(0,r.text)()}},S={namespace:a,element:"kick",path:"group.kick",fields:{serverName:(0,r.attribute)("serverName"),finalTarget:(0,r.text)()}},x={namespace:a,element:"kicked",path:"group.kicked",fields:{toJid:(0,r.text)()}},T={namespace:a,element:"group",path:"group.leave",fields:{action:(0,r.attribute)("action"),time:(0,r.integerAttribute)("time"),toJid:(m=o({staticDefault:void 0},{parseValue:function(e){return e.trim()||void 0},writeValue:function(e){return e.trim()}}),{importer:function(e){var t=e.getText();return t?m.parseValue(t):m.dynamicDefault?m.dynamicDefault(t):m.staticDefault},exporter:function(e,t){if(t||!m.emitEmpty){if(void 0!==t&&t!==m.staticDefault){var n=m.writeValue(t);n&&e.children.push(n)}}else e.children.push("")}})}},E={namespace:a,element:"muc",path:"group.left",aliases:[{path:"group.join"}],fields:{action:{importer:function(e){var t=e.getAttribute("action");if(t&&t.trim())switch(t){case"leave":return"left";case"join":return"join";default:return}},exporter:function(e,t){void 0===t||"string"!=typeof t||"left"!==t&&"join"!==t||e.setAttribute("action","left"===t?"leave":t)}},time:(0,r.integerAttribute)("time")}},I={namespace:a,element:"muc",path:"group.join",fields:{msgId:(0,r.childText)(a,"msgId")}},N={namespace:a,element:"location",aliases:["message.location"],fields:{latitude:(0,r.attribute)("latitude"),longitude:(0,r.attribute)("longitude"),isLive:(0,r.integerAttribute)("isLive")}};function k(e){e.define([c,l,u,p,d,g,y,v,b,_,w,S,x,T,E,I,N])}},1402:function(e,t,n){"use strict";n.r(t),n.d(t,{DeltapathXMPPEvent:function(){return i}});var i=function(){function e(){this.listeners={}}return e.prototype.on=function(e,t){var n;return void 0!==this.listeners[e]&&null!=this.listeners[e]||(this.listeners[e]=new Array),null===(n=this.listeners[e])||void 0===n||n.push(t),this},e.prototype.off=function(e,t){var n,i,r;if(!Array.isArray(this.listeners[e]))return this;for(var s=null,o=(null===(n=this.listeners[e])||void 0===n?void 0:n.length)||0,a=this.listeners[e],c=0;c<o;c++){if(a[c]===t){s=c;break}}return null!==s&&(null===(i=this.listeners[e])||void 0===i||i.splice(s,1)),0===(null===(r=this.listeners[e])||void 0===r?void 0:r.length)&&(this.listeners[e]=null,delete this.listeners[e]),this},e.prototype.addListener=function(e,t){return this.on(e,t)},e.prototype.once=function(e,t){var n=this,i=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];n.off(e,i),t.apply(void 0,r)};return this.on(e,i),this},e.prototype.removeListener=function(e,t){return this.off(e,t)},e.prototype.removeAllListeners=function(e){var t,n,i=this;if(e)null===(t=this.listeners[e])||void 0===t||t.splice(0,null===(n=this.listeners[e])||void 0===n?void 0:n.length),this.listeners[e]=null,delete this.listeners[e];else{var r=[];for(var s in this.listeners)Object.prototype.hasOwnProperty.call(this.listeners,s)&&(this.listeners[s]=null,r.push(s));r.forEach((function(e){return delete i.listeners[e]}))}return this},e.prototype.getListeners=function(e){return this.listeners[e]||[]},e.prototype.listenerCount=function(e){var t;return(null===(t=this.listeners[e])||void 0===t?void 0:t.length)||0},e.prototype.prependListener=function(e,t){var n;return void 0!==this.listeners[e]&&null!=this.listeners[e]||(this.listeners[e]=new Array),null===(n=this.listeners[e])||void 0===n||n.unshift(t),this},e.prototype.prependOnceListener=function(e,t){var n=this,i=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];n.off(e,i),t.apply(void 0,r)};return this.prependListener(e,i),this},e.prototype.events=function(){return{load:"Fire when the plugin is loaded",unload:"Fire when the plugin is unloaded",reconnect:"Fire when the plugin is reconnected",chat:"Fire whenever a message of type 'chat' is received",groupchat:"Fire whenever a message of type 'groupchat' is received","message:sent":"Fire when message sent","message:error":"Fire when error sending messages","message:failed":"Fire when message failed","message:acked":"Fire when message is acknowledged","message:retry":"Fire when message retried","message:hibernated":"Fire when message hibernated","message:acked:server":"Fire when message is acknowledged by the server","message:acked:peer":"Fire when message is acknowledged by a user","message:read":"Fire when receiving a conversation-read notification","message:viewed":"Fire when receiving a conversation-viewed notification","message:received":"Fire upon receiving a normal/chat/groupchat message","user:online":"Fire when the current user or a peer user is considered to be available","user:kicked":"Fire by the current user when it finds itself already been kicked by a group","user:lastseen":"Fire when receiving a user's last activity info after it is offline","user:block":"Fire when receiving a server push about users being blocked","user:unblock":"Fire when receiving a server push about users being unblocked","group:join":"Fire when the user of the current session joins a group chat","group:left":"Fire when the user of the current session has left a group chat","group:invite":"Fire when the user of the current session received a group invitation","group:kicked":"Fire by the group when the user of the current session is kicked from a group chat","group:title":"Fire when the group title is changed","group:avatar":"Fire when the group avatar is changed","group:leave":"Fire by the group when a member leaves","group:kick":"Fire by the group when a member is kicked","command:leaveGroup":"Fire when receiving a command of type 'leaveGroup'","command:updateGroup":"Fire when receiving a command of type 'updateGroup'","command:joinGroup":"Fire when receiving a command of type 'joinGroup'","webpush:avatar":"Fire when receiving web server push indicating a user's avatar needs to be refreshed","webpush:group":"Fire when receiving web server push indicating a group chat needs to reload","webpush:contact":"Fire when receiving web server push indicating the contact list must be refreshed","message:*":"Fire on all message events","user:*":"Fire on all user events","group:*":"Fire on all groupchat events","command:*":"Fire on all command events","webpush:*":"Fire on all webpush events"}},e}()},893:function(e,t,n){"use strict";n.r(t),n.d(t,{DeltapathXMPPHTTP:function(){return p}});var i=n(7029),r=n(3046),s=n(5910),o=n(9420),a=n(2456),c=function(){return c=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},c.apply(this,arguments)},l=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},u=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},p=function(){function e(){}return e.prototype.getGroupInfo=function(e){return l(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),t.label=1;case 1:return t.trys.push([1,4,,5]),[4,this.im.getGroupInfo(e)];case 2:return[4,t.sent().json()];case 3:return[2,t.sent()];case 4:throw t.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getGroupAvatar=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s;return u(this,(function(c){switch(c.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),c.label=1;case 1:return c.trys.push([1,4,,5]),[4,this.im.getGroupAvatar(e,t)];case 2:if(!(n=c.sent()).ok)throw n;return[4,n.blob()];case 3:return[2,{img:r=c.sent(),imgSrc:URL.createObjectURL(r)}];case 4:throw(s=c.sent())instanceof Response&&(0,o.throwResponse)(s),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.uploadAttachment=function(e){return l(this,void 0,void 0,(function(){var t,n,r,s,c;return u(this,(function(l){switch(l.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.im.uploadAttachment(e)];case 2:return(t=l.sent()).ok||(0,o.throwResponse)(t),[4,t.json()];case 3:return n=l.sent(),r=n.success,s=n.meta,(0,o.throwOnEmpty)(r,i.LANG.XMPP_MESSAGE_ATTACHMENT_FAILED_TO_UPLOAD),(0,o.throwOnEmpty)(s,i.LANG.XMPP_MESSAGE_ATTACHMENT_FAILED_TO_UPLOAD),s.thumbnail=!0===s.thumbnail?"1":"0",[2,s];case 4:if((c=l.sent())instanceof Error)throw c;throw new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getAttachmentThumbnail=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,c;return u(this,(function(l){switch(l.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="GET",r=new URL(this.deltapath.restUrl+"/v1/get/im/attachment/"+e+"/thumbnail"),this.deltapath.http.buildQueryParams(r,t),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:if(!(s=l.sent()).ok)throw s;return[4,s.blob()];case 3:return[2,l.sent()];case 4:throw(c=l.sent())instanceof Response&&(0,o.throwResponse)(c),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getAttachmentTextContentPreview=function(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n,r,o;return u(this,(function(c){switch(c.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="GET",r=new URL(this.deltapath.restUrl+"/v1/get/im/attachment/"+e+"/content"),c.label=1;case 1:return c.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:return[4,c.sent().json()];case 3:if("string"!=typeof(o=c.sent()).content)throw null;return[2,t?(0,s.htmlspecialchars_decode)(o.content):o.content];case 4:throw c.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getAttachmentBlob=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,l;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="GET",r=new URL(this.deltapath.restUrl+"/v1/get/im/attachment/"+e),t=c(c(c({},{filename:"",attachmentType:"0",download:"1",export:"0",audioformat:"mp3"}),t),{export:"0"}),this.deltapath.http.buildQueryParams(r,t),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:if(!(s=u.sent()).ok)throw s;return[4,s.blob()];case 3:return[2,u.sent()];case 4:throw(l=u.sent())instanceof Response&&(0,o.throwResponse)(l),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getAttachmentDiskPath=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s;return u(this,(function(o){switch(o.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="GET",r=new URL(this.deltapath.restUrl+"/v1/get/im/attachment/"+e),s={filename:t,attachmentType:"0",download:"1",export:"1",audioformat:"mp3"},this.deltapath.http.buildQueryParams(r,s),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:return[4,o.sent().json()];case 3:return[2,o.sent()];case 4:throw o.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.downloadAttachment=function(e,t,n){return l(this,void 0,void 0,(function(){var s,l,p,d;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),s="GET",l=new URL(this.deltapath.restUrl+"/v1/get/im/attachment/"+e),(t=c(c(c({},{filename:"",attachmentType:"0",download:"1",export:"0",audioformat:"mp3"}),t),{export:"0"})).filename||(t.filename=e+" - "+Date.now()),this.deltapath.http.buildQueryParams(l,t),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(l.href,{method:s})];case 2:if(!(p=u.sent()).ok)throw p;return[4,(0,r.downloadAndSaveFile)({defaultFileName:t.filename,response:p,onDownloadProgress:n})];case 3:return u.sent(),[3,5];case 4:throw(d=u.sent())instanceof Response&&(0,o.throwResponse)(d),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getUserAvatar=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,c,l;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="GET",r=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/avatar"),this.deltapath.http.buildQueryParams(r,t),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:if(!(s=u.sent()).ok)throw s;return[4,s.blob()];case 3:return[2,{img:c=u.sent(),imgSrc:URL.createObjectURL(c)}];case 4:throw(l=u.sent())instanceof Response&&(0,o.throwResponse)(l),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getUserContact=function(e,t,n,r,s,o,c){return void 0===s&&(s="1"),void 0===o&&(o="1"),l(this,void 0,void 0,(function(){var l,p,d;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),l="GET",p=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/contact"),this.deltapath.http.buildQueryParams(p,{start:t,limit:n,query:r,exactuser:s,me:o,domain:c}),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(p.href,{method:l})];case 2:return[4,u.sent().json()];case 3:if(!(d=u.sent()).list||null==d.count)throw null;return[2,{list:d.list,count:d.count}];case 4:throw u.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.removeGroupMember=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,c,l;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="POST",r=new URL(this.deltapath.restUrl+"/v2/delete/im/group/"+e+"/member/"+t),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:if(!(s=u.sent()).ok)throw s;return[4,s.json()];case 3:if(!(c=u.sent()).success||!c.group)throw null;return[2,c.group];case 4:throw(l=u.sent())instanceof Response&&(0,o.throwResponse)(l),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getGroupHistory=function(e,t,n){return l(this,void 0,void 0,(function(){var r,s,o,l=this;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="GET",s=new URL(this.deltapath.restUrl+"/v1/get/im/group/"+e+"/history"),this.deltapath.http.buildQueryParams(s,c(c({me:null!=n?n:this.deltapath.username},t),{format:i.IM.format})),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r})];case 2:return[4,u.sent().json()];case 3:if(!(o=u.sent()).success||null==o.fetchable||!o.history)throw null;return Object.values(o.history).forEach((function(e){e.pojo=l.im.rawMessageToReceivedMessage(l.im.xml2raw(l.client.stanzas,e.xml,e.fromJid,e.toJid)),e.time&&"XMPPMessage"===e.pojo.isa&&(e.pojo.time=parseInt(e.time))})),[2,{fetchable:o.fetchable,history:o.history}];case 4:throw u.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getUserHistory=function(e,t,n){return l(this,void 0,void 0,(function(){var r,s,o,l=this;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="GET",s=new URL(this.deltapath.restUrl+"/v2/get/im/user/"+e+"/history"),this.deltapath.http.buildQueryParams(s,c(c({target:t},n),{format:i.IM.format})),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r})];case 2:return[4,u.sent().json()];case 3:if(!(o=u.sent()).success||null==o.fetchable||!o.history)throw null;return Object.values(o.history).forEach((function(e){e.pojo=l.im.rawMessageToReceivedMessage(l.im.xml2raw(l.client.stanzas,e.xml,e.fromJid,e.toJid)),e.time&&"XMPPMessage"===e.pojo.isa&&(e.pojo.time=parseInt(e.time))})),[2,{fetchable:o.fetchable,history:o.history}];case 4:throw u.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getGroupSingleMessage=function(e,t,n){return l(this,void 0,void 0,(function(){var r,s,c;return u(this,(function(l){switch(l.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="GET",s=new URL(this.deltapath.restUrl+"/v1/get/im/group/"+e+"/message/"+t),this.deltapath.http.buildQueryParams(s,{me:null!=n?n:this.deltapath.username,format:i.IM.format}),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r})];case 2:return[4,l.sent().json()];case 3:if(!(c=l.sent()).success||!c.message||(0,o.isEmpty)(c.message))throw null;return c.message.pojo=this.im.rawMessageToReceivedMessage(this.im.xml2raw(this.client.stanzas,c.message.xml,c.message.fromJid,c.message.toJid)),c.message.time&&"XMPPMessage"===c.message.pojo.isa&&(c.message.pojo.time=parseInt(c.message.time)),[2,c.message];case 4:throw l.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getGroupMediaMonthList=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s;return u(this,(function(o){switch(o.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="GET",r=new URL(this.deltapath.restUrl+"/v1/get/im/group/"+e+"/media/month"),this.deltapath.http.buildQueryParams(r,{me:null!=t?t:this.deltapath.username,format:i.IM.format}),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:return[4,o.sent().json()];case 3:if(!(s=o.sent()).success||!s.list)throw null;return[2,s.list];case 4:throw o.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getGroupMedia=function(e,t,n){return l(this,void 0,void 0,(function(){var r,s,o;return u(this,(function(l){switch(l.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="GET",s=new URL(this.deltapath.restUrl+"/v1/get/im/group/"+e+"/media"),this.deltapath.http.buildQueryParams(s,c(c({me:null!=n?n:this.deltapath.username},t),{format:i.IM.format})),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r})];case 2:return[4,l.sent().json()];case 3:if(!(o=l.sent()).success||!o.media)throw null;return[2,o.media];case 4:throw l.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getUserMedia=function(e,t,n){return l(this,void 0,void 0,(function(){var r,s,o;return u(this,(function(l){switch(l.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="GET",s=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/media"),this.deltapath.http.buildQueryParams(s,c(c({target:t},n),{format:i.IM.format})),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r})];case 2:return[4,l.sent().json()];case 3:if(!(o=l.sent()).success||!o.media)throw null;return[2,o.media];case 4:throw l.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.createGroup=function(e,t,n){return l(this,void 0,void 0,(function(){var r,s,c,l,p,d,h;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="POST",s=new URL(this.deltapath.restUrl+"/v2/post/im/group/"),c=this.im.getGroupUniqueId(t),-1===n.indexOf(t)&&n.push(t),l=JSON.stringify({name:e,unique_id:c,owner:t,member:JSON.stringify(n)}),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r,body:l})];case 2:if(!(p=u.sent()).ok)throw p;return[4,p.json()];case 3:if(!(d=u.sent()).success||!d.group)throw null;return[2,d.group];case 4:throw(h=u.sent())instanceof Response&&(0,o.throwResponse)(h),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.addGroupMember=function(e,t,n){return void 0===n&&(n="member"),l(this,void 0,void 0,(function(){var r,s,c,l,p,d;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="POST",s=new URL(this.deltapath.restUrl+"/v2/post/im/group/"+e+"/member"),c=JSON.stringify({username:t,type:n}),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r,body:c})];case 2:if(!(l=u.sent()).ok)throw l;return[4,l.json()];case 3:if(!(p=u.sent()).success||!p.group)throw null;return[2,p.group];case 4:throw(d=u.sent())instanceof Response&&(0,o.throwResponse)(d),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.updateGroupAdmin=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,c,l;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="POST",r=new URL(this.deltapath.restUrl+"/v1/put/im/group/"+e+"/member/"+t),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:if(!(s=u.sent()).ok)throw s;return[4,s.json()];case 3:if(!(c=u.sent()).success||!c.group)throw null;return[2,c.group];case 4:throw(l=u.sent())instanceof Response&&(0,o.throwResponse)(l),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.updateGroupAvatar=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,c,l;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="POST",r=new FormData,s=new URL(this.deltapath.restUrl+"/v2/put/im/group/"+e+"/avatar"),r.append("change_avatar",t,t.name),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:n,body:r},!0)];case 2:if(!(c=u.sent()).ok)throw c;return[4,c.json()];case 3:if(!u.sent().success)throw null;return[3,5];case 4:throw(l=u.sent())instanceof Response&&(0,o.throwResponse)(l),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.updateGroupName=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,c,l,p;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="POST",r=new URL(this.deltapath.restUrl+"/v2/put/im/group/"+e+"/"),s=JSON.stringify({name:t}),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n,body:s})];case 2:if(!(c=u.sent()).ok)throw c;return[4,c.json()];case 3:if(!(l=u.sent()).success||!l.group)throw null;return[2,l.group];case 4:throw(p=u.sent())instanceof Response&&(0,o.throwResponse)(p),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.sendMessageHTTP=function(e,t,n,r,s){return l(this,void 0,void 0,(function(){var c,l,p,d,h;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),c="POST",l=new FormData,p=new URL(this.deltapath.restUrl+"/v1/post/im/message/send"),l.append("to",e),l.append("content",t),l.append("group",""+n),r&&l.append("reply_to",r),s&&l.append("attachment",s,s.name),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(p.href,{method:c,body:l},!0)];case 2:if(!(d=u.sent()).ok)throw d;return[4,d.json()];case 3:return[2,u.sent()];case 4:throw(h=u.sent())instanceof Response&&(0,o.throwResponse)(h),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getUserInfo=function(e){return l(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),t="GET",n=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/info"),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(n.href,{method:t})];case 2:return[4,r.sent().json()];case 3:return[2,r.sent()];case 4:throw r.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getUserMediaMonthList=function(e,t,n){return l(this,void 0,void 0,(function(){var r,s,o;return u(this,(function(c){switch(c.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="GET",s=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/media/month"),this.deltapath.http.buildQueryParams(s,{target:t,serverName:n,format:i.IM.format}),c.label=1;case 1:return c.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r})];case 2:return[4,c.sent().json()];case 3:if(!(o=c.sent()).success||!o.list)throw null;return[2,o.list];case 4:throw c.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getUserSingleMessage=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s;return u(this,(function(c){switch(c.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="GET",r=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/message/"+t),this.deltapath.http.buildQueryParams(r,{format:i.IM.format}),c.label=1;case 1:return c.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:return[4,c.sent().json()];case 3:if(!(s=c.sent()).success||!s.message||(0,o.isEmpty)(s.message))throw null;return s.message.pojo=this.im.rawMessageToReceivedMessage(this.im.xml2raw(this.client.stanzas,s.message.xml,s.message.fromJid,s.message.toJid)),s.message.time&&"XMPPMessage"===s.message.pojo.isa&&(s.message.pojo.time=parseInt(s.message.time)),[2,s.message];case 4:throw c.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getMessagesState=function(e,t,n){return l(this,void 0,void 0,(function(){var r,s,o;return u(this,(function(c){switch(c.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),r="GET",s=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/messages/state"),this.deltapath.http.buildQueryParams(s,{starttime:t,serverMapping:null==n?void 0:JSON.stringify(n),format:i.IM.format}),c.label=1;case 1:return c.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:r})];case 2:return[4,c.sent().json()];case 3:if(!(o=c.sent()).success)throw null;return[2,{chat:o.chat,groupchat:o.groupchat}];case 4:throw c.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getMessages=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,o,c=this;return u(this,(function(l){switch(l.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="GET",r=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/messages"),this.deltapath.http.buildQueryParams(r,{count:t,format:i.IM.format}),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(r.href,{method:n})];case 2:return[4,l.sent().json()];case 3:if(!(s=l.sent()).success)throw null;return o=function(e){e.pojo=c.im.rawMessageToReceivedMessage(c.im.xml2raw(c.client.stanzas,e.xml,e.fromJid,e.toJid)),e.time&&"XMPPMessage"===e.pojo.isa&&(e.pojo.time=parseInt(e.time))},s.chat&&Object.values(s.chat).forEach(o),s.groupchat&&Object.values(s.groupchat).forEach(o),[2,{chat:s.chat,groupchat:s.groupchat}];case 4:throw l.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.getUnreadMessages=function(e,t,n,r,s){return void 0===r&&(r=0),l(this,void 0,void 0,(function(){var o,c,l,p=this;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),o="GET",c=new URL(this.deltapath.restUrl+"/v2/get/im/user/"+e+"/unread"),this.deltapath.http.buildQueryParams(c,{starttime:t,msgId:n,groupchat:r,serverMapping:null==s?void 0:JSON.stringify(s),format:i.IM.format}),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(c.href,{method:o})];case 2:return[4,u.sent().json()];case 3:if(!(l=u.sent()).success)throw null;return l.messages&&Object.values(l.messages).forEach((function(e){e.pojo=p.im.rawMessageToReceivedMessage(p.im.xml2raw(p.client.stanzas,e.xml,e.fromJid,e.toJid)),e.time&&"XMPPMessage"===e.pojo.isa&&(e.pojo.time=parseInt(e.time))})),[2,{messages:l.messages,readstatus:l.readstatus}];case 4:throw u.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.searchMessage=function(e,t,n,r){return l(this,void 0,void 0,(function(){var s,o,c,l=this;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),s="GET",o=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/message/search"),this.deltapath.http.buildQueryParams(o,{start:t,limit:n,query:r,format:i.IM.format}),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(o.href,{method:s})];case 2:return[4,u.sent().json()];case 3:if(!(c=u.sent()).list||null==c.count)throw null;return Object.values(c.list).forEach((function(e){e.pojo=l.im.rawMessageToReceivedMessage(l.im.xml2raw(l.client.stanzas,e.xml,e.fromJid,e.toJid)),e.time&&"XMPPMessage"===e.pojo.isa&&(e.pojo.time=parseInt(e.time))})),[2,{list:c.list,count:c.count}];case 4:throw u.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.searchConversation=function(e,t,n,r){return l(this,void 0,void 0,(function(){var s,o,c;return u(this,(function(l){switch(l.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),s="GET",o=new URL(this.deltapath.restUrl+"/v1/get/im/user/"+e+"/conversation/search"),this.deltapath.http.buildQueryParams(o,{start:t,limit:n,query:r}),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(o.href,{method:s})];case 2:return[4,l.sent().json()];case 3:if(!(c=l.sent()).list||null==c.count)throw null;return[2,{list:c.list,count:c.count}];case 4:throw l.sent(),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e.prototype.refetchInitData=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,s,l=this;return u(this,(function(u){switch(u.label){case 0:return(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),[4,this.deltapath.http.fetch(this.deltapath.restUrl+"/im/user/"+this.deltapath.username+"/init",{method:"POST",body:JSON.stringify({contact:1,blocklist:1,nickname:1,linkedservers:1,remotegroups:1,format:i.IM.format})})];case 1:if(!(e=u.sent()).ok)throw new Error(i.LANG.XMPP_CLIENT_INIT_FAILED);return[4,e.json()];case 2:return t=u.sent(),(n=c({},t)).jid=c({},this.session.jid),n.session=c({},this.session),n.peerJid={},n.contact.forEach((function(e){n.peerJid[e.contact]=l.im.getPeerJIDFromContact(e),(0,o.isEmpty)(e.message)?e.message=null:(e.message.pojo=l.im.rawMessageToReceivedMessage(l.im.xml2raw(l.client.stanzas,e.message.xml,e.message.fromJid,e.message.toJid)),e.message.time&&"XMPPMessage"===e.message.pojo.isa&&(e.message.pojo.time=parseInt(e.message.time)))})),[4,this.client.getRoster()];case 3:return r=u.sent(),[4,this.client.getVCard(this.session.jid.bare)];case 4:return s=u.sent(),[2,c(c({},n),{roster:r,vcard:s})]}}))}))},e.prototype.updateUserAvatar=function(e,t){return l(this,void 0,void 0,(function(){var n,r,s,c,l;return u(this,(function(u){switch(u.label){case 0:(0,a.checkXMPPInitState)(this.deltapath,this.client,this.im,this.session),n="POST",r=new FormData,s=new URL(this.deltapath.restUrl+"/v1/put/im/user/"+e+"/avatar"),r.append("change_avatar",t,t.name),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.deltapath.http.fetch(s.href,{method:n,body:r},!0)];case 2:if(!(c=u.sent()).ok)throw c;return[4,c.json()];case 3:if(!u.sent().success)throw null;return[3,5];case 4:throw(l=u.sent())instanceof Response&&(0,o.throwResponse)(l),new Error(i.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 5:return[2]}}))}))},e}()},1867:function(e,t,n){"use strict";n.r(t),n.d(t,{DeltapathIM:function(){return p}});var i=n(1568),r=n(3322),s=n(1595),o=n(7029),a=n(9420),c=function(){return c=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},c.apply(this,arguments)},l=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},u=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},p=function(){function e(e){this.xmpp=e}return e.prototype.rawMessageToReceivedMessage=function(e,t){var n,r,s,p,d,h,f,m,g,y,v,b,_,w,S,x,T,E,I,N,k,A,O,j,C,R,P,L,M,F,D,q=this,U=!t,B=e,G=function(e){return delete(e=c({},e)).isa,e},J=B.from,z=B.to,X=B.type,$=B.group,V=B.receipt,H=B.command,W=B.outgoing,Q=B.attachment,K=B.location,Y=B.body,Z=B.id,ee=B.hasSubject,te=B.fromServerName,ne=B.viewConversation,ie=B.readConversation,re=B.replyTo,se=B.command,oe=void 0===se?{}:se,ae=oe.type,ce=oe.text,le=null===(r=null===(n=B.group)||void 0===n?void 0:n.jids)||void 0===r?void 0:r[0].finalTarget,ue=null===(s=B.group)||void 0===s?void 0:s.action,pe=(null===(p=B.group)||void 0===p?void 0:p.time)?B.group.time/1e3:void 0,de=null==$?void 0:$.toJid;null==J&&(J=""),null==z&&(z="");var he=J.split("/",3),fe=-1!==J.indexOf("@"+o.IM.conferencePrefix);3===he.length?(L=this.xmpp.parseJID(he[0]),M=this.xmpp.parseJID(he[1]+"/"+he[2])):fe?L=this.xmpp.parseJID(J):M=this.xmpp.parseJID(J),he=z.split("/",3),fe=-1!==z.indexOf("@"+o.IM.conferencePrefix),3===he.length?(F=this.xmpp.parseJID(he[0]),D=this.xmpp.parseJID(he[1]+"/"+he[2])):fe?F=this.xmpp.parseJID(z):D=this.xmpp.parseJID(z);var me=J,ge=z,ye={fromRawJID:me,toRawJID:ge,fromUser:M,fromGroup:L,toUser:D,toGroup:F,session:this.xmpp.session,msgId:Z,raw:e,isa:"XMPPOpaqueMessage"};if((null==W?void 0:W.length)&&(null==M?void 0:M.resource)&&(null===(d=this.xmpp.session)||void 0===d?void 0:d.jid.resource)&&M.resource===this.xmpp.session.jid.resource&&M.bare===this.xmpp.session.jid.bare)return ye;if(V&&"received"===V.type)return P={type:"receipt",category:"message",fromRawJID:me,toRawJID:ge,fromGroup:L,fromUser:M,toUser:D,toGroup:F,receiptFor:V.id,messageType:X,raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("serverAck"===(null==M?void 0:M.node)||"serverAck"===(null==L?void 0:L.node)?"message:acked:server":"message:acked:peer",G(P)),P;if("error"===X)return ye;if(ie&&ie.target&&ie.lastMsgId&&M&&M.bare!==(null===(h=this.xmpp.session)||void 0===h?void 0:h.jid.bare)&&!U&&this.xmpp.emit("message:read",c(c({type:"read",category:"message",fromRawJID:me,toRawJID:ge,fromGroup:L,fromUser:M,toUser:D,toGroup:F},ie),{raw:B})),ne&&ne.target&&ne.lastMsgId&&M&&M.bare===(null===(f=this.xmpp.session)||void 0===f?void 0:f.jid.bare)&&M.resource!==this.xmpp.session.jid.resource&&!U&&this.xmpp.emit("message:viewed",c(c({type:"viewed",category:"message",fromRawJID:me,toRawJID:ge,fromUser:M,toUser:D},ne),{raw:B})),"normal"===X&&("join"===ue||"invite"===ue||"left"===ue)&&(null==le?void 0:le.length)){var ve=this.stripLocalConfDomainFromJid(le);switch(ue){case"join":case"invite":if("invite"===ue&&!pe)return ye;null==t||t.sendPresence({from:null===(m=this.xmpp.session)||void 0===m?void 0:m.jid.full,to:le+"/"+(null===(g=this.xmpp.session)||void 0===g?void 0:g.jid.full),muc:{type:"join",history:{maxCharacters:0}}}),P={type:"invite"===ue?"invite":"join",category:"group",fromRawJID:me,toRawJID:ge,fromUser:M,toUser:D,groupUUID:ve,groupActionTime:pe,groupActionInitiator:null==M?void 0:M.bare,groupInfoRefreshRequired:!0,groupInfo:function(){return l(q,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.getGroupInfo(ve)];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()];case 3:throw e.sent(),new Error(o.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 4:return[2]}}))}))},raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("invite"===ue?"group:invite":"group:join",G(P));break;case"left":null==t||t.sendPresence({from:null===(y=this.xmpp.session)||void 0===y?void 0:y.jid.full,to:le+"/"+(null===(v=this.xmpp.session)||void 0===v?void 0:v.jid.full),type:"unavailable"}),P={type:"left",category:"group",fromRawJID:me,toRawJID:ge,fromUser:M,toUser:D,groupUUID:ve,groupActionTime:pe,groupActionInitiator:null==M?void 0:M.bare,raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("group:left",G(P))}return P}if("normal"===X&&"kicked"===ue&&de){var be=this.stripLocalConfDomainFromJid(de);return null==t||t.sendPresence({from:null===(b=this.xmpp.session)||void 0===b?void 0:b.jid.full,to:de,type:"unavailable"}),P={type:"kicked",category:"group",fromRawJID:me,toRawJID:ge,fromUser:M,toUser:D,groupUUID:be,groupActionInitiator:null==M?void 0:M.bare,raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("group:kicked",G(P)),P}if("groupchat"===X){if(M&&M.full===(null===(_=this.xmpp.session)||void 0===_?void 0:_.jid.full)&&!ue&&!H&&"request"!==(null==V?void 0:V.type))return ye;if(ee)return ye;if("title"===ue||"avatar"===ue||"invite"===ue||"leave"===ue){if(!pe){if("title"!==ue&&"avatar"!==ue)return ye;pe=Date.now()/1e3}var _e=this.stripLocalConfDomainFromJid((null==L?void 0:L.full)||"");if(!_e.length&&U&&(_e=this.stripLocalConfDomainFromJid((null==F?void 0:F.full)||"")),!_e.length)return ye;switch(ue){case"title":if(Y)return ye;P={type:"title",category:"group",fromRawJID:me,toRawJID:ge,toUser:D,toGroup:F,fromGroup:L,fromUser:M,fromServerName:te,groupUUID:_e,groupActionTime:pe,groupActionInitiator:null==M?void 0:M.bare,groupNewTitle:null==$?void 0:$.newTitle,raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("group:title",G(P));break;case"avatar":P={type:"avatar",category:"group",fromRawJID:me,toRawJID:ge,toUser:D,toGroup:F,fromGroup:L,fromUser:M,fromServerName:te,groupUUID:_e,groupActionTime:pe,groupActionInitiator:null==M?void 0:M.bare,groupNewAvatar:function(e){return void 0===e&&(e={minPixel:36,default:"1"}),l(q,void 0,void 0,(function(){var t,n,i;return u(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this.getGroupAvatar(_e,e)];case 1:if(!(t=r.sent()).ok)throw t;return[4,t.blob()];case 2:return[2,{img:n=r.sent(),imgSrc:URL.createObjectURL(n)}];case 3:throw(i=r.sent())instanceof Response&&(0,a.throwResponse)(i),new Error(o.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 4:return[2]}}))}))},raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("group:avatar",G(P));break;case"invite":P={type:"invite",category:"group",fromRawJID:me,toRawJID:ge,toUser:D,toGroup:F,fromGroup:L,fromUser:M,fromServerName:te,groupUUID:_e,groupActionTime:pe,groupActionInitiator:null==M?void 0:M.bare,groupCreator:null==$?void 0:$.creator,groupInvitees:null==$?void 0:$.jids,groupInfoRefreshRequired:!0,groupInfo:function(){return l(q,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.getGroupInfo(_e)];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()];case 3:throw e.sent(),new Error(o.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 4:return[2]}}))}))},raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("group:invite",G(P));break;case"leave":(null==M?void 0:M.bare)===(null===(w=this.xmpp.session)||void 0===w?void 0:w.jid.bare)||te&&(null==M?void 0:M.node)+"@"+te===(null===(S=this.xmpp.session)||void 0===S?void 0:S.username)?(null==t||t.sendPresence({from:null===(x=this.xmpp.session)||void 0===x?void 0:x.jid.full,to:(null==L?void 0:L.full)+"/"+(null===(T=this.xmpp.session)||void 0===T?void 0:T.jid.full),type:"unavailable"}),P={type:"leave",category:"group",fromRawJID:me,toRawJID:ge,toUser:D,toGroup:F,fromGroup:L,fromUser:M,fromServerName:te,groupUUID:_e,groupActionTime:pe,groupActionInitiator:null==M?void 0:M.bare,raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("group:leave",G(P))):(P={type:"leave",category:"group",fromRawJID:me,toRawJID:ge,toUser:D,toGroup:F,fromGroup:L,fromUser:M,fromServerName:te,groupUUID:_e,groupActionTime:pe,groupActionInitiator:null==M?void 0:M.bare,groupInfoRefreshRequired:!0,groupInfo:function(){return l(q,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.getGroupInfo(_e)];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()];case 3:throw e.sent(),new Error(o.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 4:return[2]}}))}))},raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("group:leave",G(P)))}return P}}if("request"===(null==V?void 0:V.type)&&(null==t||t.sendMessage({from:null===(E=this.xmpp.session)||void 0===E?void 0:E.jid.full,to:i.G6.toBare(J),type:"groupchat"===X?"groupchat":"normal",id:this.getMessageUniqueId(),receipt:{type:"received",id:Z}})),H&&i.G6.toBare(J)){var we=null===(I=this.xmpp.session)||void 0===I?void 0:I.conferenceDomain,Se=this.stripLocalConfDomainFromJid(ce||"");switch(ae){case"leaveGroup":null==t||t.sendPresence({from:null===(N=this.xmpp.session)||void 0===N?void 0:N.jid.full,to:ce+"@"+we+"/"+(null===(k=this.xmpp.session)||void 0===k?void 0:k.jid.full),type:"unavailable"}),P={type:"leaveGroup",category:"command",fromRawJID:me,toRawJID:ge,fromGroup:L,fromUser:M,toUser:D,toGroup:F,groupUUID:Se,raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("command:leaveGroup",G(P));break;case"updateGroup":Se=this.stripLocalConfDomainFromJid(i.G6.toBare(J)||"");case"joinGroup":"joinGroup"===ae&&(Se=ce||"",null==t||t.sendPresence({from:null===(A=this.xmpp.session)||void 0===A?void 0:A.jid.full,to:Se+"@"+we+"/"+(null===(O=this.xmpp.session)||void 0===O?void 0:O.jid.full),muc:{type:"join",history:{maxCharacters:0}}})),P={type:ae,category:"command",fromRawJID:me,toRawJID:ge,fromGroup:L,fromUser:M,toUser:D,toGroup:F,groupUUID:Se,groupInfoRefreshRequired:!0,groupInfo:function(){return l(q,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.getGroupInfo(Se)];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()];case 3:throw e.sent(),new Error(o.LANG.XMPP_FAILED_TO_FETCH_REMOTE_DATA);case 4:return[2]}}))}))},raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("command:"+ae,G(P))}return P||ye}if("kick"===ue)return P={type:"kick",category:"group",fromRawJID:me,toRawJID:ge,toUser:D,toGroup:F,fromGroup:L,fromUser:M,fromServerName:null==$?void 0:$.serverName,groupUUID:this.stripLocalConfDomainFromJid(i.G6.toBare(J)),groupActionInitiator:null==M?void 0:M.bare,groupLeaver:null==$?void 0:$.finalTarget,raw:B,isa:"XMPPNotification"},!U&&this.xmpp.emit("group:kick",G(P)),P;var xe="incoming";(W&&i.G6.toBare(z)===(null===(j=this.xmpp.session)||void 0===j?void 0:j.jid.bare)||(null==M?void 0:M.bare)===(null===(C=this.xmpp.session)||void 0===C?void 0:C.jid.bare))&&(xe="outgoing");var Te,Ee="emojitext";if(Q)Ee=Q.thumbnail?"img":"file",Te=c(c({},Q),{caption:Y,domain:(null==M?void 0:M.domain)!==(null===(R=this.xmpp.session)||void 0===R?void 0:R.jid.domain)?null==M?void 0:M.domain:void 0});else if(K)Ee="location",Te=c(c({},K),{caption:Y});else{if(!Y)return ye;Te=Y}var Ie={type:Ee,fromRawJID:me,toRawJID:ge,fromUser:M,fromGroup:L,toUser:D,toGroup:F,direction:xe,data:Te,time:Date.now()/1e3,session:this.xmpp.session,msgId:Z,replyMsgId:re,raw:B,isa:"XMPPMessage"};return!U&&this.xmpp.emit("message:received",G(Ie)),Ie},e.prototype.forkEventDispatcher=function(){var e=this;this.pid=this.xmpp.deltapath.ws.pipeOn((function(t){var n;try{n=JSON.parse(t.data)}catch(e){return}if("reload"===("string"==typeof n.clientCmd?n.clientCmd:"")){var i=n;switch(i.type){case"Avatar":e.xmpp.emit("webpush:avatar",{type:"avatar",category:"webpush",data:i.data});break;case"Phonebook":e.xmpp.emit("webpush:contact",{type:"contact",category:"webpush",data:i.data});break;case"remoteServerGroupchat":case"updateGroup":e.xmpp.emit("webpush:group",{type:"group",category:"webpush",data:i.data})}}}))},e.prototype.unforkEventDispatcher=function(){null!=this.pid&&this.xmpp.deltapath.ws.pipeOff(this.pid),delete this.pid},e.prototype.attachTo=function(e,t){var n=this;switch(e){case"message":t.on("message",(function(e){return n.onMessage(e,t)}));break;case"presence":t.on("presence",(function(e){return n.onPresence(e,t)}));break;case"iq":t.on("iq",(function(e){return n.onIq(e,t)}))}},e.prototype.onMessage=function(e,t){this.rawMessageToReceivedMessage(e,t)},e.prototype.onPresence=function(e,t){var n,i,s,a,p,d,h,f=this,m=e,g=m.to,y=m.from,v=m.type,b=m.muc,_=(void 0===b?{}:b).statusCodes,w=y.split("/",3),S=-1!==y.indexOf("@"+o.IM.conferencePrefix);3===w.length?(a=this.xmpp.parseJID(w[0]),p=this.xmpp.parseJID(w[1]+"/"+w[2])):S?a=this.xmpp.parseJID(y):p=this.xmpp.parseJID(y),w=g.split("/",3),S=-1!==g.indexOf("@"+o.IM.conferencePrefix),3===w.length?(d=this.xmpp.parseJID(w[0]),h=this.xmpp.parseJID(w[1]+"/"+w[2])):S?d=this.xmpp.parseJID(g):h=this.xmpp.parseJID(g);var x=y,T=g,E=(null==a?void 0:a.full)||(null==p?void 0:p.bare),I=!1,N=!1,k=null==v,A="unavailable"===v,O="subscribed"===v;if("subscribe"===v)t.sendPresence({from:null===(n=this.xmpp.session)||void 0===n?void 0:n.jid.full,to:E,type:"subscribed",id:this.getMessageUniqueId()});else if(O)this.xmpp.emit("user:online",{type:"online",category:"user",fromRawJID:x,toRawJID:T,fromGroup:a,fromUser:p,toGroup:d,toUser:h,selfPresence:!1,raw:e});else if(null==_||_.forEach((function(e){switch(e){case r.MUCStatusCode.SelfPresence:I=!0;break;case r.MUCStatusCode.NickChanged:N=!0,I=!0}})),I||(null==p?void 0:p.full)!==(null===(i=this.xmpp.session)||void 0===i?void 0:i.jid.full)||(I=!0),I||(null==p?void 0:p.bare)!==(null===(s=this.xmpp.session)||void 0===s?void 0:s.jid.bare)){var j=this.stripLocalConfDomainFromJid((null==a?void 0:a.full)||"");I?k?this.xmpp.emit("user:online",{type:"online",category:"user",fromRawJID:x,toRawJID:T,fromGroup:a,fromUser:p,toGroup:d,toUser:h,selfPresence:!0,raw:e}):A&&!N&&j.length&&this.xmpp.emit("user:kicked",{type:"kicked",category:"user",fromRawJID:x,toRawJID:T,fromGroup:a,fromUser:p,toGroup:d,toUser:h,groupUUID:j,selfPresence:!0,raw:e}):k?this.xmpp.emit("user:online",{type:"online",category:"user",fromRawJID:x,toRawJID:T,fromGroup:a,fromUser:p,toGroup:d,toUser:h,selfPresence:!1,raw:e}):A&&l(f,void 0,void 0,(function(){var n,i,r;return u(this,(function(s){switch(s.label){case 0:return[4,t.sendIQ({from:null===(r=this.xmpp.session)||void 0===r?void 0:r.jid.full,to:E,type:"get",lastActivity:{},id:this.getMessageUniqueId()})];case 1:return n=s.sent(),void 0!==(i=n.lastActivity).seconds&&this.xmpp.emit("user:lastseen",{type:"lastseen",category:"user",fromRawJID:x,toRawJID:T,fromGroup:a,fromUser:p,toGroup:d,toUser:h,selfPresence:!1,userLastSeen:i.seconds,userLastStatus:i.status,raw:c(c({},e),{lastActivity:i})}),[2]}}))}))}},e.prototype.onIq=function(e,t){var n,i,r,a,c,l=e.to,u=e.from,p=e.type,d=e.id;if("result"!==p&&"error"!==p){var h,f,m=u.split("/",3),g=-1!==u.indexOf("@"+o.IM.conferencePrefix);if(3!==m.length&&!g&&(h=this.xmpp.parseJID(u),m=l.split("/",3),g=-1!==l.indexOf("@"+o.IM.conferencePrefix),3!==m.length&&!g)){f=this.xmpp.parseJID(l);var y=u,v=l;switch(p){case"set":"block"===(null===(n=e.blockList)||void 0===n?void 0:n.action)?this.xmpp.emit("user:block",{type:"block",category:"user",fromRawJID:y,toRawJID:v,fromUser:h,toUser:f,blockedUsers:e.blockList.jids,raw:e}):"unblock"===(null===(i=e.blockList)||void 0===i?void 0:i.action)&&this.xmpp.emit("user:unblock",{type:"unblock",category:"user",fromRawJID:y,toRawJID:v,fromUser:h,toUser:f,unblockedUsers:e.blockList.jids,raw:e});break;case"get":e.ping&&t.sendIQ({from:null===(r=this.xmpp.session)||void 0===r?void 0:r.jid.full,to:u,type:"result",id:d}),e.vcard&&t.sendIQ({from:null===(a=this.xmpp.session)||void 0===a?void 0:a.jid.full,to:u,type:"result",vcard:{records:[{type:"jid",value:(null===(c=this.xmpp.session)||void 0===c?void 0:c.jid.full)||""},{type:"description",value:s.NS_CLIENT}]}})}}}},e.prototype.xml2rawWithTemplate=function(e,t,n){var i=this.xml2raw(e,t);return c(c({},n),i)},e.prototype.xml2raw=function(e,t,n,r){var c=i.Ku.parse(t);c.getAttribute("xmlns")||c.setAttribute("xmlns",s.NS_CLIENT),!c.getAttribute("from")&&n&&c.setAttribute("from",n),!c.getAttribute("to")&&r&&c.setAttribute("to",r);var l=e.import(c);return(0,a.throwOnNull)(l,o.LANG.XMPP_FAILED_TO_DECODE),l},e.prototype.raw2xml=function(e,t){var n=e.export("message",t);return(0,a.throwOnNull)(n,o.LANG.XMPP_FAILED_TO_ENCODE),n.toString()},e.prototype.getMessageUniqueId=function(){var e;return((null===(e=this.xmpp.session)||void 0===e?void 0:e.jid.resource)||"")+"-"+this.getRandomString(8,!1)},e.prototype.getGroupUniqueId=function(e){var t=function(e){return e<10?"0"+e:""+e},n=new Date;return e+"_"+(n.getFullYear().toString()+t(n.getMonth()+1)+t(n.getDate())+t(n.getHours())+t(n.getMinutes())+t(n.getSeconds()))+"_"+Math.floor(1e3+9e3*Math.random())},e.prototype.getRandomString=function(e,t){var n;n=t?"0123456789":"0123456789abcdefghiklmnopqrstuvwxyz";for(var i=e,r="",s=0;s<i;s++){var o=Math.floor(Math.random()*n.length);r+=n.substring(o,o+1)}return t||(r+="-",r+=(new Date).getTime()),r},e.prototype.stripLocalConfDomainFromJid=function(e){var t,n=e.indexOf("@"+(null===(t=this.xmpp.session)||void 0===t?void 0:t.conferenceDomain));return n>=0?e.substring(0,n):e},e.prototype.getPeerJIDFromContact=function(e){var t,n;return""===e.serverName?e.groupchat?e.contact+"@"+(null===(t=this.xmpp.session)||void 0===t?void 0:t.conferenceDomain):e.contact+"@"+(null===(n=this.xmpp.session)||void 0===n?void 0:n.domain):e.contact+"@"+e.domain},e.prototype.getGroupInfo=function(e,t){return l(this,void 0,void 0,(function(){var n;return u(this,(function(i){switch(i.label){case 0:return"GET",n=new URL(this.xmpp.deltapath.restUrl+"/v1/get/im/group/"+e+"/"),this.xmpp.deltapath.http.buildQueryParams(n,t),[4,this.xmpp.deltapath.http.fetch(n.href,{method:"GET"})];case 1:return[2,i.sent()]}}))}))},e.prototype.getGroupAvatar=function(e,t){return l(this,void 0,void 0,(function(){var n;return u(this,(function(i){switch(i.label){case 0:return"GET",n=new URL(this.xmpp.deltapath.restUrl+"/v1/get/im/group/"+e+"/avatar"),this.xmpp.deltapath.http.buildQueryParams(n,t),[4,this.xmpp.deltapath.http.fetch(n.href,{method:"GET"})];case 1:return[2,i.sent()]}}))}))},e.prototype.uploadAttachment=function(e){return l(this,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return"POST",(t=new FormData).append("attachment",e,e.name),[4,this.xmpp.deltapath.http.fetch(this.xmpp.deltapath.restUrl+"/v1/post/im/attachment/",{method:"POST",body:t},!0)];case 1:return[2,n.sent()]}}))}))},e}()},2918:function(e,t,n){"use strict";n.r(t),n.d(t,{checkXMPPInitState:function(){return s}});var i=n(7029),r=n(9420);function s(e,t,n,s){(0,r.throwOnNull)(e,i.LANG.XMPP_CLIENT_NOT_INITIALIZED),(0,r.throwOnNull)(t,i.LANG.XMPP_CLIENT_NOT_INITIALIZED),(0,r.throwOnNull)(n,i.LANG.XMPP_CLIENT_NOT_INITIALIZED),(0,r.throwOnEmpty)(s,i.LANG.XMPP_SESSION_NOT_INITIALIZED)}},2593:function(e,t,n){"use strict";n.r(t),n.d(t,{downloadFile:function(){return o},downloadAndSaveFile:function(){return a},sleep:function(){return c}});var i=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))},r=function(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},s=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};function o(e){var t;return i(this,void 0,void 0,(function(){var n,i,s,o,a,l,u,p,d,h,f,m,g,y;return r(this,(function(r){switch(r.label){case 0:if(n=e.response,i=e.onDownloadProgress,!n.ok||!n.body)throw n;s=n.body.getReader(),o=Number(n.headers.get("Content-Length")),a=0,l=0,u=[],r.label=1;case 1:return 2===l?[3,6]:l?[3,3]:[4,s.read()];case 2:return p=r.sent(),d=p.done,h=p.value,d?[3,6]:(h&&(u.push(h),a+=h.length),[3,5]);case 3:return[4,c(50)];case 4:r.sent(),r.label=5;case 5:return void 0!==i&&(l=i(a,o)),[3,1];case 6:return 2===l?[2,!1]:(f=null===(t=n.headers.get("content-type"))||void 0===t?void 0:t.split(";")[0],m=new Blob(u,{type:f}),g=n.headers.get("content-disposition"),y=function(e){var t,n,i=/filename=(["']?)(.+)\1/i,r=/filename=([^"'][^;"'\n]+)/i;return i.test(e)?null===(t=e.match(i))||void 0===t?void 0:t[2]:r.test(e)?null===(n=e.match(r))||void 0===n?void 0:n[1]:void 0}(null!=g?g:""),[2,{fileName:y,blob:m}])}}))}))}function a(e){return i(this,void 0,void 0,(function(){var t,n,i,a;return r(this,(function(r){switch(r.label){case 0:return t=e.defaultFileName,[4,o(s(e,["defaultFileName"]))];case 1:return!1===(n=r.sent())||(i=n.fileName,a=n.blob,function(e,t){if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t);else{var n=window.URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=e,i.click(),setTimeout((function(){window.URL.revokeObjectURL(n)}),250)}}(null!=i?i:t,a)),[2]}}))}))}function c(e){return new Promise((function(t){return setTimeout(t,e)}))}},9049:function(e,t,n){"use strict";function i(e){var t,n,i,r,s,o,a,c,l,u=function(e,t){return e<<t|e>>>32-t},p=function(e,t){var n,i,r,s,o;return r=2147483648&e,s=2147483648&t,o=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(i=1073741824&t)?2147483648^o^r^s:n|i?1073741824&o?3221225472^o^r^s:1073741824^o^r^s:o^r^s},d=function(e,t,n,i,r,s,o){return e=p(e,p(p(function(e,t,n){return e&t|~e&n}(t,n,i),r),o)),p(u(e,s),t)},h=function(e,t,n,i,r,s,o){return e=p(e,p(p(function(e,t,n){return e&n|t&~n}(t,n,i),r),o)),p(u(e,s),t)},f=function(e,t,n,i,r,s,o){return e=p(e,p(p(function(e,t,n){return e^t^n}(t,n,i),r),o)),p(u(e,s),t)},m=function(e,t,n,i,r,s,o){return e=p(e,p(p(function(e,t,n){return t^(e|~n)}(t,n,i),r),o)),p(u(e,s),t)},g=function(e){var t,n="",i="";for(t=0;t<=3;t++)n+=(i="0"+(e>>>8*t&255).toString(16)).substr(i.length-2,2);return n},y=Array();for(y=function(e){for(var t,n=e.length,i=n+8,r=16*((i-i%64)/64+1),s=Array(r-1),o=0,a=0;a<n;)o=a%4*8,s[t=(a-a%4)/4]=s[t]|e.charCodeAt(a)<<o,a++;return o=a%4*8,s[t=(a-a%4)/4]=s[t]|128<<o,s[r-2]=n<<3,s[r-1]=n>>>29,s}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}(e)),o=1732584193,a=4023233417,c=2562383102,l=271733878,t=0;t<y.length;t+=16)n=o,i=a,r=c,s=l,o=d(o,a,c,l,y[t+0],7,3614090360),l=d(l,o,a,c,y[t+1],12,3905402710),c=d(c,l,o,a,y[t+2],17,606105819),a=d(a,c,l,o,y[t+3],22,3250441966),o=d(o,a,c,l,y[t+4],7,4118548399),l=d(l,o,a,c,y[t+5],12,1200080426),c=d(c,l,o,a,y[t+6],17,2821735955),a=d(a,c,l,o,y[t+7],22,4249261313),o=d(o,a,c,l,y[t+8],7,1770035416),l=d(l,o,a,c,y[t+9],12,2336552879),c=d(c,l,o,a,y[t+10],17,4294925233),a=d(a,c,l,o,y[t+11],22,2304563134),o=d(o,a,c,l,y[t+12],7,1804603682),l=d(l,o,a,c,y[t+13],12,4254626195),c=d(c,l,o,a,y[t+14],17,2792965006),o=h(o,a=d(a,c,l,o,y[t+15],22,1236535329),c,l,y[t+1],5,4129170786),l=h(l,o,a,c,y[t+6],9,3225465664),c=h(c,l,o,a,y[t+11],14,643717713),a=h(a,c,l,o,y[t+0],20,3921069994),o=h(o,a,c,l,y[t+5],5,3593408605),l=h(l,o,a,c,y[t+10],9,38016083),c=h(c,l,o,a,y[t+15],14,3634488961),a=h(a,c,l,o,y[t+4],20,3889429448),o=h(o,a,c,l,y[t+9],5,568446438),l=h(l,o,a,c,y[t+14],9,3275163606),c=h(c,l,o,a,y[t+3],14,4107603335),a=h(a,c,l,o,y[t+8],20,1163531501),o=h(o,a,c,l,y[t+13],5,2850285829),l=h(l,o,a,c,y[t+2],9,4243563512),c=h(c,l,o,a,y[t+7],14,1735328473),o=f(o,a=h(a,c,l,o,y[t+12],20,2368359562),c,l,y[t+5],4,4294588738),l=f(l,o,a,c,y[t+8],11,2272392833),c=f(c,l,o,a,y[t+11],16,1839030562),a=f(a,c,l,o,y[t+14],23,4259657740),o=f(o,a,c,l,y[t+1],4,2763975236),l=f(l,o,a,c,y[t+4],11,1272893353),c=f(c,l,o,a,y[t+7],16,4139469664),a=f(a,c,l,o,y[t+10],23,3200236656),o=f(o,a,c,l,y[t+13],4,681279174),l=f(l,o,a,c,y[t+0],11,3936430074),c=f(c,l,o,a,y[t+3],16,3572445317),a=f(a,c,l,o,y[t+6],23,76029189),o=f(o,a,c,l,y[t+9],4,3654602809),l=f(l,o,a,c,y[t+12],11,3873151461),c=f(c,l,o,a,y[t+15],16,530742520),o=m(o,a=f(a,c,l,o,y[t+2],23,3299628645),c,l,y[t+0],6,4096336452),l=m(l,o,a,c,y[t+7],10,1126891415),c=m(c,l,o,a,y[t+14],15,2878612391),a=m(a,c,l,o,y[t+5],21,4237533241),o=m(o,a,c,l,y[t+12],6,1700485571),l=m(l,o,a,c,y[t+3],10,2399980690),c=m(c,l,o,a,y[t+10],15,4293915773),a=m(a,c,l,o,y[t+1],21,2240044497),o=m(o,a,c,l,y[t+8],6,1873313359),l=m(l,o,a,c,y[t+15],10,4264355552),c=m(c,l,o,a,y[t+6],15,2734768916),a=m(a,c,l,o,y[t+13],21,1309151649),o=m(o,a,c,l,y[t+4],6,4149444226),l=m(l,o,a,c,y[t+11],10,3174756917),c=m(c,l,o,a,y[t+2],15,718787259),a=m(a,c,l,o,y[t+9],21,3951481745),o=p(o,n),a=p(a,i),c=p(c,r),l=p(l,s);return(g(o)+g(a)+g(c)+g(l)).toLowerCase()}n.r(t),n.d(t,{md5:function(){return i}})},696:function(e,t,n){"use strict";function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(e,t){return Object.getOwnPropertyNames(t.prototype).forEach((function(n){Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.getOwnPropertyDescriptor(e.prototype,n)||Object.create(null))})),e};return e.reduce(n)}n.r(t),n.d(t,{Mixin:function(){return i}})},239:function(e,t,n){"use strict";function i(e,t){var n=0,i=0,r=!1;void 0===t&&(t=2),e=e.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var s={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===t&&(r=!0),"number"!=typeof t){for(t=[].concat(t),i=0;i<t.length;i++)0===s[t[i]]?r=!0:s[t[i]]&&(n|=s[t[i]]);t=n}return t&s.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/&#0*39;/g,"'")),r||(e=e.replace(/&quot;/g,'"')),e=e.replace(/&amp;/g,"&")}n.r(t),n.d(t,{htmlspecialchars_decode:function(){return i}})},1192:function(e,t,n){"use strict";function i(e,t){if(void 0===e||null==e)throw new Error(t)}function r(e,t){switch(!0){case!e:case e==={}:case Array.isArray(e)&&!e.length:case e&&0===Object.keys(e).length&&e.constructor===Object:throw new Error(t)}}function s(e,t){switch(!0){case"string"==typeof e&&("0"===e.trim()||!e.trim()):case"number"==typeof e&&0===e:case void 0===e||null==e:throw new Error(t)}}function o(e){var t=new Error("HTTP status code: "+e.status+". This Error instance contains a HTTP Response object, check the 'response' property on it for more details.");throw t.response=e,t.status=e.status,t}function a(e){try{return r(e,""),!1}catch(e){return!0}}n.r(t),n.d(t,{throwOnNull:function(){return i},throwOnEmpty:function(){return r},throwOnZeroish:function(){return s},throwResponse:function(){return o},isEmpty:function(){return a}})},655:function(e,t,n){"use strict";n.r(t),n.d(t,{__extends:function(){return r},__assign:function(){return s},__rest:function(){return o},__decorate:function(){return a},__param:function(){return c},__metadata:function(){return l},__awaiter:function(){return u},__generator:function(){return p},__createBinding:function(){return d},__exportStar:function(){return h},__values:function(){return f},__read:function(){return m},__spread:function(){return g},__spreadArrays:function(){return y},__spreadArray:function(){return v},__await:function(){return b},__asyncGenerator:function(){return _},__asyncDelegator:function(){return w},__asyncValues:function(){return S},__makeTemplateObject:function(){return x},__importStar:function(){return E},__importDefault:function(){return I},__classPrivateFieldGet:function(){return N},__classPrivateFieldSet:function(){return k}});var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};function o(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}function a(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}function c(e,t){return function(n,i){t(n,i,e)}}function l(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))}function p(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var d=Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]};function h(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||d(t,e,n)}function f(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function g(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e}function y(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,r++)i[r]=s[o];return i}function v(e,t,n){if(n||2===arguments.length)for(var i,r=0,s=t.length;r<s;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function _(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){r[e]&&(i[e]=function(t){return new Promise((function(n,i){s.push([e,t,n,i])>1||a(e,t)}))})}function a(e,t){try{(n=r[e](t)).value instanceof b?Promise.resolve(n.value.v).then(c,l):u(s[0][2],n)}catch(e){u(s[0][3],e)}var n}function c(e){a("next",e)}function l(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function w(e){var t,n;return t={},i("next"),i("throw",(function(e){throw e})),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,r){t[i]=e[i]?function(t){return(n=!n)?{value:b(e[i](t)),done:"return"===i}:r?r(t):t}:r}}function S(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=f(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){(function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)})(i,r,(t=e[n](t)).done,t.value)}))}}}function x(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var T=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&d(t,e,n);return T(t,e),t}function I(e){return e&&e.__esModule?e:{default:e}}function N(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)}function k(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n}},4927:function(e,t,n){function i(e){try{if(!n.g.localStorage)return!1}catch(e){return!1}var t=n.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},2361:function(){},4616:function(){}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};n(8949)}();